var cr={};cr.plugins_={};cr.behaviors={};if(typeof Object.getPrototypeOf!=="\x66\x75\x6E\x63\x74\x69\x6F\x6E"){if(typeof "\x74\x65\x73\x74".__proto__==="\x6F\x62\x6A\x65\x63\x74"){Object.getPrototypeOf=function(object){return object.__proto__}}else{Object.getPrototypeOf=function(object){return object.constructor.prototype}}};(function(){cr.logexport=function(msg){if(window.console&&window.console.log){window.console.log(msg)}};cr.logerror=function(msg){if(window.console&&window.console.error){window.console.error(msg)}};cr.seal=function(x){return x};cr.freeze=function(x){return x};cr.is_undefined=function(x){return typeof x==="\x75\x6E\x64\x65\x66\x69\x6E\x65\x64"};cr.is_number=function(x){return typeof x==="\x6E\x75\x6D\x62\x65\x72"};cr.is_string=function(x){return typeof x==="\x73\x74\x72\x69\x6E\x67"};cr.isPOT=function(x){return x>0&&((x-1)&x)===0};cr.nextHighestPowerOfTwo=function(x){--x;for(var i=1;i<32;i<<=1){x=x|x>>i};return x+1};cr.abs=function(x){return(x<0?-x:x)};cr.max=function(a,b){return(a>b?a:b)};cr.min=function(a,b){return(a<b?a:b)};cr.PI=Math.PI;cr.round=function(x){return(x+0.5)|0};cr.floor=function(x){if(x>=0){return x|0}else{return(x|0)-1}};cr.ceil=function(x){var f=x|0;return(f===x?f:f+1)};function Vector2(x,y){this.x=x;this.y=y;cr.seal(this)}Vector2.prototype.offset=function(px,py){this.x+=px;this.y+=py;return this};Vector2.prototype.mul=function(px,py){this.x*=px;this.y*=py;return this};cr.vector2=Vector2;cr.segments_intersect=function(a1x,a1y,a2x,a2y,b1x,b1y,b2x,b2y){var max_ax,min_ax,max_ay,min_ay,max_bx,min_bx,max_by,min_by;if(a1x<a2x){min_ax=a1x;max_ax=a2x}else{min_ax=a2x;max_ax=a1x};if(b1x<b2x){min_bx=b1x;max_bx=b2x}else{min_bx=b2x;max_bx=b1x};if(max_ax<min_bx||min_ax>max_bx){return false};if(a1y<a2y){min_ay=a1y;max_ay=a2y}else{min_ay=a2y;max_ay=a1y};if(b1y<b2y){min_by=b1y;max_by=b2y}else{min_by=b2y;max_by=b1y};if(max_ay<min_by||min_ay>max_by){return false};var dpx=b1x-a1x+b2x-a2x;var dpy=b1y-a1y+b2y-a2y;var qax=a2x-a1x;var qay=a2y-a1y;var qbx=b2x-b1x;var qby=b2y-b1y;var d=cr.abs(qay*qbx-qby*qax);var la=qbx*dpy-qby*dpx;if(cr.abs(la)>d){return false};var lb=qax*dpy-qay*dpx;return cr.abs(lb)<=d};function Rect(left,top,right,bottom){this["\x73\x65\x74"](left,top,right,bottom);cr.seal(this)}Rect.prototype["\x73\x65\x74"]=function(left,top,right,bottom){this.left=left;this.top=top;this.right=right;this.bottom=bottom};Rect.prototype.copy=function(r){this.left=r.left;this.top=r.top;this.right=r.right;this.bottom=r.bottom};Rect.prototype.width=function(){return this.right-this.left};Rect.prototype.height=function(){return this.bottom-this.top};Rect.prototype.offset=function(px,py){this.left+=px;this.top+=py;this.right+=px;this.bottom+=py;return this};Rect.prototype.normalize=function(){var temp=0;if(this.left>this.right){temp=this.left;this.left=this.right;this.right=temp};if(this.top>this.bottom){temp=this.top;this.top=this.bottom;this.bottom=temp}};Rect.prototype.intersects_rect=function(rc){return!(rc.right<this.left||rc.bottom<this.top||rc.left>this.right||rc.top>this.bottom)};Rect.prototype.intersects_rect_off=function(rc,ox,oy){return!(rc.right+ox<this.left||rc.bottom+oy<this.top||rc.left+ox>this.right||rc.top+oy>this.bottom)};Rect.prototype.contains_pt=function(x,y){return(x>=this.left&&x<=this.right)&&(y>=this.top&&y<=this.bottom)};Rect.prototype.equals=function(r){return this.left===r.left&&this.top===r.top&&this.right===r.right&&this.bottom===r.bottom};cr.rect=Rect;function Quad(){this.tlx=0;this.tly=0;this.trx=0;this.try_=0;this.brx=0;this.bry=0;this.blx=0;this.bly=0;cr.seal(this)}Quad.prototype.set_from_rect=function(rc){this.tlx=rc.left;this.tly=rc.top;this.trx=rc.right;this.try_=rc.top;this.brx=rc.right;this.bry=rc.bottom;this.blx=rc.left;this.bly=rc.bottom};Quad.prototype.set_from_rotated_rect=function(rc,a){if(a===0){this.set_from_rect(rc)}else{var sin_a=Math.sin(a);var cos_a=Math.cos(a);var left_sin_a=rc.left*sin_a;var top_sin_a=rc.top*sin_a;var right_sin_a=rc.right*sin_a;var bottom_sin_a=rc.bottom*sin_a;var left_cos_a=rc.left*cos_a;var top_cos_a=rc.top*cos_a;var right_cos_a=rc.right*cos_a;var bottom_cos_a=rc.bottom*cos_a;this.tlx=left_cos_a-top_sin_a;this.tly=top_cos_a+left_sin_a;this.trx=right_cos_a-top_sin_a;this.try_=top_cos_a+right_sin_a;this.brx=right_cos_a-bottom_sin_a;this.bry=bottom_cos_a+right_sin_a;this.blx=left_cos_a-bottom_sin_a;this.bly=bottom_cos_a+left_sin_a}};Quad.prototype.offset=function(px,py){this.tlx+=px;this.tly+=py;this.trx+=px;this.try_+=py;this.brx+=px;this.bry+=py;this.blx+=px;this.bly+=py;return this};var minresult=0;var maxresult=0;function minmax4(a,b,c,d){if(a<b){if(c<d){if(a<c){minresult=a}else{minresult=c};if(b>d){maxresult=b}else{maxresult=d}}else{if(a<d){minresult=a}else{minresult=d};if(b>c){maxresult=b}else{maxresult=c}}}else{if(c<d){if(b<c){minresult=b}else{minresult=c};if(a>d){maxresult=a}else{maxresult=d}}else{if(b<d){minresult=b}else{minresult=d};if(a>c){maxresult=a}else{maxresult=c}}}}Quad.prototype.bounding_box=function(rc){minmax4(this.tlx,this.trx,this.brx,this.blx);rc.left=minresult;rc.right=maxresult;minmax4(this.tly,this.try_,this.bry,this.bly);rc.top=minresult;rc.bottom=maxresult};Quad.prototype.contains_pt=function(x,y){var tlx=this.tlx;var tly=this.tly;var v0x=this.trx-tlx;var v0y=this.try_-tly;var v1x=this.brx-tlx;var v1y=this.bry-tly;var v2x=x-tlx;var v2y=y-tly;var dot00=v0x*v0x+v0y*v0y;var dot01=v0x*v1x+v0y*v1y;var dot02=v0x*v2x+v0y*v2y;var dot11=v1x*v1x+v1y*v1y;var dot12=v1x*v2x+v1y*v2y;var invDenom=1.0/(dot00*dot11-dot01*dot01);var u=(dot11*dot02-dot01*dot12)*invDenom;var v=(dot00*dot12-dot01*dot02)*invDenom;if((u>=0.0)&&(v>0.0)&&(u+v<1)){return true};v0x=this.blx-tlx;v0y=this.bly-tly;var dot00=v0x*v0x+v0y*v0y;var dot01=v0x*v1x+v0y*v1y;var dot02=v0x*v2x+v0y*v2y;invDenom=1.0/(dot00*dot11-dot01*dot01);u=(dot11*dot02-dot01*dot12)*invDenom;v=(dot00*dot12-dot01*dot02)*invDenom;return(u>=0.0)&&(v>0.0)&&(u+v<1)};Quad.prototype.at=function(i,xory){if(xory){switch(i){case 0:return this.tlx;case 1:return this.trx;case 2:return this.brx;case 3:return this.blx;case 4:return this.tlx;default:return this.tlx}}else{switch(i){case 0:return this.tly;case 1:return this.try_;case 2:return this.bry;case 3:return this.bly;case 4:return this.tly;default:return this.tly}}};Quad.prototype.midX=function(){return(this.tlx+this.trx+this.brx+this.blx)/4};Quad.prototype.midY=function(){return(this.tly+this.try_+this.bry+this.bly)/4};Quad.prototype.intersects_segment=function(x1,y1,x2,y2){if(this.contains_pt(x1,y1)||this.contains_pt(x2,y2)){return true};var a1x,a1y,a2x,a2y;var i;for(i=0;i<4;i++){a1x=this.at(i,true);a1y=this.at(i,false);a2x=this.at(i+1,true);a2y=this.at(i+1,false);if(cr.segments_intersect(x1,y1,x2,y2,a1x,a1y,a2x,a2y)){return true}};return false};Quad.prototype.intersects_quad=function(rhs){var midx=rhs.midX();var midy=rhs.midY();if(this.contains_pt(midx,midy)){return true};midx=this.midX();midy=this.midY();if(rhs.contains_pt(midx,midy)){return true};var a1x,a1y,a2x,a2y,b1x,b1y,b2x,b2y;var i,j;for(i=0;i<4;i++){for(j=0;j<4;j++){a1x=this.at(i,true);a1y=this.at(i,false);a2x=this.at(i+1,true);a2y=this.at(i+1,false);b1x=rhs.at(j,true);b1y=rhs.at(j,false);b2x=rhs.at(j+1,true);b2y=rhs.at(j+1,false);if(cr.segments_intersect(a1x,a1y,a2x,a2y,b1x,b1y,b2x,b2y)){return true}}};return false};cr.quad=Quad;cr.RGB=function(red,green,blue){return Math.max(Math.min(red,255),0)|(Math.max(Math.min(green,255),0)<<8)|(Math.max(Math.min(blue,255),0)<<16)};cr.GetRValue=function(rgb){return rgb&0xFF};cr.GetGValue=function(rgb){return(rgb&0xFF00)>>8};cr.GetBValue=function(rgb){return(rgb&0xFF0000)>>16};cr.shallowCopy=function(a,b,allowOverwrite){var attr;for(attr in b){if(b.hasOwnProperty(attr)){;;a[attr]=b[attr]}};return a};cr.arrayRemove=function(arr,index){var i,len;index=cr.floor(index);if(index<0||index>=arr.length){return};for(i=index,len=arr.length-1;i<len;i++){arr[i]=arr[i+1]};cr.truncateArray(arr,len)};cr.truncateArray=function(arr,index){arr.length=index};cr.clearArray=function(arr){cr.truncateArray(arr,0)};cr.shallowAssignArray=function(dest,src){cr.clearArray(dest);var i,len;for(i=0,len=src.length;i<len;++i){dest[i]=src[i]}};cr.appendArray=function(a,b){a.push.apply(a,b)};cr.fastIndexOf=function(arr,item){var i,len;for(i=0,len=arr.length;i<len;++i){if(arr[i]===item){return i}};return-1};cr.arrayFindRemove=function(arr,item){var index=cr.fastIndexOf(arr,item);if(index!==-1){cr.arrayRemove(arr,index)}};cr.clamp=function(x,a,b){if(x<a){return a}else{if(x>b){return b}else{return x}}};cr.to_radians=function(x){return x/(180.0/cr.PI)};cr.to_degrees=function(x){return x*(180.0/cr.PI)};cr.clamp_angle_degrees=function(a){a%=360;if(a<0){a+=360};return a};cr.clamp_angle=function(a){a%=2*cr.PI;if(a<0){a+=2*cr.PI};return a};cr.to_clamped_degrees=function(x){return cr.clamp_angle_degrees(cr.to_degrees(x))};cr.to_clamped_radians=function(x){return cr.clamp_angle(cr.to_radians(x))};cr.angleTo=function(x1,y1,x2,y2){var dx=x2-x1;var dy=y2-y1;return Math.atan2(dy,dx)};cr.angleDiff=function(a1,a2){if(a1===a2){return 0};var s1=Math.sin(a1);var c1=Math.cos(a1);var s2=Math.sin(a2);var c2=Math.cos(a2);var n=s1*s2+c1*c2;if(n>=1){return 0};if(n<=-1){return cr.PI};return Math.acos(n)};cr.angleRotate=function(start,end,step){var ss=Math.sin(start);var cs=Math.cos(start);var se=Math.sin(end);var ce=Math.cos(end);if(Math.acos(ss*se+cs*ce)>step){if(cs*se-ss*ce>0){return cr.clamp_angle(start+step)}else{return cr.clamp_angle(start-step)}}else{return cr.clamp_angle(end)}};cr.angleClockwise=function(a1,a2){var s1=Math.sin(a1);var c1=Math.cos(a1);var s2=Math.sin(a2);var c2=Math.cos(a2);return c1*s2-s1*c2<=0};cr.rotatePtAround=function(px,py,a,ox,oy,getx){if(a===0){return getx?px:py};var sin_a=Math.sin(a);var cos_a=Math.cos(a);px-=ox;py-=oy;var left_sin_a=px*sin_a;var top_sin_a=py*sin_a;var left_cos_a=px*cos_a;var top_cos_a=py*cos_a;px=left_cos_a-top_sin_a;py=top_cos_a+left_sin_a;px+=ox;py+=oy;return getx?px:py};cr.distanceTo=function(x1,y1,x2,y2){var dx=x2-x1;var dy=y2-y1;return Math.sqrt(dx*dx+dy*dy)};cr.xor=function(x,y){return!x!==!y};cr.lerp=function(a,b,x){return a+(b-a)*x};cr.unlerp=function(a,b,c){if(a===b){return 0};return(c-a)/(b-a)};cr.anglelerp=function(a,b,x){var diff=cr.angleDiff(a,b);if(cr.angleClockwise(b,a)){return a+diff*x}else{return a-diff*x}};cr.qarp=function(a,b,c,x){return cr.lerp(cr.lerp(a,b,x),cr.lerp(b,c,x),x)};cr.cubic=function(a,b,c,d,x){return cr.lerp(cr.qarp(a,b,c,x),cr.qarp(b,c,d,x),x)};cr.cosp=function(a,b,x){return(a+b+(a-b)*Math.cos(x*Math.PI))/2};cr.hasAnyOwnProperty=function(o){var p;for(p in o){if(o.hasOwnProperty(p)){return true}};return false};cr.wipe=function(obj){var p;for(p in obj){if(obj.hasOwnProperty(p)){delete obj[p]}}};var startup_time=+(new Date());cr.performance_now=function(){if(typeof window["\x70\x65\x72\x66\x6F\x72\x6D\x61\x6E\x63\x65"]!=="\x75\x6E\x64\x65\x66\x69\x6E\x65\x64"){var winperf=window["\x70\x65\x72\x66\x6F\x72\x6D\x61\x6E\x63\x65"];if(typeof winperf.now!=="\x75\x6E\x64\x65\x66\x69\x6E\x65\x64"){return winperf.now()}else{if(typeof winperf["\x77\x65\x62\x6B\x69\x74\x4E\x6F\x77"]!=="\x75\x6E\x64\x65\x66\x69\x6E\x65\x64"){return winperf["\x77\x65\x62\x6B\x69\x74\x4E\x6F\x77"]()}else{if(typeof winperf["\x6D\x6F\x7A\x4E\x6F\x77"]!=="\x75\x6E\x64\x65\x66\x69\x6E\x65\x64"){return winperf["\x6D\x6F\x7A\x4E\x6F\x77"]()}else{if(typeof winperf["\x6D\x73\x4E\x6F\x77"]!=="\x75\x6E\x64\x65\x66\x69\x6E\x65\x64"){return winperf["\x6D\x73\x4E\x6F\x77"]()}}}}};return Date.now()-startup_time};var isChrome=false;var isSafari=false;var isiOS=false;var isEjecta=false;if(typeof window!=="\x75\x6E\x64\x65\x66\x69\x6E\x65\x64"){isChrome=/chrome/i.test(navigator.userAgent)||/chromium/i.test(navigator.userAgent);isSafari=!isChrome&&/safari/i.test(navigator.userAgent);isiOS=/(iphone|ipod|ipad)/i.test(navigator.userAgent);isEjecta=window["\x63\x32\x65\x6A\x65\x63\x74\x61"]};var supports_set=((!isSafari&&!isEjecta&&!isiOS)&&(typeof Set!=="\x75\x6E\x64\x65\x66\x69\x6E\x65\x64"&&typeof Set.prototype["\x66\x6F\x72\x45\x61\x63\x68"]!=="\x75\x6E\x64\x65\x66\x69\x6E\x65\x64"));function ObjectSet_(){this.s=null;this.items=null;this.item_count=0;if(supports_set){this.s=new Set()};this.values_cache=[];this.cache_valid=true;cr.seal(this)}ObjectSet_.prototype.contains=function(x){if(this.isEmpty()){return false};if(supports_set){return this.s["\x68\x61\x73"](x)}else{return(this.items&&this.items.hasOwnProperty(x))}};ObjectSet_.prototype.add=function(x){if(supports_set){if(!this.s["\x68\x61\x73"](x)){this.s["\x61\x64\x64"](x);this.cache_valid=false}}else{var str=x.toString();var items=this.items;if(!items){this.items={};this.items[str]=x;this.item_count=1;this.cache_valid=false}else{if(!items.hasOwnProperty(str)){items[str]=x;this.item_count++;this.cache_valid=false}}}};ObjectSet_.prototype.remove=function(x){if(this.isEmpty()){return};if(supports_set){if(this.s["\x68\x61\x73"](x)){this.s["\x64\x65\x6C\x65\x74\x65"](x);this.cache_valid=false}}else{if(this.items){var str=x.toString();var items=this.items;if(items.hasOwnProperty(str)){delete items[str];this.item_count--;this.cache_valid=false}}}};ObjectSet_.prototype.clear=function(){if(this.isEmpty()){return};if(supports_set){this.s["\x63\x6C\x65\x61\x72"]()}else{this.items=null;this.item_count=0};cr.clearArray(this.values_cache);this.cache_valid=true};ObjectSet_.prototype.isEmpty=function(){return this.count()===0};ObjectSet_.prototype.count=function(){if(supports_set){return this.s["\x73\x69\x7A\x65"]}else{return this.item_count}};var current_arr=null;var current_index=0;function set_append_to_arr(x){current_arr[current_index++]=x}ObjectSet_.prototype.update_cache=function(){if(this.cache_valid){return};if(supports_set){cr.clearArray(this.values_cache);current_arr=this.values_cache;current_index=0;this.s["\x66\x6F\x72\x45\x61\x63\x68"](set_append_to_arr);;;current_arr=null;current_index=0}else{var values_cache=this.values_cache;cr.clearArray(values_cache);var p,n=0,items=this.items;if(items){for(p in items){if(items.hasOwnProperty(p)){values_cache[n++]=items[p]}}}};this.cache_valid=true};ObjectSet_.prototype.valuesRef=function(){this.update_cache();return this.values_cache};cr.ObjectSet=ObjectSet_;var tmpSet=new cr.ObjectSet();cr.removeArrayDuplicates=function(arr){var i,len;for(i=0,len=arr.length;i<len;++i){tmpSet.add(arr[i])};cr.shallowAssignArray(arr,tmpSet.valuesRef());tmpSet.clear()};cr.arrayRemoveAllFromObjectSet=function(arr,remset){if(supports_set){cr.arrayRemoveAll_set(arr,remset.s)}else{cr.arrayRemoveAll_arr(arr,remset.valuesRef())}};cr.arrayRemoveAll_set=function(arr,s){var i,j,len,item;for(i=0,j=0,len=arr.length;i<len;++i){item=arr[i];if(!s["\x68\x61\x73"](item)){arr[j++]=item}};cr.truncateArray(arr,j)};cr.arrayRemoveAll_arr=function(arr,rem){var i,j,len,item;for(i=0,j=0,len=arr.length;i<len;++i){item=arr[i];if(cr.fastIndexOf(rem,item)===-1){arr[j++]=item}};cr.truncateArray(arr,j)};function KahanAdder_(){this.c=0;this.y=0;this.t=0;this.sum=0;cr.seal(this)}KahanAdder_.prototype.add=function(v){this.y=v-this.c;this.t=this.sum+this.y;this.c=(this.t-this.sum)-this.y;this.sum=this.t};KahanAdder_.prototype.reset=function(){this.c=0;this.y=0;this.t=0;this.sum=0};cr.KahanAdder=KahanAdder_;cr.regexp_escape=function(text){return text.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\x5C\x24\x26")};function CollisionPoly_(pts_array_){this.pts_cache=[];this.bboxLeft=0;this.bboxTop=0;this.bboxRight=0;this.bboxBottom=0;this.convexpolys=null;this.set_pts(pts_array_);cr.seal(this)}CollisionPoly_.prototype.set_pts=function(pts_array_){this.pts_array=pts_array_;this.pts_count=pts_array_.length/2;this.pts_cache.length=pts_array_.length;this.cache_width=-1;this.cache_height=-1;this.cache_angle=0};CollisionPoly_.prototype.is_empty=function(){return!this.pts_array.length};CollisionPoly_.prototype.update_bbox=function(){var myptscache=this.pts_cache;var bboxLeft_=myptscache[0];var bboxRight_=bboxLeft_;var bboxTop_=myptscache[1];var bboxBottom_=bboxTop_;var x,y,i=1,i2,len=this.pts_count;for(;i<len;++i){i2=i*2;x=myptscache[i2];y=myptscache[i2+1];if(x<bboxLeft_){bboxLeft_=x};if(x>bboxRight_){bboxRight_=x};if(y<bboxTop_){bboxTop_=y};if(y>bboxBottom_){bboxBottom_=y}};this.bboxLeft=bboxLeft_;this.bboxRight=bboxRight_;this.bboxTop=bboxTop_;this.bboxBottom=bboxBottom_};CollisionPoly_.prototype.set_from_rect=function(rc,offx,offy){this.pts_cache.length=8;this.pts_count=4;var myptscache=this.pts_cache;myptscache[0]=rc.left-offx;myptscache[1]=rc.top-offy;myptscache[2]=rc.right-offx;myptscache[3]=rc.top-offy;myptscache[4]=rc.right-offx;myptscache[5]=rc.bottom-offy;myptscache[6]=rc.left-offx;myptscache[7]=rc.bottom-offy;this.cache_width=rc.right-rc.left;this.cache_height=rc.bottom-rc.top;this.update_bbox()};CollisionPoly_.prototype.set_from_quad=function(q,offx,offy,w,h){this.pts_cache.length=8;this.pts_count=4;var myptscache=this.pts_cache;myptscache[0]=q.tlx-offx;myptscache[1]=q.tly-offy;myptscache[2]=q.trx-offx;myptscache[3]=q.try_-offy;myptscache[4]=q.brx-offx;myptscache[5]=q.bry-offy;myptscache[6]=q.blx-offx;myptscache[7]=q.bly-offy;this.cache_width=w;this.cache_height=h;this.update_bbox()};CollisionPoly_.prototype.set_from_poly=function(r){this.pts_count=r.pts_count;cr.shallowAssignArray(this.pts_cache,r.pts_cache);this.bboxLeft=r.bboxLeft;this.bboxTop-r.bboxTop;this.bboxRight=r.bboxRight;this.bboxBottom=r.bboxBottom};CollisionPoly_.prototype.cache_poly=function(w,h,a){if(this.cache_width===w&&this.cache_height===h&&this.cache_angle===a){return};this.cache_width=w;this.cache_height=h;this.cache_angle=a;var i,i2,i21,len,x,y;var sina=0;var cosa=1;var myptsarray=this.pts_array;var myptscache=this.pts_cache;if(a!==0){sina=Math.sin(a);cosa=Math.cos(a)};for(i=0,len=this.pts_count;i<len;i++){i2=i*2;i21=i2+1;x=myptsarray[i2]*w;y=myptsarray[i21]*h;myptscache[i2]=(x*cosa)-(y*sina);myptscache[i21]=(y*cosa)+(x*sina)};this.update_bbox()};CollisionPoly_.prototype.contains_pt=function(a2x,a2y){var myptscache=this.pts_cache;if(a2x===myptscache[0]&&a2y===myptscache[1]){return true};var i,i2,imod,len=this.pts_count;var a1x=this.bboxLeft-110;var a1y=this.bboxTop-101;var a3x=this.bboxRight+131;var a3y=this.bboxBottom+120;var b1x,b1y,b2x,b2y;var count1=0,count2=0;for(i=0;i<len;i++){i2=i*2;imod=((i+1)%len)*2;b1x=myptscache[i2];b1y=myptscache[i2+1];b2x=myptscache[imod];b2y=myptscache[imod+1];if(cr.segments_intersect(a1x,a1y,a2x,a2y,b1x,b1y,b2x,b2y)){count1++};if(cr.segments_intersect(a3x,a3y,a2x,a2y,b1x,b1y,b2x,b2y)){count2++}};return(count1%2===1)||(count2%2===1)};CollisionPoly_.prototype.intersects_poly=function(rhs,offx,offy){var rhspts=rhs.pts_cache;var mypts=this.pts_cache;if(this.contains_pt(rhspts[0]+offx,rhspts[1]+offy)){return true};if(rhs.contains_pt(mypts[0]-offx,mypts[1]-offy)){return true};var i,i2,imod,leni,j,j2,jmod,lenj;var a1x,a1y,a2x,a2y,b1x,b1y,b2x,b2y;for(i=0,leni=this.pts_count;i<leni;i++){i2=i*2;imod=((i+1)%leni)*2;a1x=mypts[i2];a1y=mypts[i2+1];a2x=mypts[imod];a2y=mypts[imod+1];for(j=0,lenj=rhs.pts_count;j<lenj;j++){j2=j*2;jmod=((j+1)%lenj)*2;b1x=rhspts[j2]+offx;b1y=rhspts[j2+1]+offy;b2x=rhspts[jmod]+offx;b2y=rhspts[jmod+1]+offy;if(cr.segments_intersect(a1x,a1y,a2x,a2y,b1x,b1y,b2x,b2y)){return true}}};return false};CollisionPoly_.prototype.intersects_segment=function(offx,offy,x1,y1,x2,y2){var mypts=this.pts_cache;if(this.contains_pt(x1-offx,y1-offy)){return true};var i,leni,i2,imod;var a1x,a1y,a2x,a2y;for(i=0,leni=this.pts_count;i<leni;i++){i2=i*2;imod=((i+1)%leni)*2;a1x=mypts[i2]+offx;a1y=mypts[i2+1]+offy;a2x=mypts[imod]+offx;a2y=mypts[imod+1]+offy;if(cr.segments_intersect(x1,y1,x2,y2,a1x,a1y,a2x,a2y)){return true}};return false};CollisionPoly_.prototype.mirror=function(px){var i,leni,i2;for(i=0,leni=this.pts_count;i<leni;++i){i2=i*2;this.pts_cache[i2]=px*2-this.pts_cache[i2]}};CollisionPoly_.prototype.flip=function(py){var i,leni,i21;for(i=0,leni=this.pts_count;i<leni;++i){i21=i*2+1;this.pts_cache[i21]=py*2-this.pts_cache[i21]}};CollisionPoly_.prototype.diag=function(){var i,leni,i2,i21,temp;for(i=0,leni=this.pts_count;i<leni;++i){i2=i*2;i21=i2+1;temp=this.pts_cache[i2];this.pts_cache[i2]=this.pts_cache[i21];this.pts_cache[i21]=temp}};cr.CollisionPoly=CollisionPoly_;function SparseGrid_(cellwidth_,cellheight_){this.cellwidth=cellwidth_;this.cellheight=cellheight_;this.cells={}}SparseGrid_.prototype.totalCellCount=0;SparseGrid_.prototype.getCell=function(x_,y_,create_if_missing){var ret;var col=this.cells[x_];if(!col){if(create_if_missing){ret=allocGridCell(this,x_,y_);this.cells[x_]={};this.cells[x_][y_]=ret;return ret}else{return null}};ret=col[y_];if(ret){return ret}else{if(create_if_missing){ret=allocGridCell(this,x_,y_);this.cells[x_][y_]=ret;return ret}else{return null}}};SparseGrid_.prototype.XToCell=function(x_){return cr.floor(x_/this.cellwidth)};SparseGrid_.prototype.YToCell=function(y_){return cr.floor(y_/this.cellheight)};SparseGrid_.prototype.update=function(inst,oldrange,newrange){var x,lenx,y,leny,cell;if(oldrange){for(x=oldrange.left,lenx=oldrange.right;x<=lenx;++x){for(y=oldrange.top,leny=oldrange.bottom;y<=leny;++y){if(newrange&&newrange.contains_pt(x,y)){continue};cell=this.getCell(x,y,false);if(!cell){continue};cell.remove(inst);if(cell.isEmpty()){freeGridCell(cell);this.cells[x][y]=null}}}};if(newrange){for(x=newrange.left,lenx=newrange.right;x<=lenx;++x){for(y=newrange.top,leny=newrange.bottom;y<=leny;++y){if(oldrange&&oldrange.contains_pt(x,y)){continue};this.getCell(x,y,true).insert(inst)}}}};SparseGrid_.prototype.queryRange=function(rc,result){var x,lenx,ystart,y,leny,cell;x=this.XToCell(rc.left);ystart=this.YToCell(rc.top);lenx=this.XToCell(rc.right);leny=this.YToCell(rc.bottom);for(;x<=lenx;++x){for(y=ystart;y<=leny;++y){cell=this.getCell(x,y,false);if(!cell){continue};cell.dump(result)}}};cr.SparseGrid=SparseGrid_;function RenderGrid_(cellwidth_,cellheight_){this.cellwidth=cellwidth_;this.cellheight=cellheight_;this.cells={}}RenderGrid_.prototype.totalCellCount=0;RenderGrid_.prototype.getCell=function(x_,y_,create_if_missing){var ret;var col=this.cells[x_];if(!col){if(create_if_missing){ret=allocRenderCell(this,x_,y_);this.cells[x_]={};this.cells[x_][y_]=ret;return ret}else{return null}};ret=col[y_];if(ret){return ret}else{if(create_if_missing){ret=allocRenderCell(this,x_,y_);this.cells[x_][y_]=ret;return ret}else{return null}}};RenderGrid_.prototype.XToCell=function(x_){return cr.floor(x_/this.cellwidth)};RenderGrid_.prototype.YToCell=function(y_){return cr.floor(y_/this.cellheight)};RenderGrid_.prototype.update=function(inst,oldrange,newrange){var x,lenx,y,leny,cell;if(oldrange){for(x=oldrange.left,lenx=oldrange.right;x<=lenx;++x){for(y=oldrange.top,leny=oldrange.bottom;y<=leny;++y){if(newrange&&newrange.contains_pt(x,y)){continue};cell=this.getCell(x,y,false);if(!cell){continue};cell.remove(inst);if(cell.isEmpty()){freeRenderCell(cell);this.cells[x][y]=null}}}};if(newrange){for(x=newrange.left,lenx=newrange.right;x<=lenx;++x){for(y=newrange.top,leny=newrange.bottom;y<=leny;++y){if(oldrange&&oldrange.contains_pt(x,y)){continue};this.getCell(x,y,true).insert(inst)}}}};RenderGrid_.prototype.queryRange=function(left,top,right,bottom,result){var x,lenx,ystart,y,leny,cell;x=this.XToCell(left);ystart=this.YToCell(top);lenx=this.XToCell(right);leny=this.YToCell(bottom);for(;x<=lenx;++x){for(y=ystart;y<=leny;++y){cell=this.getCell(x,y,false);if(!cell){continue};cell.dump(result)}}};RenderGrid_.prototype.markRangeChanged=function(rc){var x,lenx,ystart,y,leny,cell;x=rc.left;ystart=rc.top;lenx=rc.right;leny=rc.bottom;for(;x<=lenx;++x){for(y=ystart;y<=leny;++y){cell=this.getCell(x,y,false);if(!cell){continue};cell.is_sorted=false}}};cr.RenderGrid=RenderGrid_;var gridcellcache=[];function allocGridCell(grid_,x_,y_){var ret;SparseGrid_.prototype.totalCellCount++;if(gridcellcache.length){ret=gridcellcache.pop();ret.grid=grid_;ret.x=x_;ret.y=y_;return ret}else{return new cr.GridCell(grid_,x_,y_)}}function freeGridCell(c){SparseGrid_.prototype.totalCellCount--;c.objects.clear();if(gridcellcache.length<1000){gridcellcache.push(c)}}function GridCell_(grid_,x_,y_){this.grid=grid_;this.x=x_;this.y=y_;this.objects=new cr.ObjectSet()}GridCell_.prototype.isEmpty=function(){return this.objects.isEmpty()};GridCell_.prototype.insert=function(inst){this.objects.add(inst)};GridCell_.prototype.remove=function(inst){this.objects.remove(inst)};GridCell_.prototype.dump=function(result){cr.appendArray(result,this.objects.valuesRef())};cr.GridCell=GridCell_;var rendercellcache=[];function allocRenderCell(grid_,x_,y_){var ret;RenderGrid_.prototype.totalCellCount++;if(rendercellcache.length){ret=rendercellcache.pop();ret.grid=grid_;ret.x=x_;ret.y=y_;return ret}else{return new cr.RenderCell(grid_,x_,y_)}}function freeRenderCell(c){RenderGrid_.prototype.totalCellCount--;c.reset();if(rendercellcache.length<1000){rendercellcache.push(c)}}function RenderCell_(grid_,x_,y_){this.grid=grid_;this.x=x_;this.y=y_;this.objects=[];this.is_sorted=true;this.pending_removal=new cr.ObjectSet();this.any_pending_removal=false}RenderCell_.prototype.isEmpty=function(){if(!this.objects.length){;;;;return true};if(this.objects.length>this.pending_removal.count()){return false};this.flush_pending();return true};RenderCell_.prototype.insert=function(inst){if(this.pending_removal.contains(inst)){this.pending_removal.remove(inst);if(this.pending_removal.isEmpty()){this.any_pending_removal=false};return};if(this.objects.length){var top=this.objects[this.objects.length-1];if(top.get_zindex()>inst.get_zindex()){this.is_sorted=false};this.objects.push(inst)}else{this.objects.push(inst);this.is_sorted=true};;};RenderCell_.prototype.remove=function(inst){this.pending_removal.add(inst);this.any_pending_removal=true;if(this.pending_removal.count()>=30){this.flush_pending()}};RenderCell_.prototype.flush_pending=function(){;;if(!this.any_pending_removal){return};if(this.pending_removal.count()===this.objects.length){this.reset();return};cr.arrayRemoveAllFromObjectSet(this.objects,this.pending_removal);this.pending_removal.clear();this.any_pending_removal=false};function sortByInstanceZIndex(a,b){return a.zindex-b.zindex}RenderCell_.prototype.ensure_sorted=function(){if(this.is_sorted){return};this.objects.sort(sortByInstanceZIndex);this.is_sorted=true};RenderCell_.prototype.reset=function(){cr.clearArray(this.objects);this.is_sorted=true;this.pending_removal.clear();this.any_pending_removal=false};RenderCell_.prototype.dump=function(result){this.flush_pending();this.ensure_sorted();if(this.objects.length){result.push(this.objects)}};cr.RenderCell=RenderCell_;var fxNames=["\x6C\x69\x67\x68\x74\x65\x72","\x78\x6F\x72","\x63\x6F\x70\x79","\x64\x65\x73\x74\x69\x6E\x61\x74\x69\x6F\x6E\x2D\x6F\x76\x65\x72","\x73\x6F\x75\x72\x63\x65\x2D\x69\x6E","\x64\x65\x73\x74\x69\x6E\x61\x74\x69\x6F\x6E\x2D\x69\x6E","\x73\x6F\x75\x72\x63\x65\x2D\x6F\x75\x74","\x64\x65\x73\x74\x69\x6E\x61\x74\x69\x6F\x6E\x2D\x6F\x75\x74","\x73\x6F\x75\x72\x63\x65\x2D\x61\x74\x6F\x70","\x64\x65\x73\x74\x69\x6E\x61\x74\x69\x6F\x6E\x2D\x61\x74\x6F\x70"];cr.effectToCompositeOp=function(effect){if(effect<=0||effect>=11){return "\x73\x6F\x75\x72\x63\x65\x2D\x6F\x76\x65\x72"};return fxNames[effect-1]};cr.setGLBlend=function(this_,effect,gl){if(!gl){return};this_.srcBlend=gl.ONE;this_.destBlend=gl.ONE_MINUS_SRC_ALPHA;switch(effect){case 1:this_.srcBlend=gl.ONE;this_.destBlend=gl.ONE;break;case 2:break;case 3:this_.srcBlend=gl.ONE;this_.destBlend=gl.ZERO;break;case 4:this_.srcBlend=gl.ONE_MINUS_DST_ALPHA;this_.destBlend=gl.ONE;break;case 5:this_.srcBlend=gl.DST_ALPHA;this_.destBlend=gl.ZERO;break;case 6:this_.srcBlend=gl.ZERO;this_.destBlend=gl.SRC_ALPHA;break;case 7:this_.srcBlend=gl.ONE_MINUS_DST_ALPHA;this_.destBlend=gl.ZERO;break;case 8:this_.srcBlend=gl.ZERO;this_.destBlend=gl.ONE_MINUS_SRC_ALPHA;break;case 9:this_.srcBlend=gl.DST_ALPHA;this_.destBlend=gl.ONE_MINUS_SRC_ALPHA;break;case 10:this_.srcBlend=gl.ONE_MINUS_DST_ALPHA;this_.destBlend=gl.SRC_ALPHA;break}};cr.round6dp=function(x){return Math.round(x*1000000)/1000000};cr.equals_nocase=function(a,b){if(typeof a!=="\x73\x74\x72\x69\x6E\x67"||typeof b!=="\x73\x74\x72\x69\x6E\x67"){return false};if(a.length!==b.length){return false};if(a===b){return true};return a.toLowerCase()===b.toLowerCase()};cr.isCanvasInputEvent=function(e){var target=e.target;if(!target){return true};if(target===document||target===window){return true};if(document&&document.body&&target===document.body){return true};if(cr.equals_nocase(target.tagName,"\x63\x61\x6E\x76\x61\x73")){return true};return false}}());var MatrixArray=typeof Float32Array!=="\x75\x6E\x64\x65\x66\x69\x6E\x65\x64"?Float32Array:Array,glMatrixArrayType=MatrixArray,vec3={},mat3={},mat4={},quat4={};vec3.create=function(a){var b=new MatrixArray(3);a&&(b[0]=a[0],b[1]=a[1],b[2]=a[2]);return b};vec3["\x73\x65\x74"]=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];return b};vec3.add=function(a,b,c){if(!c||a===c){return a[0]+=b[0],a[1]+=b[1],a[2]+=b[2],a};c[0]=a[0]+b[0];c[1]=a[1]+b[1];c[2]=a[2]+b[2];return c};vec3.subtract=function(a,b,c){if(!c||a===c){return a[0]-=b[0],a[1]-=b[1],a[2]-=b[2],a};c[0]=a[0]-b[0];c[1]=a[1]-b[1];c[2]=a[2]-b[2];return c};vec3.negate=function(a,b){b||(b=a);b[0]=-a[0];b[1]=-a[1];b[2]=-a[2];return b};vec3.scale=function(a,b,c){if(!c||a===c){return a[0]*=b,a[1]*=b,a[2]*=b,a};c[0]=a[0]*b;c[1]=a[1]*b;c[2]=a[2]*b;return c};vec3.normalize=function(a,b){b||(b=a);var c=a[0],d=a[1],e=a[2],g=Math.sqrt(c*c+d*d+e*e);if(g){if(g===1){return b[0]=c,b[1]=d,b[2]=e,b}}else{return b[0]=0,b[1]=0,b[2]=0,b};g=1/g;b[0]=c*g;b[1]=d*g;b[2]=e*g;return b};vec3.cross=function(a,b,c){c||(c=a);var d=a[0],e=a[1],a=a[2],g=b[0],f=b[1],b=b[2];c[0]=e*b-a*f;c[1]=a*g-d*b;c[2]=d*f-e*g;return c};vec3.length=function(a){var b=a[0],c=a[1],a=a[2];return Math.sqrt(b*b+c*c+a*a)};vec3.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]};vec3.direction=function(a,b,c){c||(c=a);var d=a[0]-b[0],e=a[1]-b[1],a=a[2]-b[2],b=Math.sqrt(d*d+e*e+a*a);if(!b){return c[0]=0,c[1]=0,c[2]=0,c};b=1/b;c[0]=d*b;c[1]=e*b;c[2]=a*b;return c};vec3.lerp=function(a,b,c,d){d||(d=a);d[0]=a[0]+c*(b[0]-a[0]);d[1]=a[1]+c*(b[1]-a[1]);d[2]=a[2]+c*(b[2]-a[2]);return d};vec3.str=function(a){return "\x5B"+a[0]+"\x2C\x20"+a[1]+"\x2C\x20"+a[2]+"\x5D"};mat3.create=function(a){var b=new MatrixArray(9);a&&(b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b[4]=a[4],b[5]=a[5],b[6]=a[6],b[7]=a[7],b[8]=a[8]);return b};mat3["\x73\x65\x74"]=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];return b};mat3.identity=function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=1;a[5]=0;a[6]=0;a[7]=0;a[8]=1;return a};mat3.transpose=function(a,b){if(!b||a===b){var c=a[1],d=a[2],e=a[5];a[1]=a[3];a[2]=a[6];a[3]=c;a[5]=a[7];a[6]=d;a[7]=e;return a};b[0]=a[0];b[1]=a[3];b[2]=a[6];b[3]=a[1];b[4]=a[4];b[5]=a[7];b[6]=a[2];b[7]=a[5];b[8]=a[8];return b};mat3.toMat4=function(a,b){b||(b=mat4.create());b[15]=1;b[14]=0;b[13]=0;b[12]=0;b[11]=0;b[10]=a[8];b[9]=a[7];b[8]=a[6];b[7]=0;b[6]=a[5];b[5]=a[4];b[4]=a[3];b[3]=0;b[2]=a[2];b[1]=a[1];b[0]=a[0];return b};mat3.str=function(a){return "\x5B"+a[0]+"\x2C\x20"+a[1]+"\x2C\x20"+a[2]+"\x2C\x20"+a[3]+"\x2C\x20"+a[4]+"\x2C\x20"+a[5]+"\x2C\x20"+a[6]+"\x2C\x20"+a[7]+"\x2C\x20"+a[8]+"\x5D"};mat4.create=function(a){var b=new MatrixArray(16);a&&(b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b[4]=a[4],b[5]=a[5],b[6]=a[6],b[7]=a[7],b[8]=a[8],b[9]=a[9],b[10]=a[10],b[11]=a[11],b[12]=a[12],b[13]=a[13],b[14]=a[14],b[15]=a[15]);return b};mat4["\x73\x65\x74"]=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];b[9]=a[9];b[10]=a[10];b[11]=a[11];b[12]=a[12];b[13]=a[13];b[14]=a[14];b[15]=a[15];return b};mat4.identity=function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};mat4.transpose=function(a,b){if(!b||a===b){var c=a[1],d=a[2],e=a[3],g=a[6],f=a[7],h=a[11];a[1]=a[4];a[2]=a[8];a[3]=a[12];a[4]=c;a[6]=a[9];a[7]=a[13];a[8]=d;a[9]=g;a[11]=a[14];a[12]=e;a[13]=f;a[14]=h;return a};b[0]=a[0];b[1]=a[4];b[2]=a[8];b[3]=a[12];b[4]=a[1];b[5]=a[5];b[6]=a[9];b[7]=a[13];b[8]=a[2];b[9]=a[6];b[10]=a[10];b[11]=a[14];b[12]=a[3];b[13]=a[7];b[14]=a[11];b[15]=a[15];return b};mat4.determinant=function(a){var b=a[0],c=a[1],d=a[2],e=a[3],g=a[4],f=a[5],h=a[6],i=a[7],j=a[8],k=a[9],l=a[10],n=a[11],o=a[12],m=a[13],p=a[14],a=a[15];return o*k*h*e-j*m*h*e-o*f*l*e+g*m*l*e+j*f*p*e-g*k*p*e-o*k*d*i+j*m*d*i+o*c*l*i-b*m*l*i-j*c*p*i+b*k*p*i+o*f*d*n-g*m*d*n-o*c*h*n+b*m*h*n+g*c*p*n-b*f*p*n-j*f*d*a+g*k*d*a+j*c*h*a-b*k*h*a-g*c*l*a+b*f*l*a};mat4.inverse=function(a,b){b||(b=a);var c=a[0],d=a[1],e=a[2],g=a[3],f=a[4],h=a[5],i=a[6],j=a[7],k=a[8],l=a[9],n=a[10],o=a[11],m=a[12],p=a[13],r=a[14],s=a[15],A=c*h-d*f,B=c*i-e*f,t=c*j-g*f,u=d*i-e*h,v=d*j-g*h,w=e*j-g*i,x=k*p-l*m,y=k*r-n*m,z=k*s-o*m,C=l*r-n*p,D=l*s-o*p,E=n*s-o*r,q=1/(A*E-B*D+t*C+u*z-v*y+w*x);b[0]=(h*E-i*D+j*C)*q;b[1]=(-d*E+e*D-g*C)*q;b[2]=(p*w-r*v+s*u)*q;b[3]=(-l*w+n*v-o*u)*q;b[4]=(-f*E+i*z-j*y)*q;b[5]=(c*E-e*z+g*y)*q;b[6]=(-m*w+r*t-s*B)*q;b[7]=(k*w-n*t+o*B)*q;b[8]=(f*D-h*z+j*x)*q;b[9]=(-c*D+d*z-g*x)*q;b[10]=(m*v-p*t+s*A)*q;b[11]=(-k*v+l*t-o*A)*q;b[12]=(-f*C+h*y-i*x)*q;b[13]=(c*C-d*y+e*x)*q;b[14]=(-m*u+p*B-r*A)*q;b[15]=(k*u-l*B+n*A)*q;return b};mat4.toRotationMat=function(a,b){b||(b=mat4.create());b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];b[9]=a[9];b[10]=a[10];b[11]=a[11];b[12]=0;b[13]=0;b[14]=0;b[15]=1;return b};mat4.toMat3=function(a,b){b||(b=mat3.create());b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[4];b[4]=a[5];b[5]=a[6];b[6]=a[8];b[7]=a[9];b[8]=a[10];return b};mat4.toInverseMat3=function(a,b){var c=a[0],d=a[1],e=a[2],g=a[4],f=a[5],h=a[6],i=a[8],j=a[9],k=a[10],l=k*f-h*j,n=-k*g+h*i,o=j*g-f*i,m=c*l+d*n+e*o;if(!m){return null};m=1/m;b||(b=mat3.create());b[0]=l*m;b[1]=(-k*d+e*j)*m;b[2]=(h*d-e*f)*m;b[3]=n*m;b[4]=(k*c-e*i)*m;b[5]=(-h*c+e*g)*m;b[6]=o*m;b[7]=(-j*c+d*i)*m;b[8]=(f*c-d*g)*m;return b};mat4.multiply=function(a,b,c){c||(c=a);var d=a[0],e=a[1],g=a[2],f=a[3],h=a[4],i=a[5],j=a[6],k=a[7],l=a[8],n=a[9],o=a[10],m=a[11],p=a[12],r=a[13],s=a[14],a=a[15],A=b[0],B=b[1],t=b[2],u=b[3],v=b[4],w=b[5],x=b[6],y=b[7],z=b[8],C=b[9],D=b[10],E=b[11],q=b[12],F=b[13],G=b[14],b=b[15];c[0]=A*d+B*h+t*l+u*p;c[1]=A*e+B*i+t*n+u*r;c[2]=A*g+B*j+t*o+u*s;c[3]=A*f+B*k+t*m+u*a;c[4]=v*d+w*h+x*l+y*p;c[5]=v*e+w*i+x*n+y*r;c[6]=v*g+w*j+x*o+y*s;c[7]=v*f+w*k+x*m+y*a;c[8]=z*d+C*h+D*l+E*p;c[9]=z*e+C*i+D*n+E*r;c[10]=z*g+C*j+D*o+E*s;c[11]=z*f+C*k+D*m+E*a;c[12]=q*d+F*h+G*l+b*p;c[13]=q*e+F*i+G*n+b*r;c[14]=q*g+F*j+G*o+b*s;c[15]=q*f+F*k+G*m+b*a;return c};mat4.multiplyVec3=function(a,b,c){c||(c=b);var d=b[0],e=b[1],b=b[2];c[0]=a[0]*d+a[4]*e+a[8]*b+a[12];c[1]=a[1]*d+a[5]*e+a[9]*b+a[13];c[2]=a[2]*d+a[6]*e+a[10]*b+a[14];return c};mat4.multiplyVec4=function(a,b,c){c||(c=b);var d=b[0],e=b[1],g=b[2],b=b[3];c[0]=a[0]*d+a[4]*e+a[8]*g+a[12]*b;c[1]=a[1]*d+a[5]*e+a[9]*g+a[13]*b;c[2]=a[2]*d+a[6]*e+a[10]*g+a[14]*b;c[3]=a[3]*d+a[7]*e+a[11]*g+a[15]*b;return c};mat4.translate=function(a,b,c){var d=b[0],e=b[1],b=b[2],g,f,h,i,j,k,l,n,o,m,p,r;if(!c||a===c){return a[12]=a[0]*d+a[4]*e+a[8]*b+a[12],a[13]=a[1]*d+a[5]*e+a[9]*b+a[13],a[14]=a[2]*d+a[6]*e+a[10]*b+a[14],a[15]=a[3]*d+a[7]*e+a[11]*b+a[15],a};g=a[0];f=a[1];h=a[2];i=a[3];j=a[4];k=a[5];l=a[6];n=a[7];o=a[8];m=a[9];p=a[10];r=a[11];c[0]=g;c[1]=f;c[2]=h;c[3]=i;c[4]=j;c[5]=k;c[6]=l;c[7]=n;c[8]=o;c[9]=m;c[10]=p;c[11]=r;c[12]=g*d+j*e+o*b+a[12];c[13]=f*d+k*e+m*b+a[13];c[14]=h*d+l*e+p*b+a[14];c[15]=i*d+n*e+r*b+a[15];return c};mat4.scale=function(a,b,c){var d=b[0],e=b[1],b=b[2];if(!c||a===c){return a[0]*=d,a[1]*=d,a[2]*=d,a[3]*=d,a[4]*=e,a[5]*=e,a[6]*=e,a[7]*=e,a[8]*=b,a[9]*=b,a[10]*=b,a[11]*=b,a};c[0]=a[0]*d;c[1]=a[1]*d;c[2]=a[2]*d;c[3]=a[3]*d;c[4]=a[4]*e;c[5]=a[5]*e;c[6]=a[6]*e;c[7]=a[7]*e;c[8]=a[8]*b;c[9]=a[9]*b;c[10]=a[10]*b;c[11]=a[11]*b;c[12]=a[12];c[13]=a[13];c[14]=a[14];c[15]=a[15];return c};mat4.rotate=function(a,b,c,d){var e=c[0],g=c[1],c=c[2],f=Math.sqrt(e*e+g*g+c*c),h,i,j,k,l,n,o,m,p,r,s,A,B,t,u,v,w,x,y,z;if(!f){return null};f!==1&&(f=1/f,e*=f,g*=f,c*=f);h=Math.sin(b);i=Math.cos(b);j=1-i;b=a[0];f=a[1];k=a[2];l=a[3];n=a[4];o=a[5];m=a[6];p=a[7];r=a[8];s=a[9];A=a[10];B=a[11];t=e*e*j+i;u=g*e*j+c*h;v=c*e*j-g*h;w=e*g*j-c*h;x=g*g*j+i;y=c*g*j+e*h;z=e*c*j+g*h;e=g*c*j-e*h;g=c*c*j+i;d?a!==d&&(d[12]=a[12],d[13]=a[13],d[14]=a[14],d[15]=a[15]):d=a;d[0]=b*t+n*u+r*v;d[1]=f*t+o*u+s*v;d[2]=k*t+m*u+A*v;d[3]=l*t+p*u+B*v;d[4]=b*w+n*x+r*y;d[5]=f*w+o*x+s*y;d[6]=k*w+m*x+A*y;d[7]=l*w+p*x+B*y;d[8]=b*z+n*e+r*g;d[9]=f*z+o*e+s*g;d[10]=k*z+m*e+A*g;d[11]=l*z+p*e+B*g;return d};mat4.rotateX=function(a,b,c){var d=Math.sin(b),b=Math.cos(b),e=a[4],g=a[5],f=a[6],h=a[7],i=a[8],j=a[9],k=a[10],l=a[11];c?a!==c&&(c[0]=a[0],c[1]=a[1],c[2]=a[2],c[3]=a[3],c[12]=a[12],c[13]=a[13],c[14]=a[14],c[15]=a[15]):c=a;c[4]=e*b+i*d;c[5]=g*b+j*d;c[6]=f*b+k*d;c[7]=h*b+l*d;c[8]=e*-d+i*b;c[9]=g*-d+j*b;c[10]=f*-d+k*b;c[11]=h*-d+l*b;return c};mat4.rotateY=function(a,b,c){var d=Math.sin(b),b=Math.cos(b),e=a[0],g=a[1],f=a[2],h=a[3],i=a[8],j=a[9],k=a[10],l=a[11];c?a!==c&&(c[4]=a[4],c[5]=a[5],c[6]=a[6],c[7]=a[7],c[12]=a[12],c[13]=a[13],c[14]=a[14],c[15]=a[15]):c=a;c[0]=e*b+i*-d;c[1]=g*b+j*-d;c[2]=f*b+k*-d;c[3]=h*b+l*-d;c[8]=e*d+i*b;c[9]=g*d+j*b;c[10]=f*d+k*b;c[11]=h*d+l*b;return c};mat4.rotateZ=function(a,b,c){var d=Math.sin(b),b=Math.cos(b),e=a[0],g=a[1],f=a[2],h=a[3],i=a[4],j=a[5],k=a[6],l=a[7];c?a!==c&&(c[8]=a[8],c[9]=a[9],c[10]=a[10],c[11]=a[11],c[12]=a[12],c[13]=a[13],c[14]=a[14],c[15]=a[15]):c=a;c[0]=e*b+i*d;c[1]=g*b+j*d;c[2]=f*b+k*d;c[3]=h*b+l*d;c[4]=e*-d+i*b;c[5]=g*-d+j*b;c[6]=f*-d+k*b;c[7]=h*-d+l*b;return c};mat4.frustum=function(a,b,c,d,e,g,f){f||(f=mat4.create());var h=b-a,i=d-c,j=g-e;f[0]=e*2/h;f[1]=0;f[2]=0;f[3]=0;f[4]=0;f[5]=e*2/i;f[6]=0;f[7]=0;f[8]=(b+a)/h;f[9]=(d+c)/i;f[10]=-(g+e)/j;f[11]=-1;f[12]=0;f[13]=0;f[14]=-(g*e*2)/j;f[15]=0;return f};mat4.perspective=function(a,b,c,d,e){a=c*Math.tan(a*Math.PI/360);b*=a;return mat4.frustum(-b,b,-a,a,c,d,e)};mat4.ortho=function(a,b,c,d,e,g,f){f||(f=mat4.create());var h=b-a,i=d-c,j=g-e;f[0]=2/h;f[1]=0;f[2]=0;f[3]=0;f[4]=0;f[5]=2/i;f[6]=0;f[7]=0;f[8]=0;f[9]=0;f[10]=-2/j;f[11]=0;f[12]=-(a+b)/h;f[13]=-(d+c)/i;f[14]=-(g+e)/j;f[15]=1;return f};mat4.lookAt=function(a,b,c,d){d||(d=mat4.create());var e,g,f,h,i,j,k,l,n=a[0],o=a[1],a=a[2];g=c[0];f=c[1];e=c[2];c=b[1];j=b[2];if(n===b[0]&&o===c&&a===j){return mat4.identity(d)};c=n-b[0];j=o-b[1];k=a-b[2];l=1/Math.sqrt(c*c+j*j+k*k);c*=l;j*=l;k*=l;b=f*k-e*j;e=e*c-g*k;g=g*j-f*c;(l=Math.sqrt(b*b+e*e+g*g))?(l=1/l,b*=l,e*=l,g*=l):g=e=b=0;f=j*g-k*e;h=k*b-c*g;i=c*e-j*b;(l=Math.sqrt(f*f+h*h+i*i))?(l=1/l,f*=l,h*=l,i*=l):i=h=f=0;d[0]=b;d[1]=f;d[2]=c;d[3]=0;d[4]=e;d[5]=h;d[6]=j;d[7]=0;d[8]=g;d[9]=i;d[10]=k;d[11]=0;d[12]=-(b*n+e*o+g*a);d[13]=-(f*n+h*o+i*a);d[14]=-(c*n+j*o+k*a);d[15]=1;return d};mat4.fromRotationTranslation=function(a,b,c){c||(c=mat4.create());var d=a[0],e=a[1],g=a[2],f=a[3],h=d+d,i=e+e,j=g+g,a=d*h,k=d*i;d*=j;var l=e*i;e*=j;g*=j;h*=f;i*=f;f*=j;c[0]=1-(l+g);c[1]=k+f;c[2]=d-i;c[3]=0;c[4]=k-f;c[5]=1-(a+g);c[6]=e+h;c[7]=0;c[8]=d+i;c[9]=e-h;c[10]=1-(a+l);c[11]=0;c[12]=b[0];c[13]=b[1];c[14]=b[2];c[15]=1;return c};mat4.str=function(a){return "\x5B"+a[0]+"\x2C\x20"+a[1]+"\x2C\x20"+a[2]+"\x2C\x20"+a[3]+"\x2C\x20"+a[4]+"\x2C\x20"+a[5]+"\x2C\x20"+a[6]+"\x2C\x20"+a[7]+"\x2C\x20"+a[8]+"\x2C\x20"+a[9]+"\x2C\x20"+a[10]+"\x2C\x20"+a[11]+"\x2C\x20"+a[12]+"\x2C\x20"+a[13]+"\x2C\x20"+a[14]+"\x2C\x20"+a[15]+"\x5D"};quat4.create=function(a){var b=new MatrixArray(4);a&&(b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3]);return b};quat4["\x73\x65\x74"]=function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];return b};quat4.calculateW=function(a,b){var c=a[0],d=a[1],e=a[2];if(!b||a===b){return a[3]=-Math.sqrt(Math.abs(1-c*c-d*d-e*e)),a};b[0]=c;b[1]=d;b[2]=e;b[3]=-Math.sqrt(Math.abs(1-c*c-d*d-e*e));return b};quat4.inverse=function(a,b){if(!b||a===b){return a[0]*=-1,a[1]*=-1,a[2]*=-1,a};b[0]=-a[0];b[1]=-a[1];b[2]=-a[2];b[3]=a[3];return b};quat4.length=function(a){var b=a[0],c=a[1],d=a[2],a=a[3];return Math.sqrt(b*b+c*c+d*d+a*a)};quat4.normalize=function(a,b){b||(b=a);var c=a[0],d=a[1],e=a[2],g=a[3],f=Math.sqrt(c*c+d*d+e*e+g*g);if(f===0){return b[0]=0,b[1]=0,b[2]=0,b[3]=0,b};f=1/f;b[0]=c*f;b[1]=d*f;b[2]=e*f;b[3]=g*f;return b};quat4.multiply=function(a,b,c){c||(c=a);var d=a[0],e=a[1],g=a[2],a=a[3],f=b[0],h=b[1],i=b[2],b=b[3];c[0]=d*b+a*f+e*i-g*h;c[1]=e*b+a*h+g*f-d*i;c[2]=g*b+a*i+d*h-e*f;c[3]=a*b-d*f-e*h-g*i;return c};quat4.multiplyVec3=function(a,b,c){c||(c=b);var d=b[0],e=b[1],g=b[2],b=a[0],f=a[1],h=a[2],a=a[3],i=a*d+f*g-h*e,j=a*e+h*d-b*g,k=a*g+b*e-f*d,d=-b*d-f*e-h*g;c[0]=i*a+d*-b+j*-h-k*-f;c[1]=j*a+d*-f+k*-b-i*-h;c[2]=k*a+d*-h+i*-f-j*-b;return c};quat4.toMat3=function(a,b){b||(b=mat3.create());var c=a[0],d=a[1],e=a[2],g=a[3],f=c+c,h=d+d,i=e+e,j=c*f,k=c*h;c*=i;var l=d*h;d*=i;e*=i;f*=g;h*=g;g*=i;b[0]=1-(l+e);b[1]=k+g;b[2]=c-h;b[3]=k-g;b[4]=1-(j+e);b[5]=d+f;b[6]=c+h;b[7]=d-f;b[8]=1-(j+l);return b};quat4.toMat4=function(a,b){b||(b=mat4.create());var c=a[0],d=a[1],e=a[2],g=a[3],f=c+c,h=d+d,i=e+e,j=c*f,k=c*h;c*=i;var l=d*h;d*=i;e*=i;f*=g;h*=g;g*=i;b[0]=1-(l+e);b[1]=k+g;b[2]=c-h;b[3]=0;b[4]=k-g;b[5]=1-(j+e);b[6]=d+f;b[7]=0;b[8]=c+h;b[9]=d-f;b[10]=1-(j+l);b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return b};quat4.slerp=function(a,b,c,d){d||(d=a);var e=a[0]*b[0]+a[1]*b[1]+a[2]*b[2]+a[3]*b[3],g,f;if(Math.abs(e)>=1){return d!==a&&(d[0]=a[0],d[1]=a[1],d[2]=a[2],d[3]=a[3]),d};g=Math.acos(e);f=Math.sqrt(1-e*e);if(Math.abs(f)<0.001){return d[0]=a[0]*0.5+b[0]*0.5,d[1]=a[1]*0.5+b[1]*0.5,d[2]=a[2]*0.5+b[2]*0.5,d[3]=a[3]*0.5+b[3]*0.5,d};e=Math.sin((1-c)*g)/f;c=Math.sin(c*g)/f;d[0]=a[0]*e+b[0]*c;d[1]=a[1]*e+b[1]*c;d[2]=a[2]*e+b[2]*c;d[3]=a[3]*e+b[3]*c;return d};quat4.str=function(a){return "\x5B"+a[0]+"\x2C\x20"+a[1]+"\x2C\x20"+a[2]+"\x2C\x20"+a[3]+"\x5D"};(function(){var MAX_VERTICES=8000;var MAX_INDICES=(MAX_VERTICES/2)*3;var MAX_POINTS=8000;var MULTI_BUFFERS=4;var BATCH_NULL=0;var BATCH_QUAD=1;var BATCH_SETTEXTURE=2;var BATCH_SETOPACITY=3;var BATCH_SETBLEND=4;var BATCH_UPDATEMODELVIEW=5;var BATCH_RENDERTOTEXTURE=6;var BATCH_CLEAR=7;var BATCH_POINTS=8;var BATCH_SETPROGRAM=9;var BATCH_SETPROGRAMPARAMETERS=10;var BATCH_SETTEXTURE1=11;var BATCH_SETCOLOR=12;var BATCH_SETDEPTHTEST=13;var BATCH_SETEARLYZMODE=14;var tempMat4=mat4.create();function GLWrap_(gl,isMobile,enableFrontToBack){this.isIE=/msie/i.test(navigator.userAgent)||/trident/i.test(navigator.userAgent);this.width=0;this.height=0;this.enableFrontToBack=!!enableFrontToBack;this.isEarlyZPass=false;this.isBatchInEarlyZPass=false;this.currentZ=0;this.zNear=1;this.zFar=1000;this.zIncrement=((this.zFar-this.zNear)/32768);this.zA=this.zFar/(this.zFar-this.zNear);this.zB=this.zFar*this.zNear/(this.zNear-this.zFar);this.kzA=65536*this.zA;this.kzB=65536*this.zB;this.cam=vec3.create([0,0,100]);this.look=vec3.create([0,0,0]);this.up=vec3.create([0,1,0]);this.worldScale=vec3.create([1,1,1]);this.enable_mipmaps=true;this.matP=mat4.create();this.matMV=mat4.create();this.lastMV=mat4.create();this.currentMV=mat4.create();this.gl=gl;this.initState()}GLWrap_.prototype.initState=function(){var gl=this.gl;var i,len;this.lastOpacity=1;this.lastTexture0=null;this.lastTexture1=null;this.currentOpacity=1;gl.clearColor(0,0,0,0);gl.clear(gl.COLOR_BUFFER_BIT);gl.enable(gl.BLEND);gl.blendFunc(gl.ONE,gl.ONE_MINUS_SRC_ALPHA);gl.disable(gl.CULL_FACE);gl.disable(gl.STENCIL_TEST);gl.disable(gl.DITHER);if(this.enableFrontToBack){gl.enable(gl.DEPTH_TEST);gl.depthFunc(gl.LEQUAL)}else{gl.disable(gl.DEPTH_TEST)};this.maxTextureSize=gl.getParameter(gl.MAX_TEXTURE_SIZE);this.lastSrcBlend=gl.ONE;this.lastDestBlend=gl.ONE_MINUS_SRC_ALPHA;this.vertexData=new Float32Array(MAX_VERTICES*(this.enableFrontToBack?3:2));this.texcoordData=new Float32Array(MAX_VERTICES*2);this.pointData=new Float32Array(MAX_POINTS*4);this.pointBuffer=gl.createBuffer();gl.bindBuffer(gl.ARRAY_BUFFER,this.pointBuffer);gl.bufferData(gl.ARRAY_BUFFER,this.pointData.byteLength,gl.DYNAMIC_DRAW);this.vertexBuffers=new Array(MULTI_BUFFERS);this.texcoordBuffers=new Array(MULTI_BUFFERS);for(i=0;i<MULTI_BUFFERS;i++){this.vertexBuffers[i]=gl.createBuffer();gl.bindBuffer(gl.ARRAY_BUFFER,this.vertexBuffers[i]);gl.bufferData(gl.ARRAY_BUFFER,this.vertexData.byteLength,gl.DYNAMIC_DRAW);this.texcoordBuffers[i]=gl.createBuffer();gl.bindBuffer(gl.ARRAY_BUFFER,this.texcoordBuffers[i]);gl.bufferData(gl.ARRAY_BUFFER,this.texcoordData.byteLength,gl.DYNAMIC_DRAW)};this.curBuffer=0;this.indexBuffer=gl.createBuffer();gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,this.indexBuffer);var indexData=new Uint16Array(MAX_INDICES);i=0,len=MAX_INDICES;var fv=0;while(i<len){indexData[i++]=fv;indexData[i++]=fv+1;indexData[i++]=fv+2;indexData[i++]=fv;indexData[i++]=fv+2;indexData[i++]=fv+3;fv+=4};gl.bufferData(gl.ELEMENT_ARRAY_BUFFER,indexData,gl.STATIC_DRAW);this.vertexPtr=0;this.texPtr=0;this.pointPtr=0;var fsSource,vsSource;this.shaderPrograms=[];fsSource=["\x76\x61\x72\x79\x69\x6E\x67\x20\x6D\x65\x64\x69\x75\x6D\x70\x20\x76\x65\x63\x32\x20\x76\x54\x65\x78\x3B","\x75\x6E\x69\x66\x6F\x72\x6D\x20\x6C\x6F\x77\x70\x20\x66\x6C\x6F\x61\x74\x20\x6F\x70\x61\x63\x69\x74\x79\x3B","\x75\x6E\x69\x66\x6F\x72\x6D\x20\x6C\x6F\x77\x70\x20\x73\x61\x6D\x70\x6C\x65\x72\x32\x44\x20\x73\x61\x6D\x70\x6C\x65\x72\x46\x72\x6F\x6E\x74\x3B","\x76\x6F\x69\x64\x20\x6D\x61\x69\x6E\x28\x76\x6F\x69\x64\x29\x20\x7B","\x09\x67\x6C\x5F\x46\x72\x61\x67\x43\x6F\x6C\x6F\x72\x20\x3D\x20\x74\x65\x78\x74\x75\x72\x65\x32\x44\x28\x73\x61\x6D\x70\x6C\x65\x72\x46\x72\x6F\x6E\x74\x2C\x20\x76\x54\x65\x78\x29\x3B","\x09\x67\x6C\x5F\x46\x72\x61\x67\x43\x6F\x6C\x6F\x72\x20\x2A\x3D\x20\x6F\x70\x61\x63\x69\x74\x79\x3B","\x7D"].join("\x0A");if(this.enableFrontToBack){vsSource=["\x61\x74\x74\x72\x69\x62\x75\x74\x65\x20\x68\x69\x67\x68\x70\x20\x76\x65\x63\x33\x20\x61\x50\x6F\x73\x3B","\x61\x74\x74\x72\x69\x62\x75\x74\x65\x20\x6D\x65\x64\x69\x75\x6D\x70\x20\x76\x65\x63\x32\x20\x61\x54\x65\x78\x3B","\x76\x61\x72\x79\x69\x6E\x67\x20\x6D\x65\x64\x69\x75\x6D\x70\x20\x76\x65\x63\x32\x20\x76\x54\x65\x78\x3B","\x75\x6E\x69\x66\x6F\x72\x6D\x20\x68\x69\x67\x68\x70\x20\x6D\x61\x74\x34\x20\x6D\x61\x74\x50\x3B","\x75\x6E\x69\x66\x6F\x72\x6D\x20\x68\x69\x67\x68\x70\x20\x6D\x61\x74\x34\x20\x6D\x61\x74\x4D\x56\x3B","\x76\x6F\x69\x64\x20\x6D\x61\x69\x6E\x28\x76\x6F\x69\x64\x29\x20\x7B","\x09\x67\x6C\x5F\x50\x6F\x73\x69\x74\x69\x6F\x6E\x20\x3D\x20\x6D\x61\x74\x50\x20\x2A\x20\x6D\x61\x74\x4D\x56\x20\x2A\x20\x76\x65\x63\x34\x28\x61\x50\x6F\x73\x2E\x78\x2C\x20\x61\x50\x6F\x73\x2E\x79\x2C\x20\x61\x50\x6F\x73\x2E\x7A\x2C\x20\x31\x2E\x30\x29\x3B","\x09\x76\x54\x65\x78\x20\x3D\x20\x61\x54\x65\x78\x3B","\x7D"].join("\x0A")}else{vsSource=["\x61\x74\x74\x72\x69\x62\x75\x74\x65\x20\x68\x69\x67\x68\x70\x20\x76\x65\x63\x32\x20\x61\x50\x6F\x73\x3B","\x61\x74\x74\x72\x69\x62\x75\x74\x65\x20\x6D\x65\x64\x69\x75\x6D\x70\x20\x76\x65\x63\x32\x20\x61\x54\x65\x78\x3B","\x76\x61\x72\x79\x69\x6E\x67\x20\x6D\x65\x64\x69\x75\x6D\x70\x20\x76\x65\x63\x32\x20\x76\x54\x65\x78\x3B","\x75\x6E\x69\x66\x6F\x72\x6D\x20\x68\x69\x67\x68\x70\x20\x6D\x61\x74\x34\x20\x6D\x61\x74\x50\x3B","\x75\x6E\x69\x66\x6F\x72\x6D\x20\x68\x69\x67\x68\x70\x20\x6D\x61\x74\x34\x20\x6D\x61\x74\x4D\x56\x3B","\x76\x6F\x69\x64\x20\x6D\x61\x69\x6E\x28\x76\x6F\x69\x64\x29\x20\x7B","\x09\x67\x6C\x5F\x50\x6F\x73\x69\x74\x69\x6F\x6E\x20\x3D\x20\x6D\x61\x74\x50\x20\x2A\x20\x6D\x61\x74\x4D\x56\x20\x2A\x20\x76\x65\x63\x34\x28\x61\x50\x6F\x73\x2E\x78\x2C\x20\x61\x50\x6F\x73\x2E\x79\x2C\x20\x30\x2E\x30\x2C\x20\x31\x2E\x30\x29\x3B","\x09\x76\x54\x65\x78\x20\x3D\x20\x61\x54\x65\x78\x3B","\x7D"].join("\x0A")};var shaderProg=this.createShaderProgram({src:fsSource},vsSource,"\x3C\x64\x65\x66\x61\x75\x6C\x74\x3E");;;this.shaderPrograms.push(shaderProg);fsSource=["\x75\x6E\x69\x66\x6F\x72\x6D\x20\x6D\x65\x64\x69\x75\x6D\x70\x20\x73\x61\x6D\x70\x6C\x65\x72\x32\x44\x20\x73\x61\x6D\x70\x6C\x65\x72\x46\x72\x6F\x6E\x74\x3B","\x76\x61\x72\x79\x69\x6E\x67\x20\x6C\x6F\x77\x70\x20\x66\x6C\x6F\x61\x74\x20\x6F\x70\x61\x63\x69\x74\x79\x3B","\x76\x6F\x69\x64\x20\x6D\x61\x69\x6E\x28\x76\x6F\x69\x64\x29\x20\x7B","\x09\x67\x6C\x5F\x46\x72\x61\x67\x43\x6F\x6C\x6F\x72\x20\x3D\x20\x74\x65\x78\x74\x75\x72\x65\x32\x44\x28\x73\x61\x6D\x70\x6C\x65\x72\x46\x72\x6F\x6E\x74\x2C\x20\x67\x6C\x5F\x50\x6F\x69\x6E\x74\x43\x6F\x6F\x72\x64\x29\x3B","\x09\x67\x6C\x5F\x46\x72\x61\x67\x43\x6F\x6C\x6F\x72\x20\x2A\x3D\x20\x6F\x70\x61\x63\x69\x74\x79\x3B","\x7D"].join("\x0A");var pointVsSource=["\x61\x74\x74\x72\x69\x62\x75\x74\x65\x20\x76\x65\x63\x34\x20\x61\x50\x6F\x73\x3B","\x76\x61\x72\x79\x69\x6E\x67\x20\x66\x6C\x6F\x61\x74\x20\x6F\x70\x61\x63\x69\x74\x79\x3B","\x75\x6E\x69\x66\x6F\x72\x6D\x20\x6D\x61\x74\x34\x20\x6D\x61\x74\x50\x3B","\x75\x6E\x69\x66\x6F\x72\x6D\x20\x6D\x61\x74\x34\x20\x6D\x61\x74\x4D\x56\x3B","\x76\x6F\x69\x64\x20\x6D\x61\x69\x6E\x28\x76\x6F\x69\x64\x29\x20\x7B","\x09\x67\x6C\x5F\x50\x6F\x73\x69\x74\x69\x6F\x6E\x20\x3D\x20\x6D\x61\x74\x50\x20\x2A\x20\x6D\x61\x74\x4D\x56\x20\x2A\x20\x76\x65\x63\x34\x28\x61\x50\x6F\x73\x2E\x78\x2C\x20\x61\x50\x6F\x73\x2E\x79\x2C\x20\x30\x2E\x30\x2C\x20\x31\x2E\x30\x29\x3B","\x09\x67\x6C\x5F\x50\x6F\x69\x6E\x74\x53\x69\x7A\x65\x20\x3D\x20\x61\x50\x6F\x73\x2E\x7A\x3B","\x09\x6F\x70\x61\x63\x69\x74\x79\x20\x3D\x20\x61\x50\x6F\x73\x2E\x77\x3B","\x7D"].join("\x0A");shaderProg=this.createShaderProgram({src:fsSource},pointVsSource,"\x3C\x70\x6F\x69\x6E\x74\x3E");;;this.shaderPrograms.push(shaderProg);fsSource=["\x76\x61\x72\x79\x69\x6E\x67\x20\x6D\x65\x64\x69\x75\x6D\x70\x20\x76\x65\x63\x32\x20\x76\x54\x65\x78\x3B","\x75\x6E\x69\x66\x6F\x72\x6D\x20\x6C\x6F\x77\x70\x20\x73\x61\x6D\x70\x6C\x65\x72\x32\x44\x20\x73\x61\x6D\x70\x6C\x65\x72\x46\x72\x6F\x6E\x74\x3B","\x76\x6F\x69\x64\x20\x6D\x61\x69\x6E\x28\x76\x6F\x69\x64\x29\x20\x7B","\x09\x69\x66\x20\x28\x74\x65\x78\x74\x75\x72\x65\x32\x44\x28\x73\x61\x6D\x70\x6C\x65\x72\x46\x72\x6F\x6E\x74\x2C\x20\x76\x54\x65\x78\x29\x2E\x61\x20\x3C\x20\x31\x2E\x30\x29","\x09\x09\x64\x69\x73\x63\x61\x72\x64\x3B","\x7D"].join("\x0A");var shaderProg=this.createShaderProgram({src:fsSource},vsSource,"\x3C\x65\x61\x72\x6C\x79\x7A\x3E");;;this.shaderPrograms.push(shaderProg);fsSource=["\x75\x6E\x69\x66\x6F\x72\x6D\x20\x6C\x6F\x77\x70\x20\x76\x65\x63\x34\x20\x63\x6F\x6C\x6F\x72\x46\x69\x6C\x6C\x3B","\x76\x6F\x69\x64\x20\x6D\x61\x69\x6E\x28\x76\x6F\x69\x64\x29\x20\x7B","\x09\x67\x6C\x5F\x46\x72\x61\x67\x43\x6F\x6C\x6F\x72\x20\x3D\x20\x63\x6F\x6C\x6F\x72\x46\x69\x6C\x6C\x3B","\x7D"].join("\x0A");var shaderProg=this.createShaderProgram({src:fsSource},vsSource,"\x3C\x66\x69\x6C\x6C\x3E");;;this.shaderPrograms.push(shaderProg);for(var shader_name in cr.shaders){if(cr.shaders.hasOwnProperty(shader_name)){this.shaderPrograms.push(this.createShaderProgram(cr.shaders[shader_name],vsSource,shader_name))}};gl.activeTexture(gl.TEXTURE0);gl.bindTexture(gl.TEXTURE_2D,null);this.batch=[];this.batchPtr=0;this.hasQuadBatchTop=false;this.hasPointBatchTop=false;this.lastProgram=-1;this.currentProgram=-1;this.currentShader=null;this.fbo=gl.createFramebuffer();this.renderToTex=null;this.depthBuffer=null;this.attachedDepthBuffer=false;if(this.enableFrontToBack){this.depthBuffer=gl.createRenderbuffer()};this.tmpVec3=vec3.create([0,0,0]);;;var pointsizes=gl.getParameter(gl.ALIASED_POINT_SIZE_RANGE);this.minPointSize=pointsizes[0];this.maxPointSize=pointsizes[1];if(this.maxPointSize>2048){this.maxPointSize=2048};this.switchProgram(0);cr.seal(this)};function GLShaderProgram(gl,shaderProgram,name){this.gl=gl;this.shaderProgram=shaderProgram;this.name=name;this.locAPos=gl.getAttribLocation(shaderProgram,"\x61\x50\x6F\x73");this.locATex=gl.getAttribLocation(shaderProgram,"\x61\x54\x65\x78");this.locMatP=gl.getUniformLocation(shaderProgram,"\x6D\x61\x74\x50");this.locMatMV=gl.getUniformLocation(shaderProgram,"\x6D\x61\x74\x4D\x56");this.locOpacity=gl.getUniformLocation(shaderProgram,"\x6F\x70\x61\x63\x69\x74\x79");this.locColorFill=gl.getUniformLocation(shaderProgram,"\x63\x6F\x6C\x6F\x72\x46\x69\x6C\x6C");this.locSamplerFront=gl.getUniformLocation(shaderProgram,"\x73\x61\x6D\x70\x6C\x65\x72\x46\x72\x6F\x6E\x74");this.locSamplerBack=gl.getUniformLocation(shaderProgram,"\x73\x61\x6D\x70\x6C\x65\x72\x42\x61\x63\x6B");this.locDestStart=gl.getUniformLocation(shaderProgram,"\x64\x65\x73\x74\x53\x74\x61\x72\x74");this.locDestEnd=gl.getUniformLocation(shaderProgram,"\x64\x65\x73\x74\x45\x6E\x64");this.locSeconds=gl.getUniformLocation(shaderProgram,"\x73\x65\x63\x6F\x6E\x64\x73");this.locPixelWidth=gl.getUniformLocation(shaderProgram,"\x70\x69\x78\x65\x6C\x57\x69\x64\x74\x68");this.locPixelHeight=gl.getUniformLocation(shaderProgram,"\x70\x69\x78\x65\x6C\x48\x65\x69\x67\x68\x74");this.locLayerScale=gl.getUniformLocation(shaderProgram,"\x6C\x61\x79\x65\x72\x53\x63\x61\x6C\x65");this.locLayerAngle=gl.getUniformLocation(shaderProgram,"\x6C\x61\x79\x65\x72\x41\x6E\x67\x6C\x65");this.locViewOrigin=gl.getUniformLocation(shaderProgram,"\x76\x69\x65\x77\x4F\x72\x69\x67\x69\x6E");this.locScrollPos=gl.getUniformLocation(shaderProgram,"\x73\x63\x72\x6F\x6C\x6C\x50\x6F\x73");this.hasAnyOptionalUniforms=!!(this.locPixelWidth||this.locPixelHeight||this.locSeconds||this.locSamplerBack||this.locDestStart||this.locDestEnd||this.locLayerScale||this.locLayerAngle||this.locViewOrigin||this.locScrollPos);this.lpPixelWidth=-999;this.lpPixelHeight=-999;this.lpOpacity=1;this.lpDestStartX=0.0;this.lpDestStartY=0.0;this.lpDestEndX=1.0;this.lpDestEndY=1.0;this.lpLayerScale=1.0;this.lpLayerAngle=0.0;this.lpViewOriginX=0.0;this.lpViewOriginY=0.0;this.lpScrollPosX=0.0;this.lpScrollPosY=0.0;this.lpSeconds=0.0;this.lastCustomParams=[];this.lpMatMV=mat4.create();if(this.locOpacity){gl.uniform1f(this.locOpacity,1)};if(this.locColorFill){gl.uniform4f(this.locColorFill,1.0,1.0,1.0,1.0)};if(this.locSamplerFront){gl.uniform1i(this.locSamplerFront,0)};if(this.locSamplerBack){gl.uniform1i(this.locSamplerBack,1)};if(this.locDestStart){gl.uniform2f(this.locDestStart,0.0,0.0)};if(this.locDestEnd){gl.uniform2f(this.locDestEnd,1.0,1.0)};if(this.locLayerScale){gl.uniform1f(this.locLayerScale,1.0)};if(this.locLayerAngle){gl.uniform1f(this.locLayerAngle,0.0)};if(this.locViewOrigin){gl.uniform2f(this.locViewOrigin,0.0,0.0)};if(this.locScrollPos){gl.uniform2f(this.locScrollPos,0.0,0.0)};if(this.locSeconds){gl.uniform1f(this.locSeconds,0.0)};this.hasCurrentMatMV=false}function areMat4sEqual(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]&&a[3]===b[3]&&a[4]===b[4]&&a[5]===b[5]&&a[6]===b[6]&&a[7]===b[7]&&a[8]===b[8]&&a[9]===b[9]&&a[10]===b[10]&&a[11]===b[11]&&a[12]===b[12]&&a[13]===b[13]&&a[14]===b[14]&&a[15]===b[15]}GLShaderProgram.prototype.updateMatMV=function(mv){if(areMat4sEqual(this.lpMatMV,mv)){return};mat4["\x73\x65\x74"](mv,this.lpMatMV);this.gl.uniformMatrix4fv(this.locMatMV,false,mv)};GLWrap_.prototype.createShaderProgram=function(shaderEntry,vsSource,name){var gl=this.gl;var fragmentShader=gl.createShader(gl.FRAGMENT_SHADER);gl.shaderSource(fragmentShader,shaderEntry.src);gl.compileShader(fragmentShader);if(!gl.getShaderParameter(fragmentShader,gl.COMPILE_STATUS)){;;gl.deleteShader(fragmentShader);return null};var vertexShader=gl.createShader(gl.VERTEX_SHADER);gl.shaderSource(vertexShader,vsSource);gl.compileShader(vertexShader);if(!gl.getShaderParameter(vertexShader,gl.COMPILE_STATUS)){;;gl.deleteShader(fragmentShader);gl.deleteShader(vertexShader);return null};var shaderProgram=gl.createProgram();gl.attachShader(shaderProgram,fragmentShader);gl.attachShader(shaderProgram,vertexShader);gl.linkProgram(shaderProgram);if(!gl.getProgramParameter(shaderProgram,gl.LINK_STATUS)){;;gl.deleteShader(fragmentShader);gl.deleteShader(vertexShader);gl.deleteProgram(shaderProgram);return null};gl.useProgram(shaderProgram);gl.deleteShader(fragmentShader);gl.deleteShader(vertexShader);var ret=new GLShaderProgram(gl,shaderProgram,name);ret.extendBoxHorizontal=shaderEntry.extendBoxHorizontal||0;ret.extendBoxVertical=shaderEntry.extendBoxVertical||0;ret.crossSampling=!!shaderEntry.crossSampling;ret.preservesOpaqueness=!!shaderEntry.preservesOpaqueness;ret.animated=!!shaderEntry.animated;ret.parameters=shaderEntry.parameters||[];var i,len;for(i=0,len=ret.parameters.length;i<len;i++){ret.parameters[i][1]=gl.getUniformLocation(shaderProgram,ret.parameters[i][0]);ret.lastCustomParams.push(0);gl.uniform1f(ret.parameters[i][1],0)};cr.seal(ret);return ret};GLWrap_.prototype.getShaderIndex=function(name_){var i,len;for(i=0,len=this.shaderPrograms.length;i<len;i++){if(this.shaderPrograms[i].name===name_){return i}};return-1};GLWrap_.prototype.project=function(x,y,out){var mv=this.matMV;var proj=this.matP;var fTempo=[0,0,0,0,0,0,0,0];fTempo[0]=mv[0]*x+mv[4]*y+mv[12];fTempo[1]=mv[1]*x+mv[5]*y+mv[13];fTempo[2]=mv[2]*x+mv[6]*y+mv[14];fTempo[3]=mv[3]*x+mv[7]*y+mv[15];fTempo[4]=proj[0]*fTempo[0]+proj[4]*fTempo[1]+proj[8]*fTempo[2]+proj[12]*fTempo[3];fTempo[5]=proj[1]*fTempo[0]+proj[5]*fTempo[1]+proj[9]*fTempo[2]+proj[13]*fTempo[3];fTempo[6]=proj[2]*fTempo[0]+proj[6]*fTempo[1]+proj[10]*fTempo[2]+proj[14]*fTempo[3];fTempo[7]=-fTempo[2];if(fTempo[7]===0.0){return};fTempo[7]=1.0/fTempo[7];fTempo[4]*=fTempo[7];fTempo[5]*=fTempo[7];fTempo[6]*=fTempo[7];out[0]=(fTempo[4]*0.5+0.5)*this.width;out[1]=(fTempo[5]*0.5+0.5)*this.height};GLWrap_.prototype.setSize=function(w,h,force){if(this.width===w&&this.height===h&&!force){return};this.endBatch();var gl=this.gl;this.width=w;this.height=h;gl.viewport(0,0,w,h);mat4.lookAt(this.cam,this.look,this.up,this.matMV);if(this.enableFrontToBack){mat4.ortho(-w/2,w/2,h/2,-h/2,this.zNear,this.zFar,this.matP);this.worldScale[0]=1;this.worldScale[1]=1}else{mat4.perspective(45,w/h,this.zNear,this.zFar,this.matP);var tl=[0,0];var br=[0,0];this.project(0,0,tl);this.project(1,1,br);this.worldScale[0]=1/(br[0]-tl[0]);this.worldScale[1]=-1/(br[1]-tl[1])};var i,len,s;for(i=0,len=this.shaderPrograms.length;i<len;i++){s=this.shaderPrograms[i];s.hasCurrentMatMV=false;if(s.locMatP){gl.useProgram(s.shaderProgram);gl.uniformMatrix4fv(s.locMatP,false,this.matP)}};gl.useProgram(this.shaderPrograms[this.lastProgram].shaderProgram);gl.bindTexture(gl.TEXTURE_2D,null);gl.activeTexture(gl.TEXTURE1);gl.bindTexture(gl.TEXTURE_2D,null);gl.activeTexture(gl.TEXTURE0);this.lastTexture0=null;this.lastTexture1=null;if(this.depthBuffer){gl.bindFramebuffer(gl.FRAMEBUFFER,this.fbo);gl.bindRenderbuffer(gl.RENDERBUFFER,this.depthBuffer);gl.renderbufferStorage(gl.RENDERBUFFER,gl.DEPTH_COMPONENT16,this.width,this.height);if(!this.attachedDepthBuffer){gl.framebufferRenderbuffer(gl.FRAMEBUFFER,gl.DEPTH_ATTACHMENT,gl.RENDERBUFFER,this.depthBuffer);this.attachedDepthBuffer=true};gl.bindRenderbuffer(gl.RENDERBUFFER,null);gl.bindFramebuffer(gl.FRAMEBUFFER,null);this.renderToTex=null}};GLWrap_.prototype.resetModelView=function(){mat4.lookAt(this.cam,this.look,this.up,this.matMV);mat4.scale(this.matMV,this.worldScale)};GLWrap_.prototype.translate=function(x,y){if(x===0&&y===0){return};this.tmpVec3[0]=x;this.tmpVec3[1]=y;this.tmpVec3[2]=0;mat4.translate(this.matMV,this.tmpVec3)};GLWrap_.prototype.scale=function(x,y){if(x===1&&y===1){return};this.tmpVec3[0]=x;this.tmpVec3[1]=y;this.tmpVec3[2]=1;mat4.scale(this.matMV,this.tmpVec3)};GLWrap_.prototype.rotateZ=function(a){if(a===0){return};mat4.rotateZ(this.matMV,a)};GLWrap_.prototype.updateModelView=function(){if(areMat4sEqual(this.lastMV,this.matMV)){return};var b=this.pushBatch();b.type=BATCH_UPDATEMODELVIEW;if(b.mat4param){mat4["\x73\x65\x74"](this.matMV,b.mat4param)}else{b.mat4param=mat4.create(this.matMV)};mat4["\x73\x65\x74"](this.matMV,this.lastMV);this.hasQuadBatchTop=false;this.hasPointBatchTop=false};GLWrap_.prototype.setEarlyZIndex=function(i){if(!this.enableFrontToBack){return};if(i>32760){i=32760};this.currentZ=this.cam[2]-this.zNear-i*this.zIncrement};function GLBatchJob(type_,glwrap_){this.type=type_;this.glwrap=glwrap_;this.gl=glwrap_.gl;this.opacityParam=0;this.startIndex=0;this.indexCount=0;this.texParam=null;this.mat4param=null;this.shaderParams=[];cr.seal(this)}GLBatchJob.prototype.doSetEarlyZPass=function(){var gl=this.gl;var glwrap=this.glwrap;if(this.startIndex!==0){gl.depthMask(true);gl.colorMask(false,false,false,false);gl.disable(gl.BLEND);gl.bindFramebuffer(gl.FRAMEBUFFER,glwrap.fbo);gl.framebufferTexture2D(gl.FRAMEBUFFER,gl.COLOR_ATTACHMENT0,gl.TEXTURE_2D,null,0);gl.clear(gl.DEPTH_BUFFER_BIT);gl.bindFramebuffer(gl.FRAMEBUFFER,null);glwrap.isBatchInEarlyZPass=true}else{gl.depthMask(false);gl.colorMask(true,true,true,true);gl.enable(gl.BLEND);glwrap.isBatchInEarlyZPass=false}};GLBatchJob.prototype.doSetTexture=function(){this.gl.bindTexture(this.gl.TEXTURE_2D,this.texParam)};GLBatchJob.prototype.doSetTexture1=function(){var gl=this.gl;gl.activeTexture(gl.TEXTURE1);gl.bindTexture(gl.TEXTURE_2D,this.texParam);gl.activeTexture(gl.TEXTURE0)};GLBatchJob.prototype.doSetOpacity=function(){var o=this.opacityParam;var glwrap=this.glwrap;glwrap.currentOpacity=o;var curProg=glwrap.currentShader;if(curProg.locOpacity&&curProg.lpOpacity!==o){curProg.lpOpacity=o;this.gl.uniform1f(curProg.locOpacity,o)}};GLBatchJob.prototype.doQuad=function(){this.gl.drawElements(this.gl.TRIANGLES,this.indexCount,this.gl.UNSIGNED_SHORT,this.startIndex)};GLBatchJob.prototype.doSetBlend=function(){this.gl.blendFunc(this.startIndex,this.indexCount)};GLBatchJob.prototype.doUpdateModelView=function(){var i,len,s,shaderPrograms=this.glwrap.shaderPrograms,currentProgram=this.glwrap.currentProgram;for(i=0,len=shaderPrograms.length;i<len;i++){s=shaderPrograms[i];if(i===currentProgram&&s.locMatMV){s.updateMatMV(this.mat4param);s.hasCurrentMatMV=true}else{s.hasCurrentMatMV=false}};mat4["\x73\x65\x74"](this.mat4param,this.glwrap.currentMV)};GLBatchJob.prototype.doRenderToTexture=function(){var gl=this.gl;var glwrap=this.glwrap;if(this.texParam){if(glwrap.lastTexture1===this.texParam){gl.activeTexture(gl.TEXTURE1);gl.bindTexture(gl.TEXTURE_2D,null);glwrap.lastTexture1=null;gl.activeTexture(gl.TEXTURE0)};gl.bindFramebuffer(gl.FRAMEBUFFER,glwrap.fbo);if(!glwrap.isBatchInEarlyZPass){gl.framebufferTexture2D(gl.FRAMEBUFFER,gl.COLOR_ATTACHMENT0,gl.TEXTURE_2D,this.texParam,0)}}else{if(!glwrap.enableFrontToBack){gl.framebufferTexture2D(gl.FRAMEBUFFER,gl.COLOR_ATTACHMENT0,gl.TEXTURE_2D,null,0)};gl.bindFramebuffer(gl.FRAMEBUFFER,null)}};GLBatchJob.prototype.doClear=function(){var gl=this.gl;var mode=this.startIndex;if(mode===0){gl.clearColor(this.mat4param[0],this.mat4param[1],this.mat4param[2],this.mat4param[3]);gl.clear(gl.COLOR_BUFFER_BIT)}else{if(mode===1){gl.enable(gl.SCISSOR_TEST);gl.scissor(this.mat4param[0],this.mat4param[1],this.mat4param[2],this.mat4param[3]);gl.clearColor(0,0,0,0);gl.clear(gl.COLOR_BUFFER_BIT);gl.disable(gl.SCISSOR_TEST)}else{gl.clear(gl.DEPTH_BUFFER_BIT)}}};GLBatchJob.prototype.doSetDepthTestEnabled=function(){var gl=this.gl;var enable=this.startIndex;if(enable!==0){gl.enable(gl.DEPTH_TEST)}else{gl.disable(gl.DEPTH_TEST)}};GLBatchJob.prototype.doPoints=function(){var gl=this.gl;var glwrap=this.glwrap;if(glwrap.enableFrontToBack){gl.disable(gl.DEPTH_TEST)};var s=glwrap.shaderPrograms[1];gl.useProgram(s.shaderProgram);if(!s.hasCurrentMatMV&&s.locMatMV){s.updateMatMV(glwrap.currentMV);s.hasCurrentMatMV=true};gl.enableVertexAttribArray(s.locAPos);gl.bindBuffer(gl.ARRAY_BUFFER,glwrap.pointBuffer);gl.vertexAttribPointer(s.locAPos,4,gl.FLOAT,false,0,0);gl.drawArrays(gl.POINTS,this.startIndex/4,this.indexCount);s=glwrap.currentShader;gl.useProgram(s.shaderProgram);if(s.locAPos>=0){gl.enableVertexAttribArray(s.locAPos);gl.bindBuffer(gl.ARRAY_BUFFER,glwrap.vertexBuffers[glwrap.curBuffer]);gl.vertexAttribPointer(s.locAPos,glwrap.enableFrontToBack?3:2,gl.FLOAT,false,0,0)};if(s.locATex>=0){gl.enableVertexAttribArray(s.locATex);gl.bindBuffer(gl.ARRAY_BUFFER,glwrap.texcoordBuffers[glwrap.curBuffer]);gl.vertexAttribPointer(s.locATex,2,gl.FLOAT,false,0,0)};if(glwrap.enableFrontToBack){gl.enable(gl.DEPTH_TEST)}};GLBatchJob.prototype.doSetProgram=function(){var gl=this.gl;var glwrap=this.glwrap;var s=glwrap.shaderPrograms[this.startIndex];glwrap.currentProgram=this.startIndex;glwrap.currentShader=s;gl.useProgram(s.shaderProgram);if(!s.hasCurrentMatMV&&s.locMatMV){s.updateMatMV(glwrap.currentMV);s.hasCurrentMatMV=true};if(s.locOpacity&&s.lpOpacity!==glwrap.currentOpacity){s.lpOpacity=glwrap.currentOpacity;gl.uniform1f(s.locOpacity,glwrap.currentOpacity)};if(s.locAPos>=0){gl.enableVertexAttribArray(s.locAPos);gl.bindBuffer(gl.ARRAY_BUFFER,glwrap.vertexBuffers[glwrap.curBuffer]);gl.vertexAttribPointer(s.locAPos,glwrap.enableFrontToBack?3:2,gl.FLOAT,false,0,0)};if(s.locATex>=0){gl.enableVertexAttribArray(s.locATex);gl.bindBuffer(gl.ARRAY_BUFFER,glwrap.texcoordBuffers[glwrap.curBuffer]);gl.vertexAttribPointer(s.locATex,2,gl.FLOAT,false,0,0)}};GLBatchJob.prototype.doSetColor=function(){var s=this.glwrap.currentShader;var mat4param=this.mat4param;this.gl.uniform4f(s.locColorFill,mat4param[0],mat4param[1],mat4param[2],mat4param[3])};GLBatchJob.prototype.doSetProgramParameters=function(){var i,len,s=this.glwrap.currentShader;var gl=this.gl;var mat4param=this.mat4param;if(s.locSamplerBack&&this.glwrap.lastTexture1!==this.texParam){gl.activeTexture(gl.TEXTURE1);gl.bindTexture(gl.TEXTURE_2D,this.texParam);this.glwrap.lastTexture1=this.texParam;gl.activeTexture(gl.TEXTURE0)};var v=mat4param[0];var v2;if(s.locPixelWidth&&v!==s.lpPixelWidth){s.lpPixelWidth=v;gl.uniform1f(s.locPixelWidth,v)};v=mat4param[1];if(s.locPixelHeight&&v!==s.lpPixelHeight){s.lpPixelHeight=v;gl.uniform1f(s.locPixelHeight,v)};v=mat4param[2];v2=mat4param[3];if(s.locDestStart&&(v!==s.lpDestStartX||v2!==s.lpDestStartY)){s.lpDestStartX=v;s.lpDestStartY=v2;gl.uniform2f(s.locDestStart,v,v2)};v=mat4param[4];v2=mat4param[5];if(s.locDestEnd&&(v!==s.lpDestEndX||v2!==s.lpDestEndY)){s.lpDestEndX=v;s.lpDestEndY=v;gl.uniform2f(s.locDestEnd,v,v2)};v=mat4param[6];if(s.locLayerScale&&v!==s.lpLayerScale){s.lpLayerScale=v;gl.uniform1f(s.locLayerScale,v)};v=mat4param[7];if(s.locLayerAngle&&v!==s.lpLayerAngle){s.lpLayerAngle=v;gl.uniform1f(s.locLayerAngle,v)};v=mat4param[8];v2=mat4param[9];if(s.locViewOrigin&&(v!==s.lpViewOriginX||v2!==s.lpViewOriginY)){s.lpViewOriginX=v;s.lpViewOriginY=v2;gl.uniform2f(s.locViewOrigin,v,v2)};v=mat4param[10];v2=mat4param[11];if(s.locScrollPos&&(v!==s.lpScrollPosX||v2!==s.lpScrollPosY)){s.lpScrollPosX=v;s.lpScrollPosY=v2;gl.uniform2f(s.locScrollPos,v,v2)};v=mat4param[12];if(s.locSeconds&&v!==s.lpSeconds){s.lpSeconds=v;gl.uniform1f(s.locSeconds,v)};if(s.parameters.length){for(i=0,len=s.parameters.length;i<len;i++){v=this.shaderParams[i];if(v!==s.lastCustomParams[i]){s.lastCustomParams[i]=v;gl.uniform1f(s.parameters[i][1],v)}}}};GLWrap_.prototype.pushBatch=function(){if(this.batchPtr===this.batch.length){this.batch.push(new GLBatchJob(BATCH_NULL,this))};return this.batch[this.batchPtr++]};GLWrap_.prototype.endBatch=function(){if(this.batchPtr===0){return};if(this.gl.isContextLost()){return};var gl=this.gl;if(this.pointPtr>0){gl.bindBuffer(gl.ARRAY_BUFFER,this.pointBuffer);gl.bufferSubData(gl.ARRAY_BUFFER,0,this.pointData.subarray(0,this.pointPtr));if(s&&s.locAPos>=0&&s.name==="\x3C\x70\x6F\x69\x6E\x74\x3E"){gl.vertexAttribPointer(s.locAPos,4,gl.FLOAT,false,0,0)}};if(this.vertexPtr>0){var s=this.currentShader;gl.bindBuffer(gl.ARRAY_BUFFER,this.vertexBuffers[this.curBuffer]);gl.bufferSubData(gl.ARRAY_BUFFER,0,this.vertexData.subarray(0,this.vertexPtr));if(s&&s.locAPos>=0&&s.name!=="\x3C\x70\x6F\x69\x6E\x74\x3E"){gl.vertexAttribPointer(s.locAPos,this.enableFrontToBack?3:2,gl.FLOAT,false,0,0)};gl.bindBuffer(gl.ARRAY_BUFFER,this.texcoordBuffers[this.curBuffer]);gl.bufferSubData(gl.ARRAY_BUFFER,0,this.texcoordData.subarray(0,this.texPtr));if(s&&s.locATex>=0&&s.name!=="\x3C\x70\x6F\x69\x6E\x74\x3E"){gl.vertexAttribPointer(s.locATex,2,gl.FLOAT,false,0,0)}};var i,len,b;for(i=0,len=this.batchPtr;i<len;i++){b=this.batch[i];switch(b.type){case 1:b.doQuad();break;case 2:b.doSetTexture();break;case 3:b.doSetOpacity();break;case 4:b.doSetBlend();break;case 5:b.doUpdateModelView();break;case 6:b.doRenderToTexture();break;case 7:b.doClear();break;case 8:b.doPoints();break;case 9:b.doSetProgram();break;case 10:b.doSetProgramParameters();break;case 11:b.doSetTexture1();break;case 12:b.doSetColor();break;case 13:b.doSetDepthTestEnabled();break;case 14:b.doSetEarlyZPass();break}};this.batchPtr=0;this.vertexPtr=0;this.texPtr=0;this.pointPtr=0;this.hasQuadBatchTop=false;this.hasPointBatchTop=false;this.isBatchInEarlyZPass=false;this.curBuffer++;if(this.curBuffer>=MULTI_BUFFERS){this.curBuffer=0}};GLWrap_.prototype.setOpacity=function(op){if(op===this.lastOpacity){return};if(this.isEarlyZPass){return};var b=this.pushBatch();b.type=BATCH_SETOPACITY;b.opacityParam=op;this.lastOpacity=op;this.hasQuadBatchTop=false;this.hasPointBatchTop=false};GLWrap_.prototype.setTexture=function(tex){if(tex===this.lastTexture0){return};var b=this.pushBatch();b.type=BATCH_SETTEXTURE;b.texParam=tex;this.lastTexture0=tex;this.hasQuadBatchTop=false;this.hasPointBatchTop=false};GLWrap_.prototype.setBlend=function(s,d){if(s===this.lastSrcBlend&&d===this.lastDestBlend){return};if(this.isEarlyZPass){return};var b=this.pushBatch();b.type=BATCH_SETBLEND;b.startIndex=s;b.indexCount=d;this.lastSrcBlend=s;this.lastDestBlend=d;this.hasQuadBatchTop=false;this.hasPointBatchTop=false};GLWrap_.prototype.isPremultipliedAlphaBlend=function(){return(this.lastSrcBlend===this.gl.ONE&&this.lastDestBlend===this.gl.ONE_MINUS_SRC_ALPHA)};GLWrap_.prototype.setAlphaBlend=function(){this.setBlend(this.gl.ONE,this.gl.ONE_MINUS_SRC_ALPHA)};GLWrap_.prototype.setNoPremultiplyAlphaBlend=function(){this.setBlend(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA)};var LAST_VERTEX=MAX_VERTICES*2-8;GLWrap_.prototype.quad=function(tlx,tly,trx,try_,brx,bry,blx,bly){if(this.vertexPtr>=LAST_VERTEX){this.endBatch()};var v=this.vertexPtr;var t=this.texPtr;var vd=this.vertexData;var td=this.texcoordData;var currentZ=this.currentZ;if(this.hasQuadBatchTop){this.batch[this.batchPtr-1].indexCount+=6}else{var b=this.pushBatch();b.type=BATCH_QUAD;b.startIndex=this.enableFrontToBack?v:(v/2)*3;b.indexCount=6;this.hasQuadBatchTop=true;this.hasPointBatchTop=false};if(this.enableFrontToBack){vd[v++]=tlx;vd[v++]=tly;vd[v++]=currentZ;vd[v++]=trx;vd[v++]=try_;vd[v++]=currentZ;vd[v++]=brx;vd[v++]=bry;vd[v++]=currentZ;vd[v++]=blx;vd[v++]=bly;vd[v++]=currentZ}else{vd[v++]=tlx;vd[v++]=tly;vd[v++]=trx;vd[v++]=try_;vd[v++]=brx;vd[v++]=bry;vd[v++]=blx;vd[v++]=bly};td[t++]=0;td[t++]=0;td[t++]=1;td[t++]=0;td[t++]=1;td[t++]=1;td[t++]=0;td[t++]=1;this.vertexPtr=v;this.texPtr=t};GLWrap_.prototype.quadTex=function(tlx,tly,trx,try_,brx,bry,blx,bly,rcTex){if(this.vertexPtr>=LAST_VERTEX){this.endBatch()};var v=this.vertexPtr;var t=this.texPtr;var vd=this.vertexData;var td=this.texcoordData;var currentZ=this.currentZ;if(this.hasQuadBatchTop){this.batch[this.batchPtr-1].indexCount+=6}else{var b=this.pushBatch();b.type=BATCH_QUAD;b.startIndex=this.enableFrontToBack?v:(v/2)*3;b.indexCount=6;this.hasQuadBatchTop=true;this.hasPointBatchTop=false};var rc_left=rcTex.left;var rc_top=rcTex.top;var rc_right=rcTex.right;var rc_bottom=rcTex.bottom;if(this.enableFrontToBack){vd[v++]=tlx;vd[v++]=tly;vd[v++]=currentZ;vd[v++]=trx;vd[v++]=try_;vd[v++]=currentZ;vd[v++]=brx;vd[v++]=bry;vd[v++]=currentZ;vd[v++]=blx;vd[v++]=bly;vd[v++]=currentZ}else{vd[v++]=tlx;vd[v++]=tly;vd[v++]=trx;vd[v++]=try_;vd[v++]=brx;vd[v++]=bry;vd[v++]=blx;vd[v++]=bly};td[t++]=rc_left;td[t++]=rc_top;td[t++]=rc_right;td[t++]=rc_top;td[t++]=rc_right;td[t++]=rc_bottom;td[t++]=rc_left;td[t++]=rc_bottom;this.vertexPtr=v;this.texPtr=t};GLWrap_.prototype.quadTexUV=function(tlx,tly,trx,try_,brx,bry,blx,bly,tlu,tlv,tru,trv,bru,brv,blu,blv){if(this.vertexPtr>=LAST_VERTEX){this.endBatch()};var v=this.vertexPtr;var t=this.texPtr;var vd=this.vertexData;var td=this.texcoordData;var currentZ=this.currentZ;if(this.hasQuadBatchTop){this.batch[this.batchPtr-1].indexCount+=6}else{var b=this.pushBatch();b.type=BATCH_QUAD;b.startIndex=this.enableFrontToBack?v:(v/2)*3;b.indexCount=6;this.hasQuadBatchTop=true;this.hasPointBatchTop=false};if(this.enableFrontToBack){vd[v++]=tlx;vd[v++]=tly;vd[v++]=currentZ;vd[v++]=trx;vd[v++]=try_;vd[v++]=currentZ;vd[v++]=brx;vd[v++]=bry;vd[v++]=currentZ;vd[v++]=blx;vd[v++]=bly;vd[v++]=currentZ}else{vd[v++]=tlx;vd[v++]=tly;vd[v++]=trx;vd[v++]=try_;vd[v++]=brx;vd[v++]=bry;vd[v++]=blx;vd[v++]=bly};td[t++]=tlu;td[t++]=tlv;td[t++]=tru;td[t++]=trv;td[t++]=bru;td[t++]=brv;td[t++]=blu;td[t++]=blv;this.vertexPtr=v;this.texPtr=t};GLWrap_.prototype.convexPoly=function(pts){var pts_count=pts.length/2;;;var tris=pts_count-2;var last_tri=tris-1;var p0x=pts[0];var p0y=pts[1];var i,i2,p1x,p1y,p2x,p2y,p3x,p3y;for(i=0;i<tris;i+=2){i2=i*2;p1x=pts[i2+2];p1y=pts[i2+3];p2x=pts[i2+4];p2y=pts[i2+5];if(i===last_tri){this.quad(p0x,p0y,p1x,p1y,p2x,p2y,p2x,p2y)}else{p3x=pts[i2+6];p3y=pts[i2+7];this.quad(p0x,p0y,p1x,p1y,p2x,p2y,p3x,p3y)}}};var LAST_POINT=MAX_POINTS-4;GLWrap_.prototype.point=function(x_,y_,size_,opacity_){if(this.pointPtr>=LAST_POINT){this.endBatch()};var p=this.pointPtr;var pd=this.pointData;if(this.hasPointBatchTop){this.batch[this.batchPtr-1].indexCount++}else{var b=this.pushBatch();b.type=BATCH_POINTS;b.startIndex=p;b.indexCount=1;this.hasPointBatchTop=true;this.hasQuadBatchTop=false};pd[p++]=x_;pd[p++]=y_;pd[p++]=size_;pd[p++]=opacity_;this.pointPtr=p};GLWrap_.prototype.switchProgram=function(progIndex){if(this.lastProgram===progIndex){return};var shaderProg=this.shaderPrograms[progIndex];if(!shaderProg){if(this.lastProgram===0){return};progIndex=0;shaderProg=this.shaderPrograms[0]};var b=this.pushBatch();b.type=BATCH_SETPROGRAM;b.startIndex=progIndex;this.lastProgram=progIndex;this.hasQuadBatchTop=false;this.hasPointBatchTop=false};GLWrap_.prototype.programUsesDest=function(progIndex){var s=this.shaderPrograms[progIndex];return!!(s.locDestStart||s.locDestEnd)};GLWrap_.prototype.programUsesCrossSampling=function(progIndex){var s=this.shaderPrograms[progIndex];return!!(s.locDestStart||s.locDestEnd||s.crossSampling)};GLWrap_.prototype.programPreservesOpaqueness=function(progIndex){return this.shaderPrograms[progIndex].preservesOpaqueness};GLWrap_.prototype.programExtendsBox=function(progIndex){var s=this.shaderPrograms[progIndex];return s.extendBoxHorizontal!==0||s.extendBoxVertical!==0};GLWrap_.prototype.getProgramBoxExtendHorizontal=function(progIndex){return this.shaderPrograms[progIndex].extendBoxHorizontal};GLWrap_.prototype.getProgramBoxExtendVertical=function(progIndex){return this.shaderPrograms[progIndex].extendBoxVertical};GLWrap_.prototype.getProgramParameterType=function(progIndex,paramIndex){return this.shaderPrograms[progIndex].parameters[paramIndex][2]};GLWrap_.prototype.programIsAnimated=function(progIndex){return this.shaderPrograms[progIndex].animated};GLWrap_.prototype.setProgramParameters=function(backTex,pixelWidth,pixelHeight,destStartX,destStartY,destEndX,destEndY,layerScale,layerAngle,viewOriginLeft,viewOriginTop,scrollPosX,scrollPosY,seconds,params){var i,len;var s=this.shaderPrograms[this.lastProgram];var b,mat4param,shaderParams;if(s.hasAnyOptionalUniforms||params.length){b=this.pushBatch();b.type=BATCH_SETPROGRAMPARAMETERS;if(b.mat4param){mat4["\x73\x65\x74"](this.matMV,b.mat4param)}else{b.mat4param=mat4.create()};mat4param=b.mat4param;mat4param[0]=pixelWidth;mat4param[1]=pixelHeight;mat4param[2]=destStartX;mat4param[3]=destStartY;mat4param[4]=destEndX;mat4param[5]=destEndY;mat4param[6]=layerScale;mat4param[7]=layerAngle;mat4param[8]=viewOriginLeft;mat4param[9]=viewOriginTop;mat4param[10]=scrollPosX;mat4param[11]=scrollPosY;mat4param[12]=seconds;if(s.locSamplerBack){;;b.texParam=backTex}else{b.texParam=null};if(params.length){shaderParams=b.shaderParams;shaderParams.length=params.length;for(i=0,len=params.length;i<len;i++){shaderParams[i]=params[i]}};this.hasQuadBatchTop=false;this.hasPointBatchTop=false}};GLWrap_.prototype.clear=function(r,g,b_,a){var b=this.pushBatch();b.type=BATCH_CLEAR;b.startIndex=0;if(!b.mat4param){b.mat4param=mat4.create()};b.mat4param[0]=r;b.mat4param[1]=g;b.mat4param[2]=b_;b.mat4param[3]=a;this.hasQuadBatchTop=false;this.hasPointBatchTop=false};GLWrap_.prototype.clearRect=function(x,y,w,h){if(w<0||h<0){return};var b=this.pushBatch();b.type=BATCH_CLEAR;b.startIndex=1;if(!b.mat4param){b.mat4param=mat4.create()};b.mat4param[0]=x;b.mat4param[1]=y;b.mat4param[2]=w;b.mat4param[3]=h;this.hasQuadBatchTop=false;this.hasPointBatchTop=false};GLWrap_.prototype.clearDepth=function(){var b=this.pushBatch();b.type=BATCH_CLEAR;b.startIndex=2;this.hasQuadBatchTop=false;this.hasPointBatchTop=false};GLWrap_.prototype.setEarlyZPass=function(e){if(!this.enableFrontToBack){return};e=!!e;if(this.isEarlyZPass===e){return};var b=this.pushBatch();b.type=BATCH_SETEARLYZMODE;b.startIndex=(e?1:0);this.hasQuadBatchTop=false;this.hasPointBatchTop=false;this.isEarlyZPass=e;this.renderToTex=null;if(this.isEarlyZPass){this.switchProgram(2)}else{this.switchProgram(0)}};GLWrap_.prototype.setDepthTestEnabled=function(e){if(!this.enableFrontToBack){return};var b=this.pushBatch();b.type=BATCH_SETDEPTHTEST;b.startIndex=(e?1:0);this.hasQuadBatchTop=false;this.hasPointBatchTop=false};GLWrap_.prototype.fullscreenQuad=function(){mat4["\x73\x65\x74"](this.lastMV,tempMat4);this.resetModelView();this.updateModelView();var halfw=this.width/2;var halfh=this.height/2;this.quad(-halfw,halfh,halfw,halfh,halfw,-halfh,-halfw,-halfh);mat4["\x73\x65\x74"](tempMat4,this.matMV);this.updateModelView()};GLWrap_.prototype.setColorFillMode=function(r_,g_,b_,a_){this.switchProgram(3);var b=this.pushBatch();b.type=BATCH_SETCOLOR;if(!b.mat4param){b.mat4param=mat4.create()};b.mat4param[0]=r_;b.mat4param[1]=g_;b.mat4param[2]=b_;b.mat4param[3]=a_;this.hasQuadBatchTop=false;this.hasPointBatchTop=false};GLWrap_.prototype.setTextureFillMode=function(){;;this.switchProgram(0)};GLWrap_.prototype.restoreEarlyZMode=function(){;;this.switchProgram(2)};GLWrap_.prototype.present=function(){this.endBatch();this.gl.flush()};function nextHighestPowerOfTwo(x){--x;for(var i=1;i<32;i<<=1){x=x|x>>i};return x+1}var all_textures=[];var textures_by_src={};GLWrap_.prototype.contextLost=function(){cr.clearArray(all_textures);textures_by_src={}};var BF_RGBA8=0;var BF_RGB8=1;var BF_RGBA4=2;var BF_RGB5_A1=3;var BF_RGB565=4;GLWrap_.prototype.loadTexture=function(img,tiling,linearsampling,pixelformat,tiletype,nomip){tiling=!!tiling;linearsampling=!!linearsampling;var tex_key=img.src+"\x2C"+tiling+"\x2C"+linearsampling+(tiling?("\x2C"+tiletype):"");var webGL_texture=null;if(typeof img.src!=="\x75\x6E\x64\x65\x66\x69\x6E\x65\x64"&&textures_by_src.hasOwnProperty(tex_key)){webGL_texture=textures_by_src[tex_key];webGL_texture.c2refcount++;return webGL_texture};this.endBatch();;;var gl=this.gl;var isPOT=(cr.isPOT(img.width)&&cr.isPOT(img.height));webGL_texture=gl.createTexture();gl.bindTexture(gl.TEXTURE_2D,webGL_texture);gl.pixelStorei(gl["\x55\x4E\x50\x41\x43\x4B\x5F\x50\x52\x45\x4D\x55\x4C\x54\x49\x50\x4C\x59\x5F\x41\x4C\x50\x48\x41\x5F\x57\x45\x42\x47\x4C"],true);var internalformat=gl.RGBA;var format=gl.RGBA;var type=gl.UNSIGNED_BYTE;if(pixelformat&&!this.isIE){switch(pixelformat){case BF_RGB8:internalformat=gl.RGB;format=gl.RGB;break;case BF_RGBA4:type=gl.UNSIGNED_SHORT_4_4_4_4;break;case BF_RGB5_A1:type=gl.UNSIGNED_SHORT_5_5_5_1;break;case BF_RGB565:internalformat=gl.RGB;format=gl.RGB;type=gl.UNSIGNED_SHORT_5_6_5;break}};if(!isPOT&&tiling){var canvas=document.createElement("\x63\x61\x6E\x76\x61\x73");canvas.width=cr.nextHighestPowerOfTwo(img.width);canvas.height=cr.nextHighestPowerOfTwo(img.height);var ctx=canvas.getContext("\x32\x64");ctx["\x77\x65\x62\x6B\x69\x74\x49\x6D\x61\x67\x65\x53\x6D\x6F\x6F\x74\x68\x69\x6E\x67\x45\x6E\x61\x62\x6C\x65\x64"]=linearsampling;ctx["\x6D\x6F\x7A\x49\x6D\x61\x67\x65\x53\x6D\x6F\x6F\x74\x68\x69\x6E\x67\x45\x6E\x61\x62\x6C\x65\x64"]=linearsampling;ctx["\x6D\x73\x49\x6D\x61\x67\x65\x53\x6D\x6F\x6F\x74\x68\x69\x6E\x67\x45\x6E\x61\x62\x6C\x65\x64"]=linearsampling;ctx["\x69\x6D\x61\x67\x65\x53\x6D\x6F\x6F\x74\x68\x69\x6E\x67\x45\x6E\x61\x62\x6C\x65\x64"]=linearsampling;ctx.drawImage(img,0,0,img.width,img.height,0,0,canvas.width,canvas.height);gl.texImage2D(gl.TEXTURE_2D,0,internalformat,format,type,canvas)}else{gl.texImage2D(gl.TEXTURE_2D,0,internalformat,format,type,img)};if(tiling){if(tiletype==="\x72\x65\x70\x65\x61\x74\x2D\x78"){gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.REPEAT);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE)}else{if(tiletype==="\x72\x65\x70\x65\x61\x74\x2D\x79"){gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.REPEAT)}else{gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.REPEAT);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.REPEAT)}}}else{gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE)};if(linearsampling){gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.LINEAR);if(isPOT&&this.enable_mipmaps&&!nomip){gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.LINEAR_MIPMAP_LINEAR);gl.generateMipmap(gl.TEXTURE_2D)}else{gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.LINEAR)}}else{gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.NEAREST);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.NEAREST)};gl.bindTexture(gl.TEXTURE_2D,null);this.lastTexture0=null;webGL_texture.c2width=img.width;webGL_texture.c2height=img.height;webGL_texture.c2refcount=1;webGL_texture.c2texkey=tex_key;all_textures.push(webGL_texture);textures_by_src[tex_key]=webGL_texture;return webGL_texture};GLWrap_.prototype.createEmptyTexture=function(w,h,linearsampling,_16bit,tiling){this.endBatch();var gl=this.gl;if(this.isIE){_16bit=false};var webGL_texture=gl.createTexture();gl.bindTexture(gl.TEXTURE_2D,webGL_texture);gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,w,h,0,gl.RGBA,_16bit?gl.UNSIGNED_SHORT_4_4_4_4:gl.UNSIGNED_BYTE,null);if(tiling){gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.REPEAT);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.REPEAT)}else{gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE)};gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,linearsampling?gl.LINEAR:gl.NEAREST);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,linearsampling?gl.LINEAR:gl.NEAREST);gl.bindTexture(gl.TEXTURE_2D,null);this.lastTexture0=null;webGL_texture.c2width=w;webGL_texture.c2height=h;all_textures.push(webGL_texture);return webGL_texture};GLWrap_.prototype.videoToTexture=function(video_,texture_,_16bit){this.endBatch();var gl=this.gl;if(this.isIE){_16bit=false};gl.bindTexture(gl.TEXTURE_2D,texture_);gl.pixelStorei(gl["\x55\x4E\x50\x41\x43\x4B\x5F\x50\x52\x45\x4D\x55\x4C\x54\x49\x50\x4C\x59\x5F\x41\x4C\x50\x48\x41\x5F\x57\x45\x42\x47\x4C"],true);try{gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,gl.RGBA,_16bit?gl.UNSIGNED_SHORT_4_4_4_4:gl.UNSIGNED_BYTE,video_)}catch(e){if(console&&console.error){console.error("\x45\x72\x72\x6F\x72\x20\x75\x70\x64\x61\x74\x69\x6E\x67\x20\x57\x65\x62\x47\x4C\x20\x74\x65\x78\x74\x75\x72\x65\x3A\x20",e)}};gl.bindTexture(gl.TEXTURE_2D,null);this.lastTexture0=null};GLWrap_.prototype.deleteTexture=function(tex){if(!tex){return};if(typeof tex.c2refcount!=="\x75\x6E\x64\x65\x66\x69\x6E\x65\x64"&&tex.c2refcount>1){tex.c2refcount--;return};this.endBatch();if(tex===this.lastTexture0){this.gl.bindTexture(this.gl.TEXTURE_2D,null);this.lastTexture0=null};if(tex===this.lastTexture1){this.gl.activeTexture(this.gl.TEXTURE1);this.gl.bindTexture(this.gl.TEXTURE_2D,null);this.gl.activeTexture(this.gl.TEXTURE0);this.lastTexture1=null};cr.arrayFindRemove(all_textures,tex);if(typeof tex.c2texkey!=="\x75\x6E\x64\x65\x66\x69\x6E\x65\x64"){delete textures_by_src[tex.c2texkey]};this.gl.deleteTexture(tex)};GLWrap_.prototype.estimateVRAM=function(){var total=this.width*this.height*4*2;var i,len,t;for(i=0,len=all_textures.length;i<len;i++){t=all_textures[i];total+=(t.c2width*t.c2height*4)};return total};GLWrap_.prototype.textureCount=function(){return all_textures.length};GLWrap_.prototype.setRenderingToTexture=function(tex){if(tex===this.renderToTex){return};var b=this.pushBatch();b.type=BATCH_RENDERTOTEXTURE;b.texParam=tex;this.renderToTex=tex;this.hasQuadBatchTop=false;this.hasPointBatchTop=false};cr.GLWrap=GLWrap_}());;;(function(){function window_innerWidth(){if(typeof jQuery!=="\x75\x6E\x64\x65\x66\x69\x6E\x65\x64"){return jQuery(window).width()}else{return window.innerWidth}}function window_innerHeight(){if(typeof jQuery!=="\x75\x6E\x64\x65\x66\x69\x6E\x65\x64"){return jQuery(window).height()}else{return window.innerHeight}}var raf=window["\x72\x65\x71\x75\x65\x73\x74\x41\x6E\x69\x6D\x61\x74\x69\x6F\x6E\x46\x72\x61\x6D\x65"]||window["\x6D\x6F\x7A\x52\x65\x71\x75\x65\x73\x74\x41\x6E\x69\x6D\x61\x74\x69\x6F\x6E\x46\x72\x61\x6D\x65"]||window["\x77\x65\x62\x6B\x69\x74\x52\x65\x71\x75\x65\x73\x74\x41\x6E\x69\x6D\x61\x74\x69\x6F\x6E\x46\x72\x61\x6D\x65"]||window["\x6D\x73\x52\x65\x71\x75\x65\x73\x74\x41\x6E\x69\x6D\x61\x74\x69\x6F\x6E\x46\x72\x61\x6D\x65"]||window["\x6F\x52\x65\x71\x75\x65\x73\x74\x41\x6E\x69\x6D\x61\x74\x69\x6F\x6E\x46\x72\x61\x6D\x65"];function Runtime(canvas){if(!canvas||(!canvas.getContext&&!canvas["\x64\x63"])){return};if(canvas["\x63\x32\x72\x75\x6E\x74\x69\x6D\x65"]){return}else{canvas["\x63\x32\x72\x75\x6E\x74\x69\x6D\x65"]=this};var self=this;this.isCrosswalk=/crosswalk/i.test(navigator.userAgent)||/xwalk/i.test(navigator.userAgent)||!!(typeof window["\x63\x32\x69\x73\x43\x72\x6F\x73\x73\x77\x61\x6C\x6B"]!=="\x75\x6E\x64\x65\x66\x69\x6E\x65\x64"&&window["\x63\x32\x69\x73\x43\x72\x6F\x73\x73\x77\x61\x6C\x6B"]);this.isCordova=this.isCrosswalk||(typeof window["\x64\x65\x76\x69\x63\x65"]!=="\x75\x6E\x64\x65\x66\x69\x6E\x65\x64"&&(typeof window["\x64\x65\x76\x69\x63\x65"]["\x63\x6F\x72\x64\x6F\x76\x61"]!=="\x75\x6E\x64\x65\x66\x69\x6E\x65\x64"||typeof window["\x64\x65\x76\x69\x63\x65"]["\x70\x68\x6F\x6E\x65\x67\x61\x70"]!=="\x75\x6E\x64\x65\x66\x69\x6E\x65\x64"))||(typeof window["\x63\x32\x69\x73\x63\x6F\x72\x64\x6F\x76\x61"]!=="\x75\x6E\x64\x65\x66\x69\x6E\x65\x64"&&window["\x63\x32\x69\x73\x63\x6F\x72\x64\x6F\x76\x61"]);this.isPhoneGap=this.isCordova;this.isDirectCanvas=!!canvas["\x64\x63"];this.isAppMobi=(typeof window["\x41\x70\x70\x4D\x6F\x62\x69"]!=="\x75\x6E\x64\x65\x66\x69\x6E\x65\x64"||this.isDirectCanvas);this.isCocoonJs=!!window["\x63\x32\x63\x6F\x63\x6F\x6F\x6E\x6A\x73"];this.isEjecta=!!window["\x63\x32\x65\x6A\x65\x63\x74\x61"];if(this.isCocoonJs){CocoonJS["\x41\x70\x70"]["\x6F\x6E\x53\x75\x73\x70\x65\x6E\x64\x65\x64"].addEventListener(function(){self["\x73\x65\x74\x53\x75\x73\x70\x65\x6E\x64\x65\x64"](true)});CocoonJS["\x41\x70\x70"]["\x6F\x6E\x41\x63\x74\x69\x76\x61\x74\x65\x64"].addEventListener(function(){self["\x73\x65\x74\x53\x75\x73\x70\x65\x6E\x64\x65\x64"](false)})};if(this.isEjecta){document.addEventListener("\x70\x61\x67\x65\x68\x69\x64\x65",function(){self["\x73\x65\x74\x53\x75\x73\x70\x65\x6E\x64\x65\x64"](true)});document.addEventListener("\x70\x61\x67\x65\x73\x68\x6F\x77",function(){self["\x73\x65\x74\x53\x75\x73\x70\x65\x6E\x64\x65\x64"](false)});document.addEventListener("\x72\x65\x73\x69\x7A\x65",function(){self["\x73\x65\x74\x53\x69\x7A\x65"](window.innerWidth,window.innerHeight)})};this.isDomFree=(this.isDirectCanvas||this.isCocoonJs||this.isEjecta);this.isMicrosoftEdge=/edge\//i.test(navigator.userAgent);this.isIE=(/msie/i.test(navigator.userAgent)||/trident/i.test(navigator.userAgent)||/iemobile/i.test(navigator.userAgent))&&!this.isMicrosoftEdge;this.isTizen=/tizen/i.test(navigator.userAgent);this.isAndroid=/android/i.test(navigator.userAgent)&&!this.isTizen&&!this.isIE&&!this.isMicrosoftEdge;this.isiPhone=(/iphone/i.test(navigator.userAgent)||/ipod/i.test(navigator.userAgent))&&!this.isIE&&!this.isMicrosoftEdge;this.isiPad=/ipad/i.test(navigator.userAgent);this.isiOS=this.isiPhone||this.isiPad||this.isEjecta;this.isiPhoneiOS6=(this.isiPhone&&/os\s6/i.test(navigator.userAgent));this.isChrome=(/chrome/i.test(navigator.userAgent)||/chromium/i.test(navigator.userAgent))&&!this.isIE&&!this.isMicrosoftEdge;this.isAmazonWebApp=/amazonwebappplatform/i.test(navigator.userAgent);this.isFirefox=/firefox/i.test(navigator.userAgent);this.isSafari=/safari/i.test(navigator.userAgent)&&!this.isChrome&&!this.isIE&&!this.isMicrosoftEdge;this.isWindows=/windows/i.test(navigator.userAgent);this.isNWjs=(typeof window["\x63\x32\x6E\x6F\x64\x65\x77\x65\x62\x6B\x69\x74"]!=="\x75\x6E\x64\x65\x66\x69\x6E\x65\x64"||typeof window["\x63\x32\x6E\x77\x6A\x73"]!=="\x75\x6E\x64\x65\x66\x69\x6E\x65\x64"||/nodewebkit/i.test(navigator.userAgent)||/nwjs/i.test(navigator.userAgent));this.isNodeWebkit=this.isNWjs;this.isArcade=(typeof window["\x69\x73\x5F\x73\x63\x69\x72\x72\x61\x5F\x61\x72\x63\x61\x64\x65"]!=="\x75\x6E\x64\x65\x66\x69\x6E\x65\x64");this.isWindows8App=!!(typeof window["\x63\x32\x69\x73\x57\x69\x6E\x64\x6F\x77\x73\x38"]!=="\x75\x6E\x64\x65\x66\x69\x6E\x65\x64"&&window["\x63\x32\x69\x73\x57\x69\x6E\x64\x6F\x77\x73\x38"]);this.isWindows8Capable=!!(typeof window["\x63\x32\x69\x73\x57\x69\x6E\x64\x6F\x77\x73\x38\x43\x61\x70\x61\x62\x6C\x65"]!=="\x75\x6E\x64\x65\x66\x69\x6E\x65\x64"&&window["\x63\x32\x69\x73\x57\x69\x6E\x64\x6F\x77\x73\x38\x43\x61\x70\x61\x62\x6C\x65"]);this.isWindowsPhone8=!!(typeof window["\x63\x32\x69\x73\x57\x69\x6E\x64\x6F\x77\x73\x50\x68\x6F\x6E\x65\x38"]!=="\x75\x6E\x64\x65\x66\x69\x6E\x65\x64"&&window["\x63\x32\x69\x73\x57\x69\x6E\x64\x6F\x77\x73\x50\x68\x6F\x6E\x65\x38"]);this.isWindowsPhone81=!!(typeof window["\x63\x32\x69\x73\x57\x69\x6E\x64\x6F\x77\x73\x50\x68\x6F\x6E\x65\x38\x31"]!=="\x75\x6E\x64\x65\x66\x69\x6E\x65\x64"&&window["\x63\x32\x69\x73\x57\x69\x6E\x64\x6F\x77\x73\x50\x68\x6F\x6E\x65\x38\x31"]);this.isWindows10=!!window["\x63\x72\x5F\x77\x69\x6E\x64\x6F\x77\x73\x31\x30"];this.isWinJS=(this.isWindows8App||this.isWindows8Capable||this.isWindowsPhone81||this.isWindows10);this.isBlackberry10=!!(typeof window["\x63\x32\x69\x73\x42\x6C\x61\x63\x6B\x62\x65\x72\x72\x79\x31\x30"]!=="\x75\x6E\x64\x65\x66\x69\x6E\x65\x64"&&window["\x63\x32\x69\x73\x42\x6C\x61\x63\x6B\x62\x65\x72\x72\x79\x31\x30"]);this.isAndroidStockBrowser=(this.isAndroid&&!this.isChrome&&!this.isCrosswalk&&!this.isFirefox&&!this.isAmazonWebApp&&!this.isDomFree);this.devicePixelRatio=1;this.isMobile=(this.isCordova||this.isCrosswalk||this.isAppMobi||this.isCocoonJs||this.isAndroid||this.isiOS||this.isWindowsPhone8||this.isWindowsPhone81||this.isBlackberry10||this.isTizen||this.isEjecta);if(!this.isMobile){this.isMobile=/(blackberry|bb10|playbook|palm|symbian|nokia|windows\s+ce|phone|mobile|tablet|kindle|silk)/i.test(navigator.userAgent)};if(typeof cr_is_preview!=="\x75\x6E\x64\x65\x66\x69\x6E\x65\x64"&&!this.isNWjs&&(window.location.search==="\x3F\x6E\x77"||/nodewebkit/i.test(navigator.userAgent)||/nwjs/i.test(navigator.userAgent))){this.isNWjs=true};this.isDebug=(typeof cr_is_preview!=="\x75\x6E\x64\x65\x66\x69\x6E\x65\x64"&&window.location.search.indexOf("\x64\x65\x62\x75\x67")>-1);this.canvas=canvas;this.canvasdiv=document.getElementById("\x63\x32\x63\x61\x6E\x76\x61\x73\x64\x69\x76");this.gl=null;this.glwrap=null;this.glUnmaskedRenderer="\x28\x75\x6E\x61\x76\x61\x69\x6C\x61\x62\x6C\x65\x29";this.enableFrontToBack=false;this.earlyz_index=0;this.ctx=null;this.fullscreenOldMarginCss="";this.firstInFullscreen=false;this.oldWidth=0;this.oldHeight=0;this.canvas.oncontextmenu=function(e){if(e.preventDefault){e.preventDefault()};return false};this.canvas.onselectstart=function(e){if(e.preventDefault){e.preventDefault()};return false};if(this.isDirectCanvas){window["\x63\x32\x72\x75\x6E\x74\x69\x6D\x65"]=this};if(this.isNWjs){window["\x6F\x6E\x64\x72\x61\x67\x6F\x76\x65\x72"]=function(e){e.preventDefault();return false};window["\x6F\x6E\x64\x72\x6F\x70"]=function(e){e.preventDefault();return false};require("\x6E\x77\x2E\x67\x75\x69")["\x41\x70\x70"]["\x63\x6C\x65\x61\x72\x43\x61\x63\x68\x65"]()};if(this.isAndroidStockBrowser&&typeof jQuery!=="\x75\x6E\x64\x65\x66\x69\x6E\x65\x64"){jQuery("\x63\x61\x6E\x76\x61\x73").parents("\x2A").css("\x6F\x76\x65\x72\x66\x6C\x6F\x77","\x76\x69\x73\x69\x62\x6C\x65")};this.width=canvas.width;this.height=canvas.height;this.draw_width=this.width;this.draw_height=this.height;this.cssWidth=this.width;this.cssHeight=this.height;this.lastWindowWidth=window.innerWidth;this.lastWindowHeight=window.innerHeight;this.forceCanvasAlpha=false;this.redraw=true;this.isSuspended=false;if(!Date.now){Date.now=function now(){return+new Date()}};this.plugins=[];this.types={};this.types_by_index=[];this.behaviors=[];this.layouts={};this.layouts_by_index=[];this.eventsheets={};this.eventsheets_by_index=[];this.wait_for_textures=[];this.triggers_to_postinit=[];this.all_global_vars=[];this.all_local_vars=[];this.solidBehavior=null;this.jumpthruBehavior=null;this.shadowcasterBehavior=null;this.deathRow={};this.hasPendingInstances=false;this.isInClearDeathRow=false;this.isInOnDestroy=0;this.isRunningEvents=false;this.isEndingLayout=false;this.createRow=[];this.isLoadingState=false;this.saveToSlot="";this.loadFromSlot="";this.loadFromJson="";this.lastSaveJson="";this.signalledContinuousPreview=false;this.suspendDrawing=false;this.dt=0;this.dt1=0;this.minimumFramerate=30;this.logictime=0;this.cpuutilisation=0;this.timescale=1.0;this.kahanTime=new cr.KahanAdder();this.wallTime=new cr.KahanAdder();this.last_tick_time=0;this.fps=0;this.last_fps_time=0;this.tickcount=0;this.execcount=0;this.framecount=0;this.objectcount=0;this.changelayout=null;this.destroycallbacks=[];this.event_stack=[];this.event_stack_index=-1;this.localvar_stack=[[]];this.localvar_stack_index=0;this.trigger_depth=0;this.pushEventStack(null);this.loop_stack=[];this.loop_stack_index=-1;this.next_uid=0;this.next_puid=0;this.layout_first_tick=true;this.family_count=0;this.suspend_events=[];this.raf_id=-1;this.timeout_id=-1;this.isloading=true;this.loadingprogress=0;this.isNodeFullscreen=false;this.stackLocalCount=0;this.audioInstance=null;this.had_a_click=false;this.isInUserInputEvent=false;this.objects_to_pretick=new cr.ObjectSet();this.objects_to_tick=new cr.ObjectSet();this.objects_to_tick2=new cr.ObjectSet();this.registered_collisions=[];this.temp_poly=new cr.CollisionPoly([]);this.temp_poly2=new cr.CollisionPoly([]);this.allGroups=[];this.groups_by_name={};this.cndsBySid={};this.actsBySid={};this.varsBySid={};this.blocksBySid={};this.running_layout=null;this.layer_canvas=null;this.layer_ctx=null;this.layer_tex=null;this.layout_tex=null;this.layout_canvas=null;this.layout_ctx=null;this.is_WebGL_context_lost=false;this.uses_background_blending=false;this.fx_tex=[null,null];this.fullscreen_scaling=0;this.files_subfolder="";this.objectsByUid={};this.loaderlogos=null;this.snapshotCanvas=null;this.snapshotData="";this.objectRefTable=[];this.requestProjectData()}Runtime.prototype.requestProjectData=function(){var self=this;var xhr;if(this.isWindowsPhone8){xhr=new ActiveXObject("\x4D\x69\x63\x72\x6F\x73\x6F\x66\x74\x2E\x58\x4D\x4C\x48\x54\x54\x50")}else{xhr=new XMLHttpRequest()};var datajs_filename="\x64\x61\x74\x61\x2E\x6A\x73";if(this.isWindows8App||this.isWindowsPhone8||this.isWindowsPhone81||this.isWindows10){datajs_filename="\x64\x61\x74\x61\x2E\x6A\x73\x6F\x6E"};xhr.open("\x47\x45\x54",datajs_filename,true);var supportsJsonResponse=false;if(!this.isDomFree&&("\x72\x65\x73\x70\x6F\x6E\x73\x65"in xhr)&&("\x72\x65\x73\x70\x6F\x6E\x73\x65\x54\x79\x70\x65"in xhr)){try{xhr["\x72\x65\x73\x70\x6F\x6E\x73\x65\x54\x79\x70\x65"]="\x6A\x73\x6F\x6E";supportsJsonResponse=(xhr["\x72\x65\x73\x70\x6F\x6E\x73\x65\x54\x79\x70\x65"]==="\x6A\x73\x6F\x6E")}catch(e){supportsJsonResponse=false}};if(!supportsJsonResponse&&("\x72\x65\x73\x70\x6F\x6E\x73\x65\x54\x79\x70\x65"in xhr)){try{xhr["\x72\x65\x73\x70\x6F\x6E\x73\x65\x54\x79\x70\x65"]="\x74\x65\x78\x74"}catch(e){}};if("\x6F\x76\x65\x72\x72\x69\x64\x65\x4D\x69\x6D\x65\x54\x79\x70\x65"in xhr){try{xhr["\x6F\x76\x65\x72\x72\x69\x64\x65\x4D\x69\x6D\x65\x54\x79\x70\x65"]("\x61\x70\x70\x6C\x69\x63\x61\x74\x69\x6F\x6E\x2F\x6A\x73\x6F\x6E\x3B\x20\x63\x68\x61\x72\x73\x65\x74\x3D\x75\x74\x66\x2D\x38")}catch(e){}};if(this.isWindowsPhone8){xhr.onreadystatechange=function(){if(xhr.readyState!==4){return};self.loadProject(JSON.parse(xhr["\x72\x65\x73\x70\x6F\x6E\x73\x65\x54\x65\x78\x74"]))}}else{xhr.onload=function(){if(supportsJsonResponse){self.loadProject(xhr["\x72\x65\x73\x70\x6F\x6E\x73\x65"])}else{if(self.isEjecta){var str=xhr["\x72\x65\x73\x70\x6F\x6E\x73\x65\x54\x65\x78\x74"];str=str.substr(str.indexOf("\x7B"));self.loadProject(JSON.parse(str))}else{self.loadProject(JSON.parse(xhr["\x72\x65\x73\x70\x6F\x6E\x73\x65\x54\x65\x78\x74"]))}}};xhr.onerror=function(e){cr.logerror("\x45\x72\x72\x6F\x72\x20\x72\x65\x71\x75\x65\x73\x74\x69\x6E\x67\x20"+datajs_filename+"\x3A");cr.logerror(e)}};xhr.send()};Runtime.prototype.initRendererAndLoader=function(){var self=this;var i,len,j,lenj,k,lenk,t,s,l,y;this.isRetina=((!this.isDomFree||this.isEjecta||this.isCordova)&&this.useHighDpi&&!this.isAndroidStockBrowser);if(this.fullscreen_mode===0&&this.isiOS){this.isRetina=false};this.devicePixelRatio=(this.isRetina?(window["\x64\x65\x76\x69\x63\x65\x50\x69\x78\x65\x6C\x52\x61\x74\x69\x6F"]||window["\x77\x65\x62\x6B\x69\x74\x44\x65\x76\x69\x63\x65\x50\x69\x78\x65\x6C\x52\x61\x74\x69\x6F"]||window["\x6D\x6F\x7A\x44\x65\x76\x69\x63\x65\x50\x69\x78\x65\x6C\x52\x61\x74\x69\x6F"]||window["\x6D\x73\x44\x65\x76\x69\x63\x65\x50\x69\x78\x65\x6C\x52\x61\x74\x69\x6F"]||1):1);this.ClearDeathRow();var attribs;var alpha_canvas=!!(this.forceCanvasAlpha||(this.alphaBackground&&!(this.isNWjs||this.isWinJS||this.isWindowsPhone8||this.isCrosswalk||this.isCordova||this.isAmazonWebApp)));if(this.fullscreen_mode>0){this["\x73\x65\x74\x53\x69\x7A\x65"](window_innerWidth(),window_innerHeight(),true)};try{if(this.enableWebGL&&(this.isCocoonJs||this.isEjecta||!this.isDomFree)){attribs={"\x61\x6C\x70\x68\x61":alpha_canvas,"\x64\x65\x70\x74\x68":false,"\x61\x6E\x74\x69\x61\x6C\x69\x61\x73":false,"\x66\x61\x69\x6C\x49\x66\x4D\x61\x6A\x6F\x72\x50\x65\x72\x66\x6F\x72\x6D\x61\x6E\x63\x65\x43\x61\x76\x65\x61\x74":true};this.gl=(this.canvas.getContext("\x77\x65\x62\x67\x6C",attribs)||this.canvas.getContext("\x65\x78\x70\x65\x72\x69\x6D\x65\x6E\x74\x61\x6C\x2D\x77\x65\x62\x67\x6C",attribs))}}catch(e){};if(this.gl){var debug_ext=this.gl.getExtension("\x57\x45\x42\x47\x4C\x5F\x64\x65\x62\x75\x67\x5F\x72\x65\x6E\x64\x65\x72\x65\x72\x5F\x69\x6E\x66\x6F");if(debug_ext){var unmasked_vendor=this.gl.getParameter(debug_ext.UNMASKED_VENDOR_WEBGL);var unmasked_renderer=this.gl.getParameter(debug_ext.UNMASKED_RENDERER_WEBGL);this.glUnmaskedRenderer=unmasked_renderer+"\x20\x5B"+unmasked_vendor+"\x5D"};if(this.enableFrontToBack){this.glUnmaskedRenderer+="\x20\x5B\x66\x72\x6F\x6E\x74\x2D\x74\x6F\x2D\x62\x61\x63\x6B\x20\x65\x6E\x61\x62\x6C\x65\x64\x5D"};if(!this.isDomFree){this.overlay_canvas=document.createElement("\x63\x61\x6E\x76\x61\x73");jQuery(this.overlay_canvas).appendTo(this.canvas.parentNode);this.overlay_canvas.oncontextmenu=function(e){return false};this.overlay_canvas.onselectstart=function(e){return false};this.overlay_canvas.width=Math.round(this.cssWidth*this.devicePixelRatio);this.overlay_canvas.height=Math.round(this.cssHeight*this.devicePixelRatio);jQuery(this.overlay_canvas).css({"\x77\x69\x64\x74\x68":this.cssWidth+"\x70\x78","\x68\x65\x69\x67\x68\x74":this.cssHeight+"\x70\x78"});this.positionOverlayCanvas();this.overlay_ctx=this.overlay_canvas.getContext("\x32\x64")};this.glwrap=new cr.GLWrap(this.gl,this.isMobile,this.enableFrontToBack);this.glwrap.setSize(this.canvas.width,this.canvas.height);this.glwrap.enable_mipmaps=(this.downscalingQuality!==0);this.ctx=null;this.canvas.addEventListener("\x77\x65\x62\x67\x6C\x63\x6F\x6E\x74\x65\x78\x74\x6C\x6F\x73\x74",function(ev){ev.preventDefault();self.onContextLost();cr.logexport("\x5B\x43\x6F\x6E\x73\x74\x72\x75\x63\x74\x20\x32\x5D\x20\x57\x65\x62\x47\x4C\x20\x63\x6F\x6E\x74\x65\x78\x74\x20\x6C\x6F\x73\x74");window["\x63\x72\x5F\x73\x65\x74\x53\x75\x73\x70\x65\x6E\x64\x65\x64"](true)},false);this.canvas.addEventListener("\x77\x65\x62\x67\x6C\x63\x6F\x6E\x74\x65\x78\x74\x72\x65\x73\x74\x6F\x72\x65\x64",function(ev){self.glwrap.initState();self.glwrap.setSize(self.glwrap.width,self.glwrap.height,true);self.layer_tex=null;self.layout_tex=null;self.fx_tex[0]=null;self.fx_tex[1]=null;self.onContextRestored();self.redraw=true;cr.logexport("\x5B\x43\x6F\x6E\x73\x74\x72\x75\x63\x74\x20\x32\x5D\x20\x57\x65\x62\x47\x4C\x20\x63\x6F\x6E\x74\x65\x78\x74\x20\x72\x65\x73\x74\x6F\x72\x65\x64");window["\x63\x72\x5F\x73\x65\x74\x53\x75\x73\x70\x65\x6E\x64\x65\x64"](false)},false);for(i=0,len=this.types_by_index.length;i<len;i++){t=this.types_by_index[i];for(j=0,lenj=t.effect_types.length;j<lenj;j++){s=t.effect_types[j];s.shaderindex=this.glwrap.getShaderIndex(s.id);s.preservesOpaqueness=this.glwrap.programPreservesOpaqueness(s.shaderindex);this.uses_background_blending=this.uses_background_blending||this.glwrap.programUsesDest(s.shaderindex)}};for(i=0,len=this.layouts_by_index.length;i<len;i++){l=this.layouts_by_index[i];for(j=0,lenj=l.effect_types.length;j<lenj;j++){s=l.effect_types[j];s.shaderindex=this.glwrap.getShaderIndex(s.id);s.preservesOpaqueness=this.glwrap.programPreservesOpaqueness(s.shaderindex)};l.updateActiveEffects();for(j=0,lenj=l.layers.length;j<lenj;j++){y=l.layers[j];for(k=0,lenk=y.effect_types.length;k<lenk;k++){s=y.effect_types[k];s.shaderindex=this.glwrap.getShaderIndex(s.id);s.preservesOpaqueness=this.glwrap.programPreservesOpaqueness(s.shaderindex);this.uses_background_blending=this.uses_background_blending||this.glwrap.programUsesDest(s.shaderindex)};y.updateActiveEffects()}}}else{if(this.fullscreen_mode>0&&this.isDirectCanvas){;;this.canvas=null;document.oncontextmenu=function(e){return false};document.onselectstart=function(e){return false};this.ctx=AppMobi["\x63\x61\x6E\x76\x61\x73"]["\x67\x65\x74\x43\x6F\x6E\x74\x65\x78\x74"]("\x32\x64");try{this.ctx["\x73\x61\x6D\x70\x6C\x69\x6E\x67\x4D\x6F\x64\x65"]=this.linearSampling?"\x73\x6D\x6F\x6F\x74\x68":"\x73\x68\x61\x72\x70";this.ctx["\x67\x6C\x6F\x62\x61\x6C\x53\x63\x61\x6C\x65"]=1;this.ctx["\x48\x54\x4D\x4C\x35\x43\x6F\x6D\x70\x61\x74\x69\x62\x69\x6C\x69\x74\x79\x4D\x6F\x64\x65"]=true;this.ctx["\x69\x6D\x61\x67\x65\x53\x6D\x6F\x6F\x74\x68\x69\x6E\x67\x45\x6E\x61\x62\x6C\x65\x64"]=this.linearSampling}catch(e){};if(this.width!==0&&this.height!==0){this.ctx.width=this.width;this.ctx.height=this.height}};if(!this.ctx){;;if(this.isCocoonJs){attribs={"\x61\x6E\x74\x69\x61\x6C\x69\x61\x73":!!this.linearSampling,"\x61\x6C\x70\x68\x61":alpha_canvas};this.ctx=this.canvas.getContext("\x32\x64",attribs)}else{attribs={"\x61\x6C\x70\x68\x61":alpha_canvas};this.ctx=this.canvas.getContext("\x32\x64",attribs)};this.ctx["\x77\x65\x62\x6B\x69\x74\x49\x6D\x61\x67\x65\x53\x6D\x6F\x6F\x74\x68\x69\x6E\x67\x45\x6E\x61\x62\x6C\x65\x64"]=this.linearSampling;this.ctx["\x6D\x6F\x7A\x49\x6D\x61\x67\x65\x53\x6D\x6F\x6F\x74\x68\x69\x6E\x67\x45\x6E\x61\x62\x6C\x65\x64"]=this.linearSampling;this.ctx["\x6D\x73\x49\x6D\x61\x67\x65\x53\x6D\x6F\x6F\x74\x68\x69\x6E\x67\x45\x6E\x61\x62\x6C\x65\x64"]=this.linearSampling;this.ctx["\x69\x6D\x61\x67\x65\x53\x6D\x6F\x6F\x74\x68\x69\x6E\x67\x45\x6E\x61\x62\x6C\x65\x64"]=this.linearSampling};this.overlay_canvas=null;this.overlay_ctx=null};this.tickFunc=function(timestamp){self.tick(false,timestamp)};if(window!=window.top&&!this.isDomFree&&!this.isWinJS&&!this.isWindowsPhone8){document.addEventListener("\x6D\x6F\x75\x73\x65\x64\x6F\x77\x6E",function(){window.focus()},true);document.addEventListener("\x74\x6F\x75\x63\x68\x73\x74\x61\x72\x74",function(){window.focus()},true)};if(typeof cr_is_preview!=="\x75\x6E\x64\x65\x66\x69\x6E\x65\x64"){if(this.isCocoonJs){console.log("\x5B\x43\x6F\x6E\x73\x74\x72\x75\x63\x74\x20\x32\x5D\x20\x49\x6E\x20\x70\x72\x65\x76\x69\x65\x77\x2D\x6F\x76\x65\x72\x2D\x77\x69\x66\x69\x20\x76\x69\x61\x20\x43\x6F\x63\x6F\x6F\x6E\x4A\x53\x20\x6D\x6F\x64\x65")};if(window.location.search.indexOf("\x63\x6F\x6E\x74\x69\x6E\x75\x6F\x75\x73")>-1){cr.logexport("\x52\x65\x6C\x6F\x61\x64\x69\x6E\x67\x20\x66\x6F\x72\x20\x63\x6F\x6E\x74\x69\x6E\x75\x6F\x75\x73\x20\x70\x72\x65\x76\x69\x65\x77");this.loadFromSlot="\x5F\x5F\x63\x32\x5F\x63\x6F\x6E\x74\x69\x6E\x75\x6F\x75\x73\x70\x72\x65\x76\x69\x65\x77";this.suspendDrawing=true};if(this.pauseOnBlur&&!this.isMobile){jQuery(window).focus(function(){self["\x73\x65\x74\x53\x75\x73\x70\x65\x6E\x64\x65\x64"](false)});jQuery(window).blur(function(){self["\x73\x65\x74\x53\x75\x73\x70\x65\x6E\x64\x65\x64"](true)})}};window.addEventListener("\x62\x6C\x75\x72",function(){self.onWindowBlur()});if(!this.isDomFree){var unfocusFormControlFunc=function(e){if(cr.isCanvasInputEvent(e)&&document["\x61\x63\x74\x69\x76\x65\x45\x6C\x65\x6D\x65\x6E\x74"]&&document["\x61\x63\x74\x69\x76\x65\x45\x6C\x65\x6D\x65\x6E\x74"]!==document.getElementsByTagName("\x62\x6F\x64\x79")[0]&&document["\x61\x63\x74\x69\x76\x65\x45\x6C\x65\x6D\x65\x6E\x74"].blur){try{document["\x61\x63\x74\x69\x76\x65\x45\x6C\x65\x6D\x65\x6E\x74"].blur()}catch(e){}}};if(window.navigator["\x70\x6F\x69\x6E\x74\x65\x72\x45\x6E\x61\x62\x6C\x65\x64"]){document.addEventListener("\x70\x6F\x69\x6E\x74\x65\x72\x64\x6F\x77\x6E",unfocusFormControlFunc)}else{if(window.navigator["\x6D\x73\x50\x6F\x69\x6E\x74\x65\x72\x45\x6E\x61\x62\x6C\x65\x64"]){document.addEventListener("\x4D\x53\x50\x6F\x69\x6E\x74\x65\x72\x44\x6F\x77\x6E",unfocusFormControlFunc)}else{document.addEventListener("\x74\x6F\x75\x63\x68\x73\x74\x61\x72\x74",unfocusFormControlFunc)}};document.addEventListener("\x6D\x6F\x75\x73\x65\x64\x6F\x77\x6E",unfocusFormControlFunc)};if(this.fullscreen_mode===0&&this.isRetina&&this.devicePixelRatio>1){this["\x73\x65\x74\x53\x69\x7A\x65"](this.original_width,this.original_height,true)};this.tryLockOrientation();this.getready();this.go();this.extra={};cr.seal(this)};var webkitRepaintFlag=false;Runtime.prototype["\x73\x65\x74\x53\x69\x7A\x65"]=function(w,h,force){var offx=0,offy=0;var neww=0,newh=0,intscale=0;var tryHideAddressBar=(this.isiPhoneiOS6&&this.isSafari&&!navigator["\x73\x74\x61\x6E\x64\x61\x6C\x6F\x6E\x65"]&&!this.isDomFree&&!this.isCordova);if(tryHideAddressBar){h+=60};if(this.lastWindowWidth===w&&this.lastWindowHeight===h&&!force){return};this.lastWindowWidth=w;this.lastWindowHeight=h;var mode=this.fullscreen_mode;var orig_aspect,cur_aspect;var isfullscreen=(document["\x6D\x6F\x7A\x46\x75\x6C\x6C\x53\x63\x72\x65\x65\x6E"]||document["\x77\x65\x62\x6B\x69\x74\x49\x73\x46\x75\x6C\x6C\x53\x63\x72\x65\x65\x6E"]||!!document["\x6D\x73\x46\x75\x6C\x6C\x73\x63\x72\x65\x65\x6E\x45\x6C\x65\x6D\x65\x6E\x74"]||document["\x66\x75\x6C\x6C\x53\x63\x72\x65\x65\x6E"]||this.isNodeFullscreen)&&!this.isCordova;if(!isfullscreen&&this.fullscreen_mode===0&&!force){return};if(isfullscreen&&this.fullscreen_scaling>0){mode=this.fullscreen_scaling};var dpr=this.devicePixelRatio;if(mode>=4){orig_aspect=this.original_width/this.original_height;cur_aspect=w/h;if(cur_aspect>orig_aspect){neww=h*orig_aspect;if(mode===5){intscale=(neww*dpr)/this.original_width;if(intscale>1){intscale=Math.floor(intscale)}else{if(intscale<1){intscale=1/Math.ceil(1/intscale)}};neww=this.original_width*intscale/dpr;newh=this.original_height*intscale/dpr;offx=(w-neww)/2;offy=(h-newh)/2;w=neww;h=newh}else{offx=(w-neww)/2;w=neww}}else{newh=w/orig_aspect;if(mode===5){intscale=(newh*dpr)/this.original_height;if(intscale>1){intscale=Math.floor(intscale)}else{if(intscale<1){intscale=1/Math.ceil(1/intscale)}};neww=this.original_width*intscale/dpr;newh=this.original_height*intscale/dpr;offx=(w-neww)/2;offy=(h-newh)/2;w=neww;h=newh}else{offy=(h-newh)/2;h=newh}};if(isfullscreen&&!this.isNWjs){offx=0;offy=0}}else{if(this.isNWjs&&this.isNodeFullscreen&&this.fullscreen_mode_set===0){offx=Math.floor((w-this.original_width)/2);offy=Math.floor((h-this.original_height)/2);w=this.original_width;h=this.original_height}};if(mode<2){this.aspect_scale=dpr};if(this.isRetina&&this.isiPad&&dpr>1){if(w>=1024){w=1023};if(h>=1024){h=1023}};this.cssWidth=Math.round(w);this.cssHeight=Math.round(h);this.width=Math.round(w*dpr);this.height=Math.round(h*dpr);this.redraw=true;if(this.wantFullscreenScalingQuality){this.draw_width=this.width;this.draw_height=this.height;this.fullscreenScalingQuality=true}else{if((this.width<this.original_width&&this.height<this.original_height)||mode===1){this.draw_width=this.width;this.draw_height=this.height;this.fullscreenScalingQuality=true}else{this.draw_width=this.original_width;this.draw_height=this.original_height;this.fullscreenScalingQuality=false;if(mode===2){orig_aspect=this.original_width/this.original_height;cur_aspect=this.lastWindowWidth/this.lastWindowHeight;if(cur_aspect<orig_aspect){this.draw_width=this.draw_height*cur_aspect}else{if(cur_aspect>orig_aspect){this.draw_height=this.draw_width/cur_aspect}}}else{if(mode===3){orig_aspect=this.original_width/this.original_height;cur_aspect=this.lastWindowWidth/this.lastWindowHeight;if(cur_aspect>orig_aspect){this.draw_width=this.draw_height*cur_aspect}else{if(cur_aspect<orig_aspect){this.draw_height=this.draw_width/cur_aspect}}}}}};if(this.canvasdiv&&!this.isDomFree){jQuery(this.canvasdiv).css({"\x77\x69\x64\x74\x68":Math.round(w)+"\x70\x78","\x68\x65\x69\x67\x68\x74":Math.round(h)+"\x70\x78","\x6D\x61\x72\x67\x69\x6E\x2D\x6C\x65\x66\x74":Math.floor(offx)+"\x70\x78","\x6D\x61\x72\x67\x69\x6E\x2D\x74\x6F\x70":Math.floor(offy)+"\x70\x78"});if(typeof cr_is_preview!=="\x75\x6E\x64\x65\x66\x69\x6E\x65\x64"){jQuery("\x23\x62\x6F\x72\x64\x65\x72\x77\x72\x61\x70").css({"\x77\x69\x64\x74\x68":Math.round(w)+"\x70\x78","\x68\x65\x69\x67\x68\x74":Math.round(h)+"\x70\x78"})}};if(this.canvas){this.canvas.width=Math.round(w*dpr);this.canvas.height=Math.round(h*dpr);if(this.isEjecta){this.canvas.style.left=Math.floor(offx)+"\x70\x78";this.canvas.style.top=Math.floor(offy)+"\x70\x78";this.canvas.style.width=Math.round(w)+"\x70\x78";this.canvas.style.height=Math.round(h)+"\x70\x78"}else{if(this.isRetina&&!this.isDomFree){this.canvas.style.width=Math.round(w)+"\x70\x78";this.canvas.style.height=Math.round(h)+"\x70\x78"}}};if(this.overlay_canvas){this.overlay_canvas.width=Math.round(w*dpr);this.overlay_canvas.height=Math.round(h*dpr);this.overlay_canvas.style.width=this.cssWidth+"\x70\x78";this.overlay_canvas.style.height=this.cssHeight+"\x70\x78"};if(this.glwrap){this.glwrap.setSize(Math.round(w*dpr),Math.round(h*dpr))};if(this.isDirectCanvas&&this.ctx){this.ctx.width=Math.round(w);this.ctx.height=Math.round(h)};if(this.ctx){this.ctx["\x77\x65\x62\x6B\x69\x74\x49\x6D\x61\x67\x65\x53\x6D\x6F\x6F\x74\x68\x69\x6E\x67\x45\x6E\x61\x62\x6C\x65\x64"]=this.linearSampling;this.ctx["\x6D\x6F\x7A\x49\x6D\x61\x67\x65\x53\x6D\x6F\x6F\x74\x68\x69\x6E\x67\x45\x6E\x61\x62\x6C\x65\x64"]=this.linearSampling;this.ctx["\x6D\x73\x49\x6D\x61\x67\x65\x53\x6D\x6F\x6F\x74\x68\x69\x6E\x67\x45\x6E\x61\x62\x6C\x65\x64"]=this.linearSampling;this.ctx["\x69\x6D\x61\x67\x65\x53\x6D\x6F\x6F\x74\x68\x69\x6E\x67\x45\x6E\x61\x62\x6C\x65\x64"]=this.linearSampling};this.tryLockOrientation();if(!this.isDomFree&&(tryHideAddressBar||this.isiPhone)){window.setTimeout(function(){window.scrollTo(0,1)},100)}};Runtime.prototype.tryLockOrientation=function(){if(!this.autoLockOrientation||this.orientations===0){return};var orientation="\x70\x6F\x72\x74\x72\x61\x69\x74";if(this.orientations===2){orientation="\x6C\x61\x6E\x64\x73\x63\x61\x70\x65"};try{if(screen["\x6F\x72\x69\x65\x6E\x74\x61\x74\x69\x6F\x6E"]&&screen["\x6F\x72\x69\x65\x6E\x74\x61\x74\x69\x6F\x6E"]["\x6C\x6F\x63\x6B"]){screen["\x6F\x72\x69\x65\x6E\x74\x61\x74\x69\x6F\x6E"]["\x6C\x6F\x63\x6B"](orientation)}else{if(screen["\x6C\x6F\x63\x6B\x4F\x72\x69\x65\x6E\x74\x61\x74\x69\x6F\x6E"]){screen["\x6C\x6F\x63\x6B\x4F\x72\x69\x65\x6E\x74\x61\x74\x69\x6F\x6E"](orientation)}else{if(screen["\x77\x65\x62\x6B\x69\x74\x4C\x6F\x63\x6B\x4F\x72\x69\x65\x6E\x74\x61\x74\x69\x6F\x6E"]){screen["\x77\x65\x62\x6B\x69\x74\x4C\x6F\x63\x6B\x4F\x72\x69\x65\x6E\x74\x61\x74\x69\x6F\x6E"](orientation)}else{if(screen["\x6D\x6F\x7A\x4C\x6F\x63\x6B\x4F\x72\x69\x65\x6E\x74\x61\x74\x69\x6F\x6E"]){screen["\x6D\x6F\x7A\x4C\x6F\x63\x6B\x4F\x72\x69\x65\x6E\x74\x61\x74\x69\x6F\x6E"](orientation)}else{if(screen["\x6D\x73\x4C\x6F\x63\x6B\x4F\x72\x69\x65\x6E\x74\x61\x74\x69\x6F\x6E"]){screen["\x6D\x73\x4C\x6F\x63\x6B\x4F\x72\x69\x65\x6E\x74\x61\x74\x69\x6F\x6E"](orientation)}}}}}}catch(e){if(console&&console.warn){console.warn("\x46\x61\x69\x6C\x65\x64\x20\x74\x6F\x20\x6C\x6F\x63\x6B\x20\x6F\x72\x69\x65\x6E\x74\x61\x74\x69\x6F\x6E\x3A\x20",e)}}};Runtime.prototype.onContextLost=function(){this.glwrap.contextLost();this.is_WebGL_context_lost=true;var i,len,t;for(i=0,len=this.types_by_index.length;i<len;i++){t=this.types_by_index[i];if(t.onLostWebGLContext){t.onLostWebGLContext()}}};Runtime.prototype.onContextRestored=function(){this.is_WebGL_context_lost=false;var i,len,t;for(i=0,len=this.types_by_index.length;i<len;i++){t=this.types_by_index[i];if(t.onRestoreWebGLContext){t.onRestoreWebGLContext()}}};Runtime.prototype.positionOverlayCanvas=function(){if(this.isDomFree){return};var isfullscreen=(document["\x6D\x6F\x7A\x46\x75\x6C\x6C\x53\x63\x72\x65\x65\x6E"]||document["\x77\x65\x62\x6B\x69\x74\x49\x73\x46\x75\x6C\x6C\x53\x63\x72\x65\x65\x6E"]||document["\x66\x75\x6C\x6C\x53\x63\x72\x65\x65\x6E"]||!!document["\x6D\x73\x46\x75\x6C\x6C\x73\x63\x72\x65\x65\x6E\x45\x6C\x65\x6D\x65\x6E\x74"]||this.isNodeFullscreen)&&!this.isCordova;var overlay_position=isfullscreen?jQuery(this.canvas).offset():jQuery(this.canvas).position();overlay_position.position="\x61\x62\x73\x6F\x6C\x75\x74\x65";jQuery(this.overlay_canvas).css(overlay_position)};var caf=window["\x63\x61\x6E\x63\x65\x6C\x41\x6E\x69\x6D\x61\x74\x69\x6F\x6E\x46\x72\x61\x6D\x65"]||window["\x6D\x6F\x7A\x43\x61\x6E\x63\x65\x6C\x41\x6E\x69\x6D\x61\x74\x69\x6F\x6E\x46\x72\x61\x6D\x65"]||window["\x77\x65\x62\x6B\x69\x74\x43\x61\x6E\x63\x65\x6C\x41\x6E\x69\x6D\x61\x74\x69\x6F\x6E\x46\x72\x61\x6D\x65"]||window["\x6D\x73\x43\x61\x6E\x63\x65\x6C\x41\x6E\x69\x6D\x61\x74\x69\x6F\x6E\x46\x72\x61\x6D\x65"]||window["\x6F\x43\x61\x6E\x63\x65\x6C\x41\x6E\x69\x6D\x61\x74\x69\x6F\x6E\x46\x72\x61\x6D\x65"];Runtime.prototype["\x73\x65\x74\x53\x75\x73\x70\x65\x6E\x64\x65\x64"]=function(s){var i,len;if(s&&!this.isSuspended){cr.logexport("\x5B\x43\x6F\x6E\x73\x74\x72\x75\x63\x74\x20\x32\x5D\x20\x53\x75\x73\x70\x65\x6E\x64\x69\x6E\x67");this.isSuspended=true;if(this.raf_id!==-1&&caf){caf(this.raf_id)};if(this.timeout_id!==-1){clearTimeout(this.timeout_id)};for(i=0,len=this.suspend_events.length;i<len;i++){this.suspend_events[i](true)}}else{if(!s&&this.isSuspended){cr.logexport("\x5B\x43\x6F\x6E\x73\x74\x72\x75\x63\x74\x20\x32\x5D\x20\x52\x65\x73\x75\x6D\x69\x6E\x67");this.isSuspended=false;this.last_tick_time=cr.performance_now();this.last_fps_time=cr.performance_now();this.framecount=0;this.logictime=0;for(i=0,len=this.suspend_events.length;i<len;i++){this.suspend_events[i](false)};this.tick(false)}}};Runtime.prototype.addSuspendCallback=function(f){this.suspend_events.push(f)};Runtime.prototype.GetObjectReference=function(i){;;return this.objectRefTable[i]};Runtime.prototype.loadProject=function(data_response){;;if(!data_response||!data_response["\x70\x72\x6F\x6A\x65\x63\x74"]){cr.logerror("\x50\x72\x6F\x6A\x65\x63\x74\x20\x6D\x6F\x64\x65\x6C\x20\x75\x6E\x61\x76\x61\x69\x6C\x61\x62\x6C\x65")};var pm=data_response["\x70\x72\x6F\x6A\x65\x63\x74"];this.name=pm[0];this.first_layout=pm[1];this.fullscreen_mode=pm[12];this.fullscreen_mode_set=pm[12];this.original_width=pm[10];this.original_height=pm[11];this.parallax_x_origin=this.original_width/2;this.parallax_y_origin=this.original_height/2;if(this.isDomFree&&!this.isEjecta&&(pm[12]>=4||pm[12]===0)){cr.logexport("\x5B\x43\x6F\x6E\x73\x74\x72\x75\x63\x74\x20\x32\x5D\x20\x4C\x65\x74\x74\x65\x72\x62\x6F\x78\x20\x73\x63\x61\x6C\x65\x20\x66\x75\x6C\x6C\x73\x63\x72\x65\x65\x6E\x20\x6D\x6F\x64\x65\x73\x20\x61\x72\x65\x20\x6E\x6F\x74\x20\x73\x75\x70\x70\x6F\x72\x74\x65\x64\x20\x6F\x6E\x20\x74\x68\x69\x73\x20\x70\x6C\x61\x74\x66\x6F\x72\x6D\x20\x2D\x20\x66\x61\x6C\x6C\x69\x6E\x67\x20\x62\x61\x63\x6B\x20\x74\x6F\x20\x27\x53\x63\x61\x6C\x65\x20\x6F\x75\x74\x65\x72\x27");this.fullscreen_mode=3;this.fullscreen_mode_set=3};this.uses_loader_layout=pm[18];this.loaderstyle=pm[19];if(this.loaderstyle===0){var loaderImage=new Image();loaderImage.crossOrigin="\x61\x6E\x6F\x6E\x79\x6D\x6F\x75\x73";loaderImage.src="\x6C\x6F\x61\x64\x69\x6E\x67\x2D\x6C\x6F\x67\x6F\x2E\x70\x6E\x67";this.loaderlogos={logo:loaderImage}}else{if(this.loaderstyle===4){var loaderC2logo_1024=new Image();loaderC2logo_1024.src="";var loaderC2logo_512=new Image();loaderC2logo_512.src="";var loaderC2logo_256=new Image();loaderC2logo_256.src="";var loaderC2logo_128=new Image();loaderC2logo_128.src="";var loaderPowered_1024=new Image();loaderPowered_1024.src="";var loaderPowered_512=new Image();loaderPowered_512.src="";var loaderPowered_256=new Image();loaderPowered_256.src="";var loaderPowered_128=new Image();loaderPowered_128.src="";var loaderWebsite_1024=new Image();loaderWebsite_1024.src="";var loaderWebsite_512=new Image();loaderWebsite_512.src="";var loaderWebsite_256=new Image();loaderWebsite_256.src="";var loaderWebsite_128=new Image();loaderWebsite_128.src="";this.loaderlogos={logo:[loaderC2logo_1024,loaderC2logo_512,loaderC2logo_256,loaderC2logo_128],powered:[loaderPowered_1024,loaderPowered_512,loaderPowered_256,loaderPowered_128],website:[loaderWebsite_1024,loaderWebsite_512,loaderWebsite_256,loaderWebsite_128]}}};this.next_uid=pm[21];this.objectRefTable=cr.getObjectRefTable();this.system=new cr.system_object(this);var i,len,j,lenj,k,lenk,idstr,m,b,t,f,p;var plugin,plugin_ctor;for(i=0,len=pm[2].length;i<len;i++){m=pm[2][i];p=this.GetObjectReference(m[0]);;;cr.add_common_aces(m,p.prototype);plugin=new p(this);plugin.singleglobal=m[1];plugin.is_world=m[2];plugin.must_predraw=m[9];if(plugin.onCreate){plugin.onCreate()};cr.seal(plugin);this.plugins.push(plugin)};this.objectRefTable=cr.getObjectRefTable();for(i=0,len=pm[3].length;i<len;i++){m=pm[3][i];plugin_ctor=this.GetObjectReference(m[1]);;;plugin=null;for(j=0,lenj=this.plugins.length;j<lenj;j++){if(this.plugins[j]instanceof plugin_ctor){plugin=this.plugins[j];break}};;;;;var type_inst=new plugin.Type(plugin);;;type_inst.name=m[0];type_inst.is_family=m[2];type_inst.instvar_sids=m[3].slice(0);type_inst.vars_count=m[3].length;type_inst.behs_count=m[4];type_inst.fx_count=m[5];type_inst.sid=m[11];if(type_inst.is_family){type_inst.members=[];type_inst.family_index=this.family_count++;type_inst.families=null}else{type_inst.members=null;type_inst.family_index=-1;type_inst.families=[]};type_inst.family_var_map=null;type_inst.family_beh_map=null;type_inst.family_fx_map=null;type_inst.is_contained=false;type_inst.container=null;if(m[6]){type_inst.texture_file=m[6][0];type_inst.texture_filesize=m[6][1];type_inst.texture_pixelformat=m[6][2]}else{type_inst.texture_file=null;type_inst.texture_filesize=0;type_inst.texture_pixelformat=0};if(m[7]){type_inst.animations=m[7]}else{type_inst.animations=null};type_inst.index=i;type_inst.instances=[];type_inst.deadCache=[];type_inst.solstack=[new cr.selection(type_inst)];type_inst.cur_sol=0;type_inst.default_instance=null;type_inst.default_layerindex=0;type_inst.stale_iids=true;type_inst.updateIIDs=cr.type_updateIIDs;type_inst.getFirstPicked=cr.type_getFirstPicked;type_inst.getPairedInstance=cr.type_getPairedInstance;type_inst.getCurrentSol=cr.type_getCurrentSol;type_inst.pushCleanSol=cr.type_pushCleanSol;type_inst.pushCopySol=cr.type_pushCopySol;type_inst.popSol=cr.type_popSol;type_inst.getBehaviorByName=cr.type_getBehaviorByName;type_inst.getBehaviorIndexByName=cr.type_getBehaviorIndexByName;type_inst.getEffectIndexByName=cr.type_getEffectIndexByName;type_inst.applySolToContainer=cr.type_applySolToContainer;type_inst.getInstanceByIID=cr.type_getInstanceByIID;type_inst.collision_grid=new cr.SparseGrid(this.original_width,this.original_height);type_inst.any_cell_changed=true;type_inst.any_instance_parallaxed=false;type_inst.extra={};type_inst.toString=cr.type_toString;type_inst.behaviors=[];for(j=0,lenj=m[8].length;j<lenj;j++){b=m[8][j];var behavior_ctor=this.GetObjectReference(b[1]);var behavior_plugin=null;for(k=0,lenk=this.behaviors.length;k<lenk;k++){if(this.behaviors[k]instanceof behavior_ctor){behavior_plugin=this.behaviors[k];break}};if(!behavior_plugin){behavior_plugin=new behavior_ctor(this);behavior_plugin.my_types=[];behavior_plugin.my_instances=new cr.ObjectSet();if(behavior_plugin.onCreate){behavior_plugin.onCreate()};cr.seal(behavior_plugin);this.behaviors.push(behavior_plugin);if(cr.behaviors.solid&&behavior_plugin instanceof cr.behaviors.solid){this.solidBehavior=behavior_plugin};if(cr.behaviors.jumpthru&&behavior_plugin instanceof cr.behaviors.jumpthru){this.jumpthruBehavior=behavior_plugin};if(cr.behaviors.shadowcaster&&behavior_plugin instanceof cr.behaviors.shadowcaster){this.shadowcasterBehavior=behavior_plugin}};if(behavior_plugin.my_types.indexOf(type_inst)===-1){behavior_plugin.my_types.push(type_inst)};var behavior_type=new behavior_plugin.Type(behavior_plugin,type_inst);behavior_type.name=b[0];behavior_type.sid=b[2];behavior_type.onCreate();cr.seal(behavior_type);type_inst.behaviors.push(behavior_type)};type_inst.global=m[9];type_inst.isOnLoaderLayout=m[10];type_inst.effect_types=[];for(j=0,lenj=m[12].length;j<lenj;j++){type_inst.effect_types.push({id:m[12][j][0],name:m[12][j][1],shaderindex:-1,preservesOpaqueness:false,active:true,index:j})};type_inst.tile_poly_data=m[13];if(!this.uses_loader_layout||type_inst.is_family||type_inst.isOnLoaderLayout||!plugin.is_world){type_inst.onCreate();cr.seal(type_inst)};if(type_inst.name){this.types[type_inst.name]=type_inst};this.types_by_index.push(type_inst);if(plugin.singleglobal){var instance=new plugin.Instance(type_inst);instance.uid=this.next_uid++;instance.puid=this.next_puid++;instance.iid=0;instance.get_iid=cr.inst_get_iid;instance.toString=cr.inst_toString;instance.properties=m[14];instance.onCreate();cr.seal(instance);type_inst.instances.push(instance);this.objectsByUid[instance.uid.toString()]=instance}};for(i=0,len=pm[4].length;i<len;i++){var familydata=pm[4][i];var familytype=this.types_by_index[familydata[0]];var familymember;for(j=1,lenj=familydata.length;j<lenj;j++){familymember=this.types_by_index[familydata[j]];familymember.families.push(familytype);familytype.members.push(familymember)}};for(i=0,len=pm[28].length;i<len;i++){var containerdata=pm[28][i];var containertypes=[];for(j=0,lenj=containerdata.length;j<lenj;j++){containertypes.push(this.types_by_index[containerdata[j]])};for(j=0,lenj=containertypes.length;j<lenj;j++){containertypes[j].is_contained=true;containertypes[j].container=containertypes}};if(this.family_count>0){for(i=0,len=this.types_by_index.length;i<len;i++){t=this.types_by_index[i];if(t.is_family||!t.families.length){continue};t.family_var_map=new Array(this.family_count);t.family_beh_map=new Array(this.family_count);t.family_fx_map=new Array(this.family_count);var all_fx=[];var varsum=0;var behsum=0;var fxsum=0;for(j=0,lenj=t.families.length;j<lenj;j++){f=t.families[j];t.family_var_map[f.family_index]=varsum;varsum+=f.vars_count;t.family_beh_map[f.family_index]=behsum;behsum+=f.behs_count;t.family_fx_map[f.family_index]=fxsum;fxsum+=f.fx_count;for(k=0,lenk=f.effect_types.length;k<lenk;k++){all_fx.push(cr.shallowCopy({},f.effect_types[k]))}};t.effect_types=all_fx.concat(t.effect_types);for(j=0,lenj=t.effect_types.length;j<lenj;j++){t.effect_types[j].index=j}}};for(i=0,len=pm[5].length;i<len;i++){m=pm[5][i];var layout=new cr.layout(this,m);cr.seal(layout);this.layouts[layout.name]=layout;this.layouts_by_index.push(layout)};for(i=0,len=pm[6].length;i<len;i++){m=pm[6][i];var sheet=new cr.eventsheet(this,m);cr.seal(sheet);this.eventsheets[sheet.name]=sheet;this.eventsheets_by_index.push(sheet)};for(i=0,len=this.eventsheets_by_index.length;i<len;i++){this.eventsheets_by_index[i].postInit()};for(i=0,len=this.eventsheets_by_index.length;i<len;i++){this.eventsheets_by_index[i].updateDeepIncludes()};for(i=0,len=this.triggers_to_postinit.length;i<len;i++){this.triggers_to_postinit[i].postInit()};cr.clearArray(this.triggers_to_postinit);this.audio_to_preload=pm[7];this.files_subfolder=pm[8];this.pixel_rounding=pm[9];this.aspect_scale=1.0;this.enableWebGL=pm[13];this.linearSampling=pm[14];this.alphaBackground=pm[15];this.versionstr=pm[16];this.useHighDpi=pm[17];this.orientations=pm[20];this.autoLockOrientation=(this.orientations>0);this.pauseOnBlur=pm[22];this.wantFullscreenScalingQuality=pm[23];this.fullscreenScalingQuality=this.wantFullscreenScalingQuality;this.downscalingQuality=pm[24];this.preloadSounds=pm[25];this.projectName=pm[26];this.enableFrontToBack=pm[27]&&!this.isIE;this.start_time=Date.now();cr.clearArray(this.objectRefTable);this.initRendererAndLoader()};var anyImageHadError=false;Runtime.prototype.waitForImageLoad=function(img_,src_){img_["\x63\x6F\x63\x6F\x6F\x6E\x4C\x61\x7A\x79\x4C\x6F\x61\x64"]=true;img_.onerror=function(e){img_.c2error=true;anyImageHadError=true;if(console&&console.error){console.error("\x45\x72\x72\x6F\x72\x20\x6C\x6F\x61\x64\x69\x6E\x67\x20\x69\x6D\x61\x67\x65\x20\x27"+img_.src+"\x27\x3A\x20",e)}};if(this.isEjecta){img_.src=src_}else{if(!img_.src){if(typeof XAPKReader!=="\x75\x6E\x64\x65\x66\x69\x6E\x65\x64"){XAPKReader["\x67\x65\x74"](src_,function(expanded_url){img_.src=expanded_url},function(e){img_.c2error=true;anyImageHadError=true;if(console&&console.error){console.error("\x45\x72\x72\x6F\x72\x20\x65\x78\x74\x72\x61\x63\x74\x69\x6E\x67\x20\x69\x6D\x61\x67\x65\x20\x27"+src_+"\x27\x20\x66\x72\x6F\x6D\x20\x65\x78\x70\x61\x6E\x73\x69\x6F\x6E\x20\x66\x69\x6C\x65\x3A\x20",e)}})}else{img_.crossOrigin="\x61\x6E\x6F\x6E\x79\x6D\x6F\x75\x73";img_.src=src_}}};this.wait_for_textures.push(img_)};Runtime.prototype.findWaitingTexture=function(src_){var i,len;for(i=0,len=this.wait_for_textures.length;i<len;i++){if(this.wait_for_textures[i].cr_src===src_){return this.wait_for_textures[i]}};return null};var audio_preload_totalsize=0;var audio_preload_started=false;Runtime.prototype.getready=function(){if(!this.audioInstance){return};audio_preload_totalsize=this.audioInstance.setPreloadList(this.audio_to_preload)};Runtime.prototype.areAllTexturesAndSoundsLoaded=function(){var totalsize=audio_preload_totalsize;var completedsize=0;var audiocompletedsize=0;var ret=true;var i,len,img;for(i=0,len=this.wait_for_textures.length;i<len;i++){img=this.wait_for_textures[i];var filesize=img.cr_filesize;if(!filesize||filesize<=0){filesize=50000};totalsize+=filesize;if(!!img.src&&(img.complete||img["\x6C\x6F\x61\x64\x65\x64"])&&!img.c2error){completedsize+=filesize}else{ret=false}};if(ret&&this.preloadSounds&&this.audioInstance){if(!audio_preload_started){this.audioInstance.startPreloads();audio_preload_started=true};audiocompletedsize=this.audioInstance.getPreloadedSize();completedsize+=audiocompletedsize;if(audiocompletedsize<audio_preload_totalsize){ret=false}};if(totalsize==0){this.progress=1}else{this.progress=(completedsize/totalsize)};return ret};var isC2SplashDone=false;Runtime.prototype.go=function(){if(!this.ctx&&!this.glwrap){return};var ctx=this.ctx||this.overlay_ctx;if(this.overlay_canvas){this.positionOverlayCanvas()};this.progress=0;this.last_progress=-1;var self=this;if(this.areAllTexturesAndSoundsLoaded()&&(this.loaderstyle!==4||isC2SplashDone)){this.go_loading_finished()}else{var ms_elapsed=Date.now()-this.start_time;if(ctx){var overlay_width=this.width;var overlay_height=this.height;var dpr=this.devicePixelRatio;if(this.loaderstyle<3&&(this.isCocoonJs||(ms_elapsed>=500&&this.last_progress!=this.progress))){ctx.clearRect(0,0,overlay_width,overlay_height);var mx=overlay_width/2;var my=overlay_height/2;var haslogo=(this.loaderstyle===0&&this.loaderlogos.logo.complete);var hlw=40*dpr;var hlh=0;var logowidth=80*dpr;var logoheight;if(haslogo){var loaderLogoImage=this.loaderlogos.logo;logowidth=loaderLogoImage.width*dpr;logoheight=loaderLogoImage.height*dpr;hlw=logowidth/2;hlh=logoheight/2;ctx.drawImage(loaderLogoImage,cr.floor(mx-hlw),cr.floor(my-hlh),logowidth,logoheight)};if(this.loaderstyle<=1){my+=hlh+(haslogo?12*dpr:0);mx-=hlw;mx=cr.floor(mx)+0.5;my=cr.floor(my)+0.5;ctx.fillStyle=anyImageHadError?"\x72\x65\x64":"\x44\x6F\x64\x67\x65\x72\x42\x6C\x75\x65";ctx.fillRect(mx,my,Math.floor(logowidth*this.progress),6*dpr);ctx.strokeStyle="\x62\x6C\x61\x63\x6B";ctx.strokeRect(mx,my,logowidth,6*dpr);ctx.strokeStyle="\x77\x68\x69\x74\x65";ctx.strokeRect(mx-1*dpr,my-1*dpr,logowidth+2*dpr,8*dpr)}else{if(this.loaderstyle===2){ctx.font=(this.isEjecta?"\x31\x32\x70\x74\x20\x41\x72\x69\x61\x6C\x4D\x54":"\x31\x32\x70\x74\x20\x41\x72\x69\x61\x6C");ctx.fillStyle=anyImageHadError?"\x23\x66\x30\x30":"\x23\x39\x39\x39";ctx.textBaseLine="\x6D\x69\x64\x64\x6C\x65";var percent_text=Math.round(this.progress*100)+"\x25";var text_dim=ctx.measureText?ctx.measureText(percent_text):null;var text_width=text_dim?text_dim.width:0;ctx.fillText(percent_text,mx-(text_width/2),my)}};this.last_progress=this.progress}else{if(this.loaderstyle===4){this.draw_c2_splash_loader(ctx);if(raf){raf(function(){self.go()})}else{setTimeout(function(){self.go()},16)};return}}};setTimeout(function(){self.go()},(this.isCocoonJs?10:100))}};var splashStartTime=-1;var splashFadeInDuration=300;var splashFadeOutDuration=300;var splashAfterFadeOutWait=(typeof cr_is_preview==="\x75\x6E\x64\x65\x66\x69\x6E\x65\x64"?200:0);var splashIsFadeIn=true;var splashIsFadeOut=false;var splashFadeInFinish=0;var splashFadeOutStart=0;var splashMinDisplayTime=(typeof cr_is_preview==="\x75\x6E\x64\x65\x66\x69\x6E\x65\x64"?3000:0);var renderViaCanvas=null;var renderViaCtx=null;var splashFrameNumber=0;function maybeCreateRenderViaCanvas(w,h){if(!renderViaCanvas||renderViaCanvas.width!==w||renderViaCanvas.height!==h){renderViaCanvas=document.createElement("\x63\x61\x6E\x76\x61\x73");renderViaCanvas.width=w;renderViaCanvas.height=h;renderViaCtx=renderViaCanvas.getContext("\x32\x64")}}function mipImage(arr,size){if(size<=128){return arr[3]}else{if(size<=256){return arr[2]}else{if(size<=512){return arr[1]}else{return arr[0]}}}}Runtime.prototype.draw_c2_splash_loader=function(ctx){if(isC2SplashDone){return};var w=Math.ceil(this.width);var h=Math.ceil(this.height);var dpr=this.devicePixelRatio;var logoimages=this.loaderlogos.logo;var poweredimages=this.loaderlogos.powered;var websiteimages=this.loaderlogos.website;for(var i=0;i<4;++i){if(!logoimages[i].complete||!poweredimages[i].complete||!websiteimages[i].complete){return}};if(splashFrameNumber===0){splashStartTime=Date.now()};var nowTime=Date.now();var isRenderingVia=false;var renderToCtx=ctx;var drawW,drawH;if(splashIsFadeIn||splashIsFadeOut){ctx.clearRect(0,0,w,h);maybeCreateRenderViaCanvas(w,h);renderToCtx=renderViaCtx;isRenderingVia=true;if(splashIsFadeIn&&splashFrameNumber===1){splashStartTime=Date.now()}}else{ctx.globalAlpha=1};renderToCtx.fillStyle="\x23\x33\x33\x33\x33\x33\x33";renderToCtx.fillRect(0,0,w,h);if(this.cssHeight>256){drawW=cr.clamp(h*0.22,105,w*0.6);drawH=drawW*0.25;renderToCtx.drawImage(mipImage(poweredimages,drawW),w*0.5-drawW/2,h*0.2-drawH/2,drawW,drawH);drawW=Math.min(h*0.395,w*0.95);drawH=drawW;renderToCtx.drawImage(mipImage(logoimages,drawW),w*0.5-drawW/2,h*0.485-drawH/2,drawW,drawH);drawW=cr.clamp(h*0.22,105,w*0.6);drawH=drawW*0.25;renderToCtx.drawImage(mipImage(websiteimages,drawW),w*0.5-drawW/2,h*0.868-drawH/2,drawW,drawH);renderToCtx.fillStyle="\x23\x33\x43\x33\x43\x33\x43";drawW=w;drawH=Math.max(h*0.005,2);renderToCtx.fillRect(0,h*0.8-drawH/2,drawW,drawH);renderToCtx.fillStyle=anyImageHadError?"\x72\x65\x64":"\x23\x45\x30\x46\x46\x36\x35";drawW=w*this.progress;renderToCtx.fillRect(w*0.5-drawW/2,h*0.8-drawH/2,drawW,drawH)}else{drawW=h*0.55;drawH=drawW;renderToCtx.drawImage(mipImage(logoimages,drawW),w*0.5-drawW/2,h*0.45-drawH/2,drawW,drawH);renderToCtx.fillStyle="\x23\x33\x43\x33\x43\x33\x43";drawW=w;drawH=Math.max(h*0.005,2);renderToCtx.fillRect(0,h*0.85-drawH/2,drawW,drawH);renderToCtx.fillStyle=anyImageHadError?"\x72\x65\x64":"\x23\x45\x30\x46\x46\x36\x35";drawW=w*this.progress;renderToCtx.fillRect(w*0.5-drawW/2,h*0.85-drawH/2,drawW,drawH)};if(isRenderingVia){if(splashIsFadeIn){if(splashFrameNumber===0){ctx.globalAlpha=0}else{ctx.globalAlpha=Math.min((nowTime-splashStartTime)/splashFadeInDuration,1)}}else{if(splashIsFadeOut){ctx.globalAlpha=Math.max(1-(nowTime-splashFadeOutStart)/splashFadeOutDuration,0)}};ctx.drawImage(renderViaCanvas,0,0,w,h)};if(splashIsFadeIn&&nowTime-splashStartTime>=splashFadeInDuration&&splashFrameNumber>=2){splashIsFadeIn=false;splashFadeInFinish=nowTime};if(!splashIsFadeIn&&nowTime-splashFadeInFinish>=splashMinDisplayTime&&!splashIsFadeOut&&this.progress>=1){splashIsFadeOut=true;splashFadeOutStart=nowTime};if((splashIsFadeOut&&nowTime-splashFadeOutStart>=splashFadeOutDuration+splashAfterFadeOutWait)||(typeof cr_is_preview!=="\x75\x6E\x64\x65\x66\x69\x6E\x65\x64"&&this.progress>=1&&Date.now()-splashStartTime<500)){isC2SplashDone=true;splashIsFadeIn=false;splashIsFadeOut=false;renderViaCanvas=null;renderViaCtx=null;this.loaderlogos=null};++splashFrameNumber};Runtime.prototype.go_loading_finished=function(){if(this.overlay_canvas){this.canvas.parentNode.removeChild(this.overlay_canvas);this.overlay_ctx=null;this.overlay_canvas=null};this.start_time=Date.now();this.last_fps_time=cr.performance_now();var i,len,t;if(this.uses_loader_layout){for(i=0,len=this.types_by_index.length;i<len;i++){t=this.types_by_index[i];if(!t.is_family&&!t.isOnLoaderLayout&&t.plugin.is_world){t.onCreate();cr.seal(t)}}}else{this.isloading=false};for(i=0,len=this.layouts_by_index.length;i<len;i++){this.layouts_by_index[i].createGlobalNonWorlds()};if(this.fullscreen_mode>=2){var orig_aspect=this.original_width/this.original_height;var cur_aspect=this.width/this.height;if((this.fullscreen_mode!==2&&cur_aspect>orig_aspect)||(this.fullscreen_mode===2&&cur_aspect<orig_aspect)){this.aspect_scale=this.height/this.original_height}else{this.aspect_scale=this.width/this.original_width}};if(this.first_layout){this.layouts[this.first_layout].startRunning()}else{this.layouts_by_index[0].startRunning()};if(!this.uses_loader_layout){this.loadingprogress=1;this.trigger(cr.system_object.prototype.cnds.OnLoadFinished,null)};if(navigator["\x73\x70\x6C\x61\x73\x68\x73\x63\x72\x65\x65\x6E"]&&navigator["\x73\x70\x6C\x61\x73\x68\x73\x63\x72\x65\x65\x6E"]["\x68\x69\x64\x65"]){navigator["\x73\x70\x6C\x61\x73\x68\x73\x63\x72\x65\x65\x6E"]["\x68\x69\x64\x65"]()};for(i=0,len=this.types_by_index.length;i<len;i++){t=this.types_by_index[i];if(t.onAppBegin){t.onAppBegin()}};if(document["\x68\x69\x64\x64\x65\x6E"]||document["\x77\x65\x62\x6B\x69\x74\x48\x69\x64\x64\x65\x6E"]||document["\x6D\x6F\x7A\x48\x69\x64\x64\x65\x6E"]||document["\x6D\x73\x48\x69\x64\x64\x65\x6E"]){window["\x63\x72\x5F\x73\x65\x74\x53\x75\x73\x70\x65\x6E\x64\x65\x64"](true)}else{this.tick(false)};if(this.isDirectCanvas){AppMobi["\x77\x65\x62\x76\x69\x65\x77"]["\x65\x78\x65\x63\x75\x74\x65"]("\x6F\x6E\x47\x61\x6D\x65\x52\x65\x61\x64\x79\x28\x29\x3B")}};Runtime.prototype.tick=function(background_wake,timestamp,debug_step){if(!this.running_layout){return};var nowtime=cr.performance_now();var logic_start=nowtime;if(!debug_step&&this.isSuspended&&!background_wake){return};if(!background_wake){if(raf){this.raf_id=raf(this.tickFunc)}else{this.timeout_id=setTimeout(this.tickFunc,this.isMobile?1:16)}};var raf_time=timestamp||nowtime;var fsmode=this.fullscreen_mode;var isfullscreen=(document["\x6D\x6F\x7A\x46\x75\x6C\x6C\x53\x63\x72\x65\x65\x6E"]||document["\x77\x65\x62\x6B\x69\x74\x49\x73\x46\x75\x6C\x6C\x53\x63\x72\x65\x65\x6E"]||document["\x66\x75\x6C\x6C\x53\x63\x72\x65\x65\x6E"]||!!document["\x6D\x73\x46\x75\x6C\x6C\x73\x63\x72\x65\x65\x6E\x45\x6C\x65\x6D\x65\x6E\x74"])&&!this.isCordova;if((isfullscreen||this.isNodeFullscreen)&&this.fullscreen_scaling>0){fsmode=this.fullscreen_scaling};if(fsmode>0&&(!this.isiOS||window.self!==window.top)){var curwidth=window.innerWidth;var curheight=window.innerHeight;if(this.lastWindowWidth!==curwidth||this.lastWindowHeight!==curheight){this["\x73\x65\x74\x53\x69\x7A\x65"](window_innerWidth(),window_innerHeight())}};if(!this.isDomFree){if(isfullscreen){if(!this.firstInFullscreen){this.fullscreenOldMarginCss=jQuery(this.canvas).css("\x6D\x61\x72\x67\x69\x6E")||"\x30";this.firstInFullscreen=true};if(!this.isChrome&&!this.isNWjs){jQuery(this.canvas).css({"\x6D\x61\x72\x67\x69\x6E\x2D\x6C\x65\x66\x74":""+Math.floor((screen.width-(this.width/this.devicePixelRatio))/2)+"\x70\x78","\x6D\x61\x72\x67\x69\x6E\x2D\x74\x6F\x70":""+Math.floor((screen.height-(this.height/this.devicePixelRatio))/2)+"\x70\x78"})}}else{if(this.firstInFullscreen){if(!this.isChrome&&!this.isNWjs){jQuery(this.canvas).css("\x6D\x61\x72\x67\x69\x6E",this.fullscreenOldMarginCss)};this.fullscreenOldMarginCss="";this.firstInFullscreen=false;if(this.fullscreen_mode===0){this["\x73\x65\x74\x53\x69\x7A\x65"](Math.round(this.oldWidth/this.devicePixelRatio),Math.round(this.oldHeight/this.devicePixelRatio),true)}}else{this.oldWidth=this.width;this.oldHeight=this.height}}};if(this.isloading){var done=this.areAllTexturesAndSoundsLoaded();this.loadingprogress=this.progress;if(done){this.isloading=false;this.progress=1;this.trigger(cr.system_object.prototype.cnds.OnLoadFinished,null)}};this.logic(raf_time);if((this.redraw||this.isCocoonJs)&&!this.is_WebGL_context_lost&&!this.suspendDrawing&&!background_wake){this.redraw=false;if(this.glwrap){this.drawGL()}else{this.draw()};if(this.snapshotCanvas){if(this.canvas&&this.canvas.toDataURL){this.snapshotData=this.canvas.toDataURL(this.snapshotCanvas[0],this.snapshotCanvas[1]);if(window["\x63\x72\x5F\x6F\x6E\x53\x6E\x61\x70\x73\x68\x6F\x74"]){window["\x63\x72\x5F\x6F\x6E\x53\x6E\x61\x70\x73\x68\x6F\x74"](this.snapshotData)};this.trigger(cr.system_object.prototype.cnds.OnCanvasSnapshot,null)};this.snapshotCanvas=null}};if(!this.hit_breakpoint){this.tickcount++;this.execcount++;this.framecount++};this.logictime+=cr.performance_now()-logic_start};Runtime.prototype.logic=function(cur_time){var i,leni,j,lenj,k,lenk,type,inst,binst;if(cur_time-this.last_fps_time>=1000){this.last_fps_time+=1000;if(cur_time-this.last_fps_time>=1000){this.last_fps_time=cur_time};this.fps=this.framecount;this.framecount=0;this.cpuutilisation=this.logictime;this.logictime=0};if(this.last_tick_time!==0){var ms_diff=cur_time-this.last_tick_time;if(ms_diff<0){ms_diff=0};this.dt1=ms_diff/1000.0;if(this.dt1>0.5){this.dt1=0}else{if(this.dt1>1/this.minimumFramerate){this.dt1=1/this.minimumFramerate}}};this.last_tick_time=cur_time;this.dt=this.dt1*this.timescale;this.kahanTime.add(this.dt);this.wallTime.add(this.dt1);var isfullscreen=(document["\x6D\x6F\x7A\x46\x75\x6C\x6C\x53\x63\x72\x65\x65\x6E"]||document["\x77\x65\x62\x6B\x69\x74\x49\x73\x46\x75\x6C\x6C\x53\x63\x72\x65\x65\x6E"]||document["\x66\x75\x6C\x6C\x53\x63\x72\x65\x65\x6E"]||!!document["\x6D\x73\x46\x75\x6C\x6C\x73\x63\x72\x65\x65\x6E\x45\x6C\x65\x6D\x65\x6E\x74"]||this.isNodeFullscreen)&&!this.isCordova;if(this.fullscreen_mode>=2||(isfullscreen&&this.fullscreen_scaling>0)){var orig_aspect=this.original_width/this.original_height;var cur_aspect=this.width/this.height;var mode=this.fullscreen_mode;if(isfullscreen&&this.fullscreen_scaling>0){mode=this.fullscreen_scaling};if((mode!==2&&cur_aspect>orig_aspect)||(mode===2&&cur_aspect<orig_aspect)){this.aspect_scale=this.height/this.original_height}else{this.aspect_scale=this.width/this.original_width};if(this.running_layout){this.running_layout.scrollToX(this.running_layout.scrollX);this.running_layout.scrollToY(this.running_layout.scrollY)}}else{this.aspect_scale=(this.isRetina?this.devicePixelRatio:1)};this.ClearDeathRow();this.isInOnDestroy++;this.system.runWaits();this.isInOnDestroy--;this.ClearDeathRow();this.isInOnDestroy++;var tickarr=this.objects_to_pretick.valuesRef();for(i=0,leni=tickarr.length;i<leni;i++){tickarr[i].pretick()};for(i=0,leni=this.types_by_index.length;i<leni;i++){type=this.types_by_index[i];if(type.is_family||(!type.behaviors.length&&!type.families.length)){continue};for(j=0,lenj=type.instances.length;j<lenj;j++){inst=type.instances[j];for(k=0,lenk=inst.behavior_insts.length;k<lenk;k++){inst.behavior_insts[k].tick()}}};for(i=0,leni=this.types_by_index.length;i<leni;i++){type=this.types_by_index[i];if(type.is_family||(!type.behaviors.length&&!type.families.length)){continue};for(j=0,lenj=type.instances.length;j<lenj;j++){inst=type.instances[j];for(k=0,lenk=inst.behavior_insts.length;k<lenk;k++){binst=inst.behavior_insts[k];if(binst.posttick){binst.posttick()}}}};tickarr=this.objects_to_tick.valuesRef();for(i=0,leni=tickarr.length;i<leni;i++){tickarr[i].tick()};this.isInOnDestroy--;this.handleSaveLoad();i=0;while(this.changelayout&&i++<10){this.doChangeLayout(this.changelayout)};for(i=0,leni=this.eventsheets_by_index.length;i<leni;i++){this.eventsheets_by_index[i].hasRun=false};if(this.running_layout.event_sheet){this.running_layout.event_sheet.run()};cr.clearArray(this.registered_collisions);this.layout_first_tick=false;this.isInOnDestroy++;for(i=0,leni=this.types_by_index.length;i<leni;i++){type=this.types_by_index[i];if(type.is_family||(!type.behaviors.length&&!type.families.length)){continue};for(j=0,lenj=type.instances.length;j<lenj;j++){var inst=type.instances[j];for(k=0,lenk=inst.behavior_insts.length;k<lenk;k++){binst=inst.behavior_insts[k];if(binst.tick2){binst.tick2()}}}};tickarr=this.objects_to_tick2.valuesRef();for(i=0,leni=tickarr.length;i<leni;i++){tickarr[i].tick2()};this.isInOnDestroy--};Runtime.prototype.onWindowBlur=function(){var i,leni,j,lenj,k,lenk,type,inst,binst;for(i=0,leni=this.types_by_index.length;i<leni;i++){type=this.types_by_index[i];if(type.is_family){continue};for(j=0,lenj=type.instances.length;j<lenj;j++){inst=type.instances[j];if(inst.onWindowBlur){inst.onWindowBlur()};if(!inst.behavior_insts){continue};for(k=0,lenk=inst.behavior_insts.length;k<lenk;k++){binst=inst.behavior_insts[k];if(binst.onWindowBlur){binst.onWindowBlur()}}}}};Runtime.prototype.doChangeLayout=function(changeToLayout){var prev_layout=this.running_layout;this.running_layout.stopRunning();var i,len,j,lenj,k,lenk,type,inst,binst;if(this.glwrap){for(i=0,len=this.types_by_index.length;i<len;i++){type=this.types_by_index[i];if(type.is_family){continue};if(type.unloadTextures&&(!type.global||type.instances.length===0)&&changeToLayout.initial_types.indexOf(type)===-1){type.unloadTextures()}}};if(prev_layout==changeToLayout){cr.clearArray(this.system.waits)};cr.clearArray(this.registered_collisions);changeToLayout.startRunning();for(i=0,len=this.types_by_index.length;i<len;i++){type=this.types_by_index[i];if(!type.global&&!type.plugin.singleglobal){continue};for(j=0,lenj=type.instances.length;j<lenj;j++){inst=type.instances[j];if(inst.onLayoutChange){inst.onLayoutChange()};if(inst.behavior_insts){for(k=0,lenk=inst.behavior_insts.length;k<lenk;k++){binst=inst.behavior_insts[k];if(binst.onLayoutChange){binst.onLayoutChange()}}}}};this.redraw=true;this.layout_first_tick=true;this.ClearDeathRow()};Runtime.prototype.pretickMe=function(inst){this.objects_to_pretick.add(inst)};Runtime.prototype.unpretickMe=function(inst){this.objects_to_pretick.remove(inst)};Runtime.prototype.tickMe=function(inst){this.objects_to_tick.add(inst)};Runtime.prototype.untickMe=function(inst){this.objects_to_tick.remove(inst)};Runtime.prototype.tick2Me=function(inst){this.objects_to_tick2.add(inst)};Runtime.prototype.untick2Me=function(inst){this.objects_to_tick2.remove(inst)};Runtime.prototype.getDt=function(inst){if(!inst||inst.my_timescale===-1.0){return this.dt};return this.dt1*inst.my_timescale};Runtime.prototype.draw=function(){this.running_layout.draw(this.ctx);if(this.isDirectCanvas){this.ctx["\x70\x72\x65\x73\x65\x6E\x74"]()}};Runtime.prototype.drawGL=function(){if(this.enableFrontToBack){this.earlyz_index=1;this.running_layout.drawGL_earlyZPass(this.glwrap)};this.running_layout.drawGL(this.glwrap);this.glwrap.present()};Runtime.prototype.addDestroyCallback=function(f){if(f){this.destroycallbacks.push(f)}};Runtime.prototype.removeDestroyCallback=function(f){cr.arrayFindRemove(this.destroycallbacks,f)};Runtime.prototype.getObjectByUID=function(uid_){;;var uidstr=uid_.toString();if(this.objectsByUid.hasOwnProperty(uidstr)){return this.objectsByUid[uidstr]}else{return null}};var objectset_cache=[];function alloc_objectset(){if(objectset_cache.length){return objectset_cache.pop()}else{return new cr.ObjectSet()}}function free_objectset(s){s.clear();objectset_cache.push(s)}Runtime.prototype.DestroyInstance=function(inst){var i,len;var type=inst.type;var typename=type.name;var has_typename=this.deathRow.hasOwnProperty(typename);var obj_set=null;if(has_typename){obj_set=this.deathRow[typename];if(obj_set.contains(inst)){return}}else{obj_set=alloc_objectset();this.deathRow[typename]=obj_set};obj_set.add(inst);this.hasPendingInstances=true;if(inst.is_contained){for(i=0,len=inst.siblings.length;i<len;i++){this.DestroyInstance(inst.siblings[i])}};if(this.isInClearDeathRow){obj_set.values_cache.push(inst)};if(!this.isEndingLayout){this.isInOnDestroy++;this.trigger(Object.getPrototypeOf(inst.type.plugin).cnds.OnDestroyed,inst);this.isInOnDestroy--}};Runtime.prototype.ClearDeathRow=function(){if(!this.hasPendingInstances){return};var inst,type,instances;var i,j,leni,lenj,obj_set;this.isInClearDeathRow=true;for(i=0,leni=this.createRow.length;i<leni;++i){inst=this.createRow[i];type=inst.type;type.instances.push(inst);for(j=0,lenj=type.families.length;j<lenj;++j){type.families[j].instances.push(inst);type.families[j].stale_iids=true}};cr.clearArray(this.createRow);this.IterateDeathRow();cr.wipe(this.deathRow);this.isInClearDeathRow=false;this.hasPendingInstances=false};Runtime.prototype.IterateDeathRow=function(){for(var p in this.deathRow){if(this.deathRow.hasOwnProperty(p)){this.ClearDeathRowForType(this.deathRow[p])}}};Runtime.prototype.ClearDeathRowForType=function(obj_set){var arr=obj_set.valuesRef();;;var type=arr[0].type;;;;;var i,len,j,lenj,w,f,layer_instances,inst;cr.arrayRemoveAllFromObjectSet(type.instances,obj_set);type.stale_iids=true;if(type.instances.length===0){type.any_instance_parallaxed=false};for(i=0,len=type.families.length;i<len;++i){f=type.families[i];cr.arrayRemoveAllFromObjectSet(f.instances,obj_set);f.stale_iids=true};for(i=0,len=this.system.waits.length;i<len;++i){w=this.system.waits[i];if(w.sols.hasOwnProperty(type.index)){cr.arrayRemoveAllFromObjectSet(w.sols[type.index].insts,obj_set)};if(!type.is_family){for(j=0,lenj=type.families.length;j<lenj;++j){f=type.families[j];if(w.sols.hasOwnProperty(f.index)){cr.arrayRemoveAllFromObjectSet(w.sols[f.index].insts,obj_set)}}}};var first_layer=arr[0].layer;if(first_layer){if(first_layer.useRenderCells){layer_instances=first_layer.instances;for(i=0,len=layer_instances.length;i<len;++i){inst=layer_instances[i];if(!obj_set.contains(inst)){continue};inst.update_bbox();first_layer.render_grid.update(inst,inst.rendercells,null);inst.rendercells["\x73\x65\x74"](0,0,-1,-1)}};cr.arrayRemoveAllFromObjectSet(first_layer.instances,obj_set);first_layer.setZIndicesStaleFrom(0)};for(i=0;i<arr.length;++i){this.ClearDeathRowForSingleInstance(arr[i],type)};free_objectset(obj_set);this.redraw=true};Runtime.prototype.ClearDeathRowForSingleInstance=function(inst,type){var i,len,binst;for(i=0,len=this.destroycallbacks.length;i<len;++i){this.destroycallbacks[i](inst)};if(inst.collcells){type.collision_grid.update(inst,inst.collcells,null)};var layer=inst.layer;if(layer){layer.removeFromInstanceList(inst,true)};if(inst.behavior_insts){for(i=0,len=inst.behavior_insts.length;i<len;++i){binst=inst.behavior_insts[i];if(binst.onDestroy){binst.onDestroy()};binst.behavior.my_instances.remove(inst)}};this.objects_to_pretick.remove(inst);this.objects_to_tick.remove(inst);this.objects_to_tick2.remove(inst);if(inst.onDestroy){inst.onDestroy()};if(this.objectsByUid.hasOwnProperty(inst.uid.toString())){delete this.objectsByUid[inst.uid.toString()]};this.objectcount--;if(type.deadCache.length<100){type.deadCache.push(inst)}};Runtime.prototype.createInstance=function(type,layer,sx,sy){if(type.is_family){var i=cr.floor(Math.random()*type.members.length);return this.createInstance(type.members[i],layer,sx,sy)};if(!type.default_instance){return null};return this.createInstanceFromInit(type.default_instance,layer,false,sx,sy,false)};var all_behaviors=[];Runtime.prototype.createInstanceFromInit=function(initial_inst,layer,is_startup_instance,sx,sy,skip_siblings){var i,len,j,lenj,p,effect_fallback,x,y;if(!initial_inst){return null};var type=this.types_by_index[initial_inst[1]];;;;;var is_world=type.plugin.is_world;;;if(this.isloading&&is_world&&!type.isOnLoaderLayout){return null};if(is_world&&!this.glwrap&&initial_inst[0][11]===11){return null};var original_layer=layer;if(!is_world){layer=null};var inst;if(type.deadCache.length){inst=type.deadCache.pop();inst.recycled=true;type.plugin.Instance.call(inst,type)}else{inst=new type.plugin.Instance(type);inst.recycled=false};if(is_startup_instance&&!skip_siblings&&!this.objectsByUid.hasOwnProperty(initial_inst[2].toString())){inst.uid=initial_inst[2]}else{inst.uid=this.next_uid++};this.objectsByUid[inst.uid.toString()]=inst;inst.puid=this.next_puid++;inst.iid=type.instances.length;for(i=0,len=this.createRow.length;i<len;++i){if(this.createRow[i].type===type){inst.iid++}};inst.get_iid=cr.inst_get_iid;inst.toString=cr.inst_toString;var initial_vars=initial_inst[3];if(inst.recycled){cr.wipe(inst.extra)}else{inst.extra={};if(typeof cr_is_preview!=="\x75\x6E\x64\x65\x66\x69\x6E\x65\x64"){inst.instance_var_names=[];inst.instance_var_names.length=initial_vars.length;for(i=0,len=initial_vars.length;i<len;i++){inst.instance_var_names[i]=initial_vars[i][1]}};inst.instance_vars=[];inst.instance_vars.length=initial_vars.length};for(i=0,len=initial_vars.length;i<len;i++){inst.instance_vars[i]=initial_vars[i][0]};if(is_world){var wm=initial_inst[0];;;inst.x=cr.is_undefined(sx)?wm[0]:sx;inst.y=cr.is_undefined(sy)?wm[1]:sy;inst.z=wm[2];inst.width=wm[3];inst.height=wm[4];inst.depth=wm[5];inst.angle=wm[6];inst.opacity=wm[7];inst.hotspotX=wm[8];inst.hotspotY=wm[9];inst.blend_mode=wm[10];effect_fallback=wm[11];if(!this.glwrap&&type.effect_types.length){inst.blend_mode=effect_fallback};inst.compositeOp=cr.effectToCompositeOp(inst.blend_mode);if(this.gl){cr.setGLBlend(inst,inst.blend_mode,this.gl)};if(inst.recycled){for(i=0,len=wm[12].length;i<len;i++){for(j=0,lenj=wm[12][i].length;j<lenj;j++){inst.effect_params[i][j]=wm[12][i][j]}};inst.bbox["\x73\x65\x74"](0,0,0,0);inst.collcells["\x73\x65\x74"](0,0,-1,-1);inst.rendercells["\x73\x65\x74"](0,0,-1,-1);inst.bquad.set_from_rect(inst.bbox);cr.clearArray(inst.bbox_changed_callbacks)}else{inst.effect_params=wm[12].slice(0);for(i=0,len=inst.effect_params.length;i<len;i++){inst.effect_params[i]=wm[12][i].slice(0)};inst.active_effect_types=[];inst.active_effect_flags=[];inst.active_effect_flags.length=type.effect_types.length;inst.bbox=new cr.rect(0,0,0,0);inst.collcells=new cr.rect(0,0,-1,-1);inst.rendercells=new cr.rect(0,0,-1,-1);inst.bquad=new cr.quad();inst.bbox_changed_callbacks=[];inst.set_bbox_changed=cr.set_bbox_changed;inst.add_bbox_changed_callback=cr.add_bbox_changed_callback;inst.contains_pt=cr.inst_contains_pt;inst.update_bbox=cr.update_bbox;inst.update_render_cell=cr.update_render_cell;inst.update_collision_cell=cr.update_collision_cell;inst.get_zindex=cr.inst_get_zindex};inst.tilemap_exists=false;inst.tilemap_width=0;inst.tilemap_height=0;inst.tilemap_data=null;if(wm.length===14){inst.tilemap_exists=true;inst.tilemap_width=wm[13][0];inst.tilemap_height=wm[13][1];inst.tilemap_data=wm[13][2]};for(i=0,len=type.effect_types.length;i<len;i++){inst.active_effect_flags[i]=true};inst.shaders_preserve_opaqueness=true;inst.updateActiveEffects=cr.inst_updateActiveEffects;inst.updateActiveEffects();inst.uses_shaders=!!inst.active_effect_types.length;inst.bbox_changed=true;inst.cell_changed=true;type.any_cell_changed=true;inst.visible=true;inst.my_timescale=-1.0;inst.layer=layer;inst.zindex=layer.instances.length;inst.earlyz_index=0;if(typeof inst.collision_poly==="\x75\x6E\x64\x65\x66\x69\x6E\x65\x64"){inst.collision_poly=null};inst.collisionsEnabled=true;this.redraw=true};var initial_props,binst;cr.clearArray(all_behaviors);for(i=0,len=type.families.length;i<len;i++){all_behaviors.push.apply(all_behaviors,type.families[i].behaviors)};all_behaviors.push.apply(all_behaviors,type.behaviors);if(inst.recycled){for(i=0,len=all_behaviors.length;i<len;i++){var btype=all_behaviors[i];binst=inst.behavior_insts[i];binst.recycled=true;btype.behavior.Instance.call(binst,btype,inst);initial_props=initial_inst[4][i];for(j=0,lenj=initial_props.length;j<lenj;j++){binst.properties[j]=initial_props[j]};binst.onCreate();btype.behavior.my_instances.add(inst)}}else{inst.behavior_insts=[];for(i=0,len=all_behaviors.length;i<len;i++){var btype=all_behaviors[i];var binst=new btype.behavior.Instance(btype,inst);binst.recycled=false;binst.properties=initial_inst[4][i].slice(0);binst.onCreate();cr.seal(binst);inst.behavior_insts.push(binst);btype.behavior.my_instances.add(inst)}};initial_props=initial_inst[5];if(inst.recycled){for(i=0,len=initial_props.length;i<len;i++){inst.properties[i]=initial_props[i]}}else{inst.properties=initial_props.slice(0)};this.createRow.push(inst);this.hasPendingInstances=true;if(layer){;;layer.appendToInstanceList(inst,true);if(layer.parallaxX!==1||layer.parallaxY!==1){type.any_instance_parallaxed=true}};this.objectcount++;if(type.is_contained){inst.is_contained=true;if(inst.recycled){cr.clearArray(inst.siblings)}else{inst.siblings=[]};if(!is_startup_instance&&!skip_siblings){for(i=0,len=type.container.length;i<len;i++){if(type.container[i]===type){continue};if(!type.container[i].default_instance){return null};inst.siblings.push(this.createInstanceFromInit(type.container[i].default_instance,original_layer,false,is_world?inst.x:sx,is_world?inst.y:sy,true))};for(i=0,len=inst.siblings.length;i<len;i++){inst.siblings[i].siblings.push(inst);for(j=0;j<len;j++){if(i!==j){inst.siblings[i].siblings.push(inst.siblings[j])}}}}}else{inst.is_contained=false;inst.siblings=null};inst.onCreate();if(!inst.recycled){cr.seal(inst)};for(i=0,len=inst.behavior_insts.length;i<len;i++){if(inst.behavior_insts[i].postCreate){inst.behavior_insts[i].postCreate()}};return inst};Runtime.prototype.getLayerByName=function(layer_name){var i,len;for(i=0,len=this.running_layout.layers.length;i<len;i++){var layer=this.running_layout.layers[i];if(cr.equals_nocase(layer.name,layer_name)){return layer}};return null};Runtime.prototype.getLayerByNumber=function(index){index=cr.floor(index);if(index<0){index=0};if(index>=this.running_layout.layers.length){index=this.running_layout.layers.length-1};return this.running_layout.layers[index]};Runtime.prototype.getLayer=function(l){if(cr.is_number(l)){return this.getLayerByNumber(l)}else{return this.getLayerByName(l.toString())}};Runtime.prototype.clearSol=function(solModifiers){var i,len;for(i=0,len=solModifiers.length;i<len;i++){solModifiers[i].getCurrentSol().select_all=true}};Runtime.prototype.pushCleanSol=function(solModifiers){var i,len;for(i=0,len=solModifiers.length;i<len;i++){solModifiers[i].pushCleanSol()}};Runtime.prototype.pushCopySol=function(solModifiers){var i,len;for(i=0,len=solModifiers.length;i<len;i++){solModifiers[i].pushCopySol()}};Runtime.prototype.popSol=function(solModifiers){var i,len;for(i=0,len=solModifiers.length;i<len;i++){solModifiers[i].popSol()}};Runtime.prototype.updateAllCells=function(type){if(!type.any_cell_changed){return};var i,len,instances=type.instances;for(i=0,len=instances.length;i<len;++i){instances[i].update_collision_cell()};var createRow=this.createRow;for(i=0,len=createRow.length;i<len;++i){if(createRow[i].type===type){createRow[i].update_collision_cell()}};type.any_cell_changed=false};Runtime.prototype.getCollisionCandidates=function(layer,rtype,bbox,candidates){var i,len,t;var is_parallaxed=(layer?(layer.parallaxX!==1||layer.parallaxY!==1):false);if(rtype.is_family){for(i=0,len=rtype.members.length;i<len;++i){t=rtype.members[i];if(is_parallaxed||t.any_instance_parallaxed){cr.appendArray(candidates,t.instances)}else{this.updateAllCells(t);t.collision_grid.queryRange(bbox,candidates)}}}else{if(is_parallaxed||rtype.any_instance_parallaxed){cr.appendArray(candidates,rtype.instances)}else{this.updateAllCells(rtype);rtype.collision_grid.queryRange(bbox,candidates)}}};Runtime.prototype.getTypesCollisionCandidates=function(layer,types,bbox,candidates){var i,len;for(i=0,len=types.length;i<len;++i){this.getCollisionCandidates(layer,types[i],bbox,candidates)}};Runtime.prototype.getSolidCollisionCandidates=function(layer,bbox,candidates){var solid=this.getSolidBehavior();if(!solid){return null};this.getTypesCollisionCandidates(layer,solid.my_types,bbox,candidates)};Runtime.prototype.getJumpthruCollisionCandidates=function(layer,bbox,candidates){var jumpthru=this.getJumpthruBehavior();if(!jumpthru){return null};this.getTypesCollisionCandidates(layer,jumpthru.my_types,bbox,candidates)};Runtime.prototype.testAndSelectCanvasPointOverlap=function(type,ptx,pty,inverted){var sol=type.getCurrentSol();var i,j,inst,len;var lx,ly;if(sol.select_all){if(!inverted){sol.select_all=false;cr.clearArray(sol.instances)};for(i=0,len=type.instances.length;i<len;i++){inst=type.instances[i];inst.update_bbox();lx=inst.layer.canvasToLayer(ptx,pty,true);ly=inst.layer.canvasToLayer(ptx,pty,false);if(inst.contains_pt(lx,ly)){if(inverted){return false}else{sol.instances.push(inst)}}}}else{j=0;for(i=0,len=sol.instances.length;i<len;i++){inst=sol.instances[i];inst.update_bbox();lx=inst.layer.canvasToLayer(ptx,pty,true);ly=inst.layer.canvasToLayer(ptx,pty,false);if(inst.contains_pt(lx,ly)){if(inverted){return false}else{sol.instances[j]=sol.instances[i];j++}}};if(!inverted){sol.instances.length=j}};type.applySolToContainer();if(inverted){return true}else{return sol.hasObjects()}};Runtime.prototype.testOverlap=function(a,b){if(!a||!b||a===b||!a.collisionsEnabled||!b.collisionsEnabled){return false};a.update_bbox();b.update_bbox();var layera=a.layer;var layerb=b.layer;var different_layers=(layera!==layerb&&(layera.parallaxX!==layerb.parallaxX||layerb.parallaxY!==layerb.parallaxY||layera.scale!==layerb.scale||layera.angle!==layerb.angle||layera.zoomRate!==layerb.zoomRate));var i,len,i2,i21,x,y,haspolya,haspolyb,polya,polyb;if(!different_layers){if(!a.bbox.intersects_rect(b.bbox)){return false};if(!a.bquad.intersects_quad(b.bquad)){return false};if(a.tilemap_exists&&b.tilemap_exists){return false};if(a.tilemap_exists){return this.testTilemapOverlap(a,b)};if(b.tilemap_exists){return this.testTilemapOverlap(b,a)};haspolya=(a.collision_poly&&!a.collision_poly.is_empty());haspolyb=(b.collision_poly&&!b.collision_poly.is_empty());if(!haspolya&&!haspolyb){return true};if(haspolya){a.collision_poly.cache_poly(a.width,a.height,a.angle);polya=a.collision_poly}else{this.temp_poly.set_from_quad(a.bquad,a.x,a.y,a.width,a.height);polya=this.temp_poly};if(haspolyb){b.collision_poly.cache_poly(b.width,b.height,b.angle);polyb=b.collision_poly}else{this.temp_poly.set_from_quad(b.bquad,b.x,b.y,b.width,b.height);polyb=this.temp_poly};return polya.intersects_poly(polyb,b.x-a.x,b.y-a.y)}else{haspolya=(a.collision_poly&&!a.collision_poly.is_empty());haspolyb=(b.collision_poly&&!b.collision_poly.is_empty());if(haspolya){a.collision_poly.cache_poly(a.width,a.height,a.angle);this.temp_poly.set_from_poly(a.collision_poly)}else{this.temp_poly.set_from_quad(a.bquad,a.x,a.y,a.width,a.height)};polya=this.temp_poly;if(haspolyb){b.collision_poly.cache_poly(b.width,b.height,b.angle);this.temp_poly2.set_from_poly(b.collision_poly)}else{this.temp_poly2.set_from_quad(b.bquad,b.x,b.y,b.width,b.height)};polyb=this.temp_poly2;for(i=0,len=polya.pts_count;i<len;i++){i2=i*2;i21=i2+1;x=polya.pts_cache[i2];y=polya.pts_cache[i21];polya.pts_cache[i2]=layera.layerToCanvas(x+a.x,y+a.y,true);polya.pts_cache[i21]=layera.layerToCanvas(x+a.x,y+a.y,false)};polya.update_bbox();for(i=0,len=polyb.pts_count;i<len;i++){i2=i*2;i21=i2+1;x=polyb.pts_cache[i2];y=polyb.pts_cache[i21];polyb.pts_cache[i2]=layerb.layerToCanvas(x+b.x,y+b.y,true);polyb.pts_cache[i21]=layerb.layerToCanvas(x+b.x,y+b.y,false)};polyb.update_bbox();return polya.intersects_poly(polyb,0,0)}};var tmpQuad=new cr.quad();var tmpRect=new cr.rect(0,0,0,0);var collrect_candidates=[];Runtime.prototype.testTilemapOverlap=function(tm,a){var i,len,c,rc;var bbox=a.bbox;var tmx=tm.x;var tmy=tm.y;tm.getCollisionRectCandidates(bbox,collrect_candidates);var collrects=collrect_candidates;var haspolya=(a.collision_poly&&!a.collision_poly.is_empty());for(i=0,len=collrects.length;i<len;++i){c=collrects[i];rc=c.rc;if(bbox.intersects_rect_off(rc,tmx,tmy)){tmpQuad.set_from_rect(rc);tmpQuad.offset(tmx,tmy);if(tmpQuad.intersects_quad(a.bquad)){if(haspolya){a.collision_poly.cache_poly(a.width,a.height,a.angle);if(c.poly){if(c.poly.intersects_poly(a.collision_poly,a.x-(tmx+rc.left),a.y-(tmy+rc.top))){cr.clearArray(collrect_candidates);return true}}else{this.temp_poly.set_from_quad(tmpQuad,0,0,rc.right-rc.left,rc.bottom-rc.top);if(this.temp_poly.intersects_poly(a.collision_poly,a.x,a.y)){cr.clearArray(collrect_candidates);return true}}}else{if(c.poly){this.temp_poly.set_from_quad(a.bquad,0,0,a.width,a.height);if(c.poly.intersects_poly(this.temp_poly,-(tmx+rc.left),-(tmy+rc.top))){cr.clearArray(collrect_candidates);return true}}else{cr.clearArray(collrect_candidates);return true}}}}};cr.clearArray(collrect_candidates);return false};Runtime.prototype.testRectOverlap=function(r,b){if(!b||!b.collisionsEnabled){return false};b.update_bbox();var layerb=b.layer;var haspolyb,polyb;if(!b.bbox.intersects_rect(r)){return false};if(b.tilemap_exists){b.getCollisionRectCandidates(r,collrect_candidates);var collrects=collrect_candidates;var i,len,c,tilerc;var tmx=b.x;var tmy=b.y;for(i=0,len=collrects.length;i<len;++i){c=collrects[i];tilerc=c.rc;if(r.intersects_rect_off(tilerc,tmx,tmy)){if(c.poly){this.temp_poly.set_from_rect(r,0,0);if(c.poly.intersects_poly(this.temp_poly,-(tmx+tilerc.left),-(tmy+tilerc.top))){cr.clearArray(collrect_candidates);return true}}else{cr.clearArray(collrect_candidates);return true}}};cr.clearArray(collrect_candidates);return false}else{tmpQuad.set_from_rect(r);if(!b.bquad.intersects_quad(tmpQuad)){return false};haspolyb=(b.collision_poly&&!b.collision_poly.is_empty());if(!haspolyb){return true};b.collision_poly.cache_poly(b.width,b.height,b.angle);tmpQuad.offset(-r.left,-r.top);this.temp_poly.set_from_quad(tmpQuad,0,0,1,1);return b.collision_poly.intersects_poly(this.temp_poly,r.left-b.x,r.top-b.y)}};Runtime.prototype.testSegmentOverlap=function(x1,y1,x2,y2,b){if(!b||!b.collisionsEnabled){return false};b.update_bbox();var layerb=b.layer;var haspolyb,polyb;tmpRect["\x73\x65\x74"](cr.min(x1,x2),cr.min(y1,y2),cr.max(x1,x2),cr.max(y1,y2));if(!b.bbox.intersects_rect(tmpRect)){return false};if(b.tilemap_exists){b.getCollisionRectCandidates(tmpRect,collrect_candidates);var collrects=collrect_candidates;var i,len,c,tilerc;var tmx=b.x;var tmy=b.y;for(i=0,len=collrects.length;i<len;++i){c=collrects[i];tilerc=c.rc;if(tmpRect.intersects_rect_off(tilerc,tmx,tmy)){tmpQuad.set_from_rect(tilerc);tmpQuad.offset(tmx,tmy);if(tmpQuad.intersects_segment(x1,y1,x2,y2)){if(c.poly){if(c.poly.intersects_segment(tmx+tilerc.left,tmy+tilerc.top,x1,y1,x2,y2)){cr.clearArray(collrect_candidates);return true}}else{cr.clearArray(collrect_candidates);return true}}}};cr.clearArray(collrect_candidates);return false}else{if(!b.bquad.intersects_segment(x1,y1,x2,y2)){return false};haspolyb=(b.collision_poly&&!b.collision_poly.is_empty());if(!haspolyb){return true};b.collision_poly.cache_poly(b.width,b.height,b.angle);return b.collision_poly.intersects_segment(b.x,b.y,x1,y1,x2,y2)}};Runtime.prototype.typeHasBehavior=function(t,b){if(!b){return false};var i,len,j,lenj,f;for(i=0,len=t.behaviors.length;i<len;i++){if(t.behaviors[i].behavior instanceof b){return true}};if(!t.is_family){for(i=0,len=t.families.length;i<len;i++){f=t.families[i];for(j=0,lenj=f.behaviors.length;j<lenj;j++){if(f.behaviors[j].behavior instanceof b){return true}}}};return false};Runtime.prototype.typeHasNoSaveBehavior=function(t){return this.typeHasBehavior(t,cr.behaviors.NoSave)};Runtime.prototype.typeHasPersistBehavior=function(t){return this.typeHasBehavior(t,cr.behaviors.Persist)};Runtime.prototype.getSolidBehavior=function(){return this.solidBehavior};Runtime.prototype.getJumpthruBehavior=function(){return this.jumpthruBehavior};var candidates=[];Runtime.prototype.testOverlapSolid=function(inst){var i,len,s;inst.update_bbox();this.getSolidCollisionCandidates(inst.layer,inst.bbox,candidates);for(i=0,len=candidates.length;i<len;++i){s=candidates[i];if(!s.extra["\x73\x6F\x6C\x69\x64\x45\x6E\x61\x62\x6C\x65\x64"]){continue};if(this.testOverlap(inst,s)){cr.clearArray(candidates);return s}};cr.clearArray(candidates);return null};Runtime.prototype.testRectOverlapSolid=function(r){var i,len,s;this.getSolidCollisionCandidates(null,r,candidates);for(i=0,len=candidates.length;i<len;++i){s=candidates[i];if(!s.extra["\x73\x6F\x6C\x69\x64\x45\x6E\x61\x62\x6C\x65\x64"]){continue};if(this.testRectOverlap(r,s)){cr.clearArray(candidates);return s}};cr.clearArray(candidates);return null};var jumpthru_array_ret=[];Runtime.prototype.testOverlapJumpThru=function(inst,all){var ret=null;if(all){ret=jumpthru_array_ret;cr.clearArray(ret)};inst.update_bbox();this.getJumpthruCollisionCandidates(inst.layer,inst.bbox,candidates);var i,len,j;for(i=0,len=candidates.length;i<len;++i){j=candidates[i];if(!j.extra["\x6A\x75\x6D\x70\x74\x68\x72\x75\x45\x6E\x61\x62\x6C\x65\x64"]){continue};if(this.testOverlap(inst,j)){if(all){ret.push(j)}else{cr.clearArray(candidates);return j}}};cr.clearArray(candidates);return ret};Runtime.prototype.pushOutSolid=function(inst,xdir,ydir,dist,include_jumpthrus,specific_jumpthru){var push_dist=dist||50;var oldx=inst.x;var oldy=inst.y;var i;var last_overlapped=null,secondlast_overlapped=null;for(i=0;i<push_dist;i++){inst.x=(oldx+(xdir*i));inst.y=(oldy+(ydir*i));inst.set_bbox_changed();if(!this.testOverlap(inst,last_overlapped)){last_overlapped=this.testOverlapSolid(inst);if(last_overlapped){secondlast_overlapped=last_overlapped};if(!last_overlapped){if(include_jumpthrus){if(specific_jumpthru){last_overlapped=(this.testOverlap(inst,specific_jumpthru)?specific_jumpthru:null)}else{last_overlapped=this.testOverlapJumpThru(inst)};if(last_overlapped){secondlast_overlapped=last_overlapped}};if(!last_overlapped){if(secondlast_overlapped){this.pushInFractional(inst,xdir,ydir,secondlast_overlapped,16)};return true}}}};inst.x=oldx;inst.y=oldy;inst.set_bbox_changed();return false};Runtime.prototype.pushOut=function(inst,xdir,ydir,dist,otherinst){var push_dist=dist||50;var oldx=inst.x;var oldy=inst.y;var i;for(i=0;i<push_dist;i++){inst.x=(oldx+(xdir*i));inst.y=(oldy+(ydir*i));inst.set_bbox_changed();if(!this.testOverlap(inst,otherinst)){return true}};inst.x=oldx;inst.y=oldy;inst.set_bbox_changed();return false};Runtime.prototype.pushInFractional=function(inst,xdir,ydir,obj,limit){var divisor=2;var frac;var forward=false;var overlapping=false;var bestx=inst.x;var besty=inst.y;while(divisor<=limit){frac=1/divisor;divisor*=2;inst.x+=xdir*frac*(forward?1:-1);inst.y+=ydir*frac*(forward?1:-1);inst.set_bbox_changed();if(this.testOverlap(inst,obj)){forward=true;overlapping=true}else{forward=false;overlapping=false;bestx=inst.x;besty=inst.y}};if(overlapping){inst.x=bestx;inst.y=besty;inst.set_bbox_changed()}};Runtime.prototype.pushOutSolidNearest=function(inst,max_dist_){var max_dist=(cr.is_undefined(max_dist_)?100:max_dist_);var dist=0;var oldx=inst.x;var oldy=inst.y;var dir=0;var dx=0,dy=0;var last_overlapped=this.testOverlapSolid(inst);if(!last_overlapped){return true};while(dist<=max_dist){switch(dir){case 0:dx=0;dy=-1;dist++;break;case 1:dx=1;dy=-1;break;case 2:dx=1;dy=0;break;case 3:dx=1;dy=1;break;case 4:dx=0;dy=1;break;case 5:dx=-1;dy=1;break;case 6:dx=-1;dy=0;break;case 7:dx=-1;dy=-1;break};dir=(dir+1)%8;inst.x=cr.floor(oldx+(dx*dist));inst.y=cr.floor(oldy+(dy*dist));inst.set_bbox_changed();if(!this.testOverlap(inst,last_overlapped)){last_overlapped=this.testOverlapSolid(inst);if(!last_overlapped){return true}}};inst.x=oldx;inst.y=oldy;inst.set_bbox_changed();return false};Runtime.prototype.registerCollision=function(a,b){if(!a.collisionsEnabled||!b.collisionsEnabled){return};this.registered_collisions.push([a,b])};Runtime.prototype.checkRegisteredCollision=function(a,b){var i,len,x;for(i=0,len=this.registered_collisions.length;i<len;i++){x=this.registered_collisions[i];if((x[0]==a&&x[1]==b)||(x[0]==b&&x[1]==a)){return true}};return false};Runtime.prototype.calculateSolidBounceAngle=function(inst,startx,starty,obj){var objx=inst.x;var objy=inst.y;var radius=cr.max(10,cr.distanceTo(startx,starty,objx,objy));var startangle=cr.angleTo(startx,starty,objx,objy);var firstsolid=obj||this.testOverlapSolid(inst);if(!firstsolid){return cr.clamp_angle(startangle+cr.PI)};var cursolid=firstsolid;var i,curangle,anticlockwise_free_angle,clockwise_free_angle;var increment=cr.to_radians(5);for(i=1;i<36;i++){curangle=startangle-i*increment;inst.x=startx+Math.cos(curangle)*radius;inst.y=starty+Math.sin(curangle)*radius;inst.set_bbox_changed();if(!this.testOverlap(inst,cursolid)){cursolid=obj?null:this.testOverlapSolid(inst);if(!cursolid){anticlockwise_free_angle=curangle;break}}};if(i===36){anticlockwise_free_angle=cr.clamp_angle(startangle+cr.PI)};var cursolid=firstsolid;for(i=1;i<36;i++){curangle=startangle+i*increment;inst.x=startx+Math.cos(curangle)*radius;inst.y=starty+Math.sin(curangle)*radius;inst.set_bbox_changed();if(!this.testOverlap(inst,cursolid)){cursolid=obj?null:this.testOverlapSolid(inst);if(!cursolid){clockwise_free_angle=curangle;break}}};if(i===36){clockwise_free_angle=cr.clamp_angle(startangle+cr.PI)};inst.x=objx;inst.y=objy;inst.set_bbox_changed();if(clockwise_free_angle===anticlockwise_free_angle){return clockwise_free_angle};var half_diff=cr.angleDiff(clockwise_free_angle,anticlockwise_free_angle)/2;var normal;if(cr.angleClockwise(clockwise_free_angle,anticlockwise_free_angle)){normal=cr.clamp_angle(anticlockwise_free_angle+half_diff+cr.PI)}else{normal=cr.clamp_angle(clockwise_free_angle+half_diff)};;;var vx=Math.cos(startangle);var vy=Math.sin(startangle);var nx=Math.cos(normal);var ny=Math.sin(normal);var v_dot_n=vx*nx+vy*ny;var rx=vx-2*v_dot_n*nx;var ry=vy-2*v_dot_n*ny;return cr.angleTo(0,0,rx,ry)};var triggerSheetIndex=-1;Runtime.prototype.trigger=function(method,inst,value){;;if(!this.running_layout){return false};var sheet=this.running_layout.event_sheet;if(!sheet){return false};var ret=false;var r,i,len;triggerSheetIndex++;var deep_includes=sheet.deep_includes;for(i=0,len=deep_includes.length;i<len;++i){r=this.triggerOnSheet(method,inst,deep_includes[i],value);ret=ret||r};r=this.triggerOnSheet(method,inst,sheet,value);ret=ret||r;triggerSheetIndex--;return ret};Runtime.prototype.triggerOnSheet=function(method,inst,sheet,value){var ret=false;var i,leni,r,families;if(!inst){r=this.triggerOnSheetForTypeName(method,inst,"\x73\x79\x73\x74\x65\x6D",sheet,value);ret=ret||r}else{r=this.triggerOnSheetForTypeName(method,inst,inst.type.name,sheet,value);ret=ret||r;families=inst.type.families;for(i=0,leni=families.length;i<leni;++i){r=this.triggerOnSheetForTypeName(method,inst,families[i].name,sheet,value);ret=ret||r}};return ret};Runtime.prototype.triggerOnSheetForTypeName=function(method,inst,type_name,sheet,value){var i,leni;var ret=false,ret2=false;var trig,index;var fasttrigger=(typeof value!=="\x75\x6E\x64\x65\x66\x69\x6E\x65\x64");var triggers=(fasttrigger?sheet.fasttriggers:sheet.triggers);var obj_entry=triggers[type_name];if(!obj_entry){return ret};var triggers_list=null;for(i=0,leni=obj_entry.length;i<leni;++i){if(obj_entry[i].method==method){triggers_list=obj_entry[i].evs;break}};if(!triggers_list){return ret};var triggers_to_fire;if(fasttrigger){triggers_to_fire=triggers_list[value]}else{triggers_to_fire=triggers_list};if(!triggers_to_fire){return null};for(i=0,leni=triggers_to_fire.length;i<leni;i++){trig=triggers_to_fire[i][0];index=triggers_to_fire[i][1];ret2=this.executeSingleTrigger(inst,type_name,trig,index);ret=ret||ret2};return ret};Runtime.prototype.executeSingleTrigger=function(inst,type_name,trig,index){var i,leni;var ret=false;this.trigger_depth++;var current_event=this.getCurrentEventStack().current_event;if(current_event){this.pushCleanSol(current_event.solModifiersIncludingParents)};var isrecursive=(this.trigger_depth>1);this.pushCleanSol(trig.solModifiersIncludingParents);if(isrecursive){this.pushLocalVarStack()};var event_stack=this.pushEventStack(trig);event_stack.current_event=trig;if(inst){var sol=this.types[type_name].getCurrentSol();sol.select_all=false;cr.clearArray(sol.instances);sol.instances[0]=inst;this.types[type_name].applySolToContainer()};var ok_to_run=true;if(trig.parent){var temp_parents_arr=event_stack.temp_parents_arr;var cur_parent=trig.parent;while(cur_parent){temp_parents_arr.push(cur_parent);cur_parent=cur_parent.parent};temp_parents_arr.reverse();for(i=0,leni=temp_parents_arr.length;i<leni;i++){if(!temp_parents_arr[i].run_pretrigger()){ok_to_run=false;break}}};if(ok_to_run){this.execcount++;if(trig.orblock){trig.run_orblocktrigger(index)}else{trig.run()};ret=ret||event_stack.last_event_true};this.popEventStack();if(isrecursive){this.popLocalVarStack()};this.popSol(trig.solModifiersIncludingParents);if(current_event){this.popSol(current_event.solModifiersIncludingParents)};if(this.hasPendingInstances&&this.isInOnDestroy===0&&triggerSheetIndex===0&&!this.isRunningEvents){this.ClearDeathRow()};this.trigger_depth--;return ret};Runtime.prototype.getCurrentCondition=function(){var evinfo=this.getCurrentEventStack();return evinfo.current_event.conditions[evinfo.cndindex]};Runtime.prototype.getCurrentAction=function(){var evinfo=this.getCurrentEventStack();return evinfo.current_event.actions[evinfo.actindex]};Runtime.prototype.pushLocalVarStack=function(){this.localvar_stack_index++;if(this.localvar_stack_index>=this.localvar_stack.length){this.localvar_stack.push([])}};Runtime.prototype.popLocalVarStack=function(){;;this.localvar_stack_index--};Runtime.prototype.getCurrentLocalVarStack=function(){return this.localvar_stack[this.localvar_stack_index]};Runtime.prototype.pushEventStack=function(cur_event){this.event_stack_index++;if(this.event_stack_index>=this.event_stack.length){this.event_stack.push(new cr.eventStackFrame())};var ret=this.getCurrentEventStack();ret.reset(cur_event);return ret};Runtime.prototype.popEventStack=function(){;;this.event_stack_index--};Runtime.prototype.getCurrentEventStack=function(){return this.event_stack[this.event_stack_index]};Runtime.prototype.pushLoopStack=function(name_){this.loop_stack_index++;if(this.loop_stack_index>=this.loop_stack.length){this.loop_stack.push(cr.seal({name:name_,index:0,stopped:false}))};var ret=this.getCurrentLoop();ret.name=name_;ret.index=0;ret.stopped=false;return ret};Runtime.prototype.popLoopStack=function(){;;this.loop_stack_index--};Runtime.prototype.getCurrentLoop=function(){return this.loop_stack[this.loop_stack_index]};Runtime.prototype.getEventVariableByName=function(name,scope){var i,leni,j,lenj,sheet,e;while(scope){for(i=0,leni=scope.subevents.length;i<leni;i++){e=scope.subevents[i];if(e instanceof cr.eventvariable&&cr.equals_nocase(name,e.name)){return e}};scope=scope.parent};for(i=0,leni=this.eventsheets_by_index.length;i<leni;i++){sheet=this.eventsheets_by_index[i];for(j=0,lenj=sheet.events.length;j<lenj;j++){e=sheet.events[j];if(e instanceof cr.eventvariable&&cr.equals_nocase(name,e.name)){return e}}};return null};Runtime.prototype.getLayoutBySid=function(sid_){var i,len;for(i=0,len=this.layouts_by_index.length;i<len;i++){if(this.layouts_by_index[i].sid===sid_){return this.layouts_by_index[i]}};return null};Runtime.prototype.getObjectTypeBySid=function(sid_){var i,len;for(i=0,len=this.types_by_index.length;i<len;i++){if(this.types_by_index[i].sid===sid_){return this.types_by_index[i]}};return null};Runtime.prototype.getGroupBySid=function(sid_){var i,len;for(i=0,len=this.allGroups.length;i<len;i++){if(this.allGroups[i].sid===sid_){return this.allGroups[i]}};return null};Runtime.prototype.doCanvasSnapshot=function(format_,quality_){this.snapshotCanvas=[format_,quality_];this.redraw=true};function makeSaveDb(e){var db=e.target.result;db.createObjectStore("\x73\x61\x76\x65\x73",{keyPath:"\x73\x6C\x6F\x74"})}function IndexedDB_WriteSlot(slot_,data_,oncomplete_,onerror_){var request=indexedDB.open("\x5F\x43\x32\x53\x61\x76\x65\x53\x74\x61\x74\x65\x73");request.onupgradeneeded=makeSaveDb;request.onerror=onerror_;request.onsuccess=function(e){var db=e.target.result;db.onerror=onerror_;var transaction=db.transaction(["\x73\x61\x76\x65\x73"],"\x72\x65\x61\x64\x77\x72\x69\x74\x65");var objectStore=transaction.objectStore("\x73\x61\x76\x65\x73");var putReq=objectStore.put({"\x73\x6C\x6F\x74":slot_,"\x64\x61\x74\x61":data_});putReq.onsuccess=oncomplete_}}function IndexedDB_ReadSlot(slot_,oncomplete_,onerror_){var request=indexedDB.open("\x5F\x43\x32\x53\x61\x76\x65\x53\x74\x61\x74\x65\x73");request.onupgradeneeded=makeSaveDb;request.onerror=onerror_;request.onsuccess=function(e){var db=e.target.result;db.onerror=onerror_;var transaction=db.transaction(["\x73\x61\x76\x65\x73"]);var objectStore=transaction.objectStore("\x73\x61\x76\x65\x73");var readReq=objectStore["\x67\x65\x74"](slot_);readReq.onsuccess=function(e){if(readReq.result){oncomplete_(readReq.result["\x64\x61\x74\x61"])}else{oncomplete_(null)}}}}Runtime.prototype.signalContinuousPreview=function(){this.signalledContinuousPreview=true};function doContinuousPreviewReload(){cr.logexport("\x52\x65\x6C\x6F\x61\x64\x69\x6E\x67\x20\x66\x6F\x72\x20\x63\x6F\x6E\x74\x69\x6E\x75\x6F\x75\x73\x20\x70\x72\x65\x76\x69\x65\x77");if(!!window["\x63\x32\x63\x6F\x63\x6F\x6F\x6E\x6A\x73"]){CocoonJS["\x41\x70\x70"]["\x72\x65\x6C\x6F\x61\x64"]()}else{if(window.location.search.indexOf("\x63\x6F\x6E\x74\x69\x6E\x75\x6F\x75\x73")>-1){window.location.reload(true)}else{window.location=window.location+"\x3F\x63\x6F\x6E\x74\x69\x6E\x75\x6F\x75\x73"}}}Runtime.prototype.handleSaveLoad=function(){var self=this;var savingToSlot=this.saveToSlot;var savingJson=this.lastSaveJson;var loadingFromSlot=this.loadFromSlot;var continuous=false;if(this.signalledContinuousPreview){continuous=true;savingToSlot="\x5F\x5F\x63\x32\x5F\x63\x6F\x6E\x74\x69\x6E\x75\x6F\x75\x73\x70\x72\x65\x76\x69\x65\x77";this.signalledContinuousPreview=false};if(savingToSlot.length){this.ClearDeathRow();savingJson=this.saveToJSONString();if(window.indexedDB&&!this.isCocoonJs){IndexedDB_WriteSlot(savingToSlot,savingJson,function(){cr.logexport("\x53\x61\x76\x65\x64\x20\x73\x74\x61\x74\x65\x20\x74\x6F\x20\x49\x6E\x64\x65\x78\x65\x64\x44\x42\x20\x73\x74\x6F\x72\x61\x67\x65\x20\x28"+savingJson.length+"\x20\x62\x79\x74\x65\x73\x29");self.lastSaveJson=savingJson;self.trigger(cr.system_object.prototype.cnds.OnSaveComplete,null);self.lastSaveJson="";if(continuous){doContinuousPreviewReload()}},function(e){try{localStorage.setItem("\x5F\x5F\x63\x32\x73\x61\x76\x65\x5F"+savingToSlot,savingJson);cr.logexport("\x53\x61\x76\x65\x64\x20\x73\x74\x61\x74\x65\x20\x74\x6F\x20\x57\x65\x62\x53\x74\x6F\x72\x61\x67\x65\x20\x28"+savingJson.length+"\x20\x62\x79\x74\x65\x73\x29");self.lastSaveJson=savingJson;self.trigger(cr.system_object.prototype.cnds.OnSaveComplete,null);self.lastSaveJson="";if(continuous){doContinuousPreviewReload()}}catch(f){cr.logexport("\x46\x61\x69\x6C\x65\x64\x20\x74\x6F\x20\x73\x61\x76\x65\x20\x67\x61\x6D\x65\x20\x73\x74\x61\x74\x65\x3A\x20"+e+"\x3B\x20"+f)}})}else{try{localStorage.setItem("\x5F\x5F\x63\x32\x73\x61\x76\x65\x5F"+savingToSlot,savingJson);cr.logexport("\x53\x61\x76\x65\x64\x20\x73\x74\x61\x74\x65\x20\x74\x6F\x20\x57\x65\x62\x53\x74\x6F\x72\x61\x67\x65\x20\x28"+savingJson.length+"\x20\x62\x79\x74\x65\x73\x29");self.lastSaveJson=savingJson;this.trigger(cr.system_object.prototype.cnds.OnSaveComplete,null);self.lastSaveJson="";if(continuous){doContinuousPreviewReload()}}catch(e){cr.logexport("\x45\x72\x72\x6F\x72\x20\x73\x61\x76\x69\x6E\x67\x20\x74\x6F\x20\x57\x65\x62\x53\x74\x6F\x72\x61\x67\x65\x3A\x20"+e)}};this.saveToSlot="";this.loadFromSlot="";this.loadFromJson=""};if(loadingFromSlot.length){if(window.indexedDB&&!this.isCocoonJs){IndexedDB_ReadSlot(loadingFromSlot,function(result_){if(result_){self.loadFromJson=result_;cr.logexport("\x4C\x6F\x61\x64\x65\x64\x20\x73\x74\x61\x74\x65\x20\x66\x72\x6F\x6D\x20\x49\x6E\x64\x65\x78\x65\x64\x44\x42\x20\x73\x74\x6F\x72\x61\x67\x65\x20\x28"+self.loadFromJson.length+"\x20\x62\x79\x74\x65\x73\x29")}else{self.loadFromJson=localStorage.getItem("\x5F\x5F\x63\x32\x73\x61\x76\x65\x5F"+loadingFromSlot)||"";cr.logexport("\x4C\x6F\x61\x64\x65\x64\x20\x73\x74\x61\x74\x65\x20\x66\x72\x6F\x6D\x20\x57\x65\x62\x53\x74\x6F\x72\x61\x67\x65\x20\x28"+self.loadFromJson.length+"\x20\x62\x79\x74\x65\x73\x29")};self.suspendDrawing=false;if(!self.loadFromJson.length){self.trigger(cr.system_object.prototype.cnds.OnLoadFailed,null)}},function(e){self.loadFromJson=localStorage.getItem("\x5F\x5F\x63\x32\x73\x61\x76\x65\x5F"+loadingFromSlot)||"";cr.logexport("\x4C\x6F\x61\x64\x65\x64\x20\x73\x74\x61\x74\x65\x20\x66\x72\x6F\x6D\x20\x57\x65\x62\x53\x74\x6F\x72\x61\x67\x65\x20\x28"+self.loadFromJson.length+"\x20\x62\x79\x74\x65\x73\x29");self.suspendDrawing=false;if(!self.loadFromJson.length){self.trigger(cr.system_object.prototype.cnds.OnLoadFailed,null)}})}else{try{this.loadFromJson=localStorage.getItem("\x5F\x5F\x63\x32\x73\x61\x76\x65\x5F"+loadingFromSlot)||"";cr.logexport("\x4C\x6F\x61\x64\x65\x64\x20\x73\x74\x61\x74\x65\x20\x66\x72\x6F\x6D\x20\x57\x65\x62\x53\x74\x6F\x72\x61\x67\x65\x20\x28"+this.loadFromJson.length+"\x20\x62\x79\x74\x65\x73\x29")}catch(e){this.loadFromJson=""};this.suspendDrawing=false;if(!self.loadFromJson.length){self.trigger(cr.system_object.prototype.cnds.OnLoadFailed,null)}};this.loadFromSlot="";this.saveToSlot=""};if(this.loadFromJson.length){this.ClearDeathRow();this.loadFromJSONString(this.loadFromJson);this.lastSaveJson=this.loadFromJson;this.trigger(cr.system_object.prototype.cnds.OnLoadComplete,null);this.lastSaveJson="";this.loadFromJson=""}};function CopyExtraObject(extra){var p,ret={};for(p in extra){if(extra.hasOwnProperty(p)){if(extra[p]instanceof cr.ObjectSet){continue};if(extra[p]&&typeof extra[p].c2userdata!=="\x75\x6E\x64\x65\x66\x69\x6E\x65\x64"){continue};if(p==="\x73\x70\x72\x69\x74\x65\x43\x72\x65\x61\x74\x65\x64\x44\x65\x73\x74\x72\x6F\x79\x43\x61\x6C\x6C\x62\x61\x63\x6B"){continue};ret[p]=extra[p]}};return ret}Runtime.prototype.saveToJSONString=function(){var i,len,j,lenj,type,layout,typeobj,g,c,a,v,p;var o={"\x63\x32\x73\x61\x76\x65":true,"\x76\x65\x72\x73\x69\x6F\x6E":1,"\x72\x74":{"\x74\x69\x6D\x65":this.kahanTime.sum,"\x77\x61\x6C\x6C\x74\x69\x6D\x65":this.wallTime.sum,"\x74\x69\x6D\x65\x73\x63\x61\x6C\x65":this.timescale,"\x74\x69\x63\x6B\x63\x6F\x75\x6E\x74":this.tickcount,"\x65\x78\x65\x63\x63\x6F\x75\x6E\x74":this.execcount,"\x6E\x65\x78\x74\x5F\x75\x69\x64":this.next_uid,"\x72\x75\x6E\x6E\x69\x6E\x67\x5F\x6C\x61\x79\x6F\x75\x74":this.running_layout.sid,"\x73\x74\x61\x72\x74\x5F\x74\x69\x6D\x65\x5F\x6F\x66\x66\x73\x65\x74":(Date.now()-this.start_time)},"\x74\x79\x70\x65\x73":{},"\x6C\x61\x79\x6F\x75\x74\x73":{},"\x65\x76\x65\x6E\x74\x73":{"\x67\x72\x6F\x75\x70\x73":{},"\x63\x6E\x64\x73":{},"\x61\x63\x74\x73":{},"\x76\x61\x72\x73":{}}};for(i=0,len=this.types_by_index.length;i<len;i++){type=this.types_by_index[i];if(type.is_family||this.typeHasNoSaveBehavior(type)){continue};typeobj={"\x69\x6E\x73\x74\x61\x6E\x63\x65\x73":[]};if(cr.hasAnyOwnProperty(type.extra)){typeobj["\x65\x78"]=CopyExtraObject(type.extra)};for(j=0,lenj=type.instances.length;j<lenj;j++){typeobj["\x69\x6E\x73\x74\x61\x6E\x63\x65\x73"].push(this.saveInstanceToJSON(type.instances[j]))};o["\x74\x79\x70\x65\x73"][type.sid.toString()]=typeobj};for(i=0,len=this.layouts_by_index.length;i<len;i++){layout=this.layouts_by_index[i];o["\x6C\x61\x79\x6F\x75\x74\x73"][layout.sid.toString()]=layout.saveToJSON()};var ogroups=o["\x65\x76\x65\x6E\x74\x73"]["\x67\x72\x6F\x75\x70\x73"];for(i=0,len=this.allGroups.length;i<len;i++){g=this.allGroups[i];ogroups[g.sid.toString()]=this.groups_by_name[g.group_name].group_active};var ocnds=o["\x65\x76\x65\x6E\x74\x73"]["\x63\x6E\x64\x73"];for(p in this.cndsBySid){if(this.cndsBySid.hasOwnProperty(p)){c=this.cndsBySid[p];if(cr.hasAnyOwnProperty(c.extra)){ocnds[p]={"\x65\x78":CopyExtraObject(c.extra)}}}};var oacts=o["\x65\x76\x65\x6E\x74\x73"]["\x61\x63\x74\x73"];for(p in this.actsBySid){if(this.actsBySid.hasOwnProperty(p)){a=this.actsBySid[p];if(cr.hasAnyOwnProperty(a.extra)){oacts[p]={"\x65\x78":a.extra}}}};var ovars=o["\x65\x76\x65\x6E\x74\x73"]["\x76\x61\x72\x73"];for(p in this.varsBySid){if(this.varsBySid.hasOwnProperty(p)){v=this.varsBySid[p];if(!v.is_constant&&(!v.parent||v.is_static)){ovars[p]=v.data}}};o["\x73\x79\x73\x74\x65\x6D"]=this.system.saveToJSON();return JSON.stringify(o)};Runtime.prototype.refreshUidMap=function(){var i,len,type,j,lenj,inst;this.objectsByUid={};for(i=0,len=this.types_by_index.length;i<len;i++){type=this.types_by_index[i];if(type.is_family){continue};for(j=0,lenj=type.instances.length;j<lenj;j++){inst=type.instances[j];this.objectsByUid[inst.uid.toString()]=inst}}};Runtime.prototype.loadFromJSONString=function(str){var o=JSON.parse(str);if(!o["\x63\x32\x73\x61\x76\x65"]){return};if(o["\x76\x65\x72\x73\x69\x6F\x6E"]>1){return};this.isLoadingState=true;var rt=o["\x72\x74"];this.kahanTime.reset();this.kahanTime.sum=rt["\x74\x69\x6D\x65"];this.wallTime.reset();this.wallTime.sum=rt["\x77\x61\x6C\x6C\x74\x69\x6D\x65"]||0;this.timescale=rt["\x74\x69\x6D\x65\x73\x63\x61\x6C\x65"];this.tickcount=rt["\x74\x69\x63\x6B\x63\x6F\x75\x6E\x74"];this.execcount=rt["\x65\x78\x65\x63\x63\x6F\x75\x6E\x74"];this.start_time=Date.now()-rt["\x73\x74\x61\x72\x74\x5F\x74\x69\x6D\x65\x5F\x6F\x66\x66\x73\x65\x74"];var layout_sid=rt["\x72\x75\x6E\x6E\x69\x6E\x67\x5F\x6C\x61\x79\x6F\x75\x74"];if(layout_sid!==this.running_layout.sid){var changeToLayout=this.getLayoutBySid(layout_sid);if(changeToLayout){this.doChangeLayout(changeToLayout)}else{return}};var i,len,j,lenj,k,lenk,p,type,existing_insts,load_insts,inst,binst,layout,layer,g,iid,t;var otypes=o["\x74\x79\x70\x65\x73"];for(p in otypes){if(otypes.hasOwnProperty(p)){type=this.getObjectTypeBySid(parseInt(p,10));if(!type||type.is_family||this.typeHasNoSaveBehavior(type)){continue};if(otypes[p]["\x65\x78"]){type.extra=otypes[p]["\x65\x78"]}else{cr.wipe(type.extra)};existing_insts=type.instances;load_insts=otypes[p]["\x69\x6E\x73\x74\x61\x6E\x63\x65\x73"];for(i=0,len=cr.min(existing_insts.length,load_insts.length);i<len;i++){this.loadInstanceFromJSON(existing_insts[i],load_insts[i])};for(i=load_insts.length,len=existing_insts.length;i<len;i++){this.DestroyInstance(existing_insts[i])};for(i=existing_insts.length,len=load_insts.length;i<len;i++){layer=null;if(type.plugin.is_world){layer=this.running_layout.getLayerBySid(load_insts[i]["\x77"]["\x6C"]);if(!layer){continue}};inst=this.createInstanceFromInit(type.default_instance,layer,false,0,0,true);this.loadInstanceFromJSON(inst,load_insts[i])};type.stale_iids=true}};this.ClearDeathRow();this.refreshUidMap();var olayouts=o["\x6C\x61\x79\x6F\x75\x74\x73"];for(p in olayouts){if(olayouts.hasOwnProperty(p)){layout=this.getLayoutBySid(parseInt(p,10));if(!layout){continue};layout.loadFromJSON(olayouts[p])}};var ogroups=o["\x65\x76\x65\x6E\x74\x73"]["\x67\x72\x6F\x75\x70\x73"];for(p in ogroups){if(ogroups.hasOwnProperty(p)){g=this.getGroupBySid(parseInt(p,10));if(g&&this.groups_by_name[g.group_name]){this.groups_by_name[g.group_name].setGroupActive(ogroups[p])}}};var ocnds=o["\x65\x76\x65\x6E\x74\x73"]["\x63\x6E\x64\x73"];for(p in ocnds){if(ocnds.hasOwnProperty(p)&&this.cndsBySid.hasOwnProperty(p)){this.cndsBySid[p].extra=ocnds[p]["\x65\x78"]}};var oacts=o["\x65\x76\x65\x6E\x74\x73"]["\x61\x63\x74\x73"];for(p in oacts){if(oacts.hasOwnProperty(p)&&this.actsBySid.hasOwnProperty(p)){this.actsBySid[p].extra=oacts[p]["\x65\x78"]}};var ovars=o["\x65\x76\x65\x6E\x74\x73"]["\x76\x61\x72\x73"];for(p in ovars){if(ovars.hasOwnProperty(p)&&this.varsBySid.hasOwnProperty(p)){this.varsBySid[p].data=ovars[p]}};this.next_uid=rt["\x6E\x65\x78\x74\x5F\x75\x69\x64"];this.isLoadingState=false;this.system.loadFromJSON(o["\x73\x79\x73\x74\x65\x6D"]);for(i=0,len=this.types_by_index.length;i<len;i++){type=this.types_by_index[i];if(type.is_family||this.typeHasNoSaveBehavior(type)){continue};for(j=0,lenj=type.instances.length;j<lenj;j++){inst=type.instances[j];if(type.is_contained){iid=inst.get_iid();cr.clearArray(inst.siblings);for(k=0,lenk=type.container.length;k<lenk;k++){t=type.container[k];if(type===t){continue};inst.siblings.push(t.instances[iid])}};if(inst.afterLoad){inst.afterLoad()};if(inst.behavior_insts){for(k=0,lenk=inst.behavior_insts.length;k<lenk;k++){binst=inst.behavior_insts[k];if(binst.afterLoad){binst.afterLoad()}}}}};this.redraw=true};Runtime.prototype.saveInstanceToJSON=function(inst,state_only){var i,len,world,behinst,et;var type=inst.type;var plugin=type.plugin;var o={};if(state_only){o["\x63\x32"]=true}else{o["\x75\x69\x64"]=inst.uid};if(cr.hasAnyOwnProperty(inst.extra)){o["\x65\x78"]=CopyExtraObject(inst.extra)};if(inst.instance_vars&&inst.instance_vars.length){o["\x69\x76\x73"]={};for(i=0,len=inst.instance_vars.length;i<len;i++){o["\x69\x76\x73"][inst.type.instvar_sids[i].toString()]=inst.instance_vars[i]}};if(plugin.is_world){world={"\x78":inst.x,"\x79":inst.y,"\x77":inst.width,"\x68":inst.height,"\x6C":inst.layer.sid,"\x7A\x69":inst.get_zindex()};if(inst.angle!==0){world["\x61"]=inst.angle};if(inst.opacity!==1){world["\x6F"]=inst.opacity};if(inst.hotspotX!==0.5){world["\x68\x58"]=inst.hotspotX};if(inst.hotspotY!==0.5){world["\x68\x59"]=inst.hotspotY};if(inst.blend_mode!==0){world["\x62\x6D"]=inst.blend_mode};if(!inst.visible){world["\x76"]=inst.visible};if(!inst.collisionsEnabled){world["\x63\x65"]=inst.collisionsEnabled};if(inst.my_timescale!==-1){world["\x6D\x74\x73"]=inst.my_timescale};if(type.effect_types.length){world["\x66\x78"]=[];for(i=0,len=type.effect_types.length;i<len;i++){et=type.effect_types[i];world["\x66\x78"].push({"\x6E\x61\x6D\x65":et.name,"\x61\x63\x74\x69\x76\x65":inst.active_effect_flags[et.index],"\x70\x61\x72\x61\x6D\x73":inst.effect_params[et.index]})}};o["\x77"]=world};if(inst.behavior_insts&&inst.behavior_insts.length){o["\x62\x65\x68\x73"]={};for(i=0,len=inst.behavior_insts.length;i<len;i++){behinst=inst.behavior_insts[i];if(behinst.saveToJSON){o["\x62\x65\x68\x73"][behinst.type.sid.toString()]=behinst.saveToJSON()}}};if(inst.saveToJSON){o["\x64\x61\x74\x61"]=inst.saveToJSON()};return o};Runtime.prototype.getInstanceVarIndexBySid=function(type,sid_){var i,len;for(i=0,len=type.instvar_sids.length;i<len;i++){if(type.instvar_sids[i]===sid_){return i}};return-1};Runtime.prototype.getBehaviorIndexBySid=function(inst,sid_){var i,len;for(i=0,len=inst.behavior_insts.length;i<len;i++){if(inst.behavior_insts[i].type.sid===sid_){return i}};return-1};Runtime.prototype.loadInstanceFromJSON=function(inst,o,state_only){var p,i,len,iv,oivs,world,fxindex,obehs,behindex;var oldlayer;var type=inst.type;var plugin=type.plugin;if(state_only){if(!o["\x63\x32"]){return}}else{inst.uid=o["\x75\x69\x64"]};if(o["\x65\x78"]){inst.extra=o["\x65\x78"]}else{cr.wipe(inst.extra)};oivs=o["\x69\x76\x73"];if(oivs){for(p in oivs){if(oivs.hasOwnProperty(p)){iv=this.getInstanceVarIndexBySid(type,parseInt(p,10));if(iv<0||iv>=inst.instance_vars.length){continue};inst.instance_vars[iv]=oivs[p]}}};if(plugin.is_world){world=o["\x77"];if(inst.layer.sid!==world["\x6C"]){oldlayer=inst.layer;inst.layer=this.running_layout.getLayerBySid(world["\x6C"]);if(inst.layer){oldlayer.removeFromInstanceList(inst,true);inst.layer.appendToInstanceList(inst,true);inst.set_bbox_changed();inst.layer.setZIndicesStaleFrom(0)}else{inst.layer=oldlayer;if(!state_only){this.DestroyInstance(inst)}}};inst.x=world["\x78"];inst.y=world["\x79"];inst.width=world["\x77"];inst.height=world["\x68"];inst.zindex=world["\x7A\x69"];inst.angle=world.hasOwnProperty("\x61")?world["\x61"]:0;inst.opacity=world.hasOwnProperty("\x6F")?world["\x6F"]:1;inst.hotspotX=world.hasOwnProperty("\x68\x58")?world["\x68\x58"]:0.5;inst.hotspotY=world.hasOwnProperty("\x68\x59")?world["\x68\x59"]:0.5;inst.visible=world.hasOwnProperty("\x76")?world["\x76"]:true;inst.collisionsEnabled=world.hasOwnProperty("\x63\x65")?world["\x63\x65"]:true;inst.my_timescale=world.hasOwnProperty("\x6D\x74\x73")?world["\x6D\x74\x73"]:-1;inst.blend_mode=world.hasOwnProperty("\x62\x6D")?world["\x62\x6D"]:0;;;inst.compositeOp=cr.effectToCompositeOp(inst.blend_mode);if(this.gl){cr.setGLBlend(inst,inst.blend_mode,this.gl)};inst.set_bbox_changed();if(world.hasOwnProperty("\x66\x78")){for(i=0,len=world["\x66\x78"].length;i<len;i++){fxindex=type.getEffectIndexByName(world["\x66\x78"][i]["\x6E\x61\x6D\x65"]);if(fxindex<0){continue};inst.active_effect_flags[fxindex]=world["\x66\x78"][i]["\x61\x63\x74\x69\x76\x65"];inst.effect_params[fxindex]=world["\x66\x78"][i]["\x70\x61\x72\x61\x6D\x73"]}};inst.updateActiveEffects()};obehs=o["\x62\x65\x68\x73"];if(obehs){for(p in obehs){if(obehs.hasOwnProperty(p)){behindex=this.getBehaviorIndexBySid(inst,parseInt(p,10));if(behindex<0){continue};inst.behavior_insts[behindex].loadFromJSON(obehs[p])}}};if(o["\x64\x61\x74\x61"]){inst.loadFromJSON(o["\x64\x61\x74\x61"])}};cr.runtime=Runtime;cr.createRuntime=function(canvasid){return new Runtime(document.getElementById(canvasid))};cr.createDCRuntime=function(w,h){return new Runtime({"\x64\x63":true,"\x77\x69\x64\x74\x68":w,"\x68\x65\x69\x67\x68\x74":h})};window["\x63\x72\x5F\x63\x72\x65\x61\x74\x65\x52\x75\x6E\x74\x69\x6D\x65"]=cr.createRuntime;window["\x63\x72\x5F\x63\x72\x65\x61\x74\x65\x44\x43\x52\x75\x6E\x74\x69\x6D\x65"]=cr.createDCRuntime;window["\x63\x72\x65\x61\x74\x65\x43\x6F\x63\x6F\x6F\x6E\x4A\x53\x52\x75\x6E\x74\x69\x6D\x65"]=function(){window["\x63\x32\x63\x6F\x63\x6F\x6F\x6E\x6A\x73"]=true;var canvas=document.createElement("\x73\x63\x72\x65\x65\x6E\x63\x61\x6E\x76\x61\x73")||document.createElement("\x63\x61\x6E\x76\x61\x73");canvas.screencanvas=true;document.body.appendChild(canvas);var rt=new Runtime(canvas);window["\x63\x32\x72\x75\x6E\x74\x69\x6D\x65"]=rt;window.addEventListener("\x6F\x72\x69\x65\x6E\x74\x61\x74\x69\x6F\x6E\x63\x68\x61\x6E\x67\x65",function(){window["\x63\x32\x72\x75\x6E\x74\x69\x6D\x65"]["\x73\x65\x74\x53\x69\x7A\x65"](window.innerWidth,window.innerHeight)});window["\x63\x32\x72\x75\x6E\x74\x69\x6D\x65"]["\x73\x65\x74\x53\x69\x7A\x65"](window.innerWidth,window.innerHeight);return rt};window["\x63\x72\x65\x61\x74\x65\x45\x6A\x65\x63\x74\x61\x52\x75\x6E\x74\x69\x6D\x65"]=function(){var canvas=document.getElementById("\x63\x61\x6E\x76\x61\x73");var rt=new Runtime(canvas);window["\x63\x32\x72\x75\x6E\x74\x69\x6D\x65"]=rt;window["\x63\x32\x72\x75\x6E\x74\x69\x6D\x65"]["\x73\x65\x74\x53\x69\x7A\x65"](window.innerWidth,window.innerHeight);return rt}}());window["\x63\x72\x5F\x67\x65\x74\x43\x32\x52\x75\x6E\x74\x69\x6D\x65"]=function(){var canvas=document.getElementById("\x63\x32\x63\x61\x6E\x76\x61\x73");if(canvas){return canvas["\x63\x32\x72\x75\x6E\x74\x69\x6D\x65"]}else{if(window["\x63\x32\x72\x75\x6E\x74\x69\x6D\x65"]){return window["\x63\x32\x72\x75\x6E\x74\x69\x6D\x65"]}else{return null}}};window["\x63\x72\x5F\x67\x65\x74\x53\x6E\x61\x70\x73\x68\x6F\x74"]=function(format_,quality_){var runtime=window["\x63\x72\x5F\x67\x65\x74\x43\x32\x52\x75\x6E\x74\x69\x6D\x65"]();if(runtime){runtime.doCanvasSnapshot(format_,quality_)}};window["\x63\x72\x5F\x73\x69\x7A\x65\x43\x61\x6E\x76\x61\x73"]=function(w,h){if(w===0||h===0){return};var runtime=window["\x63\x72\x5F\x67\x65\x74\x43\x32\x52\x75\x6E\x74\x69\x6D\x65"]();if(runtime){runtime["\x73\x65\x74\x53\x69\x7A\x65"](w,h)}};window["\x63\x72\x5F\x73\x65\x74\x53\x75\x73\x70\x65\x6E\x64\x65\x64"]=function(s){var runtime=window["\x63\x72\x5F\x67\x65\x74\x43\x32\x52\x75\x6E\x74\x69\x6D\x65"]();if(runtime){runtime["\x73\x65\x74\x53\x75\x73\x70\x65\x6E\x64\x65\x64"](s)}};(function(){function Layout(runtime,m){this.runtime=runtime;this.event_sheet=null;this.scrollX=(this.runtime.original_width/2);this.scrollY=(this.runtime.original_height/2);this.scale=1.0;this.angle=0;this.first_visit=true;this.name=m[0];this.width=m[1];this.height=m[2];this.unbounded_scrolling=m[3];this.sheetname=m[4];this.sid=m[5];var lm=m[6];var i,len;this.layers=[];this.initial_types=[];for(i=0,len=lm.length;i<len;i++){var layer=new cr.layer(this,lm[i]);layer.number=i;cr.seal(layer);this.layers.push(layer)};var im=m[7];this.initial_nonworld=[];for(i=0,len=im.length;i<len;i++){var inst=im[i];var type=this.runtime.types_by_index[inst[1]];;;if(!type.default_instance){type.default_instance=inst};this.initial_nonworld.push(inst);if(this.initial_types.indexOf(type)===-1){this.initial_types.push(type)}};this.effect_types=[];this.active_effect_types=[];this.shaders_preserve_opaqueness=true;this.effect_params=[];for(i=0,len=m[8].length;i<len;i++){this.effect_types.push({id:m[8][i][0],name:m[8][i][1],shaderindex:-1,preservesOpaqueness:false,active:true,index:i});this.effect_params.push(m[8][i][2].slice(0))};this.updateActiveEffects();this.rcTex=new cr.rect(0,0,1,1);this.rcTex2=new cr.rect(0,0,1,1);this.persist_data={}}Layout.prototype.saveObjectToPersist=function(inst){var sidStr=inst.type.sid.toString();if(!this.persist_data.hasOwnProperty(sidStr)){this.persist_data[sidStr]=[]};var type_persist=this.persist_data[sidStr];type_persist.push(this.runtime.saveInstanceToJSON(inst))};Layout.prototype.hasOpaqueBottomLayer=function(){var layer=this.layers[0];return!layer.transparent&&layer.opacity===1.0&&!layer.forceOwnTexture&&layer.visible};Layout.prototype.updateActiveEffects=function(){cr.clearArray(this.active_effect_types);this.shaders_preserve_opaqueness=true;var i,len,et;for(i=0,len=this.effect_types.length;i<len;i++){et=this.effect_types[i];if(et.active){this.active_effect_types.push(et);if(!et.preservesOpaqueness){this.shaders_preserve_opaqueness=false}}}};Layout.prototype.getEffectByName=function(name_){var i,len,et;for(i=0,len=this.effect_types.length;i<len;i++){et=this.effect_types[i];if(et.name===name_){return et}};return null};var created_instances=[];function sort_by_zindex(a,b){return a.zindex-b.zindex}var first_layout=true;Layout.prototype.startRunning=function(){if(this.sheetname){this.event_sheet=this.runtime.eventsheets[this.sheetname];;;this.event_sheet.updateDeepIncludes()};this.runtime.running_layout=this;this.scrollX=(this.runtime.original_width/2);this.scrollY=(this.runtime.original_height/2);var i,k,len,lenk,type,type_instances,inst,iid,t,s,p,q,type_data,layer;for(i=0,len=this.runtime.types_by_index.length;i<len;i++){type=this.runtime.types_by_index[i];if(type.is_family){continue};type_instances=type.instances;for(k=0,lenk=type_instances.length;k<lenk;k++){inst=type_instances[k];if(inst.layer){var num=inst.layer.number;if(num>=this.layers.length){num=this.layers.length-1};inst.layer=this.layers[num];if(inst.layer.instances.indexOf(inst)===-1){inst.layer.instances.push(inst)};inst.layer.zindices_stale=true}}};if(!first_layout){for(i=0,len=this.layers.length;i<len;++i){this.layers[i].instances.sort(sort_by_zindex)}};var layer;cr.clearArray(created_instances);this.boundScrolling();for(i=0,len=this.layers.length;i<len;i++){layer=this.layers[i];layer.createInitialInstances();layer.updateViewport(null)};var uids_changed=false;if(!this.first_visit){for(p in this.persist_data){if(this.persist_data.hasOwnProperty(p)){type=this.runtime.getObjectTypeBySid(parseInt(p,10));if(!type||type.is_family||!this.runtime.typeHasPersistBehavior(type)){continue};type_data=this.persist_data[p];for(i=0,len=type_data.length;i<len;i++){layer=null;if(type.plugin.is_world){layer=this.getLayerBySid(type_data[i]["\x77"]["\x6C"]);if(!layer){continue}};inst=this.runtime.createInstanceFromInit(type.default_instance,layer,false,0,0,true);this.runtime.loadInstanceFromJSON(inst,type_data[i]);uids_changed=true;created_instances.push(inst)};cr.clearArray(type_data)}};for(i=0,len=this.layers.length;i<len;i++){this.layers[i].instances.sort(sort_by_zindex);this.layers[i].zindices_stale=true}};if(uids_changed){this.runtime.ClearDeathRow();this.runtime.refreshUidMap()};for(i=0;i<created_instances.length;i++){inst=created_instances[i];if(!inst.type.is_contained){continue};iid=inst.get_iid();for(k=0,lenk=inst.type.container.length;k<lenk;k++){t=inst.type.container[k];if(inst.type===t){continue};if(t.instances.length>iid){inst.siblings.push(t.instances[iid])}else{if(!t.default_instance){}else{s=this.runtime.createInstanceFromInit(t.default_instance,inst.layer,true,inst.x,inst.y,true);this.runtime.ClearDeathRow();t.updateIIDs();inst.siblings.push(s);created_instances.push(s)}}}};for(i=0,len=this.initial_nonworld.length;i<len;i++){inst=this.runtime.createInstanceFromInit(this.initial_nonworld[i],null,true);;};this.runtime.changelayout=null;this.runtime.ClearDeathRow();if(this.runtime.ctx&&!this.runtime.isDomFree){for(i=0,len=this.runtime.types_by_index.length;i<len;i++){t=this.runtime.types_by_index[i];if(t.is_family||!t.instances.length||!t.preloadCanvas2D){continue};t.preloadCanvas2D(this.runtime.ctx)}};for(i=0,len=created_instances.length;i<len;i++){inst=created_instances[i];this.runtime.trigger(Object.getPrototypeOf(inst.type.plugin).cnds.OnCreated,inst)};cr.clearArray(created_instances);if(!this.runtime.isLoadingState){this.runtime.trigger(cr.system_object.prototype.cnds.OnLayoutStart,null)};this.first_visit=false};Layout.prototype.createGlobalNonWorlds=function(){var i,k,len,initial_inst,inst,type;for(i=0,k=0,len=this.initial_nonworld.length;i<len;i++){initial_inst=this.initial_nonworld[i];type=this.runtime.types_by_index[initial_inst[1]];if(type.global){if(!type.is_contained){inst=this.runtime.createInstanceFromInit(initial_inst,null,true)}}else{this.initial_nonworld[k]=initial_inst;k++}};cr.truncateArray(this.initial_nonworld,k)};Layout.prototype.stopRunning=function(){;;if(!this.runtime.isLoadingState){this.runtime.trigger(cr.system_object.prototype.cnds.OnLayoutEnd,null)};this.runtime.isEndingLayout=true;cr.clearArray(this.runtime.system.waits);var i,leni,j,lenj;var layer_instances,inst,type;if(!this.first_visit){for(i=0,leni=this.layers.length;i<leni;i++){this.layers[i].updateZIndices();layer_instances=this.layers[i].instances;for(j=0,lenj=layer_instances.length;j<lenj;j++){inst=layer_instances[j];if(!inst.type.global){if(this.runtime.typeHasPersistBehavior(inst.type)){this.saveObjectToPersist(inst)}}}}};for(i=0,leni=this.layers.length;i<leni;i++){layer_instances=this.layers[i].instances;for(j=0,lenj=layer_instances.length;j<lenj;j++){inst=layer_instances[j];if(!inst.type.global){this.runtime.DestroyInstance(inst)}};this.runtime.ClearDeathRow();cr.clearArray(layer_instances);this.layers[i].zindices_stale=true};for(i=0,leni=this.runtime.types_by_index.length;i<leni;i++){type=this.runtime.types_by_index[i];if(type.global||type.plugin.is_world||type.plugin.singleglobal||type.is_family){continue};for(j=0,lenj=type.instances.length;j<lenj;j++){this.runtime.DestroyInstance(type.instances[j])};this.runtime.ClearDeathRow()};first_layout=false;this.runtime.isEndingLayout=false};var temp_rect=new cr.rect(0,0,0,0);Layout.prototype.recreateInitialObjects=function(type,x1,y1,x2,y2){temp_rect["\x73\x65\x74"](x1,y1,x2,y2);var i,len;for(i=0,len=this.layers.length;i<len;i++){this.layers[i].recreateInitialObjects(type,temp_rect)}};Layout.prototype.draw=function(ctx){var layout_canvas;var layout_ctx=ctx;var ctx_changed=false;var render_offscreen=!this.runtime.fullscreenScalingQuality;if(render_offscreen){if(!this.runtime.layout_canvas){this.runtime.layout_canvas=document.createElement("\x63\x61\x6E\x76\x61\x73");layout_canvas=this.runtime.layout_canvas;layout_canvas.width=this.runtime.draw_width;layout_canvas.height=this.runtime.draw_height;this.runtime.layout_ctx=layout_canvas.getContext("\x32\x64");ctx_changed=true};layout_canvas=this.runtime.layout_canvas;layout_ctx=this.runtime.layout_ctx;if(layout_canvas.width!==this.runtime.draw_width){layout_canvas.width=this.runtime.draw_width;ctx_changed=true};if(layout_canvas.height!==this.runtime.draw_height){layout_canvas.height=this.runtime.draw_height;ctx_changed=true};if(ctx_changed){layout_ctx["\x77\x65\x62\x6B\x69\x74\x49\x6D\x61\x67\x65\x53\x6D\x6F\x6F\x74\x68\x69\x6E\x67\x45\x6E\x61\x62\x6C\x65\x64"]=this.runtime.linearSampling;layout_ctx["\x6D\x6F\x7A\x49\x6D\x61\x67\x65\x53\x6D\x6F\x6F\x74\x68\x69\x6E\x67\x45\x6E\x61\x62\x6C\x65\x64"]=this.runtime.linearSampling;layout_ctx["\x6D\x73\x49\x6D\x61\x67\x65\x53\x6D\x6F\x6F\x74\x68\x69\x6E\x67\x45\x6E\x61\x62\x6C\x65\x64"]=this.runtime.linearSampling;layout_ctx["\x69\x6D\x61\x67\x65\x53\x6D\x6F\x6F\x74\x68\x69\x6E\x67\x45\x6E\x61\x62\x6C\x65\x64"]=this.runtime.linearSampling}};layout_ctx.globalAlpha=1;layout_ctx.globalCompositeOperation="\x73\x6F\x75\x72\x63\x65\x2D\x6F\x76\x65\x72";if(this.runtime.alphaBackground&&!this.hasOpaqueBottomLayer()){layout_ctx.clearRect(0,0,this.runtime.draw_width,this.runtime.draw_height)};var i,len,l;for(i=0,len=this.layers.length;i<len;i++){l=this.layers[i];if(l.visible&&l.opacity>0&&l.blend_mode!==11&&(l.instances.length||!l.transparent)){l.draw(layout_ctx)}else{l.updateViewport(null)}};if(render_offscreen){ctx.drawImage(layout_canvas,0,0,this.runtime.width,this.runtime.height)}};Layout.prototype.drawGL_earlyZPass=function(glw){glw.setEarlyZPass(true);if(!this.runtime.layout_tex){this.runtime.layout_tex=glw.createEmptyTexture(this.runtime.draw_width,this.runtime.draw_height,this.runtime.linearSampling)};if(this.runtime.layout_tex.c2width!==this.runtime.draw_width||this.runtime.layout_tex.c2height!==this.runtime.draw_height){glw.deleteTexture(this.runtime.layout_tex);this.runtime.layout_tex=glw.createEmptyTexture(this.runtime.draw_width,this.runtime.draw_height,this.runtime.linearSampling)};glw.setRenderingToTexture(this.runtime.layout_tex);if(!this.runtime.fullscreenScalingQuality){glw.setSize(this.runtime.draw_width,this.runtime.draw_height)};var i,l;for(i=this.layers.length-1;i>=0;--i){l=this.layers[i];if(l.visible&&l.opacity===1&&l.shaders_preserve_opaqueness&&l.blend_mode===0&&(l.instances.length||!l.transparent)){l.drawGL_earlyZPass(glw)}else{l.updateViewport(null)}};glw.setEarlyZPass(false)};Layout.prototype.drawGL=function(glw){var render_to_texture=(this.active_effect_types.length>0||this.runtime.uses_background_blending||!this.runtime.fullscreenScalingQuality||this.runtime.enableFrontToBack);if(render_to_texture){if(!this.runtime.layout_tex){this.runtime.layout_tex=glw.createEmptyTexture(this.runtime.draw_width,this.runtime.draw_height,this.runtime.linearSampling)};if(this.runtime.layout_tex.c2width!==this.runtime.draw_width||this.runtime.layout_tex.c2height!==this.runtime.draw_height){glw.deleteTexture(this.runtime.layout_tex);this.runtime.layout_tex=glw.createEmptyTexture(this.runtime.draw_width,this.runtime.draw_height,this.runtime.linearSampling)};glw.setRenderingToTexture(this.runtime.layout_tex);if(!this.runtime.fullscreenScalingQuality){glw.setSize(this.runtime.draw_width,this.runtime.draw_height)}}else{if(this.runtime.layout_tex){glw.setRenderingToTexture(null);glw.deleteTexture(this.runtime.layout_tex);this.runtime.layout_tex=null}};if(this.runtime.alphaBackground&&!this.hasOpaqueBottomLayer()){glw.clear(0,0,0,0)};var i,len,l;for(i=0,len=this.layers.length;i<len;i++){l=this.layers[i];if(l.visible&&l.opacity>0&&(l.instances.length||!l.transparent)){l.drawGL(glw)}else{l.updateViewport(null)}};if(render_to_texture){if(this.active_effect_types.length===0||(this.active_effect_types.length===1&&this.runtime.fullscreenScalingQuality)){if(this.active_effect_types.length===1){var etindex=this.active_effect_types[0].index;glw.switchProgram(this.active_effect_types[0].shaderindex);glw.setProgramParameters(null,1.0/this.runtime.draw_width,1.0/this.runtime.draw_height,0.0,0.0,1.0,1.0,this.scale,this.angle,0.0,0.0,this.runtime.draw_width/2,this.runtime.draw_height/2,this.runtime.kahanTime.sum,this.effect_params[etindex]);if(glw.programIsAnimated(this.active_effect_types[0].shaderindex)){this.runtime.redraw=true}}else{glw.switchProgram(0)};if(!this.runtime.fullscreenScalingQuality){glw.setSize(this.runtime.width,this.runtime.height)};glw.setRenderingToTexture(null);glw.setDepthTestEnabled(false);glw.setOpacity(1);glw.setTexture(this.runtime.layout_tex);glw.setAlphaBlend();glw.resetModelView();glw.updateModelView();var halfw=this.runtime.width/2;var halfh=this.runtime.height/2;glw.quad(-halfw,halfh,halfw,halfh,halfw,-halfh,-halfw,-halfh);glw.setTexture(null);glw.setDepthTestEnabled(true)}else{this.renderEffectChain(glw,null,null,null)}}};Layout.prototype.getRenderTarget=function(){if(this.active_effect_types.length>0||this.runtime.uses_background_blending||!this.runtime.fullscreenScalingQuality||this.runtime.enableFrontToBack){return this.runtime.layout_tex}else{return null}};Layout.prototype.getMinLayerScale=function(){var m=this.layers[0].getScale();var i,len,l;for(i=1,len=this.layers.length;i<len;i++){l=this.layers[i];if(l.parallaxX===0&&l.parallaxY===0){continue};if(l.getScale()<m){m=l.getScale()}};return m};Layout.prototype.scrollToX=function(x){if(!this.unbounded_scrolling){var widthBoundary=(this.runtime.draw_width*(1/this.getMinLayerScale())/2);if(x>this.width-widthBoundary){x=this.width-widthBoundary};if(x<widthBoundary){x=widthBoundary}};if(this.scrollX!==x){this.scrollX=x;this.runtime.redraw=true}};Layout.prototype.scrollToY=function(y){if(!this.unbounded_scrolling){var heightBoundary=(this.runtime.draw_height*(1/this.getMinLayerScale())/2);if(y>this.height-heightBoundary){y=this.height-heightBoundary};if(y<heightBoundary){y=heightBoundary}};if(this.scrollY!==y){this.scrollY=y;this.runtime.redraw=true}};Layout.prototype.boundScrolling=function(){this.scrollToX(this.scrollX);this.scrollToY(this.scrollY)};Layout.prototype.renderEffectChain=function(glw,layer,inst,rendertarget){var active_effect_types=inst?inst.active_effect_types:layer?layer.active_effect_types:this.active_effect_types;var layerScale=1,layerAngle=0,viewOriginLeft=0,viewOriginTop=0,viewOriginRight=this.runtime.draw_width,viewOriginBottom=this.runtime.draw_height;if(inst){layerScale=inst.layer.getScale();layerAngle=inst.layer.getAngle();viewOriginLeft=inst.layer.viewLeft;viewOriginTop=inst.layer.viewTop;viewOriginRight=inst.layer.viewRight;viewOriginBottom=inst.layer.viewBottom}else{if(layer){layerScale=layer.getScale();layerAngle=layer.getAngle();viewOriginLeft=layer.viewLeft;viewOriginTop=layer.viewTop;viewOriginRight=layer.viewRight;viewOriginBottom=layer.viewBottom}};var fx_tex=this.runtime.fx_tex;var i,len,last,temp,fx_index=0,other_fx_index=1;var y,h;var windowWidth=this.runtime.draw_width;var windowHeight=this.runtime.draw_height;var halfw=windowWidth/2;var halfh=windowHeight/2;var rcTex=layer?layer.rcTex:this.rcTex;var rcTex2=layer?layer.rcTex2:this.rcTex2;var screenleft=0,clearleft=0;var screentop=0,cleartop=0;var screenright=windowWidth,clearright=windowWidth;var screenbottom=windowHeight,clearbottom=windowHeight;var boxExtendHorizontal=0;var boxExtendVertical=0;var inst_layer_angle=inst?inst.layer.getAngle():0;if(inst){for(i=0,len=active_effect_types.length;i<len;i++){boxExtendHorizontal+=glw.getProgramBoxExtendHorizontal(active_effect_types[i].shaderindex);boxExtendVertical+=glw.getProgramBoxExtendVertical(active_effect_types[i].shaderindex)};var bbox=inst.bbox;screenleft=layer.layerToCanvas(bbox.left,bbox.top,true,true);screentop=layer.layerToCanvas(bbox.left,bbox.top,false,true);screenright=layer.layerToCanvas(bbox.right,bbox.bottom,true,true);screenbottom=layer.layerToCanvas(bbox.right,bbox.bottom,false,true);if(inst_layer_angle!==0){var screentrx=layer.layerToCanvas(bbox.right,bbox.top,true,true);var screentry=layer.layerToCanvas(bbox.right,bbox.top,false,true);var screenblx=layer.layerToCanvas(bbox.left,bbox.bottom,true,true);var screenbly=layer.layerToCanvas(bbox.left,bbox.bottom,false,true);temp=Math.min(screenleft,screenright,screentrx,screenblx);screenright=Math.max(screenleft,screenright,screentrx,screenblx);screenleft=temp;temp=Math.min(screentop,screenbottom,screentry,screenbly);screenbottom=Math.max(screentop,screenbottom,screentry,screenbly);screentop=temp};screenleft-=boxExtendHorizontal;screentop-=boxExtendVertical;screenright+=boxExtendHorizontal;screenbottom+=boxExtendVertical;rcTex2.left=screenleft/windowWidth;rcTex2.top=1-screentop/windowHeight;rcTex2.right=screenright/windowWidth;rcTex2.bottom=1-screenbottom/windowHeight;clearleft=screenleft=cr.floor(screenleft);cleartop=screentop=cr.floor(screentop);clearright=screenright=cr.ceil(screenright);clearbottom=screenbottom=cr.ceil(screenbottom);clearleft-=boxExtendHorizontal;cleartop-=boxExtendVertical;clearright+=boxExtendHorizontal;clearbottom+=boxExtendVertical;if(screenleft<0){screenleft=0};if(screentop<0){screentop=0};if(screenright>windowWidth){screenright=windowWidth};if(screenbottom>windowHeight){screenbottom=windowHeight};if(clearleft<0){clearleft=0};if(cleartop<0){cleartop=0};if(clearright>windowWidth){clearright=windowWidth};if(clearbottom>windowHeight){clearbottom=windowHeight};rcTex.left=screenleft/windowWidth;rcTex.top=1-screentop/windowHeight;rcTex.right=screenright/windowWidth;rcTex.bottom=1-screenbottom/windowHeight}else{rcTex.left=rcTex2.left=0;rcTex.top=rcTex2.top=0;rcTex.right=rcTex2.right=1;rcTex.bottom=rcTex2.bottom=1};var pre_draw=(inst&&(glw.programUsesDest(active_effect_types[0].shaderindex)||boxExtendHorizontal!==0||boxExtendVertical!==0||inst.opacity!==1||inst.type.plugin.must_predraw))||(layer&&!inst&&layer.opacity!==1);glw.setAlphaBlend();if(pre_draw){if(!fx_tex[fx_index]){fx_tex[fx_index]=glw.createEmptyTexture(windowWidth,windowHeight,this.runtime.linearSampling)};if(fx_tex[fx_index].c2width!==windowWidth||fx_tex[fx_index].c2height!==windowHeight){glw.deleteTexture(fx_tex[fx_index]);fx_tex[fx_index]=glw.createEmptyTexture(windowWidth,windowHeight,this.runtime.linearSampling)};glw.switchProgram(0);glw.setRenderingToTexture(fx_tex[fx_index]);h=clearbottom-cleartop;y=(windowHeight-cleartop)-h;glw.clearRect(clearleft,y,clearright-clearleft,h);if(inst){inst.drawGL(glw)}else{glw.setTexture(this.runtime.layer_tex);glw.setOpacity(layer.opacity);glw.resetModelView();glw.translate(-halfw,-halfh);glw.updateModelView();glw.quadTex(screenleft,screenbottom,screenright,screenbottom,screenright,screentop,screenleft,screentop,rcTex)};rcTex2.left=rcTex2.top=0;rcTex2.right=rcTex2.bottom=1;if(inst){temp=rcTex.top;rcTex.top=rcTex.bottom;rcTex.bottom=temp};fx_index=1;other_fx_index=0};glw.setOpacity(1);var last=active_effect_types.length-1;var post_draw=glw.programUsesCrossSampling(active_effect_types[last].shaderindex)||(!layer&&!inst&&!this.runtime.fullscreenScalingQuality);var etindex=0;for(i=0,len=active_effect_types.length;i<len;i++){if(!fx_tex[fx_index]){fx_tex[fx_index]=glw.createEmptyTexture(windowWidth,windowHeight,this.runtime.linearSampling)};if(fx_tex[fx_index].c2width!==windowWidth||fx_tex[fx_index].c2height!==windowHeight){glw.deleteTexture(fx_tex[fx_index]);fx_tex[fx_index]=glw.createEmptyTexture(windowWidth,windowHeight,this.runtime.linearSampling)};glw.switchProgram(active_effect_types[i].shaderindex);etindex=active_effect_types[i].index;if(glw.programIsAnimated(active_effect_types[i].shaderindex)){this.runtime.redraw=true};if(i==0&&!pre_draw){glw.setRenderingToTexture(fx_tex[fx_index]);h=clearbottom-cleartop;y=(windowHeight-cleartop)-h;glw.clearRect(clearleft,y,clearright-clearleft,h);if(inst){glw.setProgramParameters(rendertarget,1.0/inst.width,1.0/inst.height,rcTex2.left,rcTex2.top,rcTex2.right,rcTex2.bottom,layerScale,layerAngle,viewOriginLeft,viewOriginTop,(viewOriginLeft+viewOriginRight)/2,(viewOriginTop+viewOriginBottom)/2,this.runtime.kahanTime.sum,inst.effect_params[etindex]);inst.drawGL(glw)}else{glw.setProgramParameters(rendertarget,1.0/windowWidth,1.0/windowHeight,0.0,0.0,1.0,1.0,layerScale,layerAngle,viewOriginLeft,viewOriginTop,(viewOriginLeft+viewOriginRight)/2,(viewOriginTop+viewOriginBottom)/2,this.runtime.kahanTime.sum,layer?layer.effect_params[etindex]:this.effect_params[etindex]);glw.setTexture(layer?this.runtime.layer_tex:this.runtime.layout_tex);glw.resetModelView();glw.translate(-halfw,-halfh);glw.updateModelView();glw.quadTex(screenleft,screenbottom,screenright,screenbottom,screenright,screentop,screenleft,screentop,rcTex)};rcTex2.left=rcTex2.top=0;rcTex2.right=rcTex2.bottom=1;if(inst&&!post_draw){temp=screenbottom;screenbottom=screentop;screentop=temp}}else{glw.setProgramParameters(rendertarget,1.0/windowWidth,1.0/windowHeight,rcTex2.left,rcTex2.top,rcTex2.right,rcTex2.bottom,layerScale,layerAngle,viewOriginLeft,viewOriginTop,(viewOriginLeft+viewOriginRight)/2,(viewOriginTop+viewOriginBottom)/2,this.runtime.kahanTime.sum,inst?inst.effect_params[etindex]:layer?layer.effect_params[etindex]:this.effect_params[etindex]);glw.setTexture(null);if(i===last&&!post_draw){if(inst){glw.setBlend(inst.srcBlend,inst.destBlend)}else{if(layer){glw.setBlend(layer.srcBlend,layer.destBlend)}};glw.setRenderingToTexture(rendertarget)}else{glw.setRenderingToTexture(fx_tex[fx_index]);h=clearbottom-cleartop;y=(windowHeight-cleartop)-h;glw.clearRect(clearleft,y,clearright-clearleft,h)};glw.setTexture(fx_tex[other_fx_index]);glw.resetModelView();glw.translate(-halfw,-halfh);glw.updateModelView();glw.quadTex(screenleft,screenbottom,screenright,screenbottom,screenright,screentop,screenleft,screentop,rcTex);if(i===last&&!post_draw){glw.setTexture(null)}};fx_index=(fx_index===0?1:0);other_fx_index=(fx_index===0?1:0)};if(post_draw){glw.switchProgram(0);if(inst){glw.setBlend(inst.srcBlend,inst.destBlend)}else{if(layer){glw.setBlend(layer.srcBlend,layer.destBlend)}else{if(!this.runtime.fullscreenScalingQuality){glw.setSize(this.runtime.width,this.runtime.height);halfw=this.runtime.width/2;halfh=this.runtime.height/2;screenleft=0;screentop=0;screenright=this.runtime.width;screenbottom=this.runtime.height}}};glw.setRenderingToTexture(rendertarget);glw.setTexture(fx_tex[other_fx_index]);glw.resetModelView();glw.translate(-halfw,-halfh);glw.updateModelView();if(inst&&active_effect_types.length===1&&!pre_draw){glw.quadTex(screenleft,screentop,screenright,screentop,screenright,screenbottom,screenleft,screenbottom,rcTex)}else{glw.quadTex(screenleft,screenbottom,screenright,screenbottom,screenright,screentop,screenleft,screentop,rcTex)};glw.setTexture(null)}};Layout.prototype.getLayerBySid=function(sid_){var i,len;for(i=0,len=this.layers.length;i<len;i++){if(this.layers[i].sid===sid_){return this.layers[i]}};return null};Layout.prototype.saveToJSON=function(){var i,len,layer,et;var o={"\x73\x78":this.scrollX,"\x73\x79":this.scrollY,"\x73":this.scale,"\x61":this.angle,"\x77":this.width,"\x68":this.height,"\x66\x76":this.first_visit,"\x70\x65\x72\x73\x69\x73\x74":this.persist_data,"\x66\x78":[],"\x6C\x61\x79\x65\x72\x73":{}};for(i=0,len=this.effect_types.length;i<len;i++){et=this.effect_types[i];o["\x66\x78"].push({"\x6E\x61\x6D\x65":et.name,"\x61\x63\x74\x69\x76\x65":et.active,"\x70\x61\x72\x61\x6D\x73":this.effect_params[et.index]})};for(i=0,len=this.layers.length;i<len;i++){layer=this.layers[i];o["\x6C\x61\x79\x65\x72\x73"][layer.sid.toString()]=layer.saveToJSON()};return o};Layout.prototype.loadFromJSON=function(o){var i,j,len,fx,p,layer;this.scrollX=o["\x73\x78"];this.scrollY=o["\x73\x79"];this.scale=o["\x73"];this.angle=o["\x61"];this.width=o["\x77"];this.height=o["\x68"];this.persist_data=o["\x70\x65\x72\x73\x69\x73\x74"];if(typeof o["\x66\x76"]!=="\x75\x6E\x64\x65\x66\x69\x6E\x65\x64"){this.first_visit=o["\x66\x76"]};var ofx=o["\x66\x78"];for(i=0,len=ofx.length;i<len;i++){fx=this.getEffectByName(ofx[i]["\x6E\x61\x6D\x65"]);if(!fx){continue};fx.active=ofx[i]["\x61\x63\x74\x69\x76\x65"];this.effect_params[fx.index]=ofx[i]["\x70\x61\x72\x61\x6D\x73"]};this.updateActiveEffects();var olayers=o["\x6C\x61\x79\x65\x72\x73"];for(p in olayers){if(olayers.hasOwnProperty(p)){layer=this.getLayerBySid(parseInt(p,10));if(!layer){continue};layer.loadFromJSON(olayers[p])}}};cr.layout=Layout;function Layer(layout,m){this.layout=layout;this.runtime=layout.runtime;this.instances=[];this.scale=1.0;this.angle=0;this.disableAngle=false;this.tmprect=new cr.rect(0,0,0,0);this.tmpquad=new cr.quad();this.viewLeft=0;this.viewRight=0;this.viewTop=0;this.viewBottom=0;this.zindices_stale=false;this.zindices_stale_from=-1;this.clear_earlyz_index=0;this.name=m[0];this.index=m[1];this.sid=m[2];this.visible=m[3];this.background_color=m[4];this.transparent=m[5];this.parallaxX=m[6];this.parallaxY=m[7];this.opacity=m[8];this.forceOwnTexture=m[9];this.useRenderCells=m[10];this.zoomRate=m[11];this.blend_mode=m[12];this.effect_fallback=m[13];this.compositeOp="\x73\x6F\x75\x72\x63\x65\x2D\x6F\x76\x65\x72";this.srcBlend=0;this.destBlend=0;this.render_grid=null;this.last_render_list=alloc_arr();this.render_list_stale=true;this.last_render_cells=new cr.rect(0,0,-1,-1);this.cur_render_cells=new cr.rect(0,0,-1,-1);if(this.useRenderCells){this.render_grid=new cr.RenderGrid(this.runtime.original_width,this.runtime.original_height)};this.render_offscreen=false;var im=m[14];var i,len;this.startup_initial_instances=[];this.initial_instances=[];this.created_globals=[];for(i=0,len=im.length;i<len;i++){var inst=im[i];var type=this.runtime.types_by_index[inst[1]];;;if(!type.default_instance){type.default_instance=inst;type.default_layerindex=this.index};this.initial_instances.push(inst);if(this.layout.initial_types.indexOf(type)===-1){this.layout.initial_types.push(type)}};cr.shallowAssignArray(this.startup_initial_instances,this.initial_instances);this.effect_types=[];this.active_effect_types=[];this.shaders_preserve_opaqueness=true;this.effect_params=[];for(i=0,len=m[15].length;i<len;i++){this.effect_types.push({id:m[15][i][0],name:m[15][i][1],shaderindex:-1,preservesOpaqueness:false,active:true,index:i});this.effect_params.push(m[15][i][2].slice(0))};this.updateActiveEffects();this.rcTex=new cr.rect(0,0,1,1);this.rcTex2=new cr.rect(0,0,1,1)}Layer.prototype.updateActiveEffects=function(){cr.clearArray(this.active_effect_types);this.shaders_preserve_opaqueness=true;var i,len,et;for(i=0,len=this.effect_types.length;i<len;i++){et=this.effect_types[i];if(et.active){this.active_effect_types.push(et);if(!et.preservesOpaqueness){this.shaders_preserve_opaqueness=false}}}};Layer.prototype.getEffectByName=function(name_){var i,len,et;for(i=0,len=this.effect_types.length;i<len;i++){et=this.effect_types[i];if(et.name===name_){return et}};return null};Layer.prototype.createInitialInstances=function(){var i,k,len,inst,initial_inst,type,keep,hasPersistBehavior;for(i=0,k=0,len=this.initial_instances.length;i<len;i++){initial_inst=this.initial_instances[i];type=this.runtime.types_by_index[initial_inst[1]];;;hasPersistBehavior=this.runtime.typeHasPersistBehavior(type);keep=true;if(!hasPersistBehavior||this.layout.first_visit){inst=this.runtime.createInstanceFromInit(initial_inst,this,true);;;created_instances.push(inst);if(inst.type.global){keep=false;this.created_globals.push(inst.uid)}};if(keep){this.initial_instances[k]=this.initial_instances[i];k++}};this.initial_instances.length=k;this.runtime.ClearDeathRow();if(!this.runtime.glwrap&&this.effect_types.length){this.blend_mode=this.effect_fallback};this.compositeOp=cr.effectToCompositeOp(this.blend_mode);if(this.runtime.gl){cr.setGLBlend(this,this.blend_mode,this.runtime.gl)};this.render_list_stale=true};Layer.prototype.recreateInitialObjects=function(only_type,rc){var i,len,initial_inst,type,wm,x,y,inst,j,lenj,s;var types_by_index=this.runtime.types_by_index;var only_type_is_family=only_type.is_family;var only_type_members=only_type.members;for(i=0,len=this.initial_instances.length;i<len;++i){initial_inst=this.initial_instances[i];wm=initial_inst[0];x=wm[0];y=wm[1];if(!rc.contains_pt(x,y)){continue};type=types_by_index[initial_inst[1]];if(type!==only_type){if(only_type_is_family){if(only_type_members.indexOf(type)<0){continue}}else{continue}};inst=this.runtime.createInstanceFromInit(initial_inst,this,false);this.runtime.isInOnDestroy++;this.runtime.trigger(Object.getPrototypeOf(type.plugin).cnds.OnCreated,inst);if(inst.is_contained){for(j=0,lenj=inst.siblings.length;j<lenj;j++){s=inst.siblings[i];this.runtime.trigger(Object.getPrototypeOf(s.type.plugin).cnds.OnCreated,s)}};this.runtime.isInOnDestroy--}};Layer.prototype.removeFromInstanceList=function(inst,remove_from_grid){var index=cr.fastIndexOf(this.instances,inst);if(index<0){return};if(remove_from_grid&&this.useRenderCells&&inst.rendercells&&inst.rendercells.right>=inst.rendercells.left){inst.update_bbox();this.render_grid.update(inst,inst.rendercells,null);inst.rendercells["\x73\x65\x74"](0,0,-1,-1)};if(index===this.instances.length-1){this.instances.pop()}else{cr.arrayRemove(this.instances,index);this.setZIndicesStaleFrom(index)};this.render_list_stale=true};Layer.prototype.appendToInstanceList=function(inst,add_to_grid){;;inst.zindex=this.instances.length;this.instances.push(inst);if(add_to_grid&&this.useRenderCells&&inst.rendercells){inst.set_bbox_changed()};this.render_list_stale=true};Layer.prototype.prependToInstanceList=function(inst,add_to_grid){;;this.instances.unshift(inst);this.setZIndicesStaleFrom(0);if(add_to_grid&&this.useRenderCells&&inst.rendercells){inst.set_bbox_changed()}};Layer.prototype.moveInstanceAdjacent=function(inst,other,isafter){;;var myZ=inst.get_zindex();var insertZ=other.get_zindex();cr.arrayRemove(this.instances,myZ);if(myZ<insertZ){insertZ--};if(isafter){insertZ++};if(insertZ===this.instances.length){this.instances.push(inst)}else{this.instances.splice(insertZ,0,inst)};this.setZIndicesStaleFrom(myZ<insertZ?myZ:insertZ)};Layer.prototype.setZIndicesStaleFrom=function(index){if(this.zindices_stale_from===-1){this.zindices_stale_from=index}else{if(index<this.zindices_stale_from){this.zindices_stale_from=index}};this.zindices_stale=true;this.render_list_stale=true};Layer.prototype.updateZIndices=function(){if(!this.zindices_stale){return};if(this.zindices_stale_from===-1){this.zindices_stale_from=0};var i,len,inst;if(this.useRenderCells){for(i=this.zindices_stale_from,len=this.instances.length;i<len;++i){inst=this.instances[i];inst.zindex=i;this.render_grid.markRangeChanged(inst.rendercells)}}else{for(i=this.zindices_stale_from,len=this.instances.length;i<len;++i){this.instances[i].zindex=i}};this.zindices_stale=false;this.zindices_stale_from=-1};Layer.prototype.getScale=function(include_aspect){return this.getNormalScale()*(this.runtime.fullscreenScalingQuality||include_aspect?this.runtime.aspect_scale:1)};Layer.prototype.getNormalScale=function(){return((this.scale*this.layout.scale)-1)*this.zoomRate+1};Layer.prototype.getAngle=function(){if(this.disableAngle){return 0};return cr.clamp_angle(this.layout.angle+this.angle)};var arr_cache=[];function alloc_arr(){if(arr_cache.length){return arr_cache.pop()}else{return[]}}function free_arr(a){cr.clearArray(a);arr_cache.push(a)}function mergeSortedZArrays(a,b,out){var i=0,j=0,k=0,lena=a.length,lenb=b.length,ai,bj;out.length=lena+lenb;for(;i<lena&&j<lenb;++k){ai=a[i];bj=b[j];if(ai.zindex<bj.zindex){out[k]=ai;++i}else{out[k]=bj;++j}};for(;i<lena;++i,++k){out[k]=a[i]};for(;j<lenb;++j,++k){out[k]=b[j]}}var next_arr=[];function mergeAllSortedZArrays_pass(arr,first_pass){var i,len,arr1,arr2,out;for(i=0,len=arr.length;i<len-1;i+=2){arr1=arr[i];arr2=arr[i+1];out=alloc_arr();mergeSortedZArrays(arr1,arr2,out);if(!first_pass){free_arr(arr1);free_arr(arr2)};next_arr.push(out)};if(len%2===1){if(first_pass){arr1=alloc_arr();cr.shallowAssignArray(arr1,arr[len-1]);next_arr.push(arr1)}else{next_arr.push(arr[len-1])}};cr.shallowAssignArray(arr,next_arr);cr.clearArray(next_arr)}function mergeAllSortedZArrays(arr){var first_pass=true;while(arr.length>1){mergeAllSortedZArrays_pass(arr,first_pass);first_pass=false};return arr[0]}var render_arr=[];Layer.prototype.getRenderCellInstancesToDraw=function(){;;this.updateZIndices();this.render_grid.queryRange(this.viewLeft,this.viewTop,this.viewRight,this.viewBottom,render_arr);if(!render_arr.length){return alloc_arr()};if(render_arr.length===1){var a=alloc_arr();cr.shallowAssignArray(a,render_arr[0]);cr.clearArray(render_arr);return a};var draw_list=mergeAllSortedZArrays(render_arr);cr.clearArray(render_arr);return draw_list};Layer.prototype.draw=function(ctx){this.render_offscreen=(this.forceOwnTexture||this.opacity!==1.0||this.blend_mode!==0);var layer_canvas=this.runtime.canvas;var layer_ctx=ctx;var ctx_changed=false;if(this.render_offscreen){if(!this.runtime.layer_canvas){this.runtime.layer_canvas=document.createElement("\x63\x61\x6E\x76\x61\x73");;;layer_canvas=this.runtime.layer_canvas;layer_canvas.width=this.runtime.draw_width;layer_canvas.height=this.runtime.draw_height;this.runtime.layer_ctx=layer_canvas.getContext("\x32\x64");;;ctx_changed=true};layer_canvas=this.runtime.layer_canvas;layer_ctx=this.runtime.layer_ctx;if(layer_canvas.width!==this.runtime.draw_width){layer_canvas.width=this.runtime.draw_width;ctx_changed=true};if(layer_canvas.height!==this.runtime.draw_height){layer_canvas.height=this.runtime.draw_height;ctx_changed=true};if(ctx_changed){layer_ctx["\x77\x65\x62\x6B\x69\x74\x49\x6D\x61\x67\x65\x53\x6D\x6F\x6F\x74\x68\x69\x6E\x67\x45\x6E\x61\x62\x6C\x65\x64"]=this.runtime.linearSampling;layer_ctx["\x6D\x6F\x7A\x49\x6D\x61\x67\x65\x53\x6D\x6F\x6F\x74\x68\x69\x6E\x67\x45\x6E\x61\x62\x6C\x65\x64"]=this.runtime.linearSampling;layer_ctx["\x6D\x73\x49\x6D\x61\x67\x65\x53\x6D\x6F\x6F\x74\x68\x69\x6E\x67\x45\x6E\x61\x62\x6C\x65\x64"]=this.runtime.linearSampling;layer_ctx["\x69\x6D\x61\x67\x65\x53\x6D\x6F\x6F\x74\x68\x69\x6E\x67\x45\x6E\x61\x62\x6C\x65\x64"]=this.runtime.linearSampling};if(this.transparent){layer_ctx.clearRect(0,0,this.runtime.draw_width,this.runtime.draw_height)}};layer_ctx.globalAlpha=1;layer_ctx.globalCompositeOperation="\x73\x6F\x75\x72\x63\x65\x2D\x6F\x76\x65\x72";if(!this.transparent){layer_ctx.fillStyle="\x72\x67\x62\x28"+this.background_color[0]+"\x2C"+this.background_color[1]+"\x2C"+this.background_color[2]+"\x29";layer_ctx.fillRect(0,0,this.runtime.draw_width,this.runtime.draw_height)};layer_ctx.save();this.disableAngle=true;var px=this.canvasToLayer(0,0,true,true);var py=this.canvasToLayer(0,0,false,true);this.disableAngle=false;if(this.runtime.pixel_rounding){px=Math.round(px);py=Math.round(py)};this.rotateViewport(px,py,layer_ctx);var myscale=this.getScale();layer_ctx.scale(myscale,myscale);layer_ctx.translate(-px,-py);var instances_to_draw;if(this.useRenderCells){this.cur_render_cells.left=this.render_grid.XToCell(this.viewLeft);this.cur_render_cells.top=this.render_grid.YToCell(this.viewTop);this.cur_render_cells.right=this.render_grid.XToCell(this.viewRight);this.cur_render_cells.bottom=this.render_grid.YToCell(this.viewBottom);if(this.render_list_stale||!this.cur_render_cells.equals(this.last_render_cells)){free_arr(this.last_render_list);instances_to_draw=this.getRenderCellInstancesToDraw();this.render_list_stale=false;this.last_render_cells.copy(this.cur_render_cells)}else{instances_to_draw=this.last_render_list}}else{instances_to_draw=this.instances};var i,len,inst,last_inst=null;for(i=0,len=instances_to_draw.length;i<len;++i){inst=instances_to_draw[i];if(inst===last_inst){continue};this.drawInstance(inst,layer_ctx);last_inst=inst};if(this.useRenderCells){this.last_render_list=instances_to_draw};layer_ctx.restore();if(this.render_offscreen){ctx.globalCompositeOperation=this.compositeOp;ctx.globalAlpha=this.opacity;ctx.drawImage(layer_canvas,0,0)}};Layer.prototype.drawInstance=function(inst,layer_ctx){if(!inst.visible||inst.width===0||inst.height===0){return};inst.update_bbox();var bbox=inst.bbox;if(bbox.right<this.viewLeft||bbox.bottom<this.viewTop||bbox.left>this.viewRight||bbox.top>this.viewBottom){return};layer_ctx.globalCompositeOperation=inst.compositeOp;inst.draw(layer_ctx)};Layer.prototype.updateViewport=function(ctx){this.disableAngle=true;var px=this.canvasToLayer(0,0,true,true);var py=this.canvasToLayer(0,0,false,true);this.disableAngle=false;if(this.runtime.pixel_rounding){px=Math.round(px);py=Math.round(py)};this.rotateViewport(px,py,ctx)};Layer.prototype.rotateViewport=function(px,py,ctx){var myscale=this.getScale();this.viewLeft=px;this.viewTop=py;this.viewRight=px+(this.runtime.draw_width*(1/myscale));this.viewBottom=py+(this.runtime.draw_height*(1/myscale));var myAngle=this.getAngle();if(myAngle!==0){if(ctx){ctx.translate(this.runtime.draw_width/2,this.runtime.draw_height/2);ctx.rotate(-myAngle);ctx.translate(this.runtime.draw_width/-2,this.runtime.draw_height/-2)};this.tmprect["\x73\x65\x74"](this.viewLeft,this.viewTop,this.viewRight,this.viewBottom);this.tmprect.offset((this.viewLeft+this.viewRight)/-2,(this.viewTop+this.viewBottom)/-2);this.tmpquad.set_from_rotated_rect(this.tmprect,myAngle);this.tmpquad.bounding_box(this.tmprect);this.tmprect.offset((this.viewLeft+this.viewRight)/2,(this.viewTop+this.viewBottom)/2);this.viewLeft=this.tmprect.left;this.viewTop=this.tmprect.top;this.viewRight=this.tmprect.right;this.viewBottom=this.tmprect.bottom}};Layer.prototype.drawGL_earlyZPass=function(glw){var windowWidth=this.runtime.draw_width;var windowHeight=this.runtime.draw_height;var shaderindex=0;var etindex=0;this.render_offscreen=this.forceOwnTexture;if(this.render_offscreen){if(!this.runtime.layer_tex){this.runtime.layer_tex=glw.createEmptyTexture(this.runtime.draw_width,this.runtime.draw_height,this.runtime.linearSampling)};if(this.runtime.layer_tex.c2width!==this.runtime.draw_width||this.runtime.layer_tex.c2height!==this.runtime.draw_height){glw.deleteTexture(this.runtime.layer_tex);this.runtime.layer_tex=glw.createEmptyTexture(this.runtime.draw_width,this.runtime.draw_height,this.runtime.linearSampling)};glw.setRenderingToTexture(this.runtime.layer_tex)};this.disableAngle=true;var px=this.canvasToLayer(0,0,true,true);var py=this.canvasToLayer(0,0,false,true);this.disableAngle=false;if(this.runtime.pixel_rounding){px=Math.round(px);py=Math.round(py)};this.rotateViewport(px,py,null);var myscale=this.getScale();glw.resetModelView();glw.scale(myscale,myscale);glw.rotateZ(-this.getAngle());glw.translate((this.viewLeft+this.viewRight)/-2,(this.viewTop+this.viewBottom)/-2);glw.updateModelView();var instances_to_draw;if(this.useRenderCells){this.cur_render_cells.left=this.render_grid.XToCell(this.viewLeft);this.cur_render_cells.top=this.render_grid.YToCell(this.viewTop);this.cur_render_cells.right=this.render_grid.XToCell(this.viewRight);this.cur_render_cells.bottom=this.render_grid.YToCell(this.viewBottom);if(this.render_list_stale||!this.cur_render_cells.equals(this.last_render_cells)){free_arr(this.last_render_list);instances_to_draw=this.getRenderCellInstancesToDraw();this.render_list_stale=false;this.last_render_cells.copy(this.cur_render_cells)}else{instances_to_draw=this.last_render_list}}else{instances_to_draw=this.instances};var i,inst,last_inst=null;for(i=instances_to_draw.length-1;i>=0;--i){inst=instances_to_draw[i];if(inst===last_inst){continue};this.drawInstanceGL_earlyZPass(instances_to_draw[i],glw);last_inst=inst};if(this.useRenderCells){this.last_render_list=instances_to_draw};if(!this.transparent){this.clear_earlyz_index=this.runtime.earlyz_index++;glw.setEarlyZIndex(this.clear_earlyz_index);glw.setColorFillMode(1,1,1,1);glw.fullscreenQuad();glw.restoreEarlyZMode()}};Layer.prototype.drawGL=function(glw){var windowWidth=this.runtime.draw_width;var windowHeight=this.runtime.draw_height;var shaderindex=0;var etindex=0;this.render_offscreen=(this.forceOwnTexture||this.opacity!==1.0||this.active_effect_types.length>0||this.blend_mode!==0);if(this.render_offscreen){if(!this.runtime.layer_tex){this.runtime.layer_tex=glw.createEmptyTexture(this.runtime.draw_width,this.runtime.draw_height,this.runtime.linearSampling)};if(this.runtime.layer_tex.c2width!==this.runtime.draw_width||this.runtime.layer_tex.c2height!==this.runtime.draw_height){glw.deleteTexture(this.runtime.layer_tex);this.runtime.layer_tex=glw.createEmptyTexture(this.runtime.draw_width,this.runtime.draw_height,this.runtime.linearSampling)};glw.setRenderingToTexture(this.runtime.layer_tex);if(this.transparent){glw.clear(0,0,0,0)}};if(!this.transparent){if(this.runtime.enableFrontToBack){glw.setEarlyZIndex(this.clear_earlyz_index);glw.setColorFillMode(this.background_color[0]/255,this.background_color[1]/255,this.background_color[2]/255,1);glw.fullscreenQuad();glw.setTextureFillMode()}else{glw.clear(this.background_color[0]/255,this.background_color[1]/255,this.background_color[2]/255,1)}};this.disableAngle=true;var px=this.canvasToLayer(0,0,true,true);var py=this.canvasToLayer(0,0,false,true);this.disableAngle=false;if(this.runtime.pixel_rounding){px=Math.round(px);py=Math.round(py)};this.rotateViewport(px,py,null);var myscale=this.getScale();glw.resetModelView();glw.scale(myscale,myscale);glw.rotateZ(-this.getAngle());glw.translate((this.viewLeft+this.viewRight)/-2,(this.viewTop+this.viewBottom)/-2);glw.updateModelView();var instances_to_draw;if(this.useRenderCells){this.cur_render_cells.left=this.render_grid.XToCell(this.viewLeft);this.cur_render_cells.top=this.render_grid.YToCell(this.viewTop);this.cur_render_cells.right=this.render_grid.XToCell(this.viewRight);this.cur_render_cells.bottom=this.render_grid.YToCell(this.viewBottom);if(this.render_list_stale||!this.cur_render_cells.equals(this.last_render_cells)){free_arr(this.last_render_list);instances_to_draw=this.getRenderCellInstancesToDraw();this.render_list_stale=false;this.last_render_cells.copy(this.cur_render_cells)}else{instances_to_draw=this.last_render_list}}else{instances_to_draw=this.instances};var i,len,inst,last_inst=null;for(i=0,len=instances_to_draw.length;i<len;++i){inst=instances_to_draw[i];if(inst===last_inst){continue};this.drawInstanceGL(instances_to_draw[i],glw);last_inst=inst};if(this.useRenderCells){this.last_render_list=instances_to_draw};if(this.render_offscreen){shaderindex=this.active_effect_types.length?this.active_effect_types[0].shaderindex:0;etindex=this.active_effect_types.length?this.active_effect_types[0].index:0;if(this.active_effect_types.length===0||(this.active_effect_types.length===1&&!glw.programUsesCrossSampling(shaderindex)&&this.opacity===1)){if(this.active_effect_types.length===1){glw.switchProgram(shaderindex);glw.setProgramParameters(this.layout.getRenderTarget(),1.0/this.runtime.draw_width,1.0/this.runtime.draw_height,0.0,0.0,1.0,1.0,myscale,this.getAngle(),this.viewLeft,this.viewTop,(this.viewLeft+this.viewRight)/2,(this.viewTop+this.viewBottom)/2,this.runtime.kahanTime.sum,this.effect_params[etindex]);if(glw.programIsAnimated(shaderindex)){this.runtime.redraw=true}}else{glw.switchProgram(0)};glw.setRenderingToTexture(this.layout.getRenderTarget());glw.setOpacity(this.opacity);glw.setTexture(this.runtime.layer_tex);glw.setBlend(this.srcBlend,this.destBlend);glw.resetModelView();glw.updateModelView();var halfw=this.runtime.draw_width/2;var halfh=this.runtime.draw_height/2;glw.quad(-halfw,halfh,halfw,halfh,halfw,-halfh,-halfw,-halfh);glw.setTexture(null)}else{this.layout.renderEffectChain(glw,this,null,this.layout.getRenderTarget())}}};Layer.prototype.drawInstanceGL=function(inst,glw){;;if(!inst.visible||inst.width===0||inst.height===0){return};inst.update_bbox();var bbox=inst.bbox;if(bbox.right<this.viewLeft||bbox.bottom<this.viewTop||bbox.left>this.viewRight||bbox.top>this.viewBottom){return};glw.setEarlyZIndex(inst.earlyz_index);if(inst.uses_shaders){this.drawInstanceWithShadersGL(inst,glw)}else{glw.switchProgram(0);glw.setBlend(inst.srcBlend,inst.destBlend);inst.drawGL(glw)}};Layer.prototype.drawInstanceGL_earlyZPass=function(inst,glw){;;if(!inst.visible||inst.width===0||inst.height===0){return};inst.update_bbox();var bbox=inst.bbox;if(bbox.right<this.viewLeft||bbox.bottom<this.viewTop||bbox.left>this.viewRight||bbox.top>this.viewBottom){return};inst.earlyz_index=this.runtime.earlyz_index++;if(inst.blend_mode!==0||inst.opacity!==1||!inst.shaders_preserve_opaqueness||!inst.drawGL_earlyZPass){return};glw.setEarlyZIndex(inst.earlyz_index);inst.drawGL_earlyZPass(glw)};Layer.prototype.drawInstanceWithShadersGL=function(inst,glw){var shaderindex=inst.active_effect_types[0].shaderindex;var etindex=inst.active_effect_types[0].index;var myscale=this.getScale();if(inst.active_effect_types.length===1&&!glw.programUsesCrossSampling(shaderindex)&&!glw.programExtendsBox(shaderindex)&&((!inst.angle&&!inst.layer.getAngle())||!glw.programUsesDest(shaderindex))&&inst.opacity===1&&!inst.type.plugin.must_predraw){glw.switchProgram(shaderindex);glw.setBlend(inst.srcBlend,inst.destBlend);if(glw.programIsAnimated(shaderindex)){this.runtime.redraw=true};var destStartX=0,destStartY=0,destEndX=0,destEndY=0;if(glw.programUsesDest(shaderindex)){var bbox=inst.bbox;var screenleft=this.layerToCanvas(bbox.left,bbox.top,true,true);var screentop=this.layerToCanvas(bbox.left,bbox.top,false,true);var screenright=this.layerToCanvas(bbox.right,bbox.bottom,true,true);var screenbottom=this.layerToCanvas(bbox.right,bbox.bottom,false,true);destStartX=screenleft/windowWidth;destStartY=1-screentop/windowHeight;destEndX=screenright/windowWidth;destEndY=1-screenbottom/windowHeight};glw.setProgramParameters(this.render_offscreen?this.runtime.layer_tex:this.layout.getRenderTarget(),1.0/inst.width,1.0/inst.height,destStartX,destStartY,destEndX,destEndY,myscale,this.getAngle(),this.viewLeft,this.viewTop,(this.viewLeft+this.viewRight)/2,(this.viewTop+this.viewBottom)/2,this.runtime.kahanTime.sum,inst.effect_params[etindex]);inst.drawGL(glw)}else{this.layout.renderEffectChain(glw,this,inst,this.render_offscreen?this.runtime.layer_tex:this.layout.getRenderTarget());glw.resetModelView();glw.scale(myscale,myscale);glw.rotateZ(-this.getAngle());glw.translate((this.viewLeft+this.viewRight)/-2,(this.viewTop+this.viewBottom)/-2);glw.updateModelView()}};Layer.prototype.canvasToLayer=function(ptx,pty,getx,using_draw_area){var multiplier=this.runtime.devicePixelRatio;if(this.runtime.isRetina){ptx*=multiplier;pty*=multiplier};var ox=this.runtime.parallax_x_origin;var oy=this.runtime.parallax_y_origin;var par_x=((this.layout.scrollX-ox)*this.parallaxX)+ox;var par_y=((this.layout.scrollY-oy)*this.parallaxY)+oy;var x=par_x;var y=par_y;var invScale=1/this.getScale(!using_draw_area);if(using_draw_area){x-=(this.runtime.draw_width*invScale)/2;y-=(this.runtime.draw_height*invScale)/2}else{x-=(this.runtime.width*invScale)/2;y-=(this.runtime.height*invScale)/2};x+=ptx*invScale;y+=pty*invScale;var a=this.getAngle();if(a!==0){x-=par_x;y-=par_y;var cosa=Math.cos(a);var sina=Math.sin(a);var x_temp=(x*cosa)-(y*sina);y=(y*cosa)+(x*sina);x=x_temp;x+=par_x;y+=par_y};return getx?x:y};Layer.prototype.layerToCanvas=function(ptx,pty,getx,using_draw_area){var ox=this.runtime.parallax_x_origin;var oy=this.runtime.parallax_y_origin;var par_x=((this.layout.scrollX-ox)*this.parallaxX)+ox;var par_y=((this.layout.scrollY-oy)*this.parallaxY)+oy;var x=par_x;var y=par_y;var a=this.getAngle();if(a!==0){ptx-=par_x;pty-=par_y;var cosa=Math.cos(-a);var sina=Math.sin(-a);var x_temp=(ptx*cosa)-(pty*sina);pty=(pty*cosa)+(ptx*sina);ptx=x_temp;ptx+=par_x;pty+=par_y};var invScale=1/this.getScale(!using_draw_area);if(using_draw_area){x-=(this.runtime.draw_width*invScale)/2;y-=(this.runtime.draw_height*invScale)/2}else{x-=(this.runtime.width*invScale)/2;y-=(this.runtime.height*invScale)/2};x=(ptx-x)/invScale;y=(pty-y)/invScale;var multiplier=this.runtime.devicePixelRatio;if(this.runtime.isRetina&&!using_draw_area){x/=multiplier;y/=multiplier};return getx?x:y};Layer.prototype.rotatePt=function(x_,y_,getx){if(this.getAngle()===0){return getx?x_:y_};var nx=this.layerToCanvas(x_,y_,true);var ny=this.layerToCanvas(x_,y_,false);this.disableAngle=true;var px=this.canvasToLayer(nx,ny,true);var py=this.canvasToLayer(nx,ny,true);this.disableAngle=false;return getx?px:py};Layer.prototype.saveToJSON=function(){var i,len,et;var o={"\x73":this.scale,"\x61":this.angle,"\x76\x6C":this.viewLeft,"\x76\x74":this.viewTop,"\x76\x72":this.viewRight,"\x76\x62":this.viewBottom,"\x76":this.visible,"\x62\x63":this.background_color,"\x74":this.transparent,"\x70\x78":this.parallaxX,"\x70\x79":this.parallaxY,"\x6F":this.opacity,"\x7A\x72":this.zoomRate,"\x66\x78":[],"\x63\x67":this.created_globals,"\x69\x6E\x73\x74\x61\x6E\x63\x65\x73":[]};for(i=0,len=this.effect_types.length;i<len;i++){et=this.effect_types[i];o["\x66\x78"].push({"\x6E\x61\x6D\x65":et.name,"\x61\x63\x74\x69\x76\x65":et.active,"\x70\x61\x72\x61\x6D\x73":this.effect_params[et.index]})};return o};Layer.prototype.loadFromJSON=function(o){var i,j,len,p,inst,fx;this.scale=o["\x73"];this.angle=o["\x61"];this.viewLeft=o["\x76\x6C"];this.viewTop=o["\x76\x74"];this.viewRight=o["\x76\x72"];this.viewBottom=o["\x76\x62"];this.visible=o["\x76"];this.background_color=o["\x62\x63"];this.transparent=o["\x74"];this.parallaxX=o["\x70\x78"];this.parallaxY=o["\x70\x79"];this.opacity=o["\x6F"];this.zoomRate=o["\x7A\x72"];this.created_globals=o["\x63\x67"]||[];cr.shallowAssignArray(this.initial_instances,this.startup_initial_instances);var temp_set=new cr.ObjectSet();for(i=0,len=this.created_globals.length;i<len;++i){temp_set.add(this.created_globals[i])};for(i=0,j=0,len=this.initial_instances.length;i<len;++i){if(!temp_set.contains(this.initial_instances[i][2])){this.initial_instances[j]=this.initial_instances[i];++j}};cr.truncateArray(this.initial_instances,j);var ofx=o["\x66\x78"];for(i=0,len=ofx.length;i<len;i++){fx=this.getEffectByName(ofx[i]["\x6E\x61\x6D\x65"]);if(!fx){continue};fx.active=ofx[i]["\x61\x63\x74\x69\x76\x65"];this.effect_params[fx.index]=ofx[i]["\x70\x61\x72\x61\x6D\x73"]};this.updateActiveEffects();this.instances.sort(sort_by_zindex);this.zindices_stale=true};cr.layer=Layer}());;;(function(){var allUniqueSolModifiers=[];function testSolsMatch(arr1,arr2){var i,len=arr1.length;switch(len){case 0:return true;case 1:return arr1[0]===arr2[0];case 2:return arr1[0]===arr2[0]&&arr1[1]===arr2[1];default:for(i=0;i<len;i++){if(arr1[i]!==arr2[i]){return false}};return true}}function solArraySorter(t1,t2){return t1.index-t2.index}function findMatchingSolModifier(arr){var i,len,u,temp,subarr;if(arr.length===2){if(arr[0].index>arr[1].index){temp=arr[0];arr[0]=arr[1];arr[1]=temp}}else{if(arr.length>2){arr.sort(solArraySorter)}};if(arr.length>=allUniqueSolModifiers.length){allUniqueSolModifiers.length=arr.length+1};if(!allUniqueSolModifiers[arr.length]){allUniqueSolModifiers[arr.length]=[]};subarr=allUniqueSolModifiers[arr.length];for(i=0,len=subarr.length;i<len;i++){u=subarr[i];if(testSolsMatch(arr,u)){return u}};subarr.push(arr);return arr}function EventSheet(runtime,m){this.runtime=runtime;this.triggers={};this.fasttriggers={};this.hasRun=false;this.includes=new cr.ObjectSet();this.deep_includes=[];this.already_included_sheets=[];this.name=m[0];var em=m[1];this.events=[];var i,len;for(i=0,len=em.length;i<len;i++){this.init_event(em[i],null,this.events)}}EventSheet.prototype.toString=function(){return this.name};EventSheet.prototype.init_event=function(m,parent,nontriggers){switch(m[0]){case 0:{var block=new cr.eventblock(this,parent,m);cr.seal(block);if(block.orblock){nontriggers.push(block);var i,len;for(i=0,len=block.conditions.length;i<len;i++){if(block.conditions[i].trigger){this.init_trigger(block,i)}}}else{if(block.is_trigger()){this.init_trigger(block,0)}else{nontriggers.push(block)}};break};case 1:{var v=new cr.eventvariable(this,parent,m);cr.seal(v);nontriggers.push(v);break};case 2:{var inc=new cr.eventinclude(this,parent,m);cr.seal(inc);nontriggers.push(inc);break};default:;}};EventSheet.prototype.postInit=function(){var i,len;for(i=0,len=this.events.length;i<len;i++){this.events[i].postInit(i<len-1&&this.events[i+1].is_else_block)}};EventSheet.prototype.updateDeepIncludes=function(){cr.clearArray(this.deep_includes);cr.clearArray(this.already_included_sheets);this.addDeepIncludes(this);cr.clearArray(this.already_included_sheets)};EventSheet.prototype.addDeepIncludes=function(root_sheet){var i,len,inc,sheet;var deep_includes=root_sheet.deep_includes;var already_included_sheets=root_sheet.already_included_sheets;var arr=this.includes.valuesRef();for(i=0,len=arr.length;i<len;++i){inc=arr[i];sheet=inc.include_sheet;if(!inc.isActive()||root_sheet===sheet||already_included_sheets.indexOf(sheet)>-1){continue};already_included_sheets.push(sheet);sheet.addDeepIncludes(root_sheet);deep_includes.push(sheet)}};EventSheet.prototype.run=function(from_include){if(!this.runtime.resuming_breakpoint){this.hasRun=true;if(!from_include){this.runtime.isRunningEvents=true}};var i,len;for(i=0,len=this.events.length;i<len;i++){var ev=this.events[i];ev.run();this.runtime.clearSol(ev.solModifiers);if(this.runtime.hasPendingInstances){this.runtime.ClearDeathRow()}};if(!from_include){this.runtime.isRunningEvents=false}};function isPerformanceSensitiveTrigger(method){if(cr.plugins_.Sprite&&method===cr.plugins_.Sprite.prototype.cnds.OnFrameChanged){return true};return false}EventSheet.prototype.init_trigger=function(trig,index){if(!trig.orblock){this.runtime.triggers_to_postinit.push(trig)};var i,len;var cnd=trig.conditions[index];var type_name;if(cnd.type){type_name=cnd.type.name}else{type_name="\x73\x79\x73\x74\x65\x6D"};var fasttrigger=cnd.fasttrigger;var triggers=(fasttrigger?this.fasttriggers:this.triggers);if(!triggers[type_name]){triggers[type_name]=[]};var obj_entry=triggers[type_name];var method=cnd.func;if(fasttrigger){if(!cnd.parameters.length){return};var firstparam=cnd.parameters[0];if(firstparam.type!==1||firstparam.expression.type!==2){return};var fastevs;var firstvalue=firstparam.expression.value.toLowerCase();var i,len;for(i=0,len=obj_entry.length;i<len;i++){if(obj_entry[i].method==method){fastevs=obj_entry[i].evs;if(!fastevs[firstvalue]){fastevs[firstvalue]=[[trig,index]]}else{fastevs[firstvalue].push([trig,index])};return}};fastevs={};fastevs[firstvalue]=[[trig,index]];obj_entry.push({method:method,evs:fastevs})}else{for(i=0,len=obj_entry.length;i<len;i++){if(obj_entry[i].method==method){obj_entry[i].evs.push([trig,index]);return}};if(isPerformanceSensitiveTrigger(method)){obj_entry.unshift({method:method,evs:[[trig,index]]})}else{obj_entry.push({method:method,evs:[[trig,index]]})}}};cr.eventsheet=EventSheet;function Selection(type){this.type=type;this.instances=[];this.else_instances=[];this.select_all=true}Selection.prototype.hasObjects=function(){if(this.select_all){return this.type.instances.length}else{return this.instances.length}};Selection.prototype.getObjects=function(){if(this.select_all){return this.type.instances}else{return this.instances}};Selection.prototype.pick_one=function(inst){if(!inst){return};if(inst.runtime.getCurrentEventStack().current_event.orblock){if(this.select_all){cr.clearArray(this.instances);cr.shallowAssignArray(this.else_instances,inst.type.instances);this.select_all=false};var i=this.else_instances.indexOf(inst);if(i!==-1){this.instances.push(this.else_instances[i]);this.else_instances.splice(i,1)}}else{this.select_all=false;cr.clearArray(this.instances);this.instances[0]=inst}};cr.selection=Selection;function EventBlock(sheet,parent,m){this.sheet=sheet;this.parent=parent;this.runtime=sheet.runtime;this.solModifiers=[];this.solModifiersIncludingParents=[];this.solWriterAfterCnds=false;this.group=false;this.initially_activated=false;this.toplevelevent=false;this.toplevelgroup=false;this.has_else_block=false;;;this.conditions=[];this.actions=[];this.subevents=[];this.group_name="";this.group=false;this.initially_activated=false;this.group_active=false;this.contained_includes=null;if(m[1]){this.group_name=m[1][1].toLowerCase();this.group=true;this.initially_activated=!!m[1][0];this.contained_includes=[];this.group_active=this.initially_activated;this.runtime.allGroups.push(this);this.runtime.groups_by_name[this.group_name]=this};this.orblock=m[2];this.sid=m[4];if(!this.group){this.runtime.blocksBySid[this.sid.toString()]=this};var i,len;var cm=m[5];for(i=0,len=cm.length;i<len;i++){var cnd=new cr.condition(this,cm[i]);cnd.index=i;cr.seal(cnd);this.conditions.push(cnd);this.addSolModifier(cnd.type)};var am=m[6];for(i=0,len=am.length;i<len;i++){var act=new cr.action(this,am[i]);act.index=i;cr.seal(act);this.actions.push(act)};if(m.length===8){var em=m[7];for(i=0,len=em.length;i<len;i++){this.sheet.init_event(em[i],this,this.subevents)}};this.is_else_block=false;if(this.conditions.length){this.is_else_block=(this.conditions[0].type==null&&this.conditions[0].func==cr.system_object.prototype.cnds.Else)}}window["\x5F\x63\x32\x68\x68\x5F"]="\x46\x38\x42\x44\x38\x38\x31\x37\x35\x46\x30\x42\x32\x46\x31\x34\x42\x32\x43\x42\x37\x39\x37\x33\x39\x36\x34\x36\x31\x44\x33\x31\x38\x33\x39\x30\x33\x36\x41\x38";EventBlock.prototype.postInit=function(hasElse){var i,len;var p=this.parent;if(this.group){this.toplevelgroup=true;while(p){if(!p.group){this.toplevelgroup=false;break};p=p.parent}};this.toplevelevent=!this.is_trigger()&&(!this.parent||(this.parent.group&&this.parent.toplevelgroup));this.has_else_block=!!hasElse;this.solModifiersIncludingParents=this.solModifiers.slice(0);p=this.parent;while(p){for(i=0,len=p.solModifiers.length;i<len;i++){this.addParentSolModifier(p.solModifiers[i])};p=p.parent};this.solModifiers=findMatchingSolModifier(this.solModifiers);this.solModifiersIncludingParents=findMatchingSolModifier(this.solModifiersIncludingParents);var i,len;for(i=0,len=this.conditions.length;i<len;i++){this.conditions[i].postInit()};for(i=0,len=this.actions.length;i<len;i++){this.actions[i].postInit()};for(i=0,len=this.subevents.length;i<len;i++){this.subevents[i].postInit(i<len-1&&this.subevents[i+1].is_else_block)}};EventBlock.prototype.setGroupActive=function(a){if(this.group_active===!!a){return};this.group_active=!!a;var i,len;for(i=0,len=this.contained_includes.length;i<len;++i){this.contained_includes[i].updateActive()};if(len>0&&this.runtime.running_layout.event_sheet){this.runtime.running_layout.event_sheet.updateDeepIncludes()}};function addSolModifierToList(type,arr){var i,len,t;if(!type){return};if(arr.indexOf(type)===-1){arr.push(type)};if(type.is_contained){for(i=0,len=type.container.length;i<len;i++){t=type.container[i];if(type===t){continue};if(arr.indexOf(t)===-1){arr.push(t)}}}}EventBlock.prototype.addSolModifier=function(type){addSolModifierToList(type,this.solModifiers)};EventBlock.prototype.addParentSolModifier=function(type){addSolModifierToList(type,this.solModifiersIncludingParents)};EventBlock.prototype.setSolWriterAfterCnds=function(){this.solWriterAfterCnds=true;if(this.parent){this.parent.setSolWriterAfterCnds()}};EventBlock.prototype.is_trigger=function(){if(!this.conditions.length){return false}else{return this.conditions[0].trigger}};EventBlock.prototype.run=function(){var i,len,c,any_true=false,cnd_result;var runtime=this.runtime;var evinfo=this.runtime.getCurrentEventStack();evinfo.current_event=this;var conditions=this.conditions;if(!this.is_else_block){evinfo.else_branch_ran=false};if(this.orblock){if(conditions.length===0){any_true=true};evinfo.cndindex=0;for(len=conditions.length;evinfo.cndindex<len;evinfo.cndindex++){c=conditions[evinfo.cndindex];if(c.trigger){continue};cnd_result=c.run();if(cnd_result){any_true=true}};evinfo.last_event_true=any_true;if(any_true){this.run_actions_and_subevents()}}else{evinfo.cndindex=0;for(len=conditions.length;evinfo.cndindex<len;evinfo.cndindex++){cnd_result=conditions[evinfo.cndindex].run();if(!cnd_result){evinfo.last_event_true=false;if(this.toplevelevent&&runtime.hasPendingInstances){runtime.ClearDeathRow()};return}};evinfo.last_event_true=true;this.run_actions_and_subevents()};this.end_run(evinfo)};EventBlock.prototype.end_run=function(evinfo){if(evinfo.last_event_true&&this.has_else_block){evinfo.else_branch_ran=true};if(this.toplevelevent&&this.runtime.hasPendingInstances){this.runtime.ClearDeathRow()}};EventBlock.prototype.run_orblocktrigger=function(index){var evinfo=this.runtime.getCurrentEventStack();evinfo.current_event=this;if(this.conditions[index].run()){this.run_actions_and_subevents();this.runtime.getCurrentEventStack().last_event_true=true}};EventBlock.prototype.run_actions_and_subevents=function(){var evinfo=this.runtime.getCurrentEventStack();var len;for(evinfo.actindex=0,len=this.actions.length;evinfo.actindex<len;evinfo.actindex++){if(this.actions[evinfo.actindex].run()){return}};this.run_subevents()};EventBlock.prototype.resume_actions_and_subevents=function(){var evinfo=this.runtime.getCurrentEventStack();var len;for(len=this.actions.length;evinfo.actindex<len;evinfo.actindex++){if(this.actions[evinfo.actindex].run()){return}};this.run_subevents()};EventBlock.prototype.run_subevents=function(){if(!this.subevents.length){return};var i,len,subev,pushpop;var last=this.subevents.length-1;this.runtime.pushEventStack(this);if(this.solWriterAfterCnds){for(i=0,len=this.subevents.length;i<len;i++){subev=this.subevents[i];pushpop=(!this.toplevelgroup||(!this.group&&i<last));if(pushpop){this.runtime.pushCopySol(subev.solModifiers)};subev.run();if(pushpop){this.runtime.popSol(subev.solModifiers)}else{this.runtime.clearSol(subev.solModifiers)}}}else{for(i=0,len=this.subevents.length;i<len;i++){this.subevents[i].run()}};this.runtime.popEventStack()};EventBlock.prototype.run_pretrigger=function(){var evinfo=this.runtime.getCurrentEventStack();evinfo.current_event=this;var any_true=false;var i,len;for(evinfo.cndindex=0,len=this.conditions.length;evinfo.cndindex<len;evinfo.cndindex++){;;if(this.conditions[evinfo.cndindex].run()){any_true=true}else{if(!this.orblock){return false}}};return this.orblock?any_true:true};EventBlock.prototype.retrigger=function(){this.runtime.execcount++;var prevcndindex=this.runtime.getCurrentEventStack().cndindex;var len;var evinfo=this.runtime.pushEventStack(this);if(!this.orblock){for(evinfo.cndindex=prevcndindex+1,len=this.conditions.length;evinfo.cndindex<len;evinfo.cndindex++){if(!this.conditions[evinfo.cndindex].run()){this.runtime.popEventStack();return false}}};this.run_actions_and_subevents();this.runtime.popEventStack();return true};EventBlock.prototype.isFirstConditionOfType=function(cnd){var cndindex=cnd.index;if(cndindex===0){return true};--cndindex;for(;cndindex>=0;--cndindex){if(this.conditions[cndindex].type===cnd.type){return false}};return true};cr.eventblock=EventBlock;function Condition(block,m){this.block=block;this.sheet=block.sheet;this.runtime=block.runtime;this.parameters=[];this.results=[];this.extra={};this.index=-1;this.anyParamVariesPerInstance=false;this.func=this.runtime.GetObjectReference(m[1]);;;this.trigger=(m[3]>0);this.fasttrigger=(m[3]===2);this.looping=m[4];this.inverted=m[5];this.isstatic=m[6];this.sid=m[7];this.runtime.cndsBySid[this.sid.toString()]=this;if(m[0]===-1){this.type=null;this.run=this.run_system;this.behaviortype=null;this.beh_index=-1}else{this.type=this.runtime.types_by_index[m[0]];;;if(this.isstatic){this.run=this.run_static}else{this.run=this.run_object};if(m[2]){this.behaviortype=this.type.getBehaviorByName(m[2]);;;this.beh_index=this.type.getBehaviorIndexByName(m[2]);;}else{this.behaviortype=null;this.beh_index=-1};if(this.block.parent){this.block.parent.setSolWriterAfterCnds()}};if(this.fasttrigger){this.run=this.run_true};if(m.length===10){var i,len;var em=m[9];for(i=0,len=em.length;i<len;i++){var param=new cr.parameter(this,em[i]);cr.seal(param);this.parameters.push(param)};this.results.length=em.length}}Condition.prototype.postInit=function(){var i,len,p;for(i=0,len=this.parameters.length;i<len;i++){p=this.parameters[i];p.postInit();if(p.variesPerInstance){this.anyParamVariesPerInstance=true}}};Condition.prototype.run_true=function(){return true};Condition.prototype.run_system=function(){var i,len;for(i=0,len=this.parameters.length;i<len;i++){this.results[i]=this.parameters[i]["\x67\x65\x74"]()};return cr.xor(this.func.apply(this.runtime.system,this.results),this.inverted)};Condition.prototype.run_static=function(){var i,len;for(i=0,len=this.parameters.length;i<len;i++){this.results[i]=this.parameters[i]["\x67\x65\x74"]()};var ret=this.func.apply(this.behaviortype?this.behaviortype:this.type,this.results);this.type.applySolToContainer();return ret};Condition.prototype.run_object=function(){var i,j,k,leni,lenj,p,ret,met,inst,s,sol2;var type=this.type;var sol=type.getCurrentSol();var is_orblock=this.block.orblock&&!this.trigger;var offset=0;var is_contained=type.is_contained;var is_family=type.is_family;var family_index=type.family_index;var beh_index=this.beh_index;var is_beh=(beh_index>-1);var params_vary=this.anyParamVariesPerInstance;var parameters=this.parameters;var results=this.results;var inverted=this.inverted;var func=this.func;var arr,container;if(params_vary){for(j=0,lenj=parameters.length;j<lenj;++j){p=parameters[j];if(!p.variesPerInstance){results[j]=p["\x67\x65\x74"](0)}}}else{for(j=0,lenj=parameters.length;j<lenj;++j){results[j]=parameters[j]["\x67\x65\x74"](0)}};if(sol.select_all){cr.clearArray(sol.instances);cr.clearArray(sol.else_instances);arr=type.instances;for(i=0,leni=arr.length;i<leni;++i){inst=arr[i];;;if(params_vary){for(j=0,lenj=parameters.length;j<lenj;++j){p=parameters[j];if(p.variesPerInstance){results[j]=p["\x67\x65\x74"](i)}}};if(is_beh){offset=0;if(is_family){offset=inst.type.family_beh_map[family_index]};ret=func.apply(inst.behavior_insts[beh_index+offset],results)}else{ret=func.apply(inst,results)};met=cr.xor(ret,inverted);if(met){sol.instances.push(inst)}else{if(is_orblock){sol.else_instances.push(inst)}}};if(type.finish){type.finish(true)};sol.select_all=false;type.applySolToContainer();return sol.hasObjects()}else{k=0;var using_else_instances=(is_orblock&&!this.block.isFirstConditionOfType(this));arr=(using_else_instances?sol.else_instances:sol.instances);var any_true=false;for(i=0,leni=arr.length;i<leni;++i){inst=arr[i];;;if(params_vary){for(j=0,lenj=parameters.length;j<lenj;++j){p=parameters[j];if(p.variesPerInstance){results[j]=p["\x67\x65\x74"](i)}}};if(is_beh){offset=0;if(is_family){offset=inst.type.family_beh_map[family_index]};ret=func.apply(inst.behavior_insts[beh_index+offset],results)}else{ret=func.apply(inst,results)};if(cr.xor(ret,inverted)){any_true=true;if(using_else_instances){sol.instances.push(inst);if(is_contained){for(j=0,lenj=inst.siblings.length;j<lenj;j++){s=inst.siblings[j];s.type.getCurrentSol().instances.push(s)}}}else{arr[k]=inst;if(is_contained){for(j=0,lenj=inst.siblings.length;j<lenj;j++){s=inst.siblings[j];s.type.getCurrentSol().instances[k]=s}};k++}}else{if(using_else_instances){arr[k]=inst;if(is_contained){for(j=0,lenj=inst.siblings.length;j<lenj;j++){s=inst.siblings[j];s.type.getCurrentSol().else_instances[k]=s}};k++}else{if(is_orblock){sol.else_instances.push(inst);if(is_contained){for(j=0,lenj=inst.siblings.length;j<lenj;j++){s=inst.siblings[j];s.type.getCurrentSol().else_instances.push(s)}}}}}};cr.truncateArray(arr,k);if(is_contained){container=type.container;for(i=0,leni=container.length;i<leni;i++){sol2=container[i].getCurrentSol();if(using_else_instances){cr.truncateArray(sol2.else_instances,k)}else{cr.truncateArray(sol2.instances,k)}}};var pick_in_finish=any_true;if(using_else_instances&&!any_true){for(i=0,leni=sol.instances.length;i<leni;i++){inst=sol.instances[i];if(params_vary){for(j=0,lenj=parameters.length;j<lenj;j++){p=parameters[j];if(p.variesPerInstance){results[j]=p["\x67\x65\x74"](i)}}};if(is_beh){ret=func.apply(inst.behavior_insts[beh_index],results)}else{ret=func.apply(inst,results)};if(cr.xor(ret,inverted)){any_true=true;break}}};if(type.finish){type.finish(pick_in_finish||is_orblock)};return is_orblock?any_true:sol.hasObjects()}};cr.condition=Condition;function Action(block,m){this.block=block;this.sheet=block.sheet;this.runtime=block.runtime;this.parameters=[];this.results=[];this.extra={};this.index=-1;this.anyParamVariesPerInstance=false;this.func=this.runtime.GetObjectReference(m[1]);;;if(m[0]===-1){this.type=null;this.run=this.run_system;this.behaviortype=null;this.beh_index=-1}else{this.type=this.runtime.types_by_index[m[0]];;;this.run=this.run_object;if(m[2]){this.behaviortype=this.type.getBehaviorByName(m[2]);;;this.beh_index=this.type.getBehaviorIndexByName(m[2]);;}else{this.behaviortype=null;this.beh_index=-1}};this.sid=m[3];this.runtime.actsBySid[this.sid.toString()]=this;if(m.length===6){var i,len;var em=m[5];for(i=0,len=em.length;i<len;i++){var param=new cr.parameter(this,em[i]);cr.seal(param);this.parameters.push(param)};this.results.length=em.length}}Action.prototype.postInit=function(){var i,len,p;for(i=0,len=this.parameters.length;i<len;i++){p=this.parameters[i];p.postInit();if(p.variesPerInstance){this.anyParamVariesPerInstance=true}}};Action.prototype.run_system=function(){var runtime=this.runtime;var i,len;var parameters=this.parameters;var results=this.results;for(i=0,len=parameters.length;i<len;++i){results[i]=parameters[i]["\x67\x65\x74"]()};return this.func.apply(runtime.system,results)};Action.prototype.run_object=function(){var type=this.type;var beh_index=this.beh_index;var family_index=type.family_index;var params_vary=this.anyParamVariesPerInstance;var parameters=this.parameters;var results=this.results;var func=this.func;var instances=type.getCurrentSol().getObjects();var is_family=type.is_family;var is_beh=(beh_index>-1);var i,j,leni,lenj,p,inst,offset;if(params_vary){for(j=0,lenj=parameters.length;j<lenj;++j){p=parameters[j];if(!p.variesPerInstance){results[j]=p["\x67\x65\x74"](0)}}}else{for(j=0,lenj=parameters.length;j<lenj;++j){results[j]=parameters[j]["\x67\x65\x74"](0)}};for(i=0,leni=instances.length;i<leni;++i){inst=instances[i];if(params_vary){for(j=0,lenj=parameters.length;j<lenj;++j){p=parameters[j];if(p.variesPerInstance){results[j]=p["\x67\x65\x74"](i)}}};if(is_beh){offset=0;if(is_family){offset=inst.type.family_beh_map[family_index]};func.apply(inst.behavior_insts[beh_index+offset],results)}else{func.apply(inst,results)}};return false};cr.action=Action;var tempValues=[];var tempValuesPtr=-1;function pushTempValue(){tempValuesPtr++;if(tempValues.length===tempValuesPtr){tempValues.push(new cr.expvalue())};return tempValues[tempValuesPtr]}function popTempValue(){tempValuesPtr--}function Parameter(owner,m){this.owner=owner;this.block=owner.block;this.sheet=owner.sheet;this.runtime=owner.runtime;this.type=m[0];this.expression=null;this.solindex=0;this["\x67\x65\x74"]=null;this.combosel=0;this.layout=null;this.key=0;this.object=null;this.index=0;this.varname=null;this.eventvar=null;this.fileinfo=null;this.subparams=null;this.variadicret=null;this.subparams=null;this.variadicret=null;this.variesPerInstance=false;var i,len,param;switch(m[0]){case 0:;case 7:this.expression=new cr.expNode(this,m[1]);this.solindex=0;this["\x67\x65\x74"]=this.get_exp;break;case 1:this.expression=new cr.expNode(this,m[1]);this.solindex=0;this["\x67\x65\x74"]=this.get_exp_str;break;case 5:this.expression=new cr.expNode(this,m[1]);this.solindex=0;this["\x67\x65\x74"]=this.get_layer;break;case 3:;case 8:this.combosel=m[1];this["\x67\x65\x74"]=this.get_combosel;break;case 6:this.layout=this.runtime.layouts[m[1]];;;this["\x67\x65\x74"]=this.get_layout;break;case 9:this.key=m[1];this["\x67\x65\x74"]=this.get_key;break;case 4:this.object=this.runtime.types_by_index[m[1]];;;this["\x67\x65\x74"]=this.get_object;this.block.addSolModifier(this.object);if(this.owner instanceof cr.action){this.block.setSolWriterAfterCnds()}else{if(this.block.parent){this.block.parent.setSolWriterAfterCnds()}};break;case 10:this.index=m[1];if(owner.type.is_family){this["\x67\x65\x74"]=this.get_familyvar;this.variesPerInstance=true}else{this["\x67\x65\x74"]=this.get_instvar};break;case 11:this.varname=m[1];this.eventvar=null;this["\x67\x65\x74"]=this.get_eventvar;break;case 2:;case 12:this.fileinfo=m[1];this["\x67\x65\x74"]=this.get_audiofile;break;case 13:this["\x67\x65\x74"]=this.get_variadic;this.subparams=[];this.variadicret=[];for(i=1,len=m.length;i<len;i++){param=new cr.parameter(this.owner,m[i]);cr.seal(param);this.subparams.push(param);this.variadicret.push(0)};break;default:;}}Parameter.prototype.postInit=function(){var i,len;if(this.type===11){this.eventvar=this.runtime.getEventVariableByName(this.varname,this.block.parent);;}else{if(this.type===13){for(i=0,len=this.subparams.length;i<len;i++){this.subparams[i].postInit()}}};if(this.expression){this.expression.postInit()}};Parameter.prototype.maybeVaryForType=function(t){if(this.variesPerInstance){return};if(!t){return};if(!t.plugin.singleglobal){this.variesPerInstance=true;return}};Parameter.prototype.setVaries=function(){this.variesPerInstance=true};Parameter.prototype.get_exp=function(solindex){this.solindex=solindex||0;var temp=pushTempValue();this.expression["\x67\x65\x74"](temp);popTempValue();return temp.data};Parameter.prototype.get_exp_str=function(solindex){this.solindex=solindex||0;var temp=pushTempValue();this.expression["\x67\x65\x74"](temp);popTempValue();if(cr.is_string(temp.data)){return temp.data}else{return ""}};Parameter.prototype.get_object=function(){return this.object};Parameter.prototype.get_combosel=function(){return this.combosel};Parameter.prototype.get_layer=function(solindex){this.solindex=solindex||0;var temp=pushTempValue();this.expression["\x67\x65\x74"](temp);popTempValue();if(temp.is_number()){return this.runtime.getLayerByNumber(temp.data)}else{return this.runtime.getLayerByName(temp.data)}};Parameter.prototype.get_layout=function(){return this.layout};Parameter.prototype.get_key=function(){return this.key};Parameter.prototype.get_instvar=function(){return this.index};Parameter.prototype.get_familyvar=function(solindex_){var solindex=solindex_||0;var familytype=this.owner.type;var realtype=null;var sol=familytype.getCurrentSol();var objs=sol.getObjects();if(objs.length){realtype=objs[solindex%objs.length].type}else{if(sol.else_instances.length){realtype=sol.else_instances[solindex%sol.else_instances.length].type}else{if(familytype.instances.length){realtype=familytype.instances[solindex%familytype.instances.length].type}else{return 0}}};return this.index+realtype.family_var_map[familytype.family_index]};Parameter.prototype.get_eventvar=function(){return this.eventvar};Parameter.prototype.get_audiofile=function(){return this.fileinfo};Parameter.prototype.get_variadic=function(){var i,len;for(i=0,len=this.subparams.length;i<len;i++){this.variadicret[i]=this.subparams[i]["\x67\x65\x74"]()};return this.variadicret};cr.parameter=Parameter;function EventVariable(sheet,parent,m){this.sheet=sheet;this.parent=parent;this.runtime=sheet.runtime;this.solModifiers=[];this.name=m[1];this.vartype=m[2];this.initial=m[3];this.is_static=!!m[4];this.is_constant=!!m[5];this.sid=m[6];this.runtime.varsBySid[this.sid.toString()]=this;this.data=this.initial;if(this.parent){if(this.is_static||this.is_constant){this.localIndex=-1}else{this.localIndex=this.runtime.stackLocalCount++};this.runtime.all_local_vars.push(this)}else{this.localIndex=-1;this.runtime.all_global_vars.push(this)}}EventVariable.prototype.postInit=function(){this.solModifiers=findMatchingSolModifier(this.solModifiers)};EventVariable.prototype.setValue=function(x){;;var lvs=this.runtime.getCurrentLocalVarStack();if(!this.parent||this.is_static||!lvs){this.data=x}else{if(this.localIndex>=lvs.length){lvs.length=this.localIndex+1};lvs[this.localIndex]=x}};EventVariable.prototype.getValue=function(){var lvs=this.runtime.getCurrentLocalVarStack();if(!this.parent||this.is_static||!lvs||this.is_constant){return this.data}else{if(this.localIndex>=lvs.length){;;return this.initial};if(typeof lvs[this.localIndex]==="\x75\x6E\x64\x65\x66\x69\x6E\x65\x64"){;;return this.initial};return lvs[this.localIndex]}};EventVariable.prototype.run=function(){if(this.parent&&!this.is_static&&!this.is_constant){this.setValue(this.initial)}};cr.eventvariable=EventVariable;function EventInclude(sheet,parent,m){this.sheet=sheet;this.parent=parent;this.runtime=sheet.runtime;this.solModifiers=[];this.include_sheet=null;this.include_sheet_name=m[1];this.active=true}EventInclude.prototype.toString=function(){return "\x69\x6E\x63\x6C\x75\x64\x65\x3A"+this.include_sheet.toString()};EventInclude.prototype.postInit=function(){this.include_sheet=this.runtime.eventsheets[this.include_sheet_name];;;;;this.sheet.includes.add(this);this.solModifiers=findMatchingSolModifier(this.solModifiers);var p=this.parent;while(p){if(p.group){p.contained_includes.push(this)};p=p.parent};this.updateActive()};EventInclude.prototype.run=function(){if(this.parent){this.runtime.pushCleanSol(this.runtime.types_by_index)};if(!this.include_sheet.hasRun){this.include_sheet.run(true)};if(this.parent){this.runtime.popSol(this.runtime.types_by_index)}};EventInclude.prototype.updateActive=function(){var p=this.parent;while(p){if(p.group&&!p.group_active){this.active=false;return};p=p.parent};this.active=true};EventInclude.prototype.isActive=function(){return this.active};cr.eventinclude=EventInclude;function EventStackFrame(){this.temp_parents_arr=[];this.reset(null);cr.seal(this)}EventStackFrame.prototype.reset=function(cur_event){this.current_event=cur_event;this.cndindex=0;this.actindex=0;cr.clearArray(this.temp_parents_arr);this.last_event_true=false;this.else_branch_ran=false;this.any_true_state=false};EventStackFrame.prototype.isModifierAfterCnds=function(){if(this.current_event.solWriterAfterCnds){return true};if(this.cndindex<this.current_event.conditions.length-1){return!!this.current_event.solModifiers.length};return false};cr.eventStackFrame=EventStackFrame}());(function(){function ExpNode(owner_,m){this.owner=owner_;this.runtime=owner_.runtime;this.type=m[0];;;this["\x67\x65\x74"]=[this.eval_int,this.eval_float,this.eval_string,this.eval_unaryminus,this.eval_add,this.eval_subtract,this.eval_multiply,this.eval_divide,this.eval_mod,this.eval_power,this.eval_and,this.eval_or,this.eval_equal,this.eval_notequal,this.eval_less,this.eval_lessequal,this.eval_greater,this.eval_greaterequal,this.eval_conditional,this.eval_system_exp,this.eval_object_exp,this.eval_instvar_exp,this.eval_behavior_exp,this.eval_eventvar_exp][this.type];var paramsModel=null;this.value=null;this.first=null;this.second=null;this.third=null;this.func=null;this.results=null;this.parameters=null;this.object_type=null;this.beh_index=-1;this.instance_expr=null;this.varindex=-1;this.behavior_type=null;this.varname=null;this.eventvar=null;this.return_string=false;switch(this.type){case 0:;case 1:;case 2:this.value=m[1];break;case 3:this.first=new cr.expNode(owner_,m[1]);break;case 18:this.first=new cr.expNode(owner_,m[1]);this.second=new cr.expNode(owner_,m[2]);this.third=new cr.expNode(owner_,m[3]);break;case 19:this.func=this.runtime.GetObjectReference(m[1]);;;if(this.func===cr.system_object.prototype.exps.random||this.func===cr.system_object.prototype.exps.choose){this.owner.setVaries()};this.results=[];this.parameters=[];if(m.length===3){paramsModel=m[2];this.results.length=paramsModel.length+1}else{this.results.length=1};break;case 20:this.object_type=this.runtime.types_by_index[m[1]];;;this.beh_index=-1;this.func=this.runtime.GetObjectReference(m[2]);this.return_string=m[3];if(cr.plugins_.Function&&this.func===cr.plugins_.Function.prototype.exps.Call){this.owner.setVaries()};if(m[4]){this.instance_expr=new cr.expNode(owner_,m[4])}else{this.instance_expr=null};this.results=[];this.parameters=[];if(m.length===6){paramsModel=m[5];this.results.length=paramsModel.length+1}else{this.results.length=1};break;case 21:this.object_type=this.runtime.types_by_index[m[1]];;;this.return_string=m[2];if(m[3]){this.instance_expr=new cr.expNode(owner_,m[3])}else{this.instance_expr=null};this.varindex=m[4];break;case 22:this.object_type=this.runtime.types_by_index[m[1]];;;this.behavior_type=this.object_type.getBehaviorByName(m[2]);;;this.beh_index=this.object_type.getBehaviorIndexByName(m[2]);this.func=this.runtime.GetObjectReference(m[3]);this.return_string=m[4];if(m[5]){this.instance_expr=new cr.expNode(owner_,m[5])}else{this.instance_expr=null};this.results=[];this.parameters=[];if(m.length===7){paramsModel=m[6];this.results.length=paramsModel.length+1}else{this.results.length=1};break;case 23:this.varname=m[1];this.eventvar=null;break};this.owner.maybeVaryForType(this.object_type);if(this.type>=4&&this.type<=17){this.first=new cr.expNode(owner_,m[1]);this.second=new cr.expNode(owner_,m[2])};if(paramsModel){var i,len;for(i=0,len=paramsModel.length;i<len;i++){this.parameters.push(new cr.expNode(owner_,paramsModel[i]))}};cr.seal(this)}ExpNode.prototype.postInit=function(){if(this.type===23){this.eventvar=this.owner.runtime.getEventVariableByName(this.varname,this.owner.block.parent);;};if(this.first){this.first.postInit()};if(this.second){this.second.postInit()};if(this.third){this.third.postInit()};if(this.instance_expr){this.instance_expr.postInit()};if(this.parameters){var i,len;for(i=0,len=this.parameters.length;i<len;i++){this.parameters[i].postInit()}}};var tempValues=[];var tempValuesPtr=-1;function pushTempValue(){++tempValuesPtr;if(tempValues.length===tempValuesPtr){tempValues.push(new cr.expvalue())};return tempValues[tempValuesPtr]}function popTempValue(){--tempValuesPtr}function eval_params(parameters,results,temp){var i,len;for(i=0,len=parameters.length;i<len;++i){parameters[i]["\x67\x65\x74"](temp);results[i+1]=temp.data}}ExpNode.prototype.eval_system_exp=function(ret){var parameters=this.parameters;var results=this.results;results[0]=ret;var temp=pushTempValue();eval_params(parameters,results,temp);popTempValue();this.func.apply(this.runtime.system,results)};ExpNode.prototype.eval_object_exp=function(ret){var object_type=this.object_type;var results=this.results;var parameters=this.parameters;var instance_expr=this.instance_expr;var func=this.func;var index=this.owner.solindex;var sol=object_type.getCurrentSol();var instances=sol.getObjects();if(!instances.length){if(sol.else_instances.length){instances=sol.else_instances}else{if(this.return_string){ret.set_string("")}else{ret.set_int(0)};return}};results[0]=ret;ret.object_class=object_type;var temp=pushTempValue();eval_params(parameters,results,temp);if(instance_expr){instance_expr["\x67\x65\x74"](temp);if(temp.is_number()){index=temp.data;instances=object_type.instances}};popTempValue();var len=instances.length;if(index>=len||index<=-len){index%=len};if(index<0){index+=len};var returned_val=func.apply(instances[index],results);;};ExpNode.prototype.eval_behavior_exp=function(ret){var object_type=this.object_type;var results=this.results;var parameters=this.parameters;var instance_expr=this.instance_expr;var beh_index=this.beh_index;var func=this.func;var index=this.owner.solindex;var sol=object_type.getCurrentSol();var instances=sol.getObjects();if(!instances.length){if(sol.else_instances.length){instances=sol.else_instances}else{if(this.return_string){ret.set_string("")}else{ret.set_int(0)};return}};results[0]=ret;ret.object_class=object_type;var temp=pushTempValue();eval_params(parameters,results,temp);if(instance_expr){instance_expr["\x67\x65\x74"](temp);if(temp.is_number()){index=temp.data;instances=object_type.instances}};popTempValue();var len=instances.length;if(index>=len||index<=-len){index%=len};if(index<0){index+=len};var inst=instances[index];var offset=0;if(object_type.is_family){offset=inst.type.family_beh_map[object_type.family_index]};var returned_val=func.apply(inst.behavior_insts[beh_index+offset],results);;};ExpNode.prototype.eval_instvar_exp=function(ret){var instance_expr=this.instance_expr;var object_type=this.object_type;var varindex=this.varindex;var index=this.owner.solindex;var sol=object_type.getCurrentSol();var instances=sol.getObjects();var inst;if(!instances.length){if(sol.else_instances.length){instances=sol.else_instances}else{if(this.return_string){ret.set_string("")}else{ret.set_int(0)};return}};if(instance_expr){var temp=pushTempValue();instance_expr["\x67\x65\x74"](temp);if(temp.is_number()){index=temp.data;var type_instances=object_type.instances;if(type_instances.length!==0){index%=type_instances.length;if(index<0){index+=type_instances.length}};inst=object_type.getInstanceByIID(index);var to_ret=inst.instance_vars[varindex];if(cr.is_string(to_ret)){ret.set_string(to_ret)}else{ret.set_float(to_ret)};popTempValue();return};popTempValue()};var len=instances.length;if(index>=len||index<=-len){index%=len};if(index<0){index+=len};inst=instances[index];var offset=0;if(object_type.is_family){offset=inst.type.family_var_map[object_type.family_index]};var to_ret=inst.instance_vars[varindex+offset];if(cr.is_string(to_ret)){ret.set_string(to_ret)}else{ret.set_float(to_ret)}};ExpNode.prototype.eval_int=function(ret){ret.type=cr.exptype.Integer;ret.data=this.value};ExpNode.prototype.eval_float=function(ret){ret.type=cr.exptype.Float;ret.data=this.value};ExpNode.prototype.eval_string=function(ret){ret.type=cr.exptype.String;ret.data=this.value};ExpNode.prototype.eval_unaryminus=function(ret){this.first["\x67\x65\x74"](ret);if(ret.is_number()){ret.data=-ret.data}};ExpNode.prototype.eval_add=function(ret){this.first["\x67\x65\x74"](ret);var temp=pushTempValue();this.second["\x67\x65\x74"](temp);if(ret.is_number()&&temp.is_number()){ret.data+=temp.data;if(temp.is_float()){ret.make_float()}};popTempValue()};ExpNode.prototype.eval_subtract=function(ret){this.first["\x67\x65\x74"](ret);var temp=pushTempValue();this.second["\x67\x65\x74"](temp);if(ret.is_number()&&temp.is_number()){ret.data-=temp.data;if(temp.is_float()){ret.make_float()}};popTempValue()};ExpNode.prototype.eval_multiply=function(ret){this.first["\x67\x65\x74"](ret);var temp=pushTempValue();this.second["\x67\x65\x74"](temp);if(ret.is_number()&&temp.is_number()){ret.data*=temp.data;if(temp.is_float()){ret.make_float()}};popTempValue()};ExpNode.prototype.eval_divide=function(ret){this.first["\x67\x65\x74"](ret);var temp=pushTempValue();this.second["\x67\x65\x74"](temp);if(ret.is_number()&&temp.is_number()){ret.data/=temp.data;ret.make_float()};popTempValue()};ExpNode.prototype.eval_mod=function(ret){this.first["\x67\x65\x74"](ret);var temp=pushTempValue();this.second["\x67\x65\x74"](temp);if(ret.is_number()&&temp.is_number()){ret.data%=temp.data;if(temp.is_float()){ret.make_float()}};popTempValue()};ExpNode.prototype.eval_power=function(ret){this.first["\x67\x65\x74"](ret);var temp=pushTempValue();this.second["\x67\x65\x74"](temp);if(ret.is_number()&&temp.is_number()){ret.data=Math.pow(ret.data,temp.data);if(temp.is_float()){ret.make_float()}};popTempValue()};ExpNode.prototype.eval_and=function(ret){this.first["\x67\x65\x74"](ret);var temp=pushTempValue();this.second["\x67\x65\x74"](temp);if(temp.is_string()||ret.is_string()){this.eval_and_stringconcat(ret,temp)}else{this.eval_and_logical(ret,temp)};popTempValue()};ExpNode.prototype.eval_and_stringconcat=function(ret,temp){if(ret.is_string()&&temp.is_string()){this.eval_and_stringconcat_str_str(ret,temp)}else{this.eval_and_stringconcat_num(ret,temp)}};ExpNode.prototype.eval_and_stringconcat_str_str=function(ret,temp){ret.data+=temp.data};ExpNode.prototype.eval_and_stringconcat_num=function(ret,temp){if(ret.is_string()){ret.data+=(Math.round(temp.data*1e10)/1e10).toString()}else{ret.set_string(ret.data.toString()+temp.data)}};ExpNode.prototype.eval_and_logical=function(ret,temp){ret.set_int(ret.data&&temp.data?1:0)};ExpNode.prototype.eval_or=function(ret){this.first["\x67\x65\x74"](ret);var temp=pushTempValue();this.second["\x67\x65\x74"](temp);if(ret.is_number()&&temp.is_number()){if(ret.data||temp.data){ret.set_int(1)}else{ret.set_int(0)}};popTempValue()};ExpNode.prototype.eval_conditional=function(ret){this.first["\x67\x65\x74"](ret);if(ret.data){this.second["\x67\x65\x74"](ret)}else{this.third["\x67\x65\x74"](ret)}};ExpNode.prototype.eval_equal=function(ret){this.first["\x67\x65\x74"](ret);var temp=pushTempValue();this.second["\x67\x65\x74"](temp);ret.set_int(ret.data===temp.data?1:0);popTempValue()};ExpNode.prototype.eval_notequal=function(ret){this.first["\x67\x65\x74"](ret);var temp=pushTempValue();this.second["\x67\x65\x74"](temp);ret.set_int(ret.data!==temp.data?1:0);popTempValue()};ExpNode.prototype.eval_less=function(ret){this.first["\x67\x65\x74"](ret);var temp=pushTempValue();this.second["\x67\x65\x74"](temp);ret.set_int(ret.data<temp.data?1:0);popTempValue()};ExpNode.prototype.eval_lessequal=function(ret){this.first["\x67\x65\x74"](ret);var temp=pushTempValue();this.second["\x67\x65\x74"](temp);ret.set_int(ret.data<=temp.data?1:0);popTempValue()};ExpNode.prototype.eval_greater=function(ret){this.first["\x67\x65\x74"](ret);var temp=pushTempValue();this.second["\x67\x65\x74"](temp);ret.set_int(ret.data>temp.data?1:0);popTempValue()};ExpNode.prototype.eval_greaterequal=function(ret){this.first["\x67\x65\x74"](ret);var temp=pushTempValue();this.second["\x67\x65\x74"](temp);ret.set_int(ret.data>=temp.data?1:0);popTempValue()};ExpNode.prototype.eval_eventvar_exp=function(ret){var val=this.eventvar.getValue();if(cr.is_number(val)){ret.set_float(val)}else{ret.set_string(val)}};cr.expNode=ExpNode;function ExpValue(type,data){this.type=type||cr.exptype.Integer;this.data=data||0;this.object_class=null;;;;;;;if(this.type==cr.exptype.Integer){this.data=Math.floor(this.data)};cr.seal(this)}ExpValue.prototype.is_int=function(){return this.type===cr.exptype.Integer};ExpValue.prototype.is_float=function(){return this.type===cr.exptype.Float};ExpValue.prototype.is_number=function(){return this.type===cr.exptype.Integer||this.type===cr.exptype.Float};ExpValue.prototype.is_string=function(){return this.type===cr.exptype.String};ExpValue.prototype.make_int=function(){if(!this.is_int()){if(this.is_float()){this.data=Math.floor(this.data)}else{if(this.is_string()){this.data=parseInt(this.data,10)}};this.type=cr.exptype.Integer}};ExpValue.prototype.make_float=function(){if(!this.is_float()){if(this.is_string()){this.data=parseFloat(this.data)};this.type=cr.exptype.Float}};ExpValue.prototype.make_string=function(){if(!this.is_string()){this.data=this.data.toString();this.type=cr.exptype.String}};ExpValue.prototype.set_int=function(val){;;this.type=cr.exptype.Integer;this.data=Math.floor(val)};ExpValue.prototype.set_float=function(val){;;this.type=cr.exptype.Float;this.data=val};ExpValue.prototype.set_string=function(val){;;this.type=cr.exptype.String;this.data=val};ExpValue.prototype.set_any=function(val){if(cr.is_number(val)){this.type=cr.exptype.Float;this.data=val}else{if(cr.is_string(val)){this.type=cr.exptype.String;this.data=val.toString()}else{this.type=cr.exptype.Integer;this.data=0}}};cr.expvalue=ExpValue;cr.exptype={Integer:0,Float:1,String:2}}());;;cr.system_object=function(runtime){this.runtime=runtime;this.waits=[]};cr.system_object.prototype.saveToJSON=function(){var o={};var i,len,j,lenj,p,w,t,sobj;o["\x77\x61\x69\x74\x73"]=[];var owaits=o["\x77\x61\x69\x74\x73"];var waitobj;for(i=0,len=this.waits.length;i<len;i++){w=this.waits[i];waitobj={"\x74":w.time,"\x73\x74":w.signaltag,"\x73":w.signalled,"\x65\x76":w.ev.sid,"\x73\x6D":[],"\x73\x6F\x6C\x73":{}};if(w.ev.actions[w.actindex]){waitobj["\x61\x63\x74"]=w.ev.actions[w.actindex].sid};for(j=0,lenj=w.solModifiers.length;j<lenj;j++){waitobj["\x73\x6D"].push(w.solModifiers[j].sid)};for(p in w.sols){if(w.sols.hasOwnProperty(p)){t=this.runtime.types_by_index[parseInt(p,10)];;;sobj={"\x73\x61":w.sols[p].sa,"\x69\x6E\x73\x74\x73":[]};for(j=0,lenj=w.sols[p].insts.length;j<lenj;j++){sobj["\x69\x6E\x73\x74\x73"].push(w.sols[p].insts[j].uid)};waitobj["\x73\x6F\x6C\x73"][t.sid.toString()]=sobj}};owaits.push(waitobj)};return o};cr.system_object.prototype.loadFromJSON=function(o){var owaits=o["\x77\x61\x69\x74\x73"];var i,len,j,lenj,p,w,addWait,e,aindex,t,savedsol,nusol,inst;cr.clearArray(this.waits);for(i=0,len=owaits.length;i<len;i++){w=owaits[i];e=this.runtime.blocksBySid[w["\x65\x76"].toString()];if(!e){continue};aindex=-1;for(j=0,lenj=e.actions.length;j<lenj;j++){if(e.actions[j].sid===w["\x61\x63\x74"]){aindex=j;break}};if(aindex===-1){continue};addWait={};addWait.sols={};addWait.solModifiers=[];addWait.deleteme=false;addWait.time=w["\x74"];addWait.signaltag=w["\x73\x74"]||"";addWait.signalled=!!w["\x73"];addWait.ev=e;addWait.actindex=aindex;for(j=0,lenj=w["\x73\x6D"].length;j<lenj;j++){t=this.runtime.getObjectTypeBySid(w["\x73\x6D"][j]);if(t){addWait.solModifiers.push(t)}};for(p in w["\x73\x6F\x6C\x73"]){if(w["\x73\x6F\x6C\x73"].hasOwnProperty(p)){t=this.runtime.getObjectTypeBySid(parseInt(p,10));if(!t){continue};savedsol=w["\x73\x6F\x6C\x73"][p];nusol={sa:savedsol["\x73\x61"],insts:[]};for(j=0,lenj=savedsol["\x69\x6E\x73\x74\x73"].length;j<lenj;j++){inst=this.runtime.getObjectByUID(savedsol["\x69\x6E\x73\x74\x73"][j]);if(inst){nusol.insts.push(inst)}};addWait.sols[t.index.toString()]=nusol}};this.waits.push(addWait)}};(function(){var sysProto=cr.system_object.prototype;function SysCnds(){}SysCnds.prototype.EveryTick=function(){return true};SysCnds.prototype.OnLayoutStart=function(){return true};SysCnds.prototype.OnLayoutEnd=function(){return true};SysCnds.prototype.Compare=function(x,cmp,y){return cr.do_cmp(x,cmp,y)};SysCnds.prototype.CompareTime=function(cmp,t){var elapsed=this.runtime.kahanTime.sum;if(cmp===0){var cnd=this.runtime.getCurrentCondition();if(!cnd.extra["\x43\x6F\x6D\x70\x61\x72\x65\x54\x69\x6D\x65\x5F\x65\x78\x65\x63\x75\x74\x65\x64"]){if(elapsed>=t){cnd.extra["\x43\x6F\x6D\x70\x61\x72\x65\x54\x69\x6D\x65\x5F\x65\x78\x65\x63\x75\x74\x65\x64"]=true;return true}};return false};return cr.do_cmp(elapsed,cmp,t)};SysCnds.prototype.LayerVisible=function(layer){if(!layer){return false}else{return layer.visible}};SysCnds.prototype.LayerEmpty=function(layer){if(!layer){return false}else{return!layer.instances.length}};SysCnds.prototype.LayerCmpOpacity=function(layer,cmp,opacity_){if(!layer){return false};return cr.do_cmp(layer.opacity*100,cmp,opacity_)};SysCnds.prototype.Repeat=function(count){var current_frame=this.runtime.getCurrentEventStack();var current_event=current_frame.current_event;var solModifierAfterCnds=current_frame.isModifierAfterCnds();var current_loop=this.runtime.pushLoopStack();var i;if(solModifierAfterCnds){for(i=0;i<count&&!current_loop.stopped;i++){this.runtime.pushCopySol(current_event.solModifiers);current_loop.index=i;current_event.retrigger();this.runtime.popSol(current_event.solModifiers)}}else{for(i=0;i<count&&!current_loop.stopped;i++){current_loop.index=i;current_event.retrigger()}};this.runtime.popLoopStack();return false};SysCnds.prototype.While=function(count){var current_frame=this.runtime.getCurrentEventStack();var current_event=current_frame.current_event;var solModifierAfterCnds=current_frame.isModifierAfterCnds();var current_loop=this.runtime.pushLoopStack();var i;if(solModifierAfterCnds){for(i=0;!current_loop.stopped;i++){this.runtime.pushCopySol(current_event.solModifiers);current_loop.index=i;if(!current_event.retrigger()){current_loop.stopped=true};this.runtime.popSol(current_event.solModifiers)}}else{for(i=0;!current_loop.stopped;i++){current_loop.index=i;if(!current_event.retrigger()){current_loop.stopped=true}}};this.runtime.popLoopStack();return false};SysCnds.prototype.For=function(name,start,end){var current_frame=this.runtime.getCurrentEventStack();var current_event=current_frame.current_event;var solModifierAfterCnds=current_frame.isModifierAfterCnds();var current_loop=this.runtime.pushLoopStack(name);var i;if(end<start){if(solModifierAfterCnds){for(i=start;i>=end&&!current_loop.stopped;--i){this.runtime.pushCopySol(current_event.solModifiers);current_loop.index=i;current_event.retrigger();this.runtime.popSol(current_event.solModifiers)}}else{for(i=start;i>=end&&!current_loop.stopped;--i){current_loop.index=i;current_event.retrigger()}}}else{if(solModifierAfterCnds){for(i=start;i<=end&&!current_loop.stopped;++i){this.runtime.pushCopySol(current_event.solModifiers);current_loop.index=i;current_event.retrigger();this.runtime.popSol(current_event.solModifiers)}}else{for(i=start;i<=end&&!current_loop.stopped;++i){current_loop.index=i;current_event.retrigger()}}};this.runtime.popLoopStack();return false};var foreach_instancestack=[];var foreach_instanceptr=-1;SysCnds.prototype.ForEach=function(obj){var sol=obj.getCurrentSol();foreach_instanceptr++;if(foreach_instancestack.length===foreach_instanceptr){foreach_instancestack.push([])};var instances=foreach_instancestack[foreach_instanceptr];cr.shallowAssignArray(instances,sol.getObjects());var current_frame=this.runtime.getCurrentEventStack();var current_event=current_frame.current_event;var solModifierAfterCnds=current_frame.isModifierAfterCnds();var current_loop=this.runtime.pushLoopStack();var i,len,j,lenj,inst,s,sol2;var is_contained=obj.is_contained;if(solModifierAfterCnds){for(i=0,len=instances.length;i<len&&!current_loop.stopped;i++){this.runtime.pushCopySol(current_event.solModifiers);inst=instances[i];sol=obj.getCurrentSol();sol.select_all=false;cr.clearArray(sol.instances);sol.instances[0]=inst;if(is_contained){for(j=0,lenj=inst.siblings.length;j<lenj;j++){s=inst.siblings[j];sol2=s.type.getCurrentSol();sol2.select_all=false;cr.clearArray(sol2.instances);sol2.instances[0]=s}};current_loop.index=i;current_event.retrigger();this.runtime.popSol(current_event.solModifiers)}}else{sol.select_all=false;cr.clearArray(sol.instances);for(i=0,len=instances.length;i<len&&!current_loop.stopped;i++){inst=instances[i];sol.instances[0]=inst;if(is_contained){for(j=0,lenj=inst.siblings.length;j<lenj;j++){s=inst.siblings[j];sol2=s.type.getCurrentSol();sol2.select_all=false;cr.clearArray(sol2.instances);sol2.instances[0]=s}};current_loop.index=i;current_event.retrigger()}};cr.clearArray(instances);this.runtime.popLoopStack();foreach_instanceptr--;return false};function foreach_sortinstances(a,b){var va=a.extra["\x63\x32\x5F\x66\x65\x6F\x5F\x76\x61\x6C"];var vb=b.extra["\x63\x32\x5F\x66\x65\x6F\x5F\x76\x61\x6C"];if(cr.is_number(va)&&cr.is_number(vb)){return va-vb}else{va=""+va;vb=""+vb;if(va<vb){return-1}else{if(va>vb){return 1}else{return 0}}}}SysCnds.prototype.ForEachOrdered=function(obj,exp,order){var sol=obj.getCurrentSol();foreach_instanceptr++;if(foreach_instancestack.length===foreach_instanceptr){foreach_instancestack.push([])};var instances=foreach_instancestack[foreach_instanceptr];cr.shallowAssignArray(instances,sol.getObjects());var current_frame=this.runtime.getCurrentEventStack();var current_event=current_frame.current_event;var current_condition=this.runtime.getCurrentCondition();var solModifierAfterCnds=current_frame.isModifierAfterCnds();var current_loop=this.runtime.pushLoopStack();var i,len,j,lenj,inst,s,sol2;for(i=0,len=instances.length;i<len;i++){instances[i].extra["\x63\x32\x5F\x66\x65\x6F\x5F\x76\x61\x6C"]=current_condition.parameters[1]["\x67\x65\x74"](i)};instances.sort(foreach_sortinstances);if(order===1){instances.reverse()};var is_contained=obj.is_contained;if(solModifierAfterCnds){for(i=0,len=instances.length;i<len&&!current_loop.stopped;i++){this.runtime.pushCopySol(current_event.solModifiers);inst=instances[i];sol=obj.getCurrentSol();sol.select_all=false;cr.clearArray(sol.instances);sol.instances[0]=inst;if(is_contained){for(j=0,lenj=inst.siblings.length;j<lenj;j++){s=inst.siblings[j];sol2=s.type.getCurrentSol();sol2.select_all=false;cr.clearArray(sol2.instances);sol2.instances[0]=s}};current_loop.index=i;current_event.retrigger();this.runtime.popSol(current_event.solModifiers)}}else{sol.select_all=false;cr.clearArray(sol.instances);for(i=0,len=instances.length;i<len&&!current_loop.stopped;i++){inst=instances[i];sol.instances[0]=inst;if(is_contained){for(j=0,lenj=inst.siblings.length;j<lenj;j++){s=inst.siblings[j];sol2=s.type.getCurrentSol();sol2.select_all=false;cr.clearArray(sol2.instances);sol2.instances[0]=s}};current_loop.index=i;current_event.retrigger()}};cr.clearArray(instances);this.runtime.popLoopStack();foreach_instanceptr--;return false};SysCnds.prototype.PickByComparison=function(obj_,exp_,cmp_,val_){var i,len,k,inst;if(!obj_){return};foreach_instanceptr++;if(foreach_instancestack.length===foreach_instanceptr){foreach_instancestack.push([])};var tmp_instances=foreach_instancestack[foreach_instanceptr];var sol=obj_.getCurrentSol();cr.shallowAssignArray(tmp_instances,sol.getObjects());if(sol.select_all){cr.clearArray(sol.else_instances)};var current_condition=this.runtime.getCurrentCondition();for(i=0,k=0,len=tmp_instances.length;i<len;i++){inst=tmp_instances[i];tmp_instances[k]=inst;exp_=current_condition.parameters[1]["\x67\x65\x74"](i);val_=current_condition.parameters[3]["\x67\x65\x74"](i);if(cr.do_cmp(exp_,cmp_,val_)){k++}else{sol.else_instances.push(inst)}};cr.truncateArray(tmp_instances,k);sol.select_all=false;cr.shallowAssignArray(sol.instances,tmp_instances);cr.clearArray(tmp_instances);foreach_instanceptr--;obj_.applySolToContainer();return!!sol.instances.length};SysCnds.prototype.PickByEvaluate=function(obj_,exp_){var i,len,k,inst;if(!obj_){return};foreach_instanceptr++;if(foreach_instancestack.length===foreach_instanceptr){foreach_instancestack.push([])};var tmp_instances=foreach_instancestack[foreach_instanceptr];var sol=obj_.getCurrentSol();cr.shallowAssignArray(tmp_instances,sol.getObjects());if(sol.select_all){cr.clearArray(sol.else_instances)};var current_condition=this.runtime.getCurrentCondition();for(i=0,k=0,len=tmp_instances.length;i<len;i++){inst=tmp_instances[i];tmp_instances[k]=inst;exp_=current_condition.parameters[1]["\x67\x65\x74"](i);if(exp_){k++}else{sol.else_instances.push(inst)}};cr.truncateArray(tmp_instances,k);sol.select_all=false;cr.shallowAssignArray(sol.instances,tmp_instances);cr.clearArray(tmp_instances);foreach_instanceptr--;obj_.applySolToContainer();return!!sol.instances.length};SysCnds.prototype.TriggerOnce=function(){var cndextra=this.runtime.getCurrentCondition().extra;if(typeof cndextra["\x54\x72\x69\x67\x67\x65\x72\x4F\x6E\x63\x65\x5F\x6C\x61\x73\x74\x54\x69\x63\x6B"]==="\x75\x6E\x64\x65\x66\x69\x6E\x65\x64"){cndextra["\x54\x72\x69\x67\x67\x65\x72\x4F\x6E\x63\x65\x5F\x6C\x61\x73\x74\x54\x69\x63\x6B"]=-1};var last_tick=cndextra["\x54\x72\x69\x67\x67\x65\x72\x4F\x6E\x63\x65\x5F\x6C\x61\x73\x74\x54\x69\x63\x6B"];var cur_tick=this.runtime.tickcount;cndextra["\x54\x72\x69\x67\x67\x65\x72\x4F\x6E\x63\x65\x5F\x6C\x61\x73\x74\x54\x69\x63\x6B"]=cur_tick;return this.runtime.layout_first_tick||last_tick!==cur_tick-1};SysCnds.prototype.Every=function(seconds){var cnd=this.runtime.getCurrentCondition();var last_time=cnd.extra["\x45\x76\x65\x72\x79\x5F\x6C\x61\x73\x74\x54\x69\x6D\x65"]||0;var cur_time=this.runtime.kahanTime.sum;if(typeof cnd.extra["\x45\x76\x65\x72\x79\x5F\x73\x65\x63\x6F\x6E\x64\x73"]==="\x75\x6E\x64\x65\x66\x69\x6E\x65\x64"){cnd.extra["\x45\x76\x65\x72\x79\x5F\x73\x65\x63\x6F\x6E\x64\x73"]=seconds};var this_seconds=cnd.extra["\x45\x76\x65\x72\x79\x5F\x73\x65\x63\x6F\x6E\x64\x73"];if(cur_time>=last_time+this_seconds){cnd.extra["\x45\x76\x65\x72\x79\x5F\x6C\x61\x73\x74\x54\x69\x6D\x65"]=last_time+this_seconds;if(cur_time>=cnd.extra["\x45\x76\x65\x72\x79\x5F\x6C\x61\x73\x74\x54\x69\x6D\x65"]+0.04){cnd.extra["\x45\x76\x65\x72\x79\x5F\x6C\x61\x73\x74\x54\x69\x6D\x65"]=cur_time};cnd.extra["\x45\x76\x65\x72\x79\x5F\x73\x65\x63\x6F\x6E\x64\x73"]=seconds;return true}else{if(cur_time<last_time-0.1){cnd.extra["\x45\x76\x65\x72\x79\x5F\x6C\x61\x73\x74\x54\x69\x6D\x65"]=cur_time}};return false};SysCnds.prototype.PickNth=function(obj,index){if(!obj){return false};var sol=obj.getCurrentSol();var instances=sol.getObjects();index=cr.floor(index);if(index<0||index>=instances.length){return false};var inst=instances[index];sol.pick_one(inst);obj.applySolToContainer();return true};SysCnds.prototype.PickRandom=function(obj){if(!obj){return false};var sol=obj.getCurrentSol();var instances=sol.getObjects();var index=cr.floor(Math.random()*instances.length);if(index>=instances.length){return false};var inst=instances[index];sol.pick_one(inst);obj.applySolToContainer();return true};SysCnds.prototype.CompareVar=function(v,cmp,val){return cr.do_cmp(v.getValue(),cmp,val)};SysCnds.prototype.IsGroupActive=function(group){var g=this.runtime.groups_by_name[group.toLowerCase()];return g&&g.group_active};SysCnds.prototype.IsPreview=function(){return typeof cr_is_preview!=="\x75\x6E\x64\x65\x66\x69\x6E\x65\x64"};SysCnds.prototype.PickAll=function(obj){if(!obj){return false};if(!obj.instances.length){return false};var sol=obj.getCurrentSol();sol.select_all=true;obj.applySolToContainer();return true};SysCnds.prototype.IsMobile=function(){return this.runtime.isMobile};SysCnds.prototype.CompareBetween=function(x,a,b){return x>=a&&x<=b};SysCnds.prototype.Else=function(){var current_frame=this.runtime.getCurrentEventStack();if(current_frame.else_branch_ran){return false}else{return!current_frame.last_event_true}};SysCnds.prototype.OnLoadFinished=function(){return true};SysCnds.prototype.OnCanvasSnapshot=function(){return true};SysCnds.prototype.EffectsSupported=function(){return!!this.runtime.glwrap};SysCnds.prototype.OnSaveComplete=function(){return true};SysCnds.prototype.OnLoadComplete=function(){return true};SysCnds.prototype.OnLoadFailed=function(){return true};SysCnds.prototype.ObjectUIDExists=function(u){return!!this.runtime.getObjectByUID(u)};SysCnds.prototype.IsOnPlatform=function(p){var rt=this.runtime;switch(p){case 0:return!rt.isDomFree&&!rt.isNodeWebkit&&!rt.isCordova&&!rt.isWinJS&&!rt.isWindowsPhone8&&!rt.isBlackberry10&&!rt.isAmazonWebApp;case 1:return rt.isiOS;case 2:return rt.isAndroid;case 3:return rt.isWindows8App;case 4:return rt.isWindowsPhone8;case 5:return rt.isBlackberry10;case 6:return rt.isTizen;case 7:return rt.isCocoonJs;case 8:return rt.isCordova;case 9:return rt.isArcade;case 10:return rt.isNodeWebkit;case 11:return rt.isCrosswalk;case 12:return rt.isAmazonWebApp;default:return false}};var cacheRegex=null;var lastRegex="";var lastFlags="";function getRegex(regex_,flags_){if(!cacheRegex||regex_!==lastRegex||flags_!==lastFlags){cacheRegex=new RegExp(regex_,flags_);lastRegex=regex_;lastFlags=flags_};cacheRegex.lastIndex=0;return cacheRegex}SysCnds.prototype.RegexTest=function(str_,regex_,flags_){var regex=getRegex(regex_,flags_);return regex.test(str_)};var tmp_arr=[];SysCnds.prototype.PickOverlappingPoint=function(obj_,x_,y_){if(!obj_){return false};var sol=obj_.getCurrentSol();var instances=sol.getObjects();var current_event=this.runtime.getCurrentEventStack().current_event;var orblock=current_event.orblock;var cnd=this.runtime.getCurrentCondition();var i,len,inst,pick;if(sol.select_all){cr.shallowAssignArray(tmp_arr,instances);cr.clearArray(sol.else_instances);sol.select_all=false;cr.clearArray(sol.instances)}else{if(orblock){cr.shallowAssignArray(tmp_arr,sol.else_instances);cr.clearArray(sol.else_instances)}else{cr.shallowAssignArray(tmp_arr,instances);cr.clearArray(sol.instances)}};for(i=0,len=tmp_arr.length;i<len;++i){inst=tmp_arr[i];inst.update_bbox();pick=cr.xor(inst.contains_pt(x_,y_),cnd.inverted);if(pick){sol.instances.push(inst)}else{sol.else_instances.push(inst)}};obj_.applySolToContainer();return cr.xor(!!sol.instances.length,cnd.inverted)};SysCnds.prototype.IsNaN=function(n){return!!isNaN(n)};SysCnds.prototype.AngleWithin=function(a1,within,a2){return cr.angleDiff(cr.to_radians(a1),cr.to_radians(a2))<=cr.to_radians(within)};SysCnds.prototype.IsClockwiseFrom=function(a1,a2){return cr.angleClockwise(cr.to_radians(a1),cr.to_radians(a2))};SysCnds.prototype.IsBetweenAngles=function(a,la,ua){var angle=cr.to_clamped_radians(a);var lower=cr.to_clamped_radians(la);var upper=cr.to_clamped_radians(ua);var obtuse=(!cr.angleClockwise(upper,lower));if(obtuse){return!(!cr.angleClockwise(angle,lower)&&cr.angleClockwise(angle,upper))}else{return cr.angleClockwise(angle,lower)&&!cr.angleClockwise(angle,upper)}};SysCnds.prototype.IsValueType=function(x,t){if(typeof x==="\x6E\x75\x6D\x62\x65\x72"){return t===0}else{return t===1}};sysProto.cnds=new SysCnds();function SysActs(){}SysActs.prototype.GoToLayout=function(to){if(this.runtime.isloading){return};if(this.runtime.changelayout){return};this.runtime.changelayout=to};SysActs.prototype.NextPrevLayout=function(prev){if(this.runtime.isloading){return};if(this.runtime.changelayout){return};var index=this.runtime.layouts_by_index.indexOf(this.runtime.running_layout);if(prev&&index===0){return};if(!prev&&index===this.runtime.layouts_by_index.length-1){return};var to=this.runtime.layouts_by_index[index+(prev?-1:1)];;;this.runtime.changelayout=to};SysActs.prototype.CreateObject=function(obj,layer,x,y){if(!layer||!obj){return};var inst=this.runtime.createInstance(obj,layer,x,y);if(!inst){return};this.runtime.isInOnDestroy++;var i,len,s;this.runtime.trigger(Object.getPrototypeOf(obj.plugin).cnds.OnCreated,inst);if(inst.is_contained){for(i=0,len=inst.siblings.length;i<len;i++){s=inst.siblings[i];this.runtime.trigger(Object.getPrototypeOf(s.type.plugin).cnds.OnCreated,s)}};this.runtime.isInOnDestroy--;var sol=obj.getCurrentSol();sol.select_all=false;cr.clearArray(sol.instances);sol.instances[0]=inst;if(inst.is_contained){for(i=0,len=inst.siblings.length;i<len;i++){s=inst.siblings[i];sol=s.type.getCurrentSol();sol.select_all=false;cr.clearArray(sol.instances);sol.instances[0]=s}}};SysActs.prototype.SetLayerVisible=function(layer,visible_){if(!layer){return};if(layer.visible!==visible_){layer.visible=visible_;this.runtime.redraw=true}};SysActs.prototype.SetLayerOpacity=function(layer,opacity_){if(!layer){return};opacity_=cr.clamp(opacity_/100,0,1);if(layer.opacity!==opacity_){layer.opacity=opacity_;this.runtime.redraw=true}};SysActs.prototype.SetLayerScaleRate=function(layer,sr){if(!layer){return};if(layer.zoomRate!==sr){layer.zoomRate=sr;this.runtime.redraw=true}};SysActs.prototype.SetLayerForceOwnTexture=function(layer,f){if(!layer){return};f=!!f;if(layer.forceOwnTexture!==f){layer.forceOwnTexture=f;this.runtime.redraw=true}};SysActs.prototype.SetLayoutScale=function(s){if(!this.runtime.running_layout){return};if(this.runtime.running_layout.scale!==s){this.runtime.running_layout.scale=s;this.runtime.running_layout.boundScrolling();this.runtime.redraw=true}};SysActs.prototype.ScrollX=function(x){this.runtime.running_layout.scrollToX(x)};SysActs.prototype.ScrollY=function(y){this.runtime.running_layout.scrollToY(y)};SysActs.prototype.Scroll=function(x,y){this.runtime.running_layout.scrollToX(x);this.runtime.running_layout.scrollToY(y)};SysActs.prototype.ScrollToObject=function(obj){var inst=obj.getFirstPicked();if(inst){this.runtime.running_layout.scrollToX(inst.x);this.runtime.running_layout.scrollToY(inst.y)}};SysActs.prototype.SetVar=function(v,x){;;if(v.vartype===0){if(cr.is_number(x)){v.setValue(x)}else{v.setValue(parseFloat(x))}}else{if(v.vartype===1){v.setValue(x.toString())}}};SysActs.prototype.AddVar=function(v,x){;;if(v.vartype===0){if(cr.is_number(x)){v.setValue(v.getValue()+x)}else{v.setValue(v.getValue()+parseFloat(x))}}else{if(v.vartype===1){v.setValue(v.getValue()+x.toString())}}};SysActs.prototype.SubVar=function(v,x){;;if(v.vartype===0){if(cr.is_number(x)){v.setValue(v.getValue()-x)}else{v.setValue(v.getValue()-parseFloat(x))}}};SysActs.prototype.SetGroupActive=function(group,active){var g=this.runtime.groups_by_name[group.toLowerCase()];if(!g){return};switch(active){case 0:g.setGroupActive(false);break;case 1:g.setGroupActive(true);break;case 2:g.setGroupActive(!g.group_active);break}};SysActs.prototype.SetTimescale=function(ts_){var ts=ts_;if(ts<0){ts=0};this.runtime.timescale=ts};SysActs.prototype.SetObjectTimescale=function(obj,ts_){var ts=ts_;if(ts<0){ts=0};if(!obj){return};var sol=obj.getCurrentSol();var instances=sol.getObjects();var i,len;for(i=0,len=instances.length;i<len;i++){instances[i].my_timescale=ts}};SysActs.prototype.RestoreObjectTimescale=function(obj){if(!obj){return false};var sol=obj.getCurrentSol();var instances=sol.getObjects();var i,len;for(i=0,len=instances.length;i<len;i++){instances[i].my_timescale=-1.0}};var waitobjrecycle=[];function allocWaitObject(){var w;if(waitobjrecycle.length){w=waitobjrecycle.pop()}else{w={};w.sols={};w.solModifiers=[]};w.deleteme=false;return w}function freeWaitObject(w){cr.wipe(w.sols);cr.clearArray(w.solModifiers);waitobjrecycle.push(w)}var solstateobjects=[];function allocSolStateObject(){var s;if(solstateobjects.length){s=solstateobjects.pop()}else{s={};s.insts=[]};s.sa=false;return s}function freeSolStateObject(s){cr.clearArray(s.insts);solstateobjects.push(s)}SysActs.prototype.Wait=function(seconds){if(seconds<0){return};var i,len,s,t,ss;var evinfo=this.runtime.getCurrentEventStack();var waitobj=allocWaitObject();waitobj.time=this.runtime.kahanTime.sum+seconds;waitobj.signaltag="";waitobj.signalled=false;waitobj.ev=evinfo.current_event;waitobj.actindex=evinfo.actindex+1;for(i=0,len=this.runtime.types_by_index.length;i<len;i++){t=this.runtime.types_by_index[i];s=t.getCurrentSol();if(s.select_all&&evinfo.current_event.solModifiers.indexOf(t)===-1){continue};waitobj.solModifiers.push(t);ss=allocSolStateObject();ss.sa=s.select_all;cr.shallowAssignArray(ss.insts,s.instances);waitobj.sols[i.toString()]=ss};this.waits.push(waitobj);return true};SysActs.prototype.WaitForSignal=function(tag){var i,len,s,t,ss;var evinfo=this.runtime.getCurrentEventStack();var waitobj=allocWaitObject();waitobj.time=-1;waitobj.signaltag=tag.toLowerCase();waitobj.signalled=false;waitobj.ev=evinfo.current_event;waitobj.actindex=evinfo.actindex+1;for(i=0,len=this.runtime.types_by_index.length;i<len;i++){t=this.runtime.types_by_index[i];s=t.getCurrentSol();if(s.select_all&&evinfo.current_event.solModifiers.indexOf(t)===-1){continue};waitobj.solModifiers.push(t);ss=allocSolStateObject();ss.sa=s.select_all;cr.shallowAssignArray(ss.insts,s.instances);waitobj.sols[i.toString()]=ss};this.waits.push(waitobj);return true};SysActs.prototype.Signal=function(tag){var lowertag=tag.toLowerCase();var i,len,w;for(i=0,len=this.waits.length;i<len;++i){w=this.waits[i];if(w.time!==-1){continue};if(w.signaltag===lowertag){w.signalled=true}}};SysActs.prototype.SetLayerScale=function(layer,scale){if(!layer){return};if(layer.scale===scale){return};layer.scale=scale;this.runtime.redraw=true};SysActs.prototype.ResetGlobals=function(){var i,len,g;for(i=0,len=this.runtime.all_global_vars.length;i<len;i++){g=this.runtime.all_global_vars[i];g.data=g.initial}};SysActs.prototype.SetLayoutAngle=function(a){a=cr.to_radians(a);a=cr.clamp_angle(a);if(this.runtime.running_layout){if(this.runtime.running_layout.angle!==a){this.runtime.running_layout.angle=a;this.runtime.redraw=true}}};SysActs.prototype.SetLayerAngle=function(layer,a){if(!layer){return};a=cr.to_radians(a);a=cr.clamp_angle(a);if(layer.angle===a){return};layer.angle=a;this.runtime.redraw=true};SysActs.prototype.SetLayerParallax=function(layer,px,py){if(!layer){return};if(layer.parallaxX===px/100&&layer.parallaxY===py/100){return};layer.parallaxX=px/100;layer.parallaxY=py/100;if(layer.parallaxX!==1||layer.parallaxY!==1){var i,len,instances=layer.instances;for(i=0,len=instances.length;i<len;++i){instances[i].type.any_instance_parallaxed=true}};this.runtime.redraw=true};SysActs.prototype.SetLayerBackground=function(layer,c){if(!layer){return};var r=cr.GetRValue(c);var g=cr.GetGValue(c);var b=cr.GetBValue(c);if(layer.background_color[0]===r&&layer.background_color[1]===g&&layer.background_color[2]===b){return};layer.background_color[0]=r;layer.background_color[1]=g;layer.background_color[2]=b;this.runtime.redraw=true};SysActs.prototype.SetLayerTransparent=function(layer,t){if(!layer){return};if(!!t===!!layer.transparent){return};layer.transparent=!!t;this.runtime.redraw=true};SysActs.prototype.SetLayerBlendMode=function(layer,bm){if(!layer){return};if(layer.blend_mode===bm){return};layer.blend_mode=bm;layer.compositeOp=cr.effectToCompositeOp(layer.blend_mode);if(this.runtime.gl){cr.setGLBlend(layer,layer.blend_mode,this.runtime.gl)};this.runtime.redraw=true};SysActs.prototype.StopLoop=function(){if(this.runtime.loop_stack_index<0){return};this.runtime.getCurrentLoop().stopped=true};SysActs.prototype.GoToLayoutByName=function(layoutname){if(this.runtime.isloading){return};if(this.runtime.changelayout){return};var l;for(l in this.runtime.layouts){if(this.runtime.layouts.hasOwnProperty(l)&&cr.equals_nocase(l,layoutname)){this.runtime.changelayout=this.runtime.layouts[l];return}}};SysActs.prototype.RestartLayout=function(layoutname){if(this.runtime.isloading){return};if(this.runtime.changelayout){return};if(!this.runtime.running_layout){return};this.runtime.changelayout=this.runtime.running_layout;var i,len,g;for(i=0,len=this.runtime.allGroups.length;i<len;i++){g=this.runtime.allGroups[i];g.setGroupActive(g.initially_activated)}};SysActs.prototype.SnapshotCanvas=function(format_,quality_){this.runtime.doCanvasSnapshot(format_===0?"\x69\x6D\x61\x67\x65\x2F\x70\x6E\x67":"\x69\x6D\x61\x67\x65\x2F\x6A\x70\x65\x67",quality_/100)};SysActs.prototype.SetCanvasSize=function(w,h){if(w<=0||h<=0){return};var mode=this.runtime.fullscreen_mode;var isfullscreen=(document["\x6D\x6F\x7A\x46\x75\x6C\x6C\x53\x63\x72\x65\x65\x6E"]||document["\x77\x65\x62\x6B\x69\x74\x49\x73\x46\x75\x6C\x6C\x53\x63\x72\x65\x65\x6E"]||!!document["\x6D\x73\x46\x75\x6C\x6C\x73\x63\x72\x65\x65\x6E\x45\x6C\x65\x6D\x65\x6E\x74"]||document["\x66\x75\x6C\x6C\x53\x63\x72\x65\x65\x6E"]||this.runtime.isNodeFullscreen);if(isfullscreen&&this.runtime.fullscreen_scaling>0){mode=this.runtime.fullscreen_scaling};if(mode===0){this.runtime["\x73\x65\x74\x53\x69\x7A\x65"](w,h,true)}else{this.runtime.original_width=w;this.runtime.original_height=h;this.runtime["\x73\x65\x74\x53\x69\x7A\x65"](this.runtime.lastWindowWidth,this.runtime.lastWindowHeight,true)}};SysActs.prototype.SetLayoutEffectEnabled=function(enable_,effectname_){if(!this.runtime.running_layout||!this.runtime.glwrap){return};var et=this.runtime.running_layout.getEffectByName(effectname_);if(!et){return};var enable=(enable_===1);if(et.active==enable){return};et.active=enable;this.runtime.running_layout.updateActiveEffects();this.runtime.redraw=true};SysActs.prototype.SetLayerEffectEnabled=function(layer,enable_,effectname_){if(!layer||!this.runtime.glwrap){return};var et=layer.getEffectByName(effectname_);if(!et){return};var enable=(enable_===1);if(et.active==enable){return};et.active=enable;layer.updateActiveEffects();this.runtime.redraw=true};SysActs.prototype.SetLayoutEffectParam=function(effectname_,index_,value_){if(!this.runtime.running_layout||!this.runtime.glwrap){return};var et=this.runtime.running_layout.getEffectByName(effectname_);if(!et){return};var params=this.runtime.running_layout.effect_params[et.index];index_=Math.floor(index_);if(index_<0||index_>=params.length){return};if(this.runtime.glwrap.getProgramParameterType(et.shaderindex,index_)===1){value_/=100.0};if(params[index_]===value_){return};params[index_]=value_;if(et.active){this.runtime.redraw=true}};SysActs.prototype.SetLayerEffectParam=function(layer,effectname_,index_,value_){if(!layer||!this.runtime.glwrap){return};var et=layer.getEffectByName(effectname_);if(!et){return};var params=layer.effect_params[et.index];index_=Math.floor(index_);if(index_<0||index_>=params.length){return};if(this.runtime.glwrap.getProgramParameterType(et.shaderindex,index_)===1){value_/=100.0};if(params[index_]===value_){return};params[index_]=value_;if(et.active){this.runtime.redraw=true}};SysActs.prototype.SaveState=function(slot_){this.runtime.saveToSlot=slot_};SysActs.prototype.LoadState=function(slot_){this.runtime.loadFromSlot=slot_};SysActs.prototype.LoadStateJSON=function(jsonstr_){this.runtime.loadFromJson=jsonstr_};SysActs.prototype.SetHalfFramerateMode=function(set_){this.runtime.halfFramerateMode=(set_!==0)};SysActs.prototype.SetFullscreenQuality=function(q){var isfullscreen=(document["\x6D\x6F\x7A\x46\x75\x6C\x6C\x53\x63\x72\x65\x65\x6E"]||document["\x77\x65\x62\x6B\x69\x74\x49\x73\x46\x75\x6C\x6C\x53\x63\x72\x65\x65\x6E"]||!!document["\x6D\x73\x46\x75\x6C\x6C\x73\x63\x72\x65\x65\x6E\x45\x6C\x65\x6D\x65\x6E\x74"]||document["\x66\x75\x6C\x6C\x53\x63\x72\x65\x65\x6E"]||this.isNodeFullscreen);if(!isfullscreen&&this.runtime.fullscreen_mode===0){return};this.runtime.wantFullscreenScalingQuality=(q!==0);this.runtime["\x73\x65\x74\x53\x69\x7A\x65"](this.runtime.lastWindowWidth,this.runtime.lastWindowHeight,true)};SysActs.prototype.ResetPersisted=function(){var i,len;for(i=0,len=this.runtime.layouts_by_index.length;i<len;++i){this.runtime.layouts_by_index[i].persist_data={};this.runtime.layouts_by_index[i].first_visit=true}};SysActs.prototype.RecreateInitialObjects=function(obj,x1,y1,x2,y2){if(!obj){return};this.runtime.running_layout.recreateInitialObjects(obj,x1,y1,x2,y2)};SysActs.prototype.SetPixelRounding=function(m){this.runtime.pixel_rounding=(m!==0);this.runtime.redraw=true};SysActs.prototype.SetMinimumFramerate=function(f){if(f<1){f=1};if(f>120){f=120};this.runtime.minimumFramerate=f};sysProto.acts=new SysActs();function SysExps(){}SysExps.prototype["\x69\x6E\x74"]=function(ret,x){if(cr.is_string(x)){ret.set_int(parseInt(x,10));if(isNaN(ret.data)){ret.data=0}}else{ret.set_int(x)}};SysExps.prototype["\x66\x6C\x6F\x61\x74"]=function(ret,x){if(cr.is_string(x)){ret.set_float(parseFloat(x));if(isNaN(ret.data)){ret.data=0}}else{ret.set_float(x)}};SysExps.prototype.str=function(ret,x){if(cr.is_string(x)){ret.set_string(x)}else{ret.set_string(x.toString())}};SysExps.prototype.len=function(ret,x){ret.set_int(x.length||0)};SysExps.prototype.random=function(ret,a,b){if(b===undefined){ret.set_float(Math.random()*a)}else{ret.set_float(Math.random()*(b-a)+a)}};SysExps.prototype.sqrt=function(ret,x){ret.set_float(Math.sqrt(x))};SysExps.prototype.abs=function(ret,x){ret.set_float(Math.abs(x))};SysExps.prototype.round=function(ret,x){ret.set_int(Math.round(x))};SysExps.prototype.floor=function(ret,x){ret.set_int(Math.floor(x))};SysExps.prototype.ceil=function(ret,x){ret.set_int(Math.ceil(x))};SysExps.prototype.sin=function(ret,x){ret.set_float(Math.sin(cr.to_radians(x)))};SysExps.prototype.cos=function(ret,x){ret.set_float(Math.cos(cr.to_radians(x)))};SysExps.prototype.tan=function(ret,x){ret.set_float(Math.tan(cr.to_radians(x)))};SysExps.prototype.asin=function(ret,x){ret.set_float(cr.to_degrees(Math.asin(x)))};SysExps.prototype.acos=function(ret,x){ret.set_float(cr.to_degrees(Math.acos(x)))};SysExps.prototype.atan=function(ret,x){ret.set_float(cr.to_degrees(Math.atan(x)))};SysExps.prototype.exp=function(ret,x){ret.set_float(Math.exp(x))};SysExps.prototype.ln=function(ret,x){ret.set_float(Math.log(x))};SysExps.prototype.log10=function(ret,x){ret.set_float(Math.log(x)/Math.LN10)};SysExps.prototype.max=function(ret){var max_=arguments[1];if(typeof max_!=="\x6E\x75\x6D\x62\x65\x72"){max_=0};var i,len,a;for(i=2,len=arguments.length;i<len;i++){a=arguments[i];if(typeof a!=="\x6E\x75\x6D\x62\x65\x72"){continue};if(max_<a){max_=a}};ret.set_float(max_)};SysExps.prototype.min=function(ret){var min_=arguments[1];if(typeof min_!=="\x6E\x75\x6D\x62\x65\x72"){min_=0};var i,len,a;for(i=2,len=arguments.length;i<len;i++){a=arguments[i];if(typeof a!=="\x6E\x75\x6D\x62\x65\x72"){continue};if(min_>a){min_=a}};ret.set_float(min_)};SysExps.prototype.dt=function(ret){ret.set_float(this.runtime.dt)};SysExps.prototype.timescale=function(ret){ret.set_float(this.runtime.timescale)};SysExps.prototype.wallclocktime=function(ret){ret.set_float((Date.now()-this.runtime.start_time)/1000.0)};SysExps.prototype.time=function(ret){ret.set_float(this.runtime.kahanTime.sum)};SysExps.prototype.tickcount=function(ret){ret.set_int(this.runtime.tickcount)};SysExps.prototype.objectcount=function(ret){ret.set_int(this.runtime.objectcount)};SysExps.prototype.fps=function(ret){ret.set_int(this.runtime.fps)};SysExps.prototype.loopindex=function(ret,name_){var loop,i,len;if(!this.runtime.loop_stack.length){ret.set_int(0);return};if(name_){for(i=this.runtime.loop_stack_index;i>=0;--i){loop=this.runtime.loop_stack[i];if(loop.name===name_){ret.set_int(loop.index);return}};ret.set_int(0)}else{loop=this.runtime.getCurrentLoop();ret.set_int(loop?loop.index:-1)}};SysExps.prototype.distance=function(ret,x1,y1,x2,y2){ret.set_float(cr.distanceTo(x1,y1,x2,y2))};SysExps.prototype.angle=function(ret,x1,y1,x2,y2){ret.set_float(cr.to_degrees(cr.angleTo(x1,y1,x2,y2)))};SysExps.prototype.scrollx=function(ret){ret.set_float(this.runtime.running_layout.scrollX)};SysExps.prototype.scrolly=function(ret){ret.set_float(this.runtime.running_layout.scrollY)};SysExps.prototype.newline=function(ret){ret.set_string("\x0A")};SysExps.prototype.lerp=function(ret,a,b,x){ret.set_float(cr.lerp(a,b,x))};SysExps.prototype.qarp=function(ret,a,b,c,x){ret.set_float(cr.qarp(a,b,c,x))};SysExps.prototype.cubic=function(ret,a,b,c,d,x){ret.set_float(cr.cubic(a,b,c,d,x))};SysExps.prototype.cosp=function(ret,a,b,x){ret.set_float(cr.cosp(a,b,x))};SysExps.prototype.windowwidth=function(ret){ret.set_int(this.runtime.width)};SysExps.prototype.windowheight=function(ret){ret.set_int(this.runtime.height)};SysExps.prototype.uppercase=function(ret,str){ret.set_string(cr.is_string(str)?str.toUpperCase():"")};SysExps.prototype.lowercase=function(ret,str){ret.set_string(cr.is_string(str)?str.toLowerCase():"")};SysExps.prototype.clamp=function(ret,x,l,u){if(x<l){ret.set_float(l)}else{if(x>u){ret.set_float(u)}else{ret.set_float(x)}}};SysExps.prototype.layerscale=function(ret,layerparam){var layer=this.runtime.getLayer(layerparam);if(!layer){ret.set_float(0)}else{ret.set_float(layer.scale)}};SysExps.prototype.layeropacity=function(ret,layerparam){var layer=this.runtime.getLayer(layerparam);if(!layer){ret.set_float(0)}else{ret.set_float(layer.opacity*100)}};SysExps.prototype.layerscalerate=function(ret,layerparam){var layer=this.runtime.getLayer(layerparam);if(!layer){ret.set_float(0)}else{ret.set_float(layer.zoomRate)}};SysExps.prototype.layerparallaxx=function(ret,layerparam){var layer=this.runtime.getLayer(layerparam);if(!layer){ret.set_float(0)}else{ret.set_float(layer.parallaxX*100)}};SysExps.prototype.layerparallaxy=function(ret,layerparam){var layer=this.runtime.getLayer(layerparam);if(!layer){ret.set_float(0)}else{ret.set_float(layer.parallaxY*100)}};SysExps.prototype.layerindex=function(ret,layerparam){var layer=this.runtime.getLayer(layerparam);if(!layer){ret.set_int(-1)}else{ret.set_int(layer.index)}};SysExps.prototype.layoutscale=function(ret){if(this.runtime.running_layout){ret.set_float(this.runtime.running_layout.scale)}else{ret.set_float(0)}};SysExps.prototype.layoutangle=function(ret){ret.set_float(cr.to_degrees(this.runtime.running_layout.angle))};SysExps.prototype.layerangle=function(ret,layerparam){var layer=this.runtime.getLayer(layerparam);if(!layer){ret.set_float(0)}else{ret.set_float(cr.to_degrees(layer.angle))}};SysExps.prototype.layoutwidth=function(ret){ret.set_int(this.runtime.running_layout.width)};SysExps.prototype.layoutheight=function(ret){ret.set_int(this.runtime.running_layout.height)};SysExps.prototype.find=function(ret,text,searchstr){if(cr.is_string(text)&&cr.is_string(searchstr)){ret.set_int(text.search(new RegExp(cr.regexp_escape(searchstr),"\x69")))}else{ret.set_int(-1)}};SysExps.prototype.left=function(ret,text,n){ret.set_string(cr.is_string(text)?text.substr(0,n):"")};SysExps.prototype.right=function(ret,text,n){ret.set_string(cr.is_string(text)?text.substr(text.length-n):"")};SysExps.prototype.mid=function(ret,text,index_,length_){ret.set_string(cr.is_string(text)?text.substr(index_,length_):"")};SysExps.prototype.tokenat=function(ret,text,index_,sep){if(cr.is_string(text)&&cr.is_string(sep)){var arr=text.split(sep);var i=cr.floor(index_);if(i<0||i>=arr.length){ret.set_string("")}else{ret.set_string(arr[i])}}else{ret.set_string("")}};SysExps.prototype.tokencount=function(ret,text,sep){if(cr.is_string(text)&&text.length){ret.set_int(text.split(sep).length)}else{ret.set_int(0)}};SysExps.prototype.replace=function(ret,text,find_,replace_){if(cr.is_string(text)&&cr.is_string(find_)&&cr.is_string(replace_)){ret.set_string(text.replace(new RegExp(cr.regexp_escape(find_),"\x67\x69"),replace_))}else{ret.set_string(cr.is_string(text)?text:"")}};SysExps.prototype.trim=function(ret,text){ret.set_string(cr.is_string(text)?text.trim():"")};SysExps.prototype.pi=function(ret){ret.set_float(cr.PI)};SysExps.prototype.layoutname=function(ret){if(this.runtime.running_layout){ret.set_string(this.runtime.running_layout.name)}else{ret.set_string("")}};SysExps.prototype.renderer=function(ret){ret.set_string(this.runtime.gl?"\x77\x65\x62\x67\x6C":"\x63\x61\x6E\x76\x61\x73\x32\x64")};SysExps.prototype.rendererdetail=function(ret){ret.set_string(this.runtime.glUnmaskedRenderer)};SysExps.prototype.anglediff=function(ret,a,b){ret.set_float(cr.to_degrees(cr.angleDiff(cr.to_radians(a),cr.to_radians(b))))};SysExps.prototype.choose=function(ret){var index=cr.floor(Math.random()*(arguments.length-1));ret.set_any(arguments[index+1])};SysExps.prototype.rgb=function(ret,r,g,b){ret.set_int(cr.RGB(r,g,b))};SysExps.prototype.projectversion=function(ret){ret.set_string(this.runtime.versionstr)};SysExps.prototype.projectname=function(ret){ret.set_string(this.runtime.projectName)};SysExps.prototype.anglelerp=function(ret,a,b,x){a=cr.to_radians(a);b=cr.to_radians(b);var diff=cr.angleDiff(a,b);if(cr.angleClockwise(b,a)){ret.set_float(cr.to_clamped_degrees(a+diff*x))}else{ret.set_float(cr.to_clamped_degrees(a-diff*x))}};SysExps.prototype.anglerotate=function(ret,a,b,c){a=cr.to_radians(a);b=cr.to_radians(b);c=cr.to_radians(c);ret.set_float(cr.to_clamped_degrees(cr.angleRotate(a,b,c)))};SysExps.prototype.zeropad=function(ret,n,d){var s=(n<0?"\x2D":"");if(n<0){n=-n};var zeroes=d-n.toString().length;for(var i=0;i<zeroes;i++){s+="\x30"};ret.set_string(s+n.toString())};SysExps.prototype.cpuutilisation=function(ret){ret.set_float(this.runtime.cpuutilisation/1000)};SysExps.prototype.viewportleft=function(ret,layerparam){var layer=this.runtime.getLayer(layerparam);ret.set_float(layer?layer.viewLeft:0)};SysExps.prototype.viewporttop=function(ret,layerparam){var layer=this.runtime.getLayer(layerparam);ret.set_float(layer?layer.viewTop:0)};SysExps.prototype.viewportright=function(ret,layerparam){var layer=this.runtime.getLayer(layerparam);ret.set_float(layer?layer.viewRight:0)};SysExps.prototype.viewportbottom=function(ret,layerparam){var layer=this.runtime.getLayer(layerparam);ret.set_float(layer?layer.viewBottom:0)};SysExps.prototype.loadingprogress=function(ret){ret.set_float(this.runtime.loadingprogress)};SysExps.prototype.unlerp=function(ret,a,b,y){ret.set_float(cr.unlerp(a,b,y))};SysExps.prototype.canvassnapshot=function(ret){ret.set_string(this.runtime.snapshotData)};SysExps.prototype.urlencode=function(ret,s){ret.set_string(encodeURIComponent(s))};SysExps.prototype.urldecode=function(ret,s){ret.set_string(decodeURIComponent(s))};SysExps.prototype.canvastolayerx=function(ret,layerparam,x,y){var layer=this.runtime.getLayer(layerparam);ret.set_float(layer?layer.canvasToLayer(x,y,true):0)};SysExps.prototype.canvastolayery=function(ret,layerparam,x,y){var layer=this.runtime.getLayer(layerparam);ret.set_float(layer?layer.canvasToLayer(x,y,false):0)};SysExps.prototype.layertocanvasx=function(ret,layerparam,x,y){var layer=this.runtime.getLayer(layerparam);ret.set_float(layer?layer.layerToCanvas(x,y,true):0)};SysExps.prototype.layertocanvasy=function(ret,layerparam,x,y){var layer=this.runtime.getLayer(layerparam);ret.set_float(layer?layer.layerToCanvas(x,y,false):0)};SysExps.prototype.savestatejson=function(ret){ret.set_string(this.runtime.lastSaveJson)};SysExps.prototype.imagememoryusage=function(ret){if(this.runtime.glwrap){ret.set_float(Math.round(100*this.runtime.glwrap.estimateVRAM()/(1024*1024))/100)}else{ret.set_float(0)}};SysExps.prototype.regexsearch=function(ret,str_,regex_,flags_){var regex=getRegex(regex_,flags_);ret.set_int(str_?str_.search(regex):-1)};SysExps.prototype.regexreplace=function(ret,str_,regex_,flags_,replace_){var regex=getRegex(regex_,flags_);ret.set_string(str_?str_.replace(regex,replace_):"")};var regexMatches=[];var lastMatchesStr="";var lastMatchesRegex="";var lastMatchesFlags="";function updateRegexMatches(str_,regex_,flags_){if(str_===lastMatchesStr&&regex_===lastMatchesRegex&&flags_===lastMatchesFlags){return};var regex=getRegex(regex_,flags_);regexMatches=str_.match(regex);lastMatchesStr=str_;lastMatchesRegex=regex_;lastMatchesFlags=flags_}SysExps.prototype.regexmatchcount=function(ret,str_,regex_,flags_){var regex=getRegex(regex_,flags_);updateRegexMatches(str_,regex_,flags_);ret.set_int(regexMatches?regexMatches.length:0)};SysExps.prototype.regexmatchat=function(ret,str_,regex_,flags_,index_){index_=Math.floor(index_);var regex=getRegex(regex_,flags_);updateRegexMatches(str_,regex_,flags_);if(!regexMatches||index_<0||index_>=regexMatches.length){ret.set_string("")}else{ret.set_string(regexMatches[index_])}};SysExps.prototype.infinity=function(ret){ret.set_float(Infinity)};SysExps.prototype.setbit=function(ret,n,b,v){n=n|0;b=b|0;v=(v!==0?1:0);ret.set_int((n&~(1<<b))|(v<<b))};SysExps.prototype.togglebit=function(ret,n,b){n=n|0;b=b|0;ret.set_int(n^(1<<b))};SysExps.prototype.getbit=function(ret,n,b){n=n|0;b=b|0;ret.set_int((n&(1<<b))?1:0)};SysExps.prototype.originalwindowwidth=function(ret){ret.set_int(this.runtime.original_width)};SysExps.prototype.originalwindowheight=function(ret){ret.set_int(this.runtime.original_height)};sysProto.exps=new SysExps();sysProto.runWaits=function(){var i,j,len,w,k,s,ss;var evinfo=this.runtime.getCurrentEventStack();for(i=0,len=this.waits.length;i<len;i++){w=this.waits[i];if(w.time===-1){if(!w.signalled){continue}}else{if(w.time>this.runtime.kahanTime.sum){continue}};evinfo.current_event=w.ev;evinfo.actindex=w.actindex;evinfo.cndindex=0;for(k in w.sols){if(w.sols.hasOwnProperty(k)){s=this.runtime.types_by_index[parseInt(k,10)].getCurrentSol();ss=w.sols[k];s.select_all=ss.sa;cr.shallowAssignArray(s.instances,ss.insts);freeSolStateObject(ss)}};w.ev.resume_actions_and_subevents();this.runtime.clearSol(w.solModifiers);w.deleteme=true};for(i=0,j=0,len=this.waits.length;i<len;i++){w=this.waits[i];this.waits[j]=w;if(w.deleteme){freeWaitObject(w)}else{j++}};cr.truncateArray(this.waits,j)}}());;;(function(){cr.add_common_aces=function(m,pluginProto){var singleglobal_=m[1];var position_aces=m[3];var size_aces=m[4];var angle_aces=m[5];var appearance_aces=m[6];var zorder_aces=m[7];var effects_aces=m[8];if(!pluginProto.cnds){pluginProto.cnds={}};if(!pluginProto.acts){pluginProto.acts={}};if(!pluginProto.exps){pluginProto.exps={}};var cnds=pluginProto.cnds;var acts=pluginProto.acts;var exps=pluginProto.exps;if(position_aces){cnds.CompareX=function(cmp,x){return cr.do_cmp(this.x,cmp,x)};cnds.CompareY=function(cmp,y){return cr.do_cmp(this.y,cmp,y)};cnds.IsOnScreen=function(){var layer=this.layer;this.update_bbox();var bbox=this.bbox;return!(bbox.right<layer.viewLeft||bbox.bottom<layer.viewTop||bbox.left>layer.viewRight||bbox.top>layer.viewBottom)};cnds.IsOutsideLayout=function(){this.update_bbox();var bbox=this.bbox;var layout=this.runtime.running_layout;return(bbox.right<0||bbox.bottom<0||bbox.left>layout.width||bbox.top>layout.height)};cnds.PickDistance=function(which,x,y){var sol=this.getCurrentSol();var instances=sol.getObjects();if(!instances.length){return false};var inst=instances[0];var pickme=inst;var dist=cr.distanceTo(inst.x,inst.y,x,y);var i,len,d;for(i=1,len=instances.length;i<len;i++){inst=instances[i];d=cr.distanceTo(inst.x,inst.y,x,y);if((which===0&&d<dist)||(which===1&&d>dist)){dist=d;pickme=inst}};sol.pick_one(pickme);return true};acts.SetX=function(x){if(this.x!==x){this.x=x;this.set_bbox_changed()}};acts.SetY=function(y){if(this.y!==y){this.y=y;this.set_bbox_changed()}};acts.SetPos=function(x,y){if(this.x!==x||this.y!==y){this.x=x;this.y=y;this.set_bbox_changed()}};acts.SetPosToObject=function(obj,imgpt){var inst=obj.getPairedInstance(this);if(!inst){return};var newx,newy;if(inst.getImagePoint){newx=inst.getImagePoint(imgpt,true);newy=inst.getImagePoint(imgpt,false)}else{newx=inst.x;newy=inst.y};if(this.x!==newx||this.y!==newy){this.x=newx;this.y=newy;this.set_bbox_changed()}};acts.MoveForward=function(dist){if(dist!==0){this.x+=Math.cos(this.angle)*dist;this.y+=Math.sin(this.angle)*dist;this.set_bbox_changed()}};acts.MoveAtAngle=function(a,dist){if(dist!==0){this.x+=Math.cos(cr.to_radians(a))*dist;this.y+=Math.sin(cr.to_radians(a))*dist;this.set_bbox_changed()}};exps.X=function(ret){ret.set_float(this.x)};exps.Y=function(ret){ret.set_float(this.y)};exps.dt=function(ret){ret.set_float(this.runtime.getDt(this))}};if(size_aces){cnds.CompareWidth=function(cmp,w){return cr.do_cmp(this.width,cmp,w)};cnds.CompareHeight=function(cmp,h){return cr.do_cmp(this.height,cmp,h)};acts.SetWidth=function(w){if(this.width!==w){this.width=w;this.set_bbox_changed()}};acts.SetHeight=function(h){if(this.height!==h){this.height=h;this.set_bbox_changed()}};acts.SetSize=function(w,h){if(this.width!==w||this.height!==h){this.width=w;this.height=h;this.set_bbox_changed()}};exps.Width=function(ret){ret.set_float(this.width)};exps.Height=function(ret){ret.set_float(this.height)};exps.BBoxLeft=function(ret){this.update_bbox();ret.set_float(this.bbox.left)};exps.BBoxTop=function(ret){this.update_bbox();ret.set_float(this.bbox.top)};exps.BBoxRight=function(ret){this.update_bbox();ret.set_float(this.bbox.right)};exps.BBoxBottom=function(ret){this.update_bbox();ret.set_float(this.bbox.bottom)}};if(angle_aces){cnds.AngleWithin=function(within,a){return cr.angleDiff(this.angle,cr.to_radians(a))<=cr.to_radians(within)};cnds.IsClockwiseFrom=function(a){return cr.angleClockwise(this.angle,cr.to_radians(a))};cnds.IsBetweenAngles=function(a,b){var lower=cr.to_clamped_radians(a);var upper=cr.to_clamped_radians(b);var angle=cr.clamp_angle(this.angle);var obtuse=(!cr.angleClockwise(upper,lower));if(obtuse){return!(!cr.angleClockwise(angle,lower)&&cr.angleClockwise(angle,upper))}else{return cr.angleClockwise(angle,lower)&&!cr.angleClockwise(angle,upper)}};acts.SetAngle=function(a){var newangle=cr.to_radians(cr.clamp_angle_degrees(a));if(isNaN(newangle)){return};if(this.angle!==newangle){this.angle=newangle;this.set_bbox_changed()}};acts.RotateClockwise=function(a){if(a!==0&&!isNaN(a)){this.angle+=cr.to_radians(a);this.angle=cr.clamp_angle(this.angle);this.set_bbox_changed()}};acts.RotateCounterclockwise=function(a){if(a!==0&&!isNaN(a)){this.angle-=cr.to_radians(a);this.angle=cr.clamp_angle(this.angle);this.set_bbox_changed()}};acts.RotateTowardAngle=function(amt,target){var newangle=cr.angleRotate(this.angle,cr.to_radians(target),cr.to_radians(amt));if(isNaN(newangle)){return};if(this.angle!==newangle){this.angle=newangle;this.set_bbox_changed()}};acts.RotateTowardPosition=function(amt,x,y){var dx=x-this.x;var dy=y-this.y;var target=Math.atan2(dy,dx);var newangle=cr.angleRotate(this.angle,target,cr.to_radians(amt));if(isNaN(newangle)){return};if(this.angle!==newangle){this.angle=newangle;this.set_bbox_changed()}};acts.SetTowardPosition=function(x,y){var dx=x-this.x;var dy=y-this.y;var newangle=Math.atan2(dy,dx);if(isNaN(newangle)){return};if(this.angle!==newangle){this.angle=newangle;this.set_bbox_changed()}};exps.Angle=function(ret){ret.set_float(cr.to_clamped_degrees(this.angle))}};if(!singleglobal_){cnds.CompareInstanceVar=function(iv,cmp,val){return cr.do_cmp(this.instance_vars[iv],cmp,val)};cnds.IsBoolInstanceVarSet=function(iv){return this.instance_vars[iv]};cnds.PickInstVarHiLow=function(which,iv){var sol=this.getCurrentSol();var instances=sol.getObjects();if(!instances.length){return false};var inst=instances[0];var pickme=inst;var val=inst.instance_vars[iv];var i,len,v;for(i=1,len=instances.length;i<len;i++){inst=instances[i];v=inst.instance_vars[iv];if((which===0&&v<val)||(which===1&&v>val)){val=v;pickme=inst}};sol.pick_one(pickme);return true};cnds.PickByUID=function(u){var i,len,j,inst,families,instances,sol;var cnd=this.runtime.getCurrentCondition();if(cnd.inverted){sol=this.getCurrentSol();if(sol.select_all){sol.select_all=false;cr.clearArray(sol.instances);cr.clearArray(sol.else_instances);instances=this.instances;for(i=0,len=instances.length;i<len;i++){inst=instances[i];if(inst.uid===u){sol.else_instances.push(inst)}else{sol.instances.push(inst)}};this.applySolToContainer();return!!sol.instances.length}else{for(i=0,j=0,len=sol.instances.length;i<len;i++){inst=sol.instances[i];sol.instances[j]=inst;if(inst.uid===u){sol.else_instances.push(inst)}else{j++}};cr.truncateArray(sol.instances,j);this.applySolToContainer();return!!sol.instances.length}}else{inst=this.runtime.getObjectByUID(u);if(!inst){return false};sol=this.getCurrentSol();if(!sol.select_all&&sol.instances.indexOf(inst)===-1){return false};if(this.is_family){families=inst.type.families;for(i=0,len=families.length;i<len;i++){if(families[i]===this){sol.pick_one(inst);this.applySolToContainer();return true}}}else{if(inst.type===this){sol.pick_one(inst);this.applySolToContainer();return true}};return false}};cnds.OnCreated=function(){return true};cnds.OnDestroyed=function(){return true};acts.SetInstanceVar=function(iv,val){var myinstvars=this.instance_vars;if(cr.is_number(myinstvars[iv])){if(cr.is_number(val)){myinstvars[iv]=val}else{myinstvars[iv]=parseFloat(val)}}else{if(cr.is_string(myinstvars[iv])){if(cr.is_string(val)){myinstvars[iv]=val}else{myinstvars[iv]=val.toString()}}else{;}}};acts.AddInstanceVar=function(iv,val){var myinstvars=this.instance_vars;if(cr.is_number(myinstvars[iv])){if(cr.is_number(val)){myinstvars[iv]+=val}else{myinstvars[iv]+=parseFloat(val)}}else{if(cr.is_string(myinstvars[iv])){if(cr.is_string(val)){myinstvars[iv]+=val}else{myinstvars[iv]+=val.toString()}}else{;}}};acts.SubInstanceVar=function(iv,val){var myinstvars=this.instance_vars;if(cr.is_number(myinstvars[iv])){if(cr.is_number(val)){myinstvars[iv]-=val}else{myinstvars[iv]-=parseFloat(val)}}else{;}};acts.SetBoolInstanceVar=function(iv,val){this.instance_vars[iv]=val?1:0};acts.ToggleBoolInstanceVar=function(iv){this.instance_vars[iv]=1-this.instance_vars[iv]};acts.Destroy=function(){this.runtime.DestroyInstance(this)};if(!acts.LoadFromJsonString){acts.LoadFromJsonString=function(str_){var o,i,len,binst;try{o=JSON.parse(str_)}catch(e){return};this.runtime.loadInstanceFromJSON(this,o,true);if(this.afterLoad){this.afterLoad()};if(this.behavior_insts){for(i=0,len=this.behavior_insts.length;i<len;++i){binst=this.behavior_insts[i];if(binst.afterLoad){binst.afterLoad()}}}}};exps.Count=function(ret){var count=ret.object_class.instances.length;var i,len,inst;for(i=0,len=this.runtime.createRow.length;i<len;i++){inst=this.runtime.createRow[i];if(ret.object_class.is_family){if(inst.type.families.indexOf(ret.object_class)>=0){count++}}else{if(inst.type===ret.object_class){count++}}};ret.set_int(count)};exps.PickedCount=function(ret){ret.set_int(ret.object_class.getCurrentSol().getObjects().length)};exps.UID=function(ret){ret.set_int(this.uid)};exps.IID=function(ret){ret.set_int(this.get_iid())};if(!exps.AsJSON){exps.AsJSON=function(ret){ret.set_string(JSON.stringify(this.runtime.saveInstanceToJSON(this,true)))}}};if(appearance_aces){cnds.IsVisible=function(){return this.visible};acts.SetVisible=function(v){if(!v!==!this.visible){this.visible=!!v;this.runtime.redraw=true}};cnds.CompareOpacity=function(cmp,x){return cr.do_cmp(cr.round6dp(this.opacity*100),cmp,x)};acts.SetOpacity=function(x){var new_opacity=x/100.0;if(new_opacity<0){new_opacity=0}else{if(new_opacity>1){new_opacity=1}};if(new_opacity!==this.opacity){this.opacity=new_opacity;this.runtime.redraw=true}};exps.Opacity=function(ret){ret.set_float(cr.round6dp(this.opacity*100.0))}};if(zorder_aces){cnds.IsOnLayer=function(layer_){if(!layer_){return false};return this.layer===layer_};cnds.PickTopBottom=function(which_){var sol=this.getCurrentSol();var instances=sol.getObjects();if(!instances.length){return false};var inst=instances[0];var pickme=inst;var i,len;for(i=1,len=instances.length;i<len;i++){inst=instances[i];if(which_===0){if(inst.layer.index>pickme.layer.index||(inst.layer.index===pickme.layer.index&&inst.get_zindex()>pickme.get_zindex())){pickme=inst}}else{if(inst.layer.index<pickme.layer.index||(inst.layer.index===pickme.layer.index&&inst.get_zindex()<pickme.get_zindex())){pickme=inst}}};sol.pick_one(pickme);return true};acts.MoveToTop=function(){var layer=this.layer;var layer_instances=layer.instances;if(layer_instances.length&&layer_instances[layer_instances.length-1]===this){return};layer.removeFromInstanceList(this,false);layer.appendToInstanceList(this,false);this.runtime.redraw=true};acts.MoveToBottom=function(){var layer=this.layer;var layer_instances=layer.instances;if(layer_instances.length&&layer_instances[0]===this){return};layer.removeFromInstanceList(this,false);layer.prependToInstanceList(this,false);this.runtime.redraw=true};acts.MoveToLayer=function(layerMove){if(!layerMove||layerMove==this.layer){return};this.layer.removeFromInstanceList(this,true);this.layer=layerMove;layerMove.appendToInstanceList(this,true);this.runtime.redraw=true};acts.ZMoveToObject=function(where_,obj_){var isafter=(where_===0);if(!obj_){return};var other=obj_.getFirstPicked(this);if(!other||other.uid===this.uid){return};if(this.layer.index!==other.layer.index){this.layer.removeFromInstanceList(this,true);this.layer=other.layer;other.layer.appendToInstanceList(this,true)};this.layer.moveInstanceAdjacent(this,other,isafter);this.runtime.redraw=true};exps.LayerNumber=function(ret){ret.set_int(this.layer.number)};exps.LayerName=function(ret){ret.set_string(this.layer.name)};exps.ZIndex=function(ret){ret.set_int(this.get_zindex())}};if(effects_aces){acts.SetEffectEnabled=function(enable_,effectname_){if(!this.runtime.glwrap){return};var i=this.type.getEffectIndexByName(effectname_);if(i<0){return};var enable=(enable_===1);if(this.active_effect_flags[i]===enable){return};this.active_effect_flags[i]=enable;this.updateActiveEffects();this.runtime.redraw=true};acts.SetEffectParam=function(effectname_,index_,value_){if(!this.runtime.glwrap){return};var i=this.type.getEffectIndexByName(effectname_);if(i<0){return};var et=this.type.effect_types[i];var params=this.effect_params[i];index_=Math.floor(index_);if(index_<0||index_>=params.length){return};if(this.runtime.glwrap.getProgramParameterType(et.shaderindex,index_)===1){value_/=100.0};if(params[index_]===value_){return};params[index_]=value_;if(et.active){this.runtime.redraw=true}}}};cr.set_bbox_changed=function(){this.bbox_changed=true;this.cell_changed=true;this.type.any_cell_changed=true;this.runtime.redraw=true;var i,len,callbacks=this.bbox_changed_callbacks;for(i=0,len=callbacks.length;i<len;++i){callbacks[i](this)};if(this.layer.useRenderCells){this.update_bbox()}};cr.add_bbox_changed_callback=function(f){if(f){this.bbox_changed_callbacks.push(f)}};cr.update_bbox=function(){if(!this.bbox_changed){return};var bbox=this.bbox;var bquad=this.bquad;bbox["\x73\x65\x74"](this.x,this.y,this.x+this.width,this.y+this.height);bbox.offset(-this.hotspotX*this.width,-this.hotspotY*this.height);if(!this.angle){bquad.set_from_rect(bbox)}else{bbox.offset(-this.x,-this.y);bquad.set_from_rotated_rect(bbox,this.angle);bquad.offset(this.x,this.y);bquad.bounding_box(bbox)};bbox.normalize();this.bbox_changed=false;this.update_render_cell()};var tmprc=new cr.rect(0,0,0,0);cr.update_render_cell=function(){if(!this.layer.useRenderCells){return};var mygrid=this.layer.render_grid;var bbox=this.bbox;tmprc["\x73\x65\x74"](mygrid.XToCell(bbox.left),mygrid.YToCell(bbox.top),mygrid.XToCell(bbox.right),mygrid.YToCell(bbox.bottom));if(this.rendercells.equals(tmprc)){return};if(this.rendercells.right<this.rendercells.left){mygrid.update(this,null,tmprc)}else{mygrid.update(this,this.rendercells,tmprc)};this.rendercells.copy(tmprc);this.layer.render_list_stale=true};cr.update_collision_cell=function(){if(!this.cell_changed||!this.collisionsEnabled){return};this.update_bbox();var mygrid=this.type.collision_grid;var bbox=this.bbox;tmprc["\x73\x65\x74"](mygrid.XToCell(bbox.left),mygrid.YToCell(bbox.top),mygrid.XToCell(bbox.right),mygrid.YToCell(bbox.bottom));if(this.collcells.equals(tmprc)){return};if(this.collcells.right<this.collcells.left){mygrid.update(this,null,tmprc)}else{mygrid.update(this,this.collcells,tmprc)};this.collcells.copy(tmprc);this.cell_changed=false};cr.inst_contains_pt=function(x,y){if(!this.bbox.contains_pt(x,y)){return false};if(!this.bquad.contains_pt(x,y)){return false};if(this.collision_poly&&!this.collision_poly.is_empty()){this.collision_poly.cache_poly(this.width,this.height,this.angle);return this.collision_poly.contains_pt(x-this.x,y-this.y)}else{return true}};cr.inst_get_iid=function(){this.type.updateIIDs();return this.iid};cr.inst_get_zindex=function(){this.layer.updateZIndices();return this.zindex};cr.inst_updateActiveEffects=function(){cr.clearArray(this.active_effect_types);var i,len,et;var preserves_opaqueness=true;for(i=0,len=this.active_effect_flags.length;i<len;i++){if(this.active_effect_flags[i]){et=this.type.effect_types[i];this.active_effect_types.push(et);if(!et.preservesOpaqueness){preserves_opaqueness=false}}};this.uses_shaders=!!this.active_effect_types.length;this.shaders_preserve_opaqueness=preserves_opaqueness};cr.inst_toString=function(){return "\x49\x6E\x73\x74"+this.puid};cr.type_getFirstPicked=function(frominst){if(frominst&&frominst.is_contained&&frominst.type!=this){var i,len,s;for(i=0,len=frominst.siblings.length;i<len;i++){s=frominst.siblings[i];if(s.type==this){return s}}};var instances=this.getCurrentSol().getObjects();if(instances.length){return instances[0]}else{return null}};cr.type_getPairedInstance=function(inst){var instances=this.getCurrentSol().getObjects();if(instances.length){return instances[inst.get_iid()%instances.length]}else{return null}};cr.type_updateIIDs=function(){if(!this.stale_iids||this.is_family){return};var i,len;for(i=0,len=this.instances.length;i<len;i++){this.instances[i].iid=i};var next_iid=i;var createRow=this.runtime.createRow;for(i=0,len=createRow.length;i<len;++i){if(createRow[i].type===this){createRow[i].iid=next_iid++}};this.stale_iids=false};cr.type_getInstanceByIID=function(i){if(i<this.instances.length){return this.instances[i]};i-=this.instances.length;var createRow=this.runtime.createRow;var j,lenj;for(j=0,lenj=createRow.length;j<lenj;++j){if(createRow[j].type===this){if(i===0){return createRow[j]};--i}};;;return null};cr.type_getCurrentSol=function(){return this.solstack[this.cur_sol]};cr.type_pushCleanSol=function(){this.cur_sol++;if(this.cur_sol===this.solstack.length){this.solstack.push(new cr.selection(this))}else{this.solstack[this.cur_sol].select_all=true}};cr.type_pushCopySol=function(){this.cur_sol++;if(this.cur_sol===this.solstack.length){this.solstack.push(new cr.selection(this))};var clonesol=this.solstack[this.cur_sol];var prevsol=this.solstack[this.cur_sol-1];if(prevsol.select_all){clonesol.select_all=true}else{clonesol.select_all=false;cr.shallowAssignArray(clonesol.instances,prevsol.instances);cr.shallowAssignArray(clonesol.else_instances,prevsol.else_instances)}};cr.type_popSol=function(){;;this.cur_sol--};cr.type_getBehaviorByName=function(behname){var i,len,j,lenj,f,index=0;if(!this.is_family){for(i=0,len=this.families.length;i<len;i++){f=this.families[i];for(j=0,lenj=f.behaviors.length;j<lenj;j++){if(behname===f.behaviors[j].name){this.extra["\x6C\x61\x73\x74\x42\x65\x68\x49\x6E\x64\x65\x78"]=index;return f.behaviors[j]};index++}}};for(i=0,len=this.behaviors.length;i<len;i++){if(behname===this.behaviors[i].name){this.extra["\x6C\x61\x73\x74\x42\x65\x68\x49\x6E\x64\x65\x78"]=index;return this.behaviors[i]};index++};return null};cr.type_getBehaviorIndexByName=function(behname){var b=this.getBehaviorByName(behname);if(b){return this.extra["\x6C\x61\x73\x74\x42\x65\x68\x49\x6E\x64\x65\x78"]}else{return-1}};cr.type_getEffectIndexByName=function(name_){var i,len;for(i=0,len=this.effect_types.length;i<len;i++){if(this.effect_types[i].name===name_){return i}};return-1};cr.type_applySolToContainer=function(){if(!this.is_contained||this.is_family){return};var i,len,j,lenj,t,sol,sol2;this.updateIIDs();sol=this.getCurrentSol();var select_all=sol.select_all;var es=this.runtime.getCurrentEventStack();var orblock=es&&es.current_event&&es.current_event.orblock;for(i=0,len=this.container.length;i<len;i++){t=this.container[i];if(t===this){continue};t.updateIIDs();sol2=t.getCurrentSol();sol2.select_all=select_all;if(!select_all){cr.clearArray(sol2.instances);for(j=0,lenj=sol.instances.length;j<lenj;++j){sol2.instances[j]=t.getInstanceByIID(sol.instances[j].iid)};if(orblock){cr.clearArray(sol2.else_instances);for(j=0,lenj=sol.else_instances.length;j<lenj;++j){sol2.else_instances[j]=t.getInstanceByIID(sol.else_instances[j].iid)}}}}};cr.type_toString=function(){return "\x54\x79\x70\x65"+this.sid};cr.do_cmp=function(x,cmp,y){if(typeof x==="\x75\x6E\x64\x65\x66\x69\x6E\x65\x64"||typeof y==="\x75\x6E\x64\x65\x66\x69\x6E\x65\x64"){return false};switch(cmp){case 0:return x===y;case 1:return x!==y;case 2:return x<y;case 3:return x<=y;case 4:return x>y;case 5:return x>=y;default:;;return false}}})();cr.shaders={};cr.shaders["\x65\x78\x70\x6F\x73\x75\x72\x65"]={src:["\x76\x61\x72\x79\x69\x6E\x67\x20\x6D\x65\x64\x69\x75\x6D\x70\x20\x76\x65\x63\x32\x20\x76\x54\x65\x78\x3B","\x75\x6E\x69\x66\x6F\x72\x6D\x20\x6C\x6F\x77\x70\x20\x73\x61\x6D\x70\x6C\x65\x72\x32\x44\x20\x73\x61\x6D\x70\x6C\x65\x72\x46\x72\x6F\x6E\x74\x3B","\x75\x6E\x69\x66\x6F\x72\x6D\x20\x6D\x65\x64\x69\x75\x6D\x70\x20\x66\x6C\x6F\x61\x74\x20\x65\x78\x70\x6F\x73\x75\x72\x65\x3B","\x76\x6F\x69\x64\x20\x6D\x61\x69\x6E\x28\x76\x6F\x69\x64\x29","\x7B","\x6C\x6F\x77\x70\x20\x76\x65\x63\x34\x20\x66\x72\x6F\x6E\x74\x20\x3D\x20\x74\x65\x78\x74\x75\x72\x65\x32\x44\x28\x73\x61\x6D\x70\x6C\x65\x72\x46\x72\x6F\x6E\x74\x2C\x20\x76\x54\x65\x78\x29\x3B","\x67\x6C\x5F\x46\x72\x61\x67\x43\x6F\x6C\x6F\x72\x20\x3D\x20\x76\x65\x63\x34\x28\x66\x72\x6F\x6E\x74\x2E\x72\x67\x62\x20\x2A\x20\x70\x6F\x77\x28\x32\x2E\x30\x2C\x20\x65\x78\x70\x6F\x73\x75\x72\x65\x29\x2C\x20\x66\x72\x6F\x6E\x74\x2E\x61\x29\x3B","\x7D"].join("\x0A"),extendBoxHorizontal:0,extendBoxVertical:0,crossSampling:false,preservesOpaqueness:true,animated:false,parameters:[["\x65\x78\x70\x6F\x73\x75\x72\x65",0,1]]};;;cr.plugins_.Audio=function(runtime){this.runtime=runtime};(function(){var pluginProto=cr.plugins_.Audio.prototype;pluginProto.Type=function(plugin){this.plugin=plugin;this.runtime=plugin.runtime};var typeProto=pluginProto.Type.prototype;typeProto.onCreate=function(){};var audRuntime=null;var audInst=null;var audTag="";var appPath="";var API_HTML5=0;var API_WEBAUDIO=1;var API_CORDOVA=2;var API_APPMOBI=3;var api=API_HTML5;var context=null;var audioBuffers=[];var audioInstances=[];var lastAudio=null;var useOgg=false;var timescale_mode=0;var silent=false;var masterVolume=1;var listenerX=0;var listenerY=0;var panningModel=1;var distanceModel=1;var refDistance=10;var maxDistance=10000;var rolloffFactor=1;var micSource=null;var micTag="";var isMusicWorkaround=false;var musicPlayNextTouch=[];function dbToLinear(x){var v=dbToLinear_nocap(x);if(!isFinite(v)){v=0};if(v<0){v=0};if(v>1){v=1};return v}function linearToDb(x){if(x<0){x=0};if(x>1){x=1};return linearToDb_nocap(x)}function dbToLinear_nocap(x){return Math.pow(10,x/20)}function linearToDb_nocap(x){return(Math.log(x)/Math.log(10))*20}var effects={};function getDestinationForTag(tag){tag=tag.toLowerCase();if(effects.hasOwnProperty(tag)){if(effects[tag].length){return effects[tag][0].getInputNode()}};return context["\x64\x65\x73\x74\x69\x6E\x61\x74\x69\x6F\x6E"]}function createGain(){if(context["\x63\x72\x65\x61\x74\x65\x47\x61\x69\x6E"]){return context["\x63\x72\x65\x61\x74\x65\x47\x61\x69\x6E"]()}else{return context["\x63\x72\x65\x61\x74\x65\x47\x61\x69\x6E\x4E\x6F\x64\x65"]()}}function createDelay(d){if(context["\x63\x72\x65\x61\x74\x65\x44\x65\x6C\x61\x79"]){return context["\x63\x72\x65\x61\x74\x65\x44\x65\x6C\x61\x79"](d)}else{return context["\x63\x72\x65\x61\x74\x65\x44\x65\x6C\x61\x79\x4E\x6F\x64\x65"](d)}}function startSource(s){if(s["\x73\x74\x61\x72\x74"]){s["\x73\x74\x61\x72\x74"](0)}else{s["\x6E\x6F\x74\x65\x4F\x6E"](0)}}function startSourceAt(s,x,d){if(s["\x73\x74\x61\x72\x74"]){s["\x73\x74\x61\x72\x74"](0,x)}else{s["\x6E\x6F\x74\x65\x47\x72\x61\x69\x6E\x4F\x6E"](0,x,d-x)}}function stopSource(s){try{if(s["\x73\x74\x6F\x70"]){s["\x73\x74\x6F\x70"](0)}else{s["\x6E\x6F\x74\x65\x4F\x66\x66"](0)}}catch(e){}}function setAudioParam(ap,value,ramp,time){if(!ap){return};ap["\x63\x61\x6E\x63\x65\x6C\x53\x63\x68\x65\x64\x75\x6C\x65\x64\x56\x61\x6C\x75\x65\x73"](0);if(time===0){ap["\x76\x61\x6C\x75\x65"]=value;return};var curTime=context["\x63\x75\x72\x72\x65\x6E\x74\x54\x69\x6D\x65"];time+=curTime;switch(ramp){case 0:ap["\x73\x65\x74\x56\x61\x6C\x75\x65\x41\x74\x54\x69\x6D\x65"](value,time);break;case 1:ap["\x73\x65\x74\x56\x61\x6C\x75\x65\x41\x74\x54\x69\x6D\x65"](ap["\x76\x61\x6C\x75\x65"],curTime);ap["\x6C\x69\x6E\x65\x61\x72\x52\x61\x6D\x70\x54\x6F\x56\x61\x6C\x75\x65\x41\x74\x54\x69\x6D\x65"](value,time);break;case 2:ap["\x73\x65\x74\x56\x61\x6C\x75\x65\x41\x74\x54\x69\x6D\x65"](ap["\x76\x61\x6C\x75\x65"],curTime);ap["\x65\x78\x70\x6F\x6E\x65\x6E\x74\x69\x61\x6C\x52\x61\x6D\x70\x54\x6F\x56\x61\x6C\x75\x65\x41\x74\x54\x69\x6D\x65"](value,time);break}}var filterTypes=["\x6C\x6F\x77\x70\x61\x73\x73","\x68\x69\x67\x68\x70\x61\x73\x73","\x62\x61\x6E\x64\x70\x61\x73\x73","\x6C\x6F\x77\x73\x68\x65\x6C\x66","\x68\x69\x67\x68\x73\x68\x65\x6C\x66","\x70\x65\x61\x6B\x69\x6E\x67","\x6E\x6F\x74\x63\x68","\x61\x6C\x6C\x70\x61\x73\x73"];function FilterEffect(type,freq,detune,q,gain,mix){this.type="\x66\x69\x6C\x74\x65\x72";this.params=[type,freq,detune,q,gain,mix];this.inputNode=createGain();this.wetNode=createGain();this.wetNode["\x67\x61\x69\x6E"]["\x76\x61\x6C\x75\x65"]=mix;this.dryNode=createGain();this.dryNode["\x67\x61\x69\x6E"]["\x76\x61\x6C\x75\x65"]=1-mix;this.filterNode=context["\x63\x72\x65\x61\x74\x65\x42\x69\x71\x75\x61\x64\x46\x69\x6C\x74\x65\x72"]();if(typeof this.filterNode["\x74\x79\x70\x65"]==="\x6E\x75\x6D\x62\x65\x72"){this.filterNode["\x74\x79\x70\x65"]=type}else{this.filterNode["\x74\x79\x70\x65"]=filterTypes[type]};this.filterNode["\x66\x72\x65\x71\x75\x65\x6E\x63\x79"]["\x76\x61\x6C\x75\x65"]=freq;if(this.filterNode["\x64\x65\x74\x75\x6E\x65"]){this.filterNode["\x64\x65\x74\x75\x6E\x65"]["\x76\x61\x6C\x75\x65"]=detune};this.filterNode["\x51"]["\x76\x61\x6C\x75\x65"]=q;this.filterNode["\x67\x61\x69\x6E"]["\x76\x61\x6C\x75\x65"]=gain;this.inputNode["\x63\x6F\x6E\x6E\x65\x63\x74"](this.filterNode);this.inputNode["\x63\x6F\x6E\x6E\x65\x63\x74"](this.dryNode);this.filterNode["\x63\x6F\x6E\x6E\x65\x63\x74"](this.wetNode)}FilterEffect.prototype.connectTo=function(node){this.wetNode["\x64\x69\x73\x63\x6F\x6E\x6E\x65\x63\x74"]();this.wetNode["\x63\x6F\x6E\x6E\x65\x63\x74"](node);this.dryNode["\x64\x69\x73\x63\x6F\x6E\x6E\x65\x63\x74"]();this.dryNode["\x63\x6F\x6E\x6E\x65\x63\x74"](node)};FilterEffect.prototype.remove=function(){this.inputNode["\x64\x69\x73\x63\x6F\x6E\x6E\x65\x63\x74"]();this.filterNode["\x64\x69\x73\x63\x6F\x6E\x6E\x65\x63\x74"]();this.wetNode["\x64\x69\x73\x63\x6F\x6E\x6E\x65\x63\x74"]();this.dryNode["\x64\x69\x73\x63\x6F\x6E\x6E\x65\x63\x74"]()};FilterEffect.prototype.getInputNode=function(){return this.inputNode};FilterEffect.prototype.setParam=function(param,value,ramp,time){switch(param){case 0:value=value/100;if(value<0){value=0};if(value>1){value=1};this.params[5]=value;setAudioParam(this.wetNode["\x67\x61\x69\x6E"],value,ramp,time);setAudioParam(this.dryNode["\x67\x61\x69\x6E"],1-value,ramp,time);break;case 1:this.params[1]=value;setAudioParam(this.filterNode["\x66\x72\x65\x71\x75\x65\x6E\x63\x79"],value,ramp,time);break;case 2:this.params[2]=value;setAudioParam(this.filterNode["\x64\x65\x74\x75\x6E\x65"],value,ramp,time);break;case 3:this.params[3]=value;setAudioParam(this.filterNode["\x51"],value,ramp,time);break;case 4:this.params[4]=value;setAudioParam(this.filterNode["\x67\x61\x69\x6E"],value,ramp,time);break}};function DelayEffect(delayTime,delayGain,mix){this.type="\x64\x65\x6C\x61\x79";this.params=[delayTime,delayGain,mix];this.inputNode=createGain();this.wetNode=createGain();this.wetNode["\x67\x61\x69\x6E"]["\x76\x61\x6C\x75\x65"]=mix;this.dryNode=createGain();this.dryNode["\x67\x61\x69\x6E"]["\x76\x61\x6C\x75\x65"]=1-mix;this.mainNode=createGain();this.delayNode=createDelay(delayTime);this.delayNode["\x64\x65\x6C\x61\x79\x54\x69\x6D\x65"]["\x76\x61\x6C\x75\x65"]=delayTime;this.delayGainNode=createGain();this.delayGainNode["\x67\x61\x69\x6E"]["\x76\x61\x6C\x75\x65"]=delayGain;this.inputNode["\x63\x6F\x6E\x6E\x65\x63\x74"](this.mainNode);this.inputNode["\x63\x6F\x6E\x6E\x65\x63\x74"](this.dryNode);this.mainNode["\x63\x6F\x6E\x6E\x65\x63\x74"](this.wetNode);this.mainNode["\x63\x6F\x6E\x6E\x65\x63\x74"](this.delayNode);this.delayNode["\x63\x6F\x6E\x6E\x65\x63\x74"](this.delayGainNode);this.delayGainNode["\x63\x6F\x6E\x6E\x65\x63\x74"](this.mainNode)}DelayEffect.prototype.connectTo=function(node){this.wetNode["\x64\x69\x73\x63\x6F\x6E\x6E\x65\x63\x74"]();this.wetNode["\x63\x6F\x6E\x6E\x65\x63\x74"](node);this.dryNode["\x64\x69\x73\x63\x6F\x6E\x6E\x65\x63\x74"]();this.dryNode["\x63\x6F\x6E\x6E\x65\x63\x74"](node)};DelayEffect.prototype.remove=function(){this.inputNode["\x64\x69\x73\x63\x6F\x6E\x6E\x65\x63\x74"]();this.mainNode["\x64\x69\x73\x63\x6F\x6E\x6E\x65\x63\x74"]();this.delayNode["\x64\x69\x73\x63\x6F\x6E\x6E\x65\x63\x74"]();this.delayGainNode["\x64\x69\x73\x63\x6F\x6E\x6E\x65\x63\x74"]();this.wetNode["\x64\x69\x73\x63\x6F\x6E\x6E\x65\x63\x74"]();this.dryNode["\x64\x69\x73\x63\x6F\x6E\x6E\x65\x63\x74"]()};DelayEffect.prototype.getInputNode=function(){return this.inputNode};DelayEffect.prototype.setParam=function(param,value,ramp,time){switch(param){case 0:value=value/100;if(value<0){value=0};if(value>1){value=1};this.params[2]=value;setAudioParam(this.wetNode["\x67\x61\x69\x6E"],value,ramp,time);setAudioParam(this.dryNode["\x67\x61\x69\x6E"],1-value,ramp,time);break;case 4:this.params[1]=dbToLinear(value);setAudioParam(this.delayGainNode["\x67\x61\x69\x6E"],dbToLinear(value),ramp,time);break;case 5:this.params[0]=value;setAudioParam(this.delayNode["\x64\x65\x6C\x61\x79\x54\x69\x6D\x65"],value,ramp,time);break}};function ConvolveEffect(buffer,normalize,mix,src){this.type="\x63\x6F\x6E\x76\x6F\x6C\x76\x65";this.params=[normalize,mix,src];this.inputNode=createGain();this.wetNode=createGain();this.wetNode["\x67\x61\x69\x6E"]["\x76\x61\x6C\x75\x65"]=mix;this.dryNode=createGain();this.dryNode["\x67\x61\x69\x6E"]["\x76\x61\x6C\x75\x65"]=1-mix;this.convolveNode=context["\x63\x72\x65\x61\x74\x65\x43\x6F\x6E\x76\x6F\x6C\x76\x65\x72"]();if(buffer){this.convolveNode["\x6E\x6F\x72\x6D\x61\x6C\x69\x7A\x65"]=normalize;this.convolveNode["\x62\x75\x66\x66\x65\x72"]=buffer};this.inputNode["\x63\x6F\x6E\x6E\x65\x63\x74"](this.convolveNode);this.inputNode["\x63\x6F\x6E\x6E\x65\x63\x74"](this.dryNode);this.convolveNode["\x63\x6F\x6E\x6E\x65\x63\x74"](this.wetNode)}ConvolveEffect.prototype.connectTo=function(node){this.wetNode["\x64\x69\x73\x63\x6F\x6E\x6E\x65\x63\x74"]();this.wetNode["\x63\x6F\x6E\x6E\x65\x63\x74"](node);this.dryNode["\x64\x69\x73\x63\x6F\x6E\x6E\x65\x63\x74"]();this.dryNode["\x63\x6F\x6E\x6E\x65\x63\x74"](node)};ConvolveEffect.prototype.remove=function(){this.inputNode["\x64\x69\x73\x63\x6F\x6E\x6E\x65\x63\x74"]();this.convolveNode["\x64\x69\x73\x63\x6F\x6E\x6E\x65\x63\x74"]();this.wetNode["\x64\x69\x73\x63\x6F\x6E\x6E\x65\x63\x74"]();this.dryNode["\x64\x69\x73\x63\x6F\x6E\x6E\x65\x63\x74"]()};ConvolveEffect.prototype.getInputNode=function(){return this.inputNode};ConvolveEffect.prototype.setParam=function(param,value,ramp,time){switch(param){case 0:value=value/100;if(value<0){value=0};if(value>1){value=1};this.params[1]=value;setAudioParam(this.wetNode["\x67\x61\x69\x6E"],value,ramp,time);setAudioParam(this.dryNode["\x67\x61\x69\x6E"],1-value,ramp,time);break}};function FlangerEffect(delay,modulation,freq,feedback,mix){this.type="\x66\x6C\x61\x6E\x67\x65\x72";this.params=[delay,modulation,freq,feedback,mix];this.inputNode=createGain();this.dryNode=createGain();this.dryNode["\x67\x61\x69\x6E"]["\x76\x61\x6C\x75\x65"]=1-(mix/2);this.wetNode=createGain();this.wetNode["\x67\x61\x69\x6E"]["\x76\x61\x6C\x75\x65"]=mix/2;this.feedbackNode=createGain();this.feedbackNode["\x67\x61\x69\x6E"]["\x76\x61\x6C\x75\x65"]=feedback;this.delayNode=createDelay(delay+modulation);this.delayNode["\x64\x65\x6C\x61\x79\x54\x69\x6D\x65"]["\x76\x61\x6C\x75\x65"]=delay;this.oscNode=context["\x63\x72\x65\x61\x74\x65\x4F\x73\x63\x69\x6C\x6C\x61\x74\x6F\x72"]();this.oscNode["\x66\x72\x65\x71\x75\x65\x6E\x63\x79"]["\x76\x61\x6C\x75\x65"]=freq;this.oscGainNode=createGain();this.oscGainNode["\x67\x61\x69\x6E"]["\x76\x61\x6C\x75\x65"]=modulation;this.inputNode["\x63\x6F\x6E\x6E\x65\x63\x74"](this.delayNode);this.inputNode["\x63\x6F\x6E\x6E\x65\x63\x74"](this.dryNode);this.delayNode["\x63\x6F\x6E\x6E\x65\x63\x74"](this.wetNode);this.delayNode["\x63\x6F\x6E\x6E\x65\x63\x74"](this.feedbackNode);this.feedbackNode["\x63\x6F\x6E\x6E\x65\x63\x74"](this.delayNode);this.oscNode["\x63\x6F\x6E\x6E\x65\x63\x74"](this.oscGainNode);this.oscGainNode["\x63\x6F\x6E\x6E\x65\x63\x74"](this.delayNode["\x64\x65\x6C\x61\x79\x54\x69\x6D\x65"]);startSource(this.oscNode)}FlangerEffect.prototype.connectTo=function(node){this.dryNode["\x64\x69\x73\x63\x6F\x6E\x6E\x65\x63\x74"]();this.dryNode["\x63\x6F\x6E\x6E\x65\x63\x74"](node);this.wetNode["\x64\x69\x73\x63\x6F\x6E\x6E\x65\x63\x74"]();this.wetNode["\x63\x6F\x6E\x6E\x65\x63\x74"](node)};FlangerEffect.prototype.remove=function(){this.inputNode["\x64\x69\x73\x63\x6F\x6E\x6E\x65\x63\x74"]();this.delayNode["\x64\x69\x73\x63\x6F\x6E\x6E\x65\x63\x74"]();this.oscNode["\x64\x69\x73\x63\x6F\x6E\x6E\x65\x63\x74"]();this.oscGainNode["\x64\x69\x73\x63\x6F\x6E\x6E\x65\x63\x74"]();this.dryNode["\x64\x69\x73\x63\x6F\x6E\x6E\x65\x63\x74"]();this.wetNode["\x64\x69\x73\x63\x6F\x6E\x6E\x65\x63\x74"]();this.feedbackNode["\x64\x69\x73\x63\x6F\x6E\x6E\x65\x63\x74"]()};FlangerEffect.prototype.getInputNode=function(){return this.inputNode};FlangerEffect.prototype.setParam=function(param,value,ramp,time){switch(param){case 0:value=value/100;if(value<0){value=0};if(value>1){value=1};this.params[4]=value;setAudioParam(this.wetNode["\x67\x61\x69\x6E"],value/2,ramp,time);setAudioParam(this.dryNode["\x67\x61\x69\x6E"],1-(value/2),ramp,time);break;case 6:this.params[1]=value/1000;setAudioParam(this.oscGainNode["\x67\x61\x69\x6E"],value/1000,ramp,time);break;case 7:this.params[2]=value;setAudioParam(this.oscNode["\x66\x72\x65\x71\x75\x65\x6E\x63\x79"],value,ramp,time);break;case 8:this.params[3]=value/100;setAudioParam(this.feedbackNode["\x67\x61\x69\x6E"],value/100,ramp,time);break}};function PhaserEffect(freq,detune,q,modulation,modfreq,mix){this.type="\x70\x68\x61\x73\x65\x72";this.params=[freq,detune,q,modulation,modfreq,mix];this.inputNode=createGain();this.dryNode=createGain();this.dryNode["\x67\x61\x69\x6E"]["\x76\x61\x6C\x75\x65"]=1-(mix/2);this.wetNode=createGain();this.wetNode["\x67\x61\x69\x6E"]["\x76\x61\x6C\x75\x65"]=mix/2;this.filterNode=context["\x63\x72\x65\x61\x74\x65\x42\x69\x71\x75\x61\x64\x46\x69\x6C\x74\x65\x72"]();if(typeof this.filterNode["\x74\x79\x70\x65"]==="\x6E\x75\x6D\x62\x65\x72"){this.filterNode["\x74\x79\x70\x65"]=7}else{this.filterNode["\x74\x79\x70\x65"]="\x61\x6C\x6C\x70\x61\x73\x73"};this.filterNode["\x66\x72\x65\x71\x75\x65\x6E\x63\x79"]["\x76\x61\x6C\x75\x65"]=freq;if(this.filterNode["\x64\x65\x74\x75\x6E\x65"]){this.filterNode["\x64\x65\x74\x75\x6E\x65"]["\x76\x61\x6C\x75\x65"]=detune};this.filterNode["\x51"]["\x76\x61\x6C\x75\x65"]=q;this.oscNode=context["\x63\x72\x65\x61\x74\x65\x4F\x73\x63\x69\x6C\x6C\x61\x74\x6F\x72"]();this.oscNode["\x66\x72\x65\x71\x75\x65\x6E\x63\x79"]["\x76\x61\x6C\x75\x65"]=modfreq;this.oscGainNode=createGain();this.oscGainNode["\x67\x61\x69\x6E"]["\x76\x61\x6C\x75\x65"]=modulation;this.inputNode["\x63\x6F\x6E\x6E\x65\x63\x74"](this.filterNode);this.inputNode["\x63\x6F\x6E\x6E\x65\x63\x74"](this.dryNode);this.filterNode["\x63\x6F\x6E\x6E\x65\x63\x74"](this.wetNode);this.oscNode["\x63\x6F\x6E\x6E\x65\x63\x74"](this.oscGainNode);this.oscGainNode["\x63\x6F\x6E\x6E\x65\x63\x74"](this.filterNode["\x66\x72\x65\x71\x75\x65\x6E\x63\x79"]);startSource(this.oscNode)}PhaserEffect.prototype.connectTo=function(node){this.dryNode["\x64\x69\x73\x63\x6F\x6E\x6E\x65\x63\x74"]();this.dryNode["\x63\x6F\x6E\x6E\x65\x63\x74"](node);this.wetNode["\x64\x69\x73\x63\x6F\x6E\x6E\x65\x63\x74"]();this.wetNode["\x63\x6F\x6E\x6E\x65\x63\x74"](node)};PhaserEffect.prototype.remove=function(){this.inputNode["\x64\x69\x73\x63\x6F\x6E\x6E\x65\x63\x74"]();this.filterNode["\x64\x69\x73\x63\x6F\x6E\x6E\x65\x63\x74"]();this.oscNode["\x64\x69\x73\x63\x6F\x6E\x6E\x65\x63\x74"]();this.oscGainNode["\x64\x69\x73\x63\x6F\x6E\x6E\x65\x63\x74"]();this.dryNode["\x64\x69\x73\x63\x6F\x6E\x6E\x65\x63\x74"]();this.wetNode["\x64\x69\x73\x63\x6F\x6E\x6E\x65\x63\x74"]()};PhaserEffect.prototype.getInputNode=function(){return this.inputNode};PhaserEffect.prototype.setParam=function(param,value,ramp,time){switch(param){case 0:value=value/100;if(value<0){value=0};if(value>1){value=1};this.params[5]=value;setAudioParam(this.wetNode["\x67\x61\x69\x6E"],value/2,ramp,time);setAudioParam(this.dryNode["\x67\x61\x69\x6E"],1-(value/2),ramp,time);break;case 1:this.params[0]=value;setAudioParam(this.filterNode["\x66\x72\x65\x71\x75\x65\x6E\x63\x79"],value,ramp,time);break;case 2:this.params[1]=value;setAudioParam(this.filterNode["\x64\x65\x74\x75\x6E\x65"],value,ramp,time);break;case 3:this.params[2]=value;setAudioParam(this.filterNode["\x51"],value,ramp,time);break;case 6:this.params[3]=value;setAudioParam(this.oscGainNode["\x67\x61\x69\x6E"],value,ramp,time);break;case 7:this.params[4]=value;setAudioParam(this.oscNode["\x66\x72\x65\x71\x75\x65\x6E\x63\x79"],value,ramp,time);break}};function GainEffect(g){this.type="\x67\x61\x69\x6E";this.params=[g];this.node=createGain();this.node["\x67\x61\x69\x6E"]["\x76\x61\x6C\x75\x65"]=g}GainEffect.prototype.connectTo=function(node_){this.node["\x64\x69\x73\x63\x6F\x6E\x6E\x65\x63\x74"]();this.node["\x63\x6F\x6E\x6E\x65\x63\x74"](node_)};GainEffect.prototype.remove=function(){this.node["\x64\x69\x73\x63\x6F\x6E\x6E\x65\x63\x74"]()};GainEffect.prototype.getInputNode=function(){return this.node};GainEffect.prototype.setParam=function(param,value,ramp,time){switch(param){case 4:this.params[0]=dbToLinear(value);setAudioParam(this.node["\x67\x61\x69\x6E"],dbToLinear(value),ramp,time);break}};function TremoloEffect(freq,mix){this.type="\x74\x72\x65\x6D\x6F\x6C\x6F";this.params=[freq,mix];this.node=createGain();this.node["\x67\x61\x69\x6E"]["\x76\x61\x6C\x75\x65"]=1-(mix/2);this.oscNode=context["\x63\x72\x65\x61\x74\x65\x4F\x73\x63\x69\x6C\x6C\x61\x74\x6F\x72"]();this.oscNode["\x66\x72\x65\x71\x75\x65\x6E\x63\x79"]["\x76\x61\x6C\x75\x65"]=freq;this.oscGainNode=createGain();this.oscGainNode["\x67\x61\x69\x6E"]["\x76\x61\x6C\x75\x65"]=mix/2;this.oscNode["\x63\x6F\x6E\x6E\x65\x63\x74"](this.oscGainNode);this.oscGainNode["\x63\x6F\x6E\x6E\x65\x63\x74"](this.node["\x67\x61\x69\x6E"]);startSource(this.oscNode)}TremoloEffect.prototype.connectTo=function(node_){this.node["\x64\x69\x73\x63\x6F\x6E\x6E\x65\x63\x74"]();this.node["\x63\x6F\x6E\x6E\x65\x63\x74"](node_)};TremoloEffect.prototype.remove=function(){this.oscNode["\x64\x69\x73\x63\x6F\x6E\x6E\x65\x63\x74"]();this.oscGainNode["\x64\x69\x73\x63\x6F\x6E\x6E\x65\x63\x74"]();this.node["\x64\x69\x73\x63\x6F\x6E\x6E\x65\x63\x74"]()};TremoloEffect.prototype.getInputNode=function(){return this.node};TremoloEffect.prototype.setParam=function(param,value,ramp,time){switch(param){case 0:value=value/100;if(value<0){value=0};if(value>1){value=1};this.params[1]=value;setAudioParam(this.node["\x67\x61\x69\x6E"]["\x76\x61\x6C\x75\x65"],1-(value/2),ramp,time);setAudioParam(this.oscGainNode["\x67\x61\x69\x6E"]["\x76\x61\x6C\x75\x65"],value/2,ramp,time);break;case 7:this.params[0]=value;setAudioParam(this.oscNode["\x66\x72\x65\x71\x75\x65\x6E\x63\x79"],value,ramp,time);break}};function RingModulatorEffect(freq,mix){this.type="\x72\x69\x6E\x67\x6D\x6F\x64";this.params=[freq,mix];this.inputNode=createGain();this.wetNode=createGain();this.wetNode["\x67\x61\x69\x6E"]["\x76\x61\x6C\x75\x65"]=mix;this.dryNode=createGain();this.dryNode["\x67\x61\x69\x6E"]["\x76\x61\x6C\x75\x65"]=1-mix;this.ringNode=createGain();this.ringNode["\x67\x61\x69\x6E"]["\x76\x61\x6C\x75\x65"]=0;this.oscNode=context["\x63\x72\x65\x61\x74\x65\x4F\x73\x63\x69\x6C\x6C\x61\x74\x6F\x72"]();this.oscNode["\x66\x72\x65\x71\x75\x65\x6E\x63\x79"]["\x76\x61\x6C\x75\x65"]=freq;this.oscNode["\x63\x6F\x6E\x6E\x65\x63\x74"](this.ringNode["\x67\x61\x69\x6E"]);startSource(this.oscNode);this.inputNode["\x63\x6F\x6E\x6E\x65\x63\x74"](this.ringNode);this.inputNode["\x63\x6F\x6E\x6E\x65\x63\x74"](this.dryNode);this.ringNode["\x63\x6F\x6E\x6E\x65\x63\x74"](this.wetNode)}RingModulatorEffect.prototype.connectTo=function(node_){this.wetNode["\x64\x69\x73\x63\x6F\x6E\x6E\x65\x63\x74"]();this.wetNode["\x63\x6F\x6E\x6E\x65\x63\x74"](node_);this.dryNode["\x64\x69\x73\x63\x6F\x6E\x6E\x65\x63\x74"]();this.dryNode["\x63\x6F\x6E\x6E\x65\x63\x74"](node_)};RingModulatorEffect.prototype.remove=function(){this.oscNode["\x64\x69\x73\x63\x6F\x6E\x6E\x65\x63\x74"]();this.ringNode["\x64\x69\x73\x63\x6F\x6E\x6E\x65\x63\x74"]();this.inputNode["\x64\x69\x73\x63\x6F\x6E\x6E\x65\x63\x74"]();this.wetNode["\x64\x69\x73\x63\x6F\x6E\x6E\x65\x63\x74"]();this.dryNode["\x64\x69\x73\x63\x6F\x6E\x6E\x65\x63\x74"]()};RingModulatorEffect.prototype.getInputNode=function(){return this.inputNode};RingModulatorEffect.prototype.setParam=function(param,value,ramp,time){switch(param){case 0:value=value/100;if(value<0){value=0};if(value>1){value=1};this.params[1]=value;setAudioParam(this.wetNode["\x67\x61\x69\x6E"],value,ramp,time);setAudioParam(this.dryNode["\x67\x61\x69\x6E"],1-value,ramp,time);break;case 7:this.params[0]=value;setAudioParam(this.oscNode["\x66\x72\x65\x71\x75\x65\x6E\x63\x79"],value,ramp,time);break}};function DistortionEffect(threshold,headroom,drive,makeupgain,mix){this.type="\x64\x69\x73\x74\x6F\x72\x74\x69\x6F\x6E";this.params=[threshold,headroom,drive,makeupgain,mix];this.inputNode=createGain();this.preGain=createGain();this.postGain=createGain();this.setDrive(drive,dbToLinear_nocap(makeupgain));this.wetNode=createGain();this.wetNode["\x67\x61\x69\x6E"]["\x76\x61\x6C\x75\x65"]=mix;this.dryNode=createGain();this.dryNode["\x67\x61\x69\x6E"]["\x76\x61\x6C\x75\x65"]=1-mix;this.waveShaper=context["\x63\x72\x65\x61\x74\x65\x57\x61\x76\x65\x53\x68\x61\x70\x65\x72"]();this.curve=new Float32Array(65536);this.generateColortouchCurve(threshold,headroom);this.waveShaper.curve=this.curve;this.inputNode["\x63\x6F\x6E\x6E\x65\x63\x74"](this.preGain);this.inputNode["\x63\x6F\x6E\x6E\x65\x63\x74"](this.dryNode);this.preGain["\x63\x6F\x6E\x6E\x65\x63\x74"](this.waveShaper);this.waveShaper["\x63\x6F\x6E\x6E\x65\x63\x74"](this.postGain);this.postGain["\x63\x6F\x6E\x6E\x65\x63\x74"](this.wetNode)}DistortionEffect.prototype.setDrive=function(drive,makeupgain){if(drive<0.01){drive=0.01};this.preGain["\x67\x61\x69\x6E"]["\x76\x61\x6C\x75\x65"]=drive;this.postGain["\x67\x61\x69\x6E"]["\x76\x61\x6C\x75\x65"]=Math.pow(1/drive,0.6)*makeupgain};function e4(x,k){return 1.0-Math.exp(-k*x)}DistortionEffect.prototype.shape=function(x,linearThreshold,linearHeadroom){var maximum=1.05*linearHeadroom*linearThreshold;var kk=(maximum-linearThreshold);var sign=x<0?-1:+1;var absx=x<0?-x:x;var shapedInput=absx<linearThreshold?absx:linearThreshold+kk*e4(absx-linearThreshold,1.0/kk);shapedInput*=sign;return shapedInput};DistortionEffect.prototype.generateColortouchCurve=function(threshold,headroom){var linearThreshold=dbToLinear_nocap(threshold);var linearHeadroom=dbToLinear_nocap(headroom);var n=65536;var n2=n/2;var x=0;for(var i=0;i<n2;++i){x=i/n2;x=this.shape(x,linearThreshold,linearHeadroom);this.curve[n2+i]=x;this.curve[n2-i-1]=-x}};DistortionEffect.prototype.connectTo=function(node){this.wetNode["\x64\x69\x73\x63\x6F\x6E\x6E\x65\x63\x74"]();this.wetNode["\x63\x6F\x6E\x6E\x65\x63\x74"](node);this.dryNode["\x64\x69\x73\x63\x6F\x6E\x6E\x65\x63\x74"]();this.dryNode["\x63\x6F\x6E\x6E\x65\x63\x74"](node)};DistortionEffect.prototype.remove=function(){this.inputNode["\x64\x69\x73\x63\x6F\x6E\x6E\x65\x63\x74"]();this.preGain["\x64\x69\x73\x63\x6F\x6E\x6E\x65\x63\x74"]();this.waveShaper["\x64\x69\x73\x63\x6F\x6E\x6E\x65\x63\x74"]();this.postGain["\x64\x69\x73\x63\x6F\x6E\x6E\x65\x63\x74"]();this.wetNode["\x64\x69\x73\x63\x6F\x6E\x6E\x65\x63\x74"]();this.dryNode["\x64\x69\x73\x63\x6F\x6E\x6E\x65\x63\x74"]()};DistortionEffect.prototype.getInputNode=function(){return this.inputNode};DistortionEffect.prototype.setParam=function(param,value,ramp,time){switch(param){case 0:value=value/100;if(value<0){value=0};if(value>1){value=1};this.params[4]=value;setAudioParam(this.wetNode["\x67\x61\x69\x6E"],value,ramp,time);setAudioParam(this.dryNode["\x67\x61\x69\x6E"],1-value,ramp,time);break}};function CompressorEffect(threshold,knee,ratio,attack,release){this.type="\x63\x6F\x6D\x70\x72\x65\x73\x73\x6F\x72";this.params=[threshold,knee,ratio,attack,release];this.node=context["\x63\x72\x65\x61\x74\x65\x44\x79\x6E\x61\x6D\x69\x63\x73\x43\x6F\x6D\x70\x72\x65\x73\x73\x6F\x72"]();try{this.node["\x74\x68\x72\x65\x73\x68\x6F\x6C\x64"]["\x76\x61\x6C\x75\x65"]=threshold;this.node["\x6B\x6E\x65\x65"]["\x76\x61\x6C\x75\x65"]=knee;this.node["\x72\x61\x74\x69\x6F"]["\x76\x61\x6C\x75\x65"]=ratio;this.node["\x61\x74\x74\x61\x63\x6B"]["\x76\x61\x6C\x75\x65"]=attack;this.node["\x72\x65\x6C\x65\x61\x73\x65"]["\x76\x61\x6C\x75\x65"]=release}catch(e){}}CompressorEffect.prototype.connectTo=function(node_){this.node["\x64\x69\x73\x63\x6F\x6E\x6E\x65\x63\x74"]();this.node["\x63\x6F\x6E\x6E\x65\x63\x74"](node_)};CompressorEffect.prototype.remove=function(){this.node["\x64\x69\x73\x63\x6F\x6E\x6E\x65\x63\x74"]()};CompressorEffect.prototype.getInputNode=function(){return this.node};CompressorEffect.prototype.setParam=function(param,value,ramp,time){};function AnalyserEffect(fftSize,smoothing){this.type="\x61\x6E\x61\x6C\x79\x73\x65\x72";this.params=[fftSize,smoothing];this.node=context["\x63\x72\x65\x61\x74\x65\x41\x6E\x61\x6C\x79\x73\x65\x72"]();this.node["\x66\x66\x74\x53\x69\x7A\x65"]=fftSize;this.node["\x73\x6D\x6F\x6F\x74\x68\x69\x6E\x67\x54\x69\x6D\x65\x43\x6F\x6E\x73\x74\x61\x6E\x74"]=smoothing;this.freqBins=new Float32Array(this.node["\x66\x72\x65\x71\x75\x65\x6E\x63\x79\x42\x69\x6E\x43\x6F\x75\x6E\x74"]);this.signal=new Uint8Array(fftSize);this.peak=0;this.rms=0}AnalyserEffect.prototype.tick=function(){this.node["\x67\x65\x74\x46\x6C\x6F\x61\x74\x46\x72\x65\x71\x75\x65\x6E\x63\x79\x44\x61\x74\x61"](this.freqBins);this.node["\x67\x65\x74\x42\x79\x74\x65\x54\x69\x6D\x65\x44\x6F\x6D\x61\x69\x6E\x44\x61\x74\x61"](this.signal);var fftSize=this.node["\x66\x66\x74\x53\x69\x7A\x65"];var i=0;this.peak=0;var rmsSquaredSum=0;var s=0;for(;i<fftSize;i++){s=(this.signal[i]-128)/128;if(s<0){s=-s};if(this.peak<s){this.peak=s};rmsSquaredSum+=s*s};this.peak=linearToDb(this.peak);this.rms=linearToDb(Math.sqrt(rmsSquaredSum/fftSize))};AnalyserEffect.prototype.connectTo=function(node_){this.node["\x64\x69\x73\x63\x6F\x6E\x6E\x65\x63\x74"]();this.node["\x63\x6F\x6E\x6E\x65\x63\x74"](node_)};AnalyserEffect.prototype.remove=function(){this.node["\x64\x69\x73\x63\x6F\x6E\x6E\x65\x63\x74"]()};AnalyserEffect.prototype.getInputNode=function(){return this.node};AnalyserEffect.prototype.setParam=function(param,value,ramp,time){};var OT_POS_SAMPLES=4;function ObjectTracker(){this.obj=null;this.loadUid=0;this.speeds=[];this.lastX=0;this.lastY=0;this.moveAngle=0}ObjectTracker.prototype.setObject=function(obj_){this.obj=obj_;if(this.obj){this.lastX=this.obj.x;this.lastY=this.obj.y};cr.clearArray(this.speeds)};ObjectTracker.prototype.hasObject=function(){return!!this.obj};ObjectTracker.prototype.tick=function(dt){if(!this.obj||dt===0){return};this.moveAngle=cr.angleTo(this.lastX,this.lastY,this.obj.x,this.obj.y);var s=cr.distanceTo(this.lastX,this.lastY,this.obj.x,this.obj.y)/dt;if(this.speeds.length<OT_POS_SAMPLES){this.speeds.push(s)}else{this.speeds.shift();this.speeds.push(s)};this.lastX=this.obj.x;this.lastY=this.obj.y};ObjectTracker.prototype.getSpeed=function(){if(!this.speeds.length){return 0};var i,len,sum=0;for(i=0,len=this.speeds.length;i<len;i++){sum+=this.speeds[i]};return sum/this.speeds.length};ObjectTracker.prototype.getVelocityX=function(){return Math.cos(this.moveAngle)*this.getSpeed()};ObjectTracker.prototype.getVelocityY=function(){return Math.sin(this.moveAngle)*this.getSpeed()};var iOShadtouchstart=false;var iOShadtouchend=false;function C2AudioBuffer(src_,is_music){this.src=src_;this.myapi=api;this.is_music=is_music;this.added_end_listener=false;var self=this;this.outNode=null;this.mediaSourceNode=null;this.panWhenReady=[];this.seekWhenReady=0;this.pauseWhenReady=false;this.supportWebAudioAPI=false;this.failedToLoad=false;this.wasEverReady=false;if(api===API_WEBAUDIO&&is_music){this.myapi=API_HTML5;this.outNode=createGain()};this.bufferObject=null;this.audioData=null;var request;switch(this.myapi){case API_HTML5:this.bufferObject=new Audio();this.bufferObject.crossOrigin="\x61\x6E\x6F\x6E\x79\x6D\x6F\x75\x73";this.bufferObject.addEventListener("\x63\x61\x6E\x70\x6C\x61\x79\x74\x68\x72\x6F\x75\x67\x68",function(){self.wasEverReady=true});if(api===API_WEBAUDIO&&context["\x63\x72\x65\x61\x74\x65\x4D\x65\x64\x69\x61\x45\x6C\x65\x6D\x65\x6E\x74\x53\x6F\x75\x72\x63\x65"]&&!/wiiu/i.test(navigator.userAgent)){this.supportWebAudioAPI=true;this.bufferObject.addEventListener("\x63\x61\x6E\x70\x6C\x61\x79",function(){if(!self.mediaSourceNode){self.mediaSourceNode=context["\x63\x72\x65\x61\x74\x65\x4D\x65\x64\x69\x61\x45\x6C\x65\x6D\x65\x6E\x74\x53\x6F\x75\x72\x63\x65"](self.bufferObject);self.mediaSourceNode["\x63\x6F\x6E\x6E\x65\x63\x74"](self.outNode)}})};this.bufferObject.autoplay=false;this.bufferObject.preload="\x61\x75\x74\x6F";this.bufferObject.src=src_;break;case API_WEBAUDIO:request=new XMLHttpRequest();request.open("\x47\x45\x54",src_,true);request.responseType="\x61\x72\x72\x61\x79\x62\x75\x66\x66\x65\x72";request.onload=function(){self.audioData=request.response;self.decodeAudioBuffer()};request.onerror=function(){self.failedToLoad=true};request.send();break;case API_CORDOVA:this.bufferObject=true;break;case API_APPMOBI:this.bufferObject=true;break}}C2AudioBuffer.prototype.decodeAudioBuffer=function(){if(this.bufferObject||!this.audioData){return};var self=this;if(context["\x64\x65\x63\x6F\x64\x65\x41\x75\x64\x69\x6F\x44\x61\x74\x61"]){context["\x64\x65\x63\x6F\x64\x65\x41\x75\x64\x69\x6F\x44\x61\x74\x61"](this.audioData,function(buffer){self.bufferObject=buffer;self.audioData=null;var p,i,len,a;if(!cr.is_undefined(self.playTagWhenReady)&&!silent){if(self.panWhenReady.length){for(i=0,len=self.panWhenReady.length;i<len;i++){p=self.panWhenReady[i];a=new C2AudioInstance(self,p.thistag);a.setPannerEnabled(true);if(typeof p.objUid!=="\x75\x6E\x64\x65\x66\x69\x6E\x65\x64"){p.obj=audRuntime.getObjectByUID(p.objUid);if(!p.obj){continue}};if(p.obj){var px=cr.rotatePtAround(p.obj.x,p.obj.y,-p.obj.layer.getAngle(),listenerX,listenerY,true);var py=cr.rotatePtAround(p.obj.x,p.obj.y,-p.obj.layer.getAngle(),listenerX,listenerY,false);a.setPan(px,py,cr.to_degrees(p.obj.angle-p.obj.layer.getAngle()),p.ia,p.oa,p.og);a.setObject(p.obj)}else{a.setPan(p.x,p.y,p.a,p.ia,p.oa,p.og)};a.play(self.loopWhenReady,self.volumeWhenReady,self.seekWhenReady);if(self.pauseWhenReady){a.pause()};audioInstances.push(a)};cr.clearArray(self.panWhenReady)}else{a=new C2AudioInstance(self,self.playTagWhenReady||"");a.play(self.loopWhenReady,self.volumeWhenReady,self.seekWhenReady);if(self.pauseWhenReady){a.pause()};audioInstances.push(a)}}else{if(!cr.is_undefined(self.convolveWhenReady)){var convolveNode=self.convolveWhenReady.convolveNode;convolveNode["\x6E\x6F\x72\x6D\x61\x6C\x69\x7A\x65"]=self.normalizeWhenReady;convolveNode["\x62\x75\x66\x66\x65\x72"]=buffer}}},function(e){self.failedToLoad=true})}else{this.bufferObject=context["\x63\x72\x65\x61\x74\x65\x42\x75\x66\x66\x65\x72"](this.audioData,false);this.audioData=null;if(!cr.is_undefined(this.playTagWhenReady)&&!silent){var a=new C2AudioInstance(this,this.playTagWhenReady);a.play(this.loopWhenReady,this.volumeWhenReady,this.seekWhenReady);if(this.pauseWhenReady){a.pause()};audioInstances.push(a)}else{if(!cr.is_undefined(this.convolveWhenReady)){var convolveNode=this.convolveWhenReady.convolveNode;convolveNode["\x6E\x6F\x72\x6D\x61\x6C\x69\x7A\x65"]=this.normalizeWhenReady;convolveNode["\x62\x75\x66\x66\x65\x72"]=this.bufferObject}}}};C2AudioBuffer.prototype.isLoaded=function(){switch(this.myapi){case API_HTML5:var ret=this.bufferObject["\x72\x65\x61\x64\x79\x53\x74\x61\x74\x65"]>=4;if(ret){this.wasEverReady=true};return ret||this.wasEverReady;case API_WEBAUDIO:return!!this.audioData||!!this.bufferObject;case API_CORDOVA:return true;case API_APPMOBI:return true};return false};C2AudioBuffer.prototype.isLoadedAndDecoded=function(){switch(this.myapi){case API_HTML5:return this.isLoaded();case API_WEBAUDIO:return!!this.bufferObject;case API_CORDOVA:return true;case API_APPMOBI:return true};return false};C2AudioBuffer.prototype.hasFailedToLoad=function(){switch(this.myapi){case API_HTML5:return!!this.bufferObject["\x65\x72\x72\x6F\x72"];case API_WEBAUDIO:return this.failedToLoad};return false};function C2AudioInstance(buffer_,tag_){var self=this;this.tag=tag_;this.fresh=true;this.stopped=true;this.src=buffer_.src;this.buffer=buffer_;this.myapi=api;this.is_music=buffer_.is_music;this.playbackRate=1;this.hasPlaybackEnded=true;this.resume_me=false;this.is_paused=false;this.resume_position=0;this.looping=false;this.is_muted=false;this.is_silent=false;this.volume=1;this.onended_handler=function(e){if(self.is_paused||self.resume_me){return};var bufferThatEnded=this;if(!bufferThatEnded){bufferThatEnded=e.target};if(bufferThatEnded!==self.active_buffer){return};self.hasPlaybackEnded=true;self.stopped=true;audTag=self.tag;audRuntime.trigger(cr.plugins_.Audio.prototype.cnds.OnEnded,audInst)};this.active_buffer=null;this.isTimescaled=((timescale_mode===1&&!this.is_music)||timescale_mode===2);this.mutevol=1;this.startTime=(this.isTimescaled?audRuntime.kahanTime.sum:audRuntime.wallTime.sum);this.gainNode=null;this.pannerNode=null;this.pannerEnabled=false;this.objectTracker=null;this.panX=0;this.panY=0;this.panAngle=0;this.panConeInner=0;this.panConeOuter=0;this.panConeOuterGain=0;this.instanceObject=null;var add_end_listener=false;if(this.myapi===API_WEBAUDIO&&this.buffer.myapi===API_HTML5&&!this.buffer.supportWebAudioAPI){this.myapi=API_HTML5};switch(this.myapi){case API_HTML5:if(this.is_music){this.instanceObject=buffer_.bufferObject;add_end_listener=!buffer_.added_end_listener;buffer_.added_end_listener=true}else{this.instanceObject=new Audio();this.instanceObject.crossOrigin="\x61\x6E\x6F\x6E\x79\x6D\x6F\x75\x73";this.instanceObject.autoplay=false;this.instanceObject.src=buffer_.bufferObject.src;add_end_listener=true};if(add_end_listener){this.instanceObject.addEventListener('\x65\x6E\x64\x65\x64',function(){audTag=self.tag;self.stopped=true;audRuntime.trigger(cr.plugins_.Audio.prototype.cnds.OnEnded,audInst)})};break;case API_WEBAUDIO:this.gainNode=createGain();this.gainNode["\x63\x6F\x6E\x6E\x65\x63\x74"](getDestinationForTag(tag_));if(this.buffer.myapi===API_WEBAUDIO){if(buffer_.bufferObject){this.instanceObject=context["\x63\x72\x65\x61\x74\x65\x42\x75\x66\x66\x65\x72\x53\x6F\x75\x72\x63\x65"]();this.instanceObject["\x62\x75\x66\x66\x65\x72"]=buffer_.bufferObject;this.instanceObject["\x63\x6F\x6E\x6E\x65\x63\x74"](this.gainNode)}}else{this.instanceObject=this.buffer.bufferObject;this.buffer.outNode["\x63\x6F\x6E\x6E\x65\x63\x74"](this.gainNode);if(!this.buffer.added_end_listener){this.buffer.added_end_listener=true;this.buffer.bufferObject.addEventListener('\x65\x6E\x64\x65\x64',function(){audTag=self.tag;self.stopped=true;audRuntime.trigger(cr.plugins_.Audio.prototype.cnds.OnEnded,audInst)})}};break;case API_CORDOVA:this.instanceObject=new window["\x4D\x65\x64\x69\x61"](appPath+this.src,null,null,function(status){if(status===window["\x4D\x65\x64\x69\x61"]["\x4D\x45\x44\x49\x41\x5F\x53\x54\x4F\x50\x50\x45\x44"]){self.hasPlaybackEnded=true;self.stopped=true;audTag=self.tag;audRuntime.trigger(cr.plugins_.Audio.prototype.cnds.OnEnded,audInst)}});break;case API_APPMOBI:this.instanceObject=true;break}}C2AudioInstance.prototype.hasEnded=function(){var time;switch(this.myapi){case API_HTML5:return this.instanceObject.ended;case API_WEBAUDIO:if(this.buffer.myapi===API_WEBAUDIO){if(!this.fresh&&!this.stopped&&this.instanceObject["\x6C\x6F\x6F\x70"]){return false};if(this.is_paused){return false};return this.hasPlaybackEnded}else{return this.instanceObject.ended};case API_CORDOVA:return this.hasPlaybackEnded;case API_APPMOBI:true};return true};C2AudioInstance.prototype.canBeRecycled=function(){if(this.fresh||this.stopped){return true};return this.hasEnded()};C2AudioInstance.prototype.setPannerEnabled=function(enable_){if(api!==API_WEBAUDIO){return};if(!this.pannerEnabled&&enable_){if(!this.gainNode){return};if(!this.pannerNode){this.pannerNode=context["\x63\x72\x65\x61\x74\x65\x50\x61\x6E\x6E\x65\x72"]();if(typeof this.pannerNode["\x70\x61\x6E\x6E\x69\x6E\x67\x4D\x6F\x64\x65\x6C"]==="\x6E\x75\x6D\x62\x65\x72"){this.pannerNode["\x70\x61\x6E\x6E\x69\x6E\x67\x4D\x6F\x64\x65\x6C"]=panningModel}else{this.pannerNode["\x70\x61\x6E\x6E\x69\x6E\x67\x4D\x6F\x64\x65\x6C"]=["\x65\x71\x75\x61\x6C\x70\x6F\x77\x65\x72","\x48\x52\x54\x46","\x73\x6F\x75\x6E\x64\x66\x69\x65\x6C\x64"][panningModel]};if(typeof this.pannerNode["\x64\x69\x73\x74\x61\x6E\x63\x65\x4D\x6F\x64\x65\x6C"]==="\x6E\x75\x6D\x62\x65\x72"){this.pannerNode["\x64\x69\x73\x74\x61\x6E\x63\x65\x4D\x6F\x64\x65\x6C"]=distanceModel}else{this.pannerNode["\x64\x69\x73\x74\x61\x6E\x63\x65\x4D\x6F\x64\x65\x6C"]=["\x6C\x69\x6E\x65\x61\x72","\x69\x6E\x76\x65\x72\x73\x65","\x65\x78\x70\x6F\x6E\x65\x6E\x74\x69\x61\x6C"][distanceModel]};this.pannerNode["\x72\x65\x66\x44\x69\x73\x74\x61\x6E\x63\x65"]=refDistance;this.pannerNode["\x6D\x61\x78\x44\x69\x73\x74\x61\x6E\x63\x65"]=maxDistance;this.pannerNode["\x72\x6F\x6C\x6C\x6F\x66\x66\x46\x61\x63\x74\x6F\x72"]=rolloffFactor};this.gainNode["\x64\x69\x73\x63\x6F\x6E\x6E\x65\x63\x74"]();this.gainNode["\x63\x6F\x6E\x6E\x65\x63\x74"](this.pannerNode);this.pannerNode["\x63\x6F\x6E\x6E\x65\x63\x74"](getDestinationForTag(this.tag));this.pannerEnabled=true}else{if(this.pannerEnabled&&!enable_){if(!this.gainNode){return};this.pannerNode["\x64\x69\x73\x63\x6F\x6E\x6E\x65\x63\x74"]();this.gainNode["\x64\x69\x73\x63\x6F\x6E\x6E\x65\x63\x74"]();this.gainNode["\x63\x6F\x6E\x6E\x65\x63\x74"](getDestinationForTag(this.tag));this.pannerEnabled=false}}};C2AudioInstance.prototype.setPan=function(x,y,angle,innerangle,outerangle,outergain){if(!this.pannerEnabled||api!==API_WEBAUDIO){return};this.pannerNode["\x73\x65\x74\x50\x6F\x73\x69\x74\x69\x6F\x6E"](x,y,0);this.pannerNode["\x73\x65\x74\x4F\x72\x69\x65\x6E\x74\x61\x74\x69\x6F\x6E"](Math.cos(cr.to_radians(angle)),Math.sin(cr.to_radians(angle)),0);this.pannerNode["\x63\x6F\x6E\x65\x49\x6E\x6E\x65\x72\x41\x6E\x67\x6C\x65"]=innerangle;this.pannerNode["\x63\x6F\x6E\x65\x4F\x75\x74\x65\x72\x41\x6E\x67\x6C\x65"]=outerangle;this.pannerNode["\x63\x6F\x6E\x65\x4F\x75\x74\x65\x72\x47\x61\x69\x6E"]=outergain;this.panX=x;this.panY=y;this.panAngle=angle;this.panConeInner=innerangle;this.panConeOuter=outerangle;this.panConeOuterGain=outergain};C2AudioInstance.prototype.setObject=function(o){if(!this.pannerEnabled||api!==API_WEBAUDIO){return};if(!this.objectTracker){this.objectTracker=new ObjectTracker()};this.objectTracker.setObject(o)};C2AudioInstance.prototype.tick=function(dt){if(!this.pannerEnabled||api!==API_WEBAUDIO||!this.objectTracker||!this.objectTracker.hasObject()||!this.isPlaying()){return};this.objectTracker.tick(dt);var inst=this.objectTracker.obj;var px=cr.rotatePtAround(inst.x,inst.y,-inst.layer.getAngle(),listenerX,listenerY,true);var py=cr.rotatePtAround(inst.x,inst.y,-inst.layer.getAngle(),listenerX,listenerY,false);this.pannerNode["\x73\x65\x74\x50\x6F\x73\x69\x74\x69\x6F\x6E"](px,py,0);var a=0;if(typeof this.objectTracker.obj.angle!=="\x75\x6E\x64\x65\x66\x69\x6E\x65\x64"){a=inst.angle-inst.layer.getAngle();this.pannerNode["\x73\x65\x74\x4F\x72\x69\x65\x6E\x74\x61\x74\x69\x6F\x6E"](Math.cos(a),Math.sin(a),0)};px=cr.rotatePtAround(this.objectTracker.getVelocityX(),this.objectTracker.getVelocityY(),-inst.layer.getAngle(),0,0,true);py=cr.rotatePtAround(this.objectTracker.getVelocityX(),this.objectTracker.getVelocityY(),-inst.layer.getAngle(),0,0,false);this.pannerNode["\x73\x65\x74\x56\x65\x6C\x6F\x63\x69\x74\x79"](px,py,0)};C2AudioInstance.prototype.play=function(looping,vol,fromPosition){var instobj=this.instanceObject;this.looping=looping;this.volume=vol;var seekPos=fromPosition||0;switch(this.myapi){case API_HTML5:if(instobj.playbackRate!==1.0){instobj.playbackRate=1.0};if(instobj.volume!==vol*masterVolume){instobj.volume=vol*masterVolume};if(instobj.loop!==looping){instobj.loop=looping};if(instobj.muted){instobj.muted=false};if(instobj.currentTime!==seekPos){try{instobj.currentTime=seekPos}catch(err){;}};if(this.is_music&&isMusicWorkaround&&!audRuntime.isInUserInputEvent){musicPlayNextTouch.push(this)}else{try{this.instanceObject.play()}catch(e){if(console&&console.log){console.log("\x5B\x43\x32\x5D\x20\x57\x41\x52\x4E\x49\x4E\x47\x3A\x20\x65\x78\x63\x65\x70\x74\x69\x6F\x6E\x20\x74\x72\x79\x69\x6E\x67\x20\x74\x6F\x20\x70\x6C\x61\x79\x20\x61\x75\x64\x69\x6F\x20\x27"+this.buffer.src+"\x27\x3A\x20",e)}}};break;case API_WEBAUDIO:this.muted=false;this.mutevol=1;if(this.buffer.myapi===API_WEBAUDIO){this.gainNode["\x67\x61\x69\x6E"]["\x76\x61\x6C\x75\x65"]=vol*masterVolume;if(!this.fresh){this.instanceObject=context["\x63\x72\x65\x61\x74\x65\x42\x75\x66\x66\x65\x72\x53\x6F\x75\x72\x63\x65"]();this.instanceObject["\x62\x75\x66\x66\x65\x72"]=this.buffer.bufferObject;this.instanceObject["\x63\x6F\x6E\x6E\x65\x63\x74"](this.gainNode)};this.instanceObject["\x6F\x6E\x65\x6E\x64\x65\x64"]=this.onended_handler;this.active_buffer=this.instanceObject;this.instanceObject.loop=looping;this.hasPlaybackEnded=false;if(seekPos===0){startSource(this.instanceObject)}else{startSourceAt(this.instanceObject,seekPos,this.getDuration())}}else{if(instobj.playbackRate!==1.0){instobj.playbackRate=1.0};if(instobj.loop!==looping){instobj.loop=looping};instobj.volume=vol*masterVolume;if(instobj.currentTime!==seekPos){try{instobj.currentTime=seekPos}catch(err){;}};if(this.is_music&&isMusicWorkaround&&!audRuntime.isInUserInputEvent){musicPlayNextTouch.push(this)}else{instobj.play()}};break;case API_CORDOVA:if((!this.fresh&&this.stopped)||seekPos!==0){instobj["\x73\x65\x65\x6B\x54\x6F"](seekPos)};instobj["\x70\x6C\x61\x79"]();this.hasPlaybackEnded=false;break;case API_APPMOBI:if(audRuntime.isDirectCanvas){AppMobi["\x63\x6F\x6E\x74\x65\x78\x74"]["\x70\x6C\x61\x79\x53\x6F\x75\x6E\x64"](this.src,looping)}else{AppMobi["\x70\x6C\x61\x79\x65\x72"]["\x70\x6C\x61\x79\x53\x6F\x75\x6E\x64"](this.src,looping)};break};this.playbackRate=1;this.startTime=(this.isTimescaled?audRuntime.kahanTime.sum:audRuntime.wallTime.sum)-seekPos;this.fresh=false;this.stopped=false;this.is_paused=false};C2AudioInstance.prototype.stop=function(){switch(this.myapi){case API_HTML5:if(!this.instanceObject.paused){this.instanceObject.pause()};break;case API_WEBAUDIO:if(this.buffer.myapi===API_WEBAUDIO){stopSource(this.instanceObject)}else{if(!this.instanceObject.paused){this.instanceObject.pause()}};break;case API_CORDOVA:this.instanceObject["\x73\x74\x6F\x70"]();break;case API_APPMOBI:if(audRuntime.isDirectCanvas){AppMobi["\x63\x6F\x6E\x74\x65\x78\x74"]["\x73\x74\x6F\x70\x53\x6F\x75\x6E\x64"](this.src)};break};this.stopped=true;this.is_paused=false};C2AudioInstance.prototype.pause=function(){if(this.fresh||this.stopped||this.hasEnded()||this.is_paused){return};switch(this.myapi){case API_HTML5:if(!this.instanceObject.paused){this.instanceObject.pause()};break;case API_WEBAUDIO:if(this.buffer.myapi===API_WEBAUDIO){this.resume_position=this.getPlaybackTime(true);if(this.looping){this.resume_position=this.resume_position%this.getDuration()};this.is_paused=true;stopSource(this.instanceObject)}else{if(!this.instanceObject.paused){this.instanceObject.pause()}};break;case API_CORDOVA:this.instanceObject["\x70\x61\x75\x73\x65"]();break;case API_APPMOBI:if(audRuntime.isDirectCanvas){AppMobi["\x63\x6F\x6E\x74\x65\x78\x74"]["\x73\x74\x6F\x70\x53\x6F\x75\x6E\x64"](this.src)};break};this.is_paused=true};C2AudioInstance.prototype.resume=function(){if(this.fresh||this.stopped||this.hasEnded()||!this.is_paused){return};switch(this.myapi){case API_HTML5:this.instanceObject.play();break;case API_WEBAUDIO:if(this.buffer.myapi===API_WEBAUDIO){this.instanceObject=context["\x63\x72\x65\x61\x74\x65\x42\x75\x66\x66\x65\x72\x53\x6F\x75\x72\x63\x65"]();this.instanceObject["\x62\x75\x66\x66\x65\x72"]=this.buffer.bufferObject;this.instanceObject["\x63\x6F\x6E\x6E\x65\x63\x74"](this.gainNode);this.instanceObject["\x6F\x6E\x65\x6E\x64\x65\x64"]=this.onended_handler;this.active_buffer=this.instanceObject;this.instanceObject.loop=this.looping;this.gainNode["\x67\x61\x69\x6E"]["\x76\x61\x6C\x75\x65"]=masterVolume*this.volume*this.mutevol;this.updatePlaybackRate();this.startTime=(this.isTimescaled?audRuntime.kahanTime.sum:audRuntime.wallTime.sum)-(this.resume_position/(this.playbackRate||0.001));startSourceAt(this.instanceObject,this.resume_position,this.getDuration())}else{this.instanceObject.play()};break;case API_CORDOVA:this.instanceObject["\x70\x6C\x61\x79"]();break;case API_APPMOBI:if(audRuntime.isDirectCanvas){AppMobi["\x63\x6F\x6E\x74\x65\x78\x74"]["\x72\x65\x73\x75\x6D\x65\x53\x6F\x75\x6E\x64"](this.src)};break};this.is_paused=false};C2AudioInstance.prototype.seek=function(pos){if(this.fresh||this.stopped||this.hasEnded()){return};switch(this.myapi){case API_HTML5:try{this.instanceObject.currentTime=pos}catch(e){};break;case API_WEBAUDIO:if(this.buffer.myapi===API_WEBAUDIO){if(this.is_paused){this.resume_position=pos}else{this.pause();this.resume_position=pos;this.resume()}}else{try{this.instanceObject.currentTime=pos}catch(e){}};break;case API_CORDOVA:break;case API_APPMOBI:if(audRuntime.isDirectCanvas){AppMobi["\x63\x6F\x6E\x74\x65\x78\x74"]["\x73\x65\x65\x6B\x53\x6F\x75\x6E\x64"](this.src,pos)};break}};C2AudioInstance.prototype.reconnect=function(toNode){if(this.myapi!==API_WEBAUDIO){return};if(this.pannerEnabled){this.pannerNode["\x64\x69\x73\x63\x6F\x6E\x6E\x65\x63\x74"]();this.pannerNode["\x63\x6F\x6E\x6E\x65\x63\x74"](toNode)}else{this.gainNode["\x64\x69\x73\x63\x6F\x6E\x6E\x65\x63\x74"]();this.gainNode["\x63\x6F\x6E\x6E\x65\x63\x74"](toNode)}};C2AudioInstance.prototype.getDuration=function(applyPlaybackRate){var ret=0;switch(this.myapi){case API_HTML5:if(typeof this.instanceObject.duration!=="\x75\x6E\x64\x65\x66\x69\x6E\x65\x64"){ret=this.instanceObject.duration};break;case API_WEBAUDIO:ret=this.buffer.bufferObject["\x64\x75\x72\x61\x74\x69\x6F\x6E"];break;case API_CORDOVA:ret=this.instanceObject["\x67\x65\x74\x44\x75\x72\x61\x74\x69\x6F\x6E"]();break;case API_APPMOBI:if(audRuntime.isDirectCanvas){ret=AppMobi["\x63\x6F\x6E\x74\x65\x78\x74"]["\x67\x65\x74\x44\x75\x72\x61\x74\x69\x6F\x6E\x53\x6F\x75\x6E\x64"](this.src)};break};if(applyPlaybackRate){ret/=(this.playbackRate||0.001)};return ret};C2AudioInstance.prototype.getPlaybackTime=function(applyPlaybackRate){var duration=this.getDuration();var ret=0;switch(this.myapi){case API_HTML5:if(typeof this.instanceObject.currentTime!=="\x75\x6E\x64\x65\x66\x69\x6E\x65\x64"){ret=this.instanceObject.currentTime};break;case API_WEBAUDIO:if(this.buffer.myapi===API_WEBAUDIO){if(this.is_paused){return this.resume_position}else{ret=(this.isTimescaled?audRuntime.kahanTime.sum:audRuntime.wallTime.sum)-this.startTime}}else{if(typeof this.instanceObject.currentTime!=="\x75\x6E\x64\x65\x66\x69\x6E\x65\x64"){ret=this.instanceObject.currentTime}};break;case API_CORDOVA:break;case API_APPMOBI:if(audRuntime.isDirectCanvas){ret=AppMobi["\x63\x6F\x6E\x74\x65\x78\x74"]["\x67\x65\x74\x50\x6C\x61\x79\x62\x61\x63\x6B\x54\x69\x6D\x65\x53\x6F\x75\x6E\x64"](this.src)};break};if(applyPlaybackRate){ret*=this.playbackRate};if(!this.looping&&ret>duration){ret=duration};return ret};C2AudioInstance.prototype.isPlaying=function(){return!this.is_paused&&!this.fresh&&!this.stopped&&!this.hasEnded()};C2AudioInstance.prototype.setVolume=function(v){this.volume=v;this.updateVolume()};C2AudioInstance.prototype.updateVolume=function(){var volToSet=this.volume*masterVolume;if(!isFinite(volToSet)){volToSet=0};switch(this.myapi){case API_HTML5:if(typeof this.instanceObject.volume!=="\x75\x6E\x64\x65\x66\x69\x6E\x65\x64"&&this.instanceObject.volume!==volToSet){this.instanceObject.volume=volToSet};break;case API_WEBAUDIO:if(this.buffer.myapi===API_WEBAUDIO){this.gainNode["\x67\x61\x69\x6E"]["\x76\x61\x6C\x75\x65"]=volToSet*this.mutevol}else{if(typeof this.instanceObject.volume!=="\x75\x6E\x64\x65\x66\x69\x6E\x65\x64"&&this.instanceObject.volume!==volToSet){this.instanceObject.volume=volToSet}};break;case API_CORDOVA:break;case API_APPMOBI:break}};C2AudioInstance.prototype.getVolume=function(){return this.volume};C2AudioInstance.prototype.doSetMuted=function(m){switch(this.myapi){case API_HTML5:if(this.instanceObject.muted!==!!m){this.instanceObject.muted=!!m};break;case API_WEBAUDIO:if(this.buffer.myapi===API_WEBAUDIO){this.mutevol=(m?0:1);this.gainNode["\x67\x61\x69\x6E"]["\x76\x61\x6C\x75\x65"]=masterVolume*this.volume*this.mutevol}else{if(this.instanceObject.muted!==!!m){this.instanceObject.muted=!!m}};break;case API_CORDOVA:break;case API_APPMOBI:break}};C2AudioInstance.prototype.setMuted=function(m){this.is_muted=!!m;this.doSetMuted(this.is_muted||this.is_silent)};C2AudioInstance.prototype.setSilent=function(m){this.is_silent=!!m;this.doSetMuted(this.is_muted||this.is_silent)};C2AudioInstance.prototype.setLooping=function(l){this.looping=l;switch(this.myapi){case API_HTML5:if(this.instanceObject.loop!==!!l){this.instanceObject.loop=!!l};break;case API_WEBAUDIO:if(this.instanceObject.loop!==!!l){this.instanceObject.loop=!!l};break;case API_CORDOVA:break;case API_APPMOBI:if(audRuntime.isDirectCanvas){AppMobi["\x63\x6F\x6E\x74\x65\x78\x74"]["\x73\x65\x74\x4C\x6F\x6F\x70\x69\x6E\x67\x53\x6F\x75\x6E\x64"](this.src,l)};break}};C2AudioInstance.prototype.setPlaybackRate=function(r){this.playbackRate=r;this.updatePlaybackRate()};C2AudioInstance.prototype.updatePlaybackRate=function(){var r=this.playbackRate;if(this.isTimescaled){r*=audRuntime.timescale};switch(this.myapi){case API_HTML5:if(this.instanceObject.playbackRate!==r){this.instanceObject.playbackRate=r};break;case API_WEBAUDIO:if(this.buffer.myapi===API_WEBAUDIO){if(this.instanceObject["\x70\x6C\x61\x79\x62\x61\x63\x6B\x52\x61\x74\x65"]["\x76\x61\x6C\x75\x65"]!==r){this.instanceObject["\x70\x6C\x61\x79\x62\x61\x63\x6B\x52\x61\x74\x65"]["\x76\x61\x6C\x75\x65"]=r}}else{if(this.instanceObject.playbackRate!==r){this.instanceObject.playbackRate=r}};break;case API_CORDOVA:break;case API_APPMOBI:break}};C2AudioInstance.prototype.setSuspended=function(s){switch(this.myapi){case API_HTML5:if(s){if(this.isPlaying()){this.resume_me=true;this.instanceObject["\x70\x61\x75\x73\x65"]()}else{this.resume_me=false}}else{if(this.resume_me){this.instanceObject["\x70\x6C\x61\x79"]();this.resume_me=false}};break;case API_WEBAUDIO:if(s){if(this.isPlaying()){this.resume_me=true;if(this.buffer.myapi===API_WEBAUDIO){this.resume_position=this.getPlaybackTime(true);if(this.looping){this.resume_position=this.resume_position%this.getDuration()};stopSource(this.instanceObject)}else{this.instanceObject["\x70\x61\x75\x73\x65"]()}}else{this.resume_me=false}}else{if(this.resume_me){if(this.buffer.myapi===API_WEBAUDIO){this.instanceObject=context["\x63\x72\x65\x61\x74\x65\x42\x75\x66\x66\x65\x72\x53\x6F\x75\x72\x63\x65"]();this.instanceObject["\x62\x75\x66\x66\x65\x72"]=this.buffer.bufferObject;this.instanceObject["\x63\x6F\x6E\x6E\x65\x63\x74"](this.gainNode);this.instanceObject["\x6F\x6E\x65\x6E\x64\x65\x64"]=this.onended_handler;this.active_buffer=this.instanceObject;this.instanceObject.loop=this.looping;this.gainNode["\x67\x61\x69\x6E"]["\x76\x61\x6C\x75\x65"]=masterVolume*this.volume*this.mutevol;this.updatePlaybackRate();this.startTime=(this.isTimescaled?audRuntime.kahanTime.sum:audRuntime.wallTime.sum)-(this.resume_position/(this.playbackRate||0.001));startSourceAt(this.instanceObject,this.resume_position,this.getDuration())}else{this.instanceObject["\x70\x6C\x61\x79"]()};this.resume_me=false}};break;case API_CORDOVA:if(s){if(this.isPlaying()){this.instanceObject["\x70\x61\x75\x73\x65"]();this.resume_me=true}else{this.resume_me=false}}else{if(this.resume_me){this.resume_me=false;this.instanceObject["\x70\x6C\x61\x79"]()}};break;case API_APPMOBI:break}};pluginProto.Instance=function(type){this.type=type;this.runtime=type.runtime;audRuntime=this.runtime;audInst=this;this.listenerTracker=null;this.listenerZ=-600;if((this.runtime.isiOS||(this.runtime.isAndroid&&(this.runtime.isChrome||this.runtime.isAndroidStockBrowser)))&&!this.runtime.isCrosswalk&&!this.runtime.isDomFree&&!this.runtime.isAmazonWebApp){isMusicWorkaround=true};context=null;if(typeof AudioContext!=="\x75\x6E\x64\x65\x66\x69\x6E\x65\x64"){api=API_WEBAUDIO;context=new AudioContext()}else{if(typeof webkitAudioContext!=="\x75\x6E\x64\x65\x66\x69\x6E\x65\x64"){api=API_WEBAUDIO;context=new webkitAudioContext()}};if(isMusicWorkaround){var unblockWebAudio=function(){var buffer=context["\x63\x72\x65\x61\x74\x65\x42\x75\x66\x66\x65\x72"](1,1,22050);var source=context["\x63\x72\x65\x61\x74\x65\x42\x75\x66\x66\x65\x72\x53\x6F\x75\x72\x63\x65"]();source["\x62\x75\x66\x66\x65\x72"]=buffer;source["\x63\x6F\x6E\x6E\x65\x63\x74"](context["\x64\x65\x73\x74\x69\x6E\x61\x74\x69\x6F\x6E"]);startSource(source)};var playQueuedMusic=function(){var i,len,m;if(isMusicWorkaround){if(!silent){for(i=0,len=musicPlayNextTouch.length;i<len;++i){m=musicPlayNextTouch[i];if(!m.stopped&&!m.is_paused){m.instanceObject.play()}}};cr.clearArray(musicPlayNextTouch)}};document.addEventListener("\x74\x6F\x75\x63\x68\x65\x6E\x64",function(){if(!iOShadtouchend&&context){unblockWebAudio();iOShadtouchend=true};playQueuedMusic()},true)};if(api!==API_WEBAUDIO){if(this.runtime.isCordova&&typeof window["\x4D\x65\x64\x69\x61"]!=="\x75\x6E\x64\x65\x66\x69\x6E\x65\x64"){api=API_CORDOVA}else{if(this.runtime.isAppMobi){api=API_APPMOBI}}};if(api===API_CORDOVA){appPath=location.href;var i=appPath.lastIndexOf("\x2F");if(i>-1){appPath=appPath.substr(0,i+1)};appPath=appPath.replace("\x66\x69\x6C\x65\x3A\x2F\x2F","")};if(this.runtime.isSafari&&this.runtime.isWindows&&typeof Audio==="\x75\x6E\x64\x65\x66\x69\x6E\x65\x64"){alert("\x49\x74\x20\x6C\x6F\x6F\x6B\x73\x20\x6C\x69\x6B\x65\x20\x79\x6F\x75\x27\x72\x65\x20\x75\x73\x69\x6E\x67\x20\x53\x61\x66\x61\x72\x69\x20\x66\x6F\x72\x20\x57\x69\x6E\x64\x6F\x77\x73\x20\x77\x69\x74\x68\x6F\x75\x74\x20\x51\x75\x69\x63\x6B\x74\x69\x6D\x65\x2E\x20\x20\x41\x75\x64\x69\x6F\x20\x63\x61\x6E\x6E\x6F\x74\x20\x62\x65\x20\x70\x6C\x61\x79\x65\x64\x20\x75\x6E\x74\x69\x6C\x20\x51\x75\x69\x63\x6B\x74\x69\x6D\x65\x20\x69\x73\x20\x69\x6E\x73\x74\x61\x6C\x6C\x65\x64\x2E");this.runtime.DestroyInstance(this)}else{if(this.runtime.isDirectCanvas){useOgg=this.runtime.isAndroid}else{try{useOgg=!!(new Audio().canPlayType('\x61\x75\x64\x69\x6F\x2F\x6F\x67\x67\x3B\x20\x63\x6F\x64\x65\x63\x73\x3D\x22\x76\x6F\x72\x62\x69\x73\x22'))}catch(e){useOgg=false}};switch(api){case API_HTML5:;;break;case API_WEBAUDIO:;;break;case API_CORDOVA:;;break;case API_APPMOBI:;;break;default:;};this.runtime.tickMe(this)}};var instanceProto=pluginProto.Instance.prototype;instanceProto.onCreate=function(){this.runtime.audioInstance=this;timescale_mode=this.properties[0];this.saveload=this.properties[1];this.playinbackground=(this.properties[2]!==0);panningModel=this.properties[3];distanceModel=this.properties[4];this.listenerZ=-this.properties[5];refDistance=this.properties[6];maxDistance=this.properties[7];rolloffFactor=this.properties[8];this.listenerTracker=new ObjectTracker();var draw_width=(this.runtime.draw_width||this.runtime.width);var draw_height=(this.runtime.draw_height||this.runtime.height);if(api===API_WEBAUDIO){if(typeof context["\x6C\x69\x73\x74\x65\x6E\x65\x72"]["\x64\x6F\x70\x70\x6C\x65\x72\x46\x61\x63\x74\x6F\x72"]!=="\x75\x6E\x64\x65\x66\x69\x6E\x65\x64"){context["\x6C\x69\x73\x74\x65\x6E\x65\x72"]["\x64\x6F\x70\x70\x6C\x65\x72\x46\x61\x63\x74\x6F\x72"]=0};context["\x6C\x69\x73\x74\x65\x6E\x65\x72"]["\x73\x65\x74\x50\x6F\x73\x69\x74\x69\x6F\x6E"](draw_width/2,draw_height/2,this.listenerZ);context["\x6C\x69\x73\x74\x65\x6E\x65\x72"]["\x73\x65\x74\x4F\x72\x69\x65\x6E\x74\x61\x74\x69\x6F\x6E"](0,0,1,0,-1,0);window["\x63\x32\x4F\x6E\x41\x75\x64\x69\x6F\x4D\x69\x63\x53\x74\x72\x65\x61\x6D"]=function(localMediaStream,tag){if(micSource){micSource["\x64\x69\x73\x63\x6F\x6E\x6E\x65\x63\x74"]()};micTag=tag.toLowerCase();micSource=context["\x63\x72\x65\x61\x74\x65\x4D\x65\x64\x69\x61\x53\x74\x72\x65\x61\x6D\x53\x6F\x75\x72\x63\x65"](localMediaStream);micSource["\x63\x6F\x6E\x6E\x65\x63\x74"](getDestinationForTag(micTag))}};this.runtime.addSuspendCallback(function(s){audInst.onSuspend(s)});var self=this;this.runtime.addDestroyCallback(function(inst){self.onInstanceDestroyed(inst)})};instanceProto.onInstanceDestroyed=function(inst){var i,len,a;for(i=0,len=audioInstances.length;i<len;i++){a=audioInstances[i];if(a.objectTracker){if(a.objectTracker.obj===inst){a.objectTracker.obj=null;if(a.pannerEnabled&&a.isPlaying()&&a.looping){a.stop()}}}};if(this.listenerTracker.obj===inst){this.listenerTracker.obj=null}};instanceProto.saveToJSON=function(){var o={"\x73\x69\x6C\x65\x6E\x74":silent,"\x6D\x61\x73\x74\x65\x72\x56\x6F\x6C\x75\x6D\x65":masterVolume,"\x6C\x69\x73\x74\x65\x6E\x65\x72\x5A":this.listenerZ,"\x6C\x69\x73\x74\x65\x6E\x65\x72\x55\x69\x64":this.listenerTracker.hasObject()?this.listenerTracker.obj.uid:-1,"\x70\x6C\x61\x79\x69\x6E\x67":[],"\x65\x66\x66\x65\x63\x74\x73":{}};var playingarr=o["\x70\x6C\x61\x79\x69\x6E\x67"];var i,len,a,d,p,panobj,playbackTime;for(i=0,len=audioInstances.length;i<len;i++){a=audioInstances[i];if(!a.isPlaying()){continue};if(this.saveload===3){continue};if(a.is_music&&this.saveload===1){continue};if(!a.is_music&&this.saveload===2){continue};playbackTime=a.getPlaybackTime();if(a.looping){playbackTime=playbackTime%a.getDuration()};d={"\x74\x61\x67":a.tag,"\x62\x75\x66\x66\x65\x72\x73\x72\x63":a.buffer.src,"\x69\x73\x5F\x6D\x75\x73\x69\x63":a.is_music,"\x70\x6C\x61\x79\x62\x61\x63\x6B\x54\x69\x6D\x65":playbackTime,"\x76\x6F\x6C\x75\x6D\x65":a.volume,"\x6C\x6F\x6F\x70\x69\x6E\x67":a.looping,"\x6D\x75\x74\x65\x64":a.is_muted,"\x70\x6C\x61\x79\x62\x61\x63\x6B\x52\x61\x74\x65":a.playbackRate,"\x70\x61\x75\x73\x65\x64":a.is_paused,"\x72\x65\x73\x75\x6D\x65\x5F\x70\x6F\x73\x69\x74\x69\x6F\x6E":a.resume_position};if(a.pannerEnabled){d["\x70\x61\x6E"]={};panobj=d["\x70\x61\x6E"];if(a.objectTracker&&a.objectTracker.hasObject()){panobj["\x6F\x62\x6A\x55\x69\x64"]=a.objectTracker.obj.uid}else{panobj["\x78"]=a.panX;panobj["\x79"]=a.panY;panobj["\x61"]=a.panAngle};panobj["\x69\x61"]=a.panConeInner;panobj["\x6F\x61"]=a.panConeOuter;panobj["\x6F\x67"]=a.panConeOuterGain};playingarr.push(d)};var fxobj=o["\x65\x66\x66\x65\x63\x74\x73"];var fxarr;for(p in effects){if(effects.hasOwnProperty(p)){fxarr=[];for(i=0,len=effects[p].length;i<len;i++){fxarr.push({"\x74\x79\x70\x65":effects[p][i].type,"\x70\x61\x72\x61\x6D\x73":effects[p][i].params})};fxobj[p]=fxarr}};return o};var objectTrackerUidsToLoad=[];instanceProto.loadFromJSON=function(o){var setSilent=o["\x73\x69\x6C\x65\x6E\x74"];masterVolume=o["\x6D\x61\x73\x74\x65\x72\x56\x6F\x6C\x75\x6D\x65"];this.listenerZ=o["\x6C\x69\x73\x74\x65\x6E\x65\x72\x5A"];this.listenerTracker.setObject(null);var listenerUid=o["\x6C\x69\x73\x74\x65\x6E\x65\x72\x55\x69\x64"];if(listenerUid!==-1){this.listenerTracker.loadUid=listenerUid;objectTrackerUidsToLoad.push(this.listenerTracker)};var playingarr=o["\x70\x6C\x61\x79\x69\x6E\x67"];var i,len,d,src,is_music,tag,playbackTime,looping,vol,b,a,p,pan,panObjUid;if(this.saveload!==3){for(i=0,len=audioInstances.length;i<len;i++){a=audioInstances[i];if(a.is_music&&this.saveload===1){continue};if(!a.is_music&&this.saveload===2){continue};a.stop()}};var fxarr,fxtype,fxparams,fx;for(p in effects){if(effects.hasOwnProperty(p)){for(i=0,len=effects[p].length;i<len;i++){effects[p][i].remove()}}};cr.wipe(effects);for(p in o["\x65\x66\x66\x65\x63\x74\x73"]){if(o["\x65\x66\x66\x65\x63\x74\x73"].hasOwnProperty(p)){fxarr=o["\x65\x66\x66\x65\x63\x74\x73"][p];for(i=0,len=fxarr.length;i<len;i++){fxtype=fxarr[i]["\x74\x79\x70\x65"];fxparams=fxarr[i]["\x70\x61\x72\x61\x6D\x73"];switch(fxtype){case "\x66\x69\x6C\x74\x65\x72":addEffectForTag(p,new FilterEffect(fxparams[0],fxparams[1],fxparams[2],fxparams[3],fxparams[4],fxparams[5]));break;case "\x64\x65\x6C\x61\x79":addEffectForTag(p,new DelayEffect(fxparams[0],fxparams[1],fxparams[2]));break;case "\x63\x6F\x6E\x76\x6F\x6C\x76\x65":src=fxparams[2];b=this.getAudioBuffer(src,false);if(b.bufferObject){fx=new ConvolveEffect(b.bufferObject,fxparams[0],fxparams[1],src)}else{fx=new ConvolveEffect(null,fxparams[0],fxparams[1],src);b.normalizeWhenReady=fxparams[0];b.convolveWhenReady=fx};addEffectForTag(p,fx);break;case "\x66\x6C\x61\x6E\x67\x65\x72":addEffectForTag(p,new FlangerEffect(fxparams[0],fxparams[1],fxparams[2],fxparams[3],fxparams[4]));break;case "\x70\x68\x61\x73\x65\x72":addEffectForTag(p,new PhaserEffect(fxparams[0],fxparams[1],fxparams[2],fxparams[3],fxparams[4],fxparams[5]));break;case "\x67\x61\x69\x6E":addEffectForTag(p,new GainEffect(fxparams[0]));break;case "\x74\x72\x65\x6D\x6F\x6C\x6F":addEffectForTag(p,new TremoloEffect(fxparams[0],fxparams[1]));break;case "\x72\x69\x6E\x67\x6D\x6F\x64":addEffectForTag(p,new RingModulatorEffect(fxparams[0],fxparams[1]));break;case "\x64\x69\x73\x74\x6F\x72\x74\x69\x6F\x6E":addEffectForTag(p,new DistortionEffect(fxparams[0],fxparams[1],fxparams[2],fxparams[3],fxparams[4]));break;case "\x63\x6F\x6D\x70\x72\x65\x73\x73\x6F\x72":addEffectForTag(p,new CompressorEffect(fxparams[0],fxparams[1],fxparams[2],fxparams[3],fxparams[4]));break;case "\x61\x6E\x61\x6C\x79\x73\x65\x72":addEffectForTag(p,new AnalyserEffect(fxparams[0],fxparams[1]));break}}}};for(i=0,len=playingarr.length;i<len;i++){if(this.saveload===3){continue};d=playingarr[i];src=d["\x62\x75\x66\x66\x65\x72\x73\x72\x63"];is_music=d["\x69\x73\x5F\x6D\x75\x73\x69\x63"];tag=d["\x74\x61\x67"];playbackTime=d["\x70\x6C\x61\x79\x62\x61\x63\x6B\x54\x69\x6D\x65"];looping=d["\x6C\x6F\x6F\x70\x69\x6E\x67"];vol=d["\x76\x6F\x6C\x75\x6D\x65"];pan=d["\x70\x61\x6E"];panObjUid=(pan&&pan.hasOwnProperty("\x6F\x62\x6A\x55\x69\x64"))?pan["\x6F\x62\x6A\x55\x69\x64"]:-1;if(is_music&&this.saveload===1){continue};if(!is_music&&this.saveload===2){continue};a=this.getAudioInstance(src,tag,is_music,looping,vol);if(!a){b=this.getAudioBuffer(src,is_music);b.seekWhenReady=playbackTime;b.pauseWhenReady=d["\x70\x61\x75\x73\x65\x64"];if(pan){if(panObjUid!==-1){b.panWhenReady.push({objUid:panObjUid,ia:pan["\x69\x61"],oa:pan["\x6F\x61"],og:pan["\x6F\x67"],thistag:tag})}else{b.panWhenReady.push({x:pan["\x78"],y:pan["\x79"],a:pan["\x61"],ia:pan["\x69\x61"],oa:pan["\x6F\x61"],og:pan["\x6F\x67"],thistag:tag})}};continue};a.resume_position=d["\x72\x65\x73\x75\x6D\x65\x5F\x70\x6F\x73\x69\x74\x69\x6F\x6E"];a.setPannerEnabled(!!pan);a.play(looping,vol,playbackTime);a.updatePlaybackRate();a.updateVolume();a.doSetMuted(a.is_muted||a.is_silent);if(d["\x70\x61\x75\x73\x65\x64"]){a.pause()};if(d["\x6D\x75\x74\x65\x64"]){a.setMuted(true)};a.doSetMuted(a.is_muted||a.is_silent);if(pan){if(panObjUid!==-1){a.objectTracker=a.objectTracker||new ObjectTracker();a.objectTracker.loadUid=panObjUid;objectTrackerUidsToLoad.push(a.objectTracker)}else{a.setPan(pan["\x78"],pan["\x79"],pan["\x61"],pan["\x69\x61"],pan["\x6F\x61"],pan["\x6F\x67"])}}};if(setSilent&&!silent){for(i=0,len=audioInstances.length;i<len;i++){audioInstances[i].setSilent(true)};silent=true}else{if(!setSilent&&silent){for(i=0,len=audioInstances.length;i<len;i++){audioInstances[i].setSilent(false)};silent=false}}};instanceProto.afterLoad=function(){var i,len,ot,inst;for(i=0,len=objectTrackerUidsToLoad.length;i<len;i++){ot=objectTrackerUidsToLoad[i];inst=this.runtime.getObjectByUID(ot.loadUid);ot.setObject(inst);ot.loadUid=-1;if(inst){listenerX=inst.x;listenerY=inst.y}};cr.clearArray(objectTrackerUidsToLoad)};instanceProto.onSuspend=function(s){if(this.playinbackground){return};if(!s&&context&&context["\x72\x65\x73\x75\x6D\x65"]){context["\x72\x65\x73\x75\x6D\x65"]()};var i,len;for(i=0,len=audioInstances.length;i<len;i++){audioInstances[i].setSuspended(s)};if(s&&context&&context["\x73\x75\x73\x70\x65\x6E\x64"]){context["\x73\x75\x73\x70\x65\x6E\x64"]()}};instanceProto.tick=function(){var dt=this.runtime.dt;var i,len,a;for(i=0,len=audioInstances.length;i<len;i++){a=audioInstances[i];a.tick(dt);if(timescale_mode!==0){a.updatePlaybackRate()}};var p,arr,f;for(p in effects){if(effects.hasOwnProperty(p)){arr=effects[p];for(i=0,len=arr.length;i<len;i++){f=arr[i];if(f.tick){f.tick()}}}};if(api===API_WEBAUDIO&&this.listenerTracker.hasObject()){this.listenerTracker.tick(dt);listenerX=this.listenerTracker.obj.x;listenerY=this.listenerTracker.obj.y;context["\x6C\x69\x73\x74\x65\x6E\x65\x72"]["\x73\x65\x74\x50\x6F\x73\x69\x74\x69\x6F\x6E"](this.listenerTracker.obj.x,this.listenerTracker.obj.y,this.listenerZ);context["\x6C\x69\x73\x74\x65\x6E\x65\x72"]["\x73\x65\x74\x56\x65\x6C\x6F\x63\x69\x74\x79"](this.listenerTracker.getVelocityX(),this.listenerTracker.getVelocityY(),0)}};var preload_list=[];instanceProto.setPreloadList=function(arr){var i,len,p,filename,size,isOgg;var total_size=0;for(i=0,len=arr.length;i<len;++i){p=arr[i];filename=p[0];size=p[1]*2;isOgg=(filename.length>4&&filename.substr(filename.length-4)==="\x2E\x6F\x67\x67");if((isOgg&&useOgg)||(!isOgg&&!useOgg)){preload_list.push({filename:filename,size:size,obj:null});total_size+=size}};return total_size};instanceProto.startPreloads=function(){var i,len,p,src;for(i=0,len=preload_list.length;i<len;++i){p=preload_list[i];src=this.runtime.files_subfolder+p.filename;p.obj=this.getAudioBuffer(src,false)}};instanceProto.getPreloadedSize=function(){var completed=0;var i,len,p;for(i=0,len=preload_list.length;i<len;++i){p=preload_list[i];if(p.obj.isLoadedAndDecoded()||p.obj.hasFailedToLoad()||this.runtime.isDomFree||this.runtime.isAndroidStockBrowser){completed+=p.size}else{if(p.obj.isLoaded()){completed+=Math.floor(p.size/2)}}};return completed};instanceProto.getAudioBuffer=function(src_,is_music){var i,len,a,ret=null,j,k,lenj,ai;for(i=0,len=audioBuffers.length;i<len;i++){a=audioBuffers[i];if(a.src===src_){ret=a;break}};if(!ret){ret=new C2AudioBuffer(src_,is_music);audioBuffers.push(ret)};return ret};instanceProto.getAudioInstance=function(src_,tag,is_music,looping,vol){var i,len,a;for(i=0,len=audioInstances.length;i<len;i++){a=audioInstances[i];if(a.src===src_&&(a.canBeRecycled()||is_music)){a.tag=tag;return a}};var b=this.getAudioBuffer(src_,is_music);if(!b.bufferObject){if(tag!=="\x3C\x70\x72\x65\x6C\x6F\x61\x64\x3E"){b.playTagWhenReady=tag;b.loopWhenReady=looping;b.volumeWhenReady=vol};return null};a=new C2AudioInstance(b,tag);audioInstances.push(a);return a};var taggedAudio=[];function SortByIsPlaying(a,b){var an=a.isPlaying()?1:0;var bn=b.isPlaying()?1:0;if(an===bn){return 0}else{if(an<bn){return 1}else{return-1}}}function getAudioByTag(tag,sort_by_playing){cr.clearArray(taggedAudio);if(!tag.length){if(!lastAudio||lastAudio.hasEnded()){return}else{cr.clearArray(taggedAudio);taggedAudio[0]=lastAudio;return}};var i,len,a;for(i=0,len=audioInstances.length;i<len;i++){a=audioInstances[i];if(cr.equals_nocase(tag,a.tag)){taggedAudio.push(a)}};if(sort_by_playing){taggedAudio.sort(SortByIsPlaying)}}function reconnectEffects(tag){var i,len,arr,n,toNode=context["\x64\x65\x73\x74\x69\x6E\x61\x74\x69\x6F\x6E"];if(effects.hasOwnProperty(tag)){arr=effects[tag];if(arr.length){toNode=arr[0].getInputNode();for(i=0,len=arr.length;i<len;i++){n=arr[i];if(i+1===len){n.connectTo(context["\x64\x65\x73\x74\x69\x6E\x61\x74\x69\x6F\x6E"])}else{n.connectTo(arr[i+1].getInputNode())}}}};getAudioByTag(tag);for(i=0,len=taggedAudio.length;i<len;i++){taggedAudio[i].reconnect(toNode)};if(micSource&&micTag===tag){micSource["\x64\x69\x73\x63\x6F\x6E\x6E\x65\x63\x74"]();micSource["\x63\x6F\x6E\x6E\x65\x63\x74"](toNode)}}function addEffectForTag(tag,fx){if(!effects.hasOwnProperty(tag)){effects[tag]=[fx]}else{effects[tag].push(fx)};reconnectEffects(tag)}function Cnds(){}Cnds.prototype.OnEnded=function(t){return cr.equals_nocase(audTag,t)};Cnds.prototype.PreloadsComplete=function(){var i,len;for(i=0,len=audioBuffers.length;i<len;i++){if(!audioBuffers[i].isLoadedAndDecoded()&&!audioBuffers[i].hasFailedToLoad()){return false}};return true};Cnds.prototype.AdvancedAudioSupported=function(){return api===API_WEBAUDIO};Cnds.prototype.IsSilent=function(){return silent};Cnds.prototype.IsAnyPlaying=function(){var i,len;for(i=0,len=audioInstances.length;i<len;i++){if(audioInstances[i].isPlaying()){return true}};return false};Cnds.prototype.IsTagPlaying=function(tag){getAudioByTag(tag);var i,len;for(i=0,len=taggedAudio.length;i<len;i++){if(taggedAudio[i].isPlaying()){return true}};return false};pluginProto.cnds=new Cnds();function Acts(){}Acts.prototype.Play=function(file,looping,vol,tag){if(silent){return};var v=dbToLinear(vol);var is_music=file[1];var src=this.runtime.files_subfolder+file[0]+(useOgg?"\x2E\x6F\x67\x67":"\x2E\x6D\x34\x61");lastAudio=this.getAudioInstance(src,tag,is_music,looping!==0,v);if(!lastAudio){return};lastAudio.setPannerEnabled(false);lastAudio.play(looping!==0,v)};Acts.prototype.PlayAtPosition=function(file,looping,vol,x_,y_,angle_,innerangle_,outerangle_,outergain_,tag){if(silent){return};var v=dbToLinear(vol);var is_music=file[1];var src=this.runtime.files_subfolder+file[0]+(useOgg?"\x2E\x6F\x67\x67":"\x2E\x6D\x34\x61");lastAudio=this.getAudioInstance(src,tag,is_music,looping!==0,v);if(!lastAudio){var b=this.getAudioBuffer(src,is_music);b.panWhenReady.push({x:x_,y:y_,a:angle_,ia:innerangle_,oa:outerangle_,og:dbToLinear(outergain_),thistag:tag});return};lastAudio.setPannerEnabled(true);lastAudio.setPan(x_,y_,angle_,innerangle_,outerangle_,dbToLinear(outergain_));lastAudio.play(looping!==0,v)};Acts.prototype.PlayAtObject=function(file,looping,vol,obj,innerangle,outerangle,outergain,tag){if(silent||!obj){return};var inst=obj.getFirstPicked();if(!inst){return};var v=dbToLinear(vol);var is_music=file[1];var src=this.runtime.files_subfolder+file[0]+(useOgg?"\x2E\x6F\x67\x67":"\x2E\x6D\x34\x61");lastAudio=this.getAudioInstance(src,tag,is_music,looping!==0,v);if(!lastAudio){var b=this.getAudioBuffer(src,is_music);b.panWhenReady.push({obj:inst,ia:innerangle,oa:outerangle,og:dbToLinear(outergain),thistag:tag});return};lastAudio.setPannerEnabled(true);var px=cr.rotatePtAround(inst.x,inst.y,-inst.layer.getAngle(),listenerX,listenerY,true);var py=cr.rotatePtAround(inst.x,inst.y,-inst.layer.getAngle(),listenerX,listenerY,false);lastAudio.setPan(px,py,cr.to_degrees(inst.angle-inst.layer.getAngle()),innerangle,outerangle,dbToLinear(outergain));lastAudio.setObject(inst);lastAudio.play(looping!==0,v)};Acts.prototype.PlayByName=function(folder,filename,looping,vol,tag){if(silent){return};var v=dbToLinear(vol);var is_music=(folder===1);var src=this.runtime.files_subfolder+filename.toLowerCase()+(useOgg?"\x2E\x6F\x67\x67":"\x2E\x6D\x34\x61");lastAudio=this.getAudioInstance(src,tag,is_music,looping!==0,v);if(!lastAudio){return};lastAudio.setPannerEnabled(false);lastAudio.play(looping!==0,v)};Acts.prototype.PlayAtPositionByName=function(folder,filename,looping,vol,x_,y_,angle_,innerangle_,outerangle_,outergain_,tag){if(silent){return};var v=dbToLinear(vol);var is_music=(folder===1);var src=this.runtime.files_subfolder+filename.toLowerCase()+(useOgg?"\x2E\x6F\x67\x67":"\x2E\x6D\x34\x61");lastAudio=this.getAudioInstance(src,tag,is_music,looping!==0,v);if(!lastAudio){var b=this.getAudioBuffer(src,is_music);b.panWhenReady.push({x:x_,y:y_,a:angle_,ia:innerangle_,oa:outerangle_,og:dbToLinear(outergain_),thistag:tag});return};lastAudio.setPannerEnabled(true);lastAudio.setPan(x_,y_,angle_,innerangle_,outerangle_,dbToLinear(outergain_));lastAudio.play(looping!==0,v)};Acts.prototype.PlayAtObjectByName=function(folder,filename,looping,vol,obj,innerangle,outerangle,outergain,tag){if(silent||!obj){return};var inst=obj.getFirstPicked();if(!inst){return};var v=dbToLinear(vol);var is_music=(folder===1);var src=this.runtime.files_subfolder+filename.toLowerCase()+(useOgg?"\x2E\x6F\x67\x67":"\x2E\x6D\x34\x61");lastAudio=this.getAudioInstance(src,tag,is_music,looping!==0,v);if(!lastAudio){var b=this.getAudioBuffer(src,is_music);b.panWhenReady.push({obj:inst,ia:innerangle,oa:outerangle,og:dbToLinear(outergain),thistag:tag});return};lastAudio.setPannerEnabled(true);var px=cr.rotatePtAround(inst.x,inst.y,-inst.layer.getAngle(),listenerX,listenerY,true);var py=cr.rotatePtAround(inst.x,inst.y,-inst.layer.getAngle(),listenerX,listenerY,false);lastAudio.setPan(px,py,cr.to_degrees(inst.angle-inst.layer.getAngle()),innerangle,outerangle,dbToLinear(outergain));lastAudio.setObject(inst);lastAudio.play(looping!==0,v)};Acts.prototype.SetLooping=function(tag,looping){getAudioByTag(tag);var i,len;for(i=0,len=taggedAudio.length;i<len;i++){taggedAudio[i].setLooping(looping===0)}};Acts.prototype.SetMuted=function(tag,muted){getAudioByTag(tag);var i,len;for(i=0,len=taggedAudio.length;i<len;i++){taggedAudio[i].setMuted(muted===0)}};Acts.prototype.SetVolume=function(tag,vol){getAudioByTag(tag);var v=dbToLinear(vol);var i,len;for(i=0,len=taggedAudio.length;i<len;i++){taggedAudio[i].setVolume(v)}};Acts.prototype.Preload=function(file){if(silent){return};var is_music=file[1];var src=this.runtime.files_subfolder+file[0]+(useOgg?"\x2E\x6F\x67\x67":"\x2E\x6D\x34\x61");if(api===API_APPMOBI){if(this.runtime.isDirectCanvas){AppMobi["\x63\x6F\x6E\x74\x65\x78\x74"]["\x6C\x6F\x61\x64\x53\x6F\x75\x6E\x64"](src)}else{AppMobi["\x70\x6C\x61\x79\x65\x72"]["\x6C\x6F\x61\x64\x53\x6F\x75\x6E\x64"](src)};return}else{if(api===API_CORDOVA){return}};this.getAudioInstance(src,"\x3C\x70\x72\x65\x6C\x6F\x61\x64\x3E",is_music,false)};Acts.prototype.PreloadByName=function(folder,filename){if(silent){return};var is_music=(folder===1);var src=this.runtime.files_subfolder+filename.toLowerCase()+(useOgg?"\x2E\x6F\x67\x67":"\x2E\x6D\x34\x61");if(api===API_APPMOBI){if(this.runtime.isDirectCanvas){AppMobi["\x63\x6F\x6E\x74\x65\x78\x74"]["\x6C\x6F\x61\x64\x53\x6F\x75\x6E\x64"](src)}else{AppMobi["\x70\x6C\x61\x79\x65\x72"]["\x6C\x6F\x61\x64\x53\x6F\x75\x6E\x64"](src)};return}else{if(api===API_CORDOVA){return}};this.getAudioInstance(src,"\x3C\x70\x72\x65\x6C\x6F\x61\x64\x3E",is_music,false)};Acts.prototype.SetPlaybackRate=function(tag,rate){getAudioByTag(tag);if(rate<0.0){rate=0};var i,len;for(i=0,len=taggedAudio.length;i<len;i++){taggedAudio[i].setPlaybackRate(rate)}};Acts.prototype.Stop=function(tag){getAudioByTag(tag);var i,len;for(i=0,len=taggedAudio.length;i<len;i++){taggedAudio[i].stop()}};Acts.prototype.StopAll=function(){var i,len;for(i=0,len=audioInstances.length;i<len;i++){audioInstances[i].stop()}};Acts.prototype.SetPaused=function(tag,state){getAudioByTag(tag);var i,len;for(i=0,len=taggedAudio.length;i<len;i++){if(state===0){taggedAudio[i].pause()}else{taggedAudio[i].resume()}}};Acts.prototype.Seek=function(tag,pos){getAudioByTag(tag);var i,len;for(i=0,len=taggedAudio.length;i<len;i++){taggedAudio[i].seek(pos)}};Acts.prototype.SetSilent=function(s){var i,len;if(s===2){s=(silent?1:0)};if(s===0&&!silent){for(i=0,len=audioInstances.length;i<len;i++){audioInstances[i].setSilent(true)};silent=true}else{if(s===1&&silent){for(i=0,len=audioInstances.length;i<len;i++){audioInstances[i].setSilent(false)};silent=false}}};Acts.prototype.SetMasterVolume=function(vol){masterVolume=dbToLinear(vol);var i,len;for(i=0,len=audioInstances.length;i<len;i++){audioInstances[i].updateVolume()}};Acts.prototype.AddFilterEffect=function(tag,type,freq,detune,q,gain,mix){if(api!==API_WEBAUDIO||type<0||type>=filterTypes.length||!context["\x63\x72\x65\x61\x74\x65\x42\x69\x71\x75\x61\x64\x46\x69\x6C\x74\x65\x72"]){return};tag=tag.toLowerCase();mix=mix/100;if(mix<0){mix=0};if(mix>1){mix=1};addEffectForTag(tag,new FilterEffect(type,freq,detune,q,gain,mix))};Acts.prototype.AddDelayEffect=function(tag,delay,gain,mix){if(api!==API_WEBAUDIO){return};tag=tag.toLowerCase();mix=mix/100;if(mix<0){mix=0};if(mix>1){mix=1};addEffectForTag(tag,new DelayEffect(delay,dbToLinear(gain),mix))};Acts.prototype.AddFlangerEffect=function(tag,delay,modulation,freq,feedback,mix){if(api!==API_WEBAUDIO||!context["\x63\x72\x65\x61\x74\x65\x4F\x73\x63\x69\x6C\x6C\x61\x74\x6F\x72"]){return};tag=tag.toLowerCase();mix=mix/100;if(mix<0){mix=0};if(mix>1){mix=1};addEffectForTag(tag,new FlangerEffect(delay/1000,modulation/1000,freq,feedback/100,mix))};Acts.prototype.AddPhaserEffect=function(tag,freq,detune,q,mod,modfreq,mix){if(api!==API_WEBAUDIO||!context["\x63\x72\x65\x61\x74\x65\x4F\x73\x63\x69\x6C\x6C\x61\x74\x6F\x72"]){return};tag=tag.toLowerCase();mix=mix/100;if(mix<0){mix=0};if(mix>1){mix=1};addEffectForTag(tag,new PhaserEffect(freq,detune,q,mod,modfreq,mix))};Acts.prototype.AddConvolutionEffect=function(tag,file,norm,mix){if(api!==API_WEBAUDIO||!context["\x63\x72\x65\x61\x74\x65\x43\x6F\x6E\x76\x6F\x6C\x76\x65\x72"]){return};var doNormalize=(norm===0);var src=this.runtime.files_subfolder+file[0]+(useOgg?"\x2E\x6F\x67\x67":"\x2E\x6D\x34\x61");var b=this.getAudioBuffer(src,false);tag=tag.toLowerCase();mix=mix/100;if(mix<0){mix=0};if(mix>1){mix=1};var fx;if(b.bufferObject){fx=new ConvolveEffect(b.bufferObject,doNormalize,mix,src)}else{fx=new ConvolveEffect(null,doNormalize,mix,src);b.normalizeWhenReady=doNormalize;b.convolveWhenReady=fx};addEffectForTag(tag,fx)};Acts.prototype.AddGainEffect=function(tag,g){if(api!==API_WEBAUDIO){return};tag=tag.toLowerCase();addEffectForTag(tag,new GainEffect(dbToLinear(g)))};Acts.prototype.AddMuteEffect=function(tag){if(api!==API_WEBAUDIO){return};tag=tag.toLowerCase();addEffectForTag(tag,new GainEffect(0))};Acts.prototype.AddTremoloEffect=function(tag,freq,mix){if(api!==API_WEBAUDIO||!context["\x63\x72\x65\x61\x74\x65\x4F\x73\x63\x69\x6C\x6C\x61\x74\x6F\x72"]){return};tag=tag.toLowerCase();mix=mix/100;if(mix<0){mix=0};if(mix>1){mix=1};addEffectForTag(tag,new TremoloEffect(freq,mix))};Acts.prototype.AddRingModEffect=function(tag,freq,mix){if(api!==API_WEBAUDIO||!context["\x63\x72\x65\x61\x74\x65\x4F\x73\x63\x69\x6C\x6C\x61\x74\x6F\x72"]){return};tag=tag.toLowerCase();mix=mix/100;if(mix<0){mix=0};if(mix>1){mix=1};addEffectForTag(tag,new RingModulatorEffect(freq,mix))};Acts.prototype.AddDistortionEffect=function(tag,threshold,headroom,drive,makeupgain,mix){if(api!==API_WEBAUDIO||!context["\x63\x72\x65\x61\x74\x65\x57\x61\x76\x65\x53\x68\x61\x70\x65\x72"]){return};tag=tag.toLowerCase();mix=mix/100;if(mix<0){mix=0};if(mix>1){mix=1};addEffectForTag(tag,new DistortionEffect(threshold,headroom,drive,makeupgain,mix))};Acts.prototype.AddCompressorEffect=function(tag,threshold,knee,ratio,attack,release){if(api!==API_WEBAUDIO||!context["\x63\x72\x65\x61\x74\x65\x44\x79\x6E\x61\x6D\x69\x63\x73\x43\x6F\x6D\x70\x72\x65\x73\x73\x6F\x72"]){return};tag=tag.toLowerCase();addEffectForTag(tag,new CompressorEffect(threshold,knee,ratio,attack/1000,release/1000))};Acts.prototype.AddAnalyserEffect=function(tag,fftSize,smoothing){if(api!==API_WEBAUDIO){return};tag=tag.toLowerCase();addEffectForTag(tag,new AnalyserEffect(fftSize,smoothing))};Acts.prototype.RemoveEffects=function(tag){if(api!==API_WEBAUDIO){return};tag=tag.toLowerCase();var i,len,arr;if(effects.hasOwnProperty(tag)){arr=effects[tag];if(arr.length){for(i=0,len=arr.length;i<len;i++){arr[i].remove()};cr.clearArray(arr);reconnectEffects(tag)}}};Acts.prototype.SetEffectParameter=function(tag,index,param,value,ramp,time){if(api!==API_WEBAUDIO){return};tag=tag.toLowerCase();index=Math.floor(index);var arr;if(!effects.hasOwnProperty(tag)){return};arr=effects[tag];if(index<0||index>=arr.length){return};arr[index].setParam(param,value,ramp,time)};Acts.prototype.SetListenerObject=function(obj_){if(!obj_||api!==API_WEBAUDIO){return};var inst=obj_.getFirstPicked();if(!inst){return};this.listenerTracker.setObject(inst);listenerX=inst.x;listenerY=inst.y};Acts.prototype.SetListenerZ=function(z){this.listenerZ=z};pluginProto.acts=new Acts();function Exps(){}Exps.prototype.Duration=function(ret,tag){getAudioByTag(tag,true);if(taggedAudio.length){ret.set_float(taggedAudio[0].getDuration())}else{ret.set_float(0)}};Exps.prototype.PlaybackTime=function(ret,tag){getAudioByTag(tag,true);if(taggedAudio.length){ret.set_float(taggedAudio[0].getPlaybackTime(true))}else{ret.set_float(0)}};Exps.prototype.Volume=function(ret,tag){getAudioByTag(tag,true);if(taggedAudio.length){var v=taggedAudio[0].getVolume();ret.set_float(linearToDb(v))}else{ret.set_float(0)}};Exps.prototype.MasterVolume=function(ret){ret.set_float(linearToDb(masterVolume))};Exps.prototype.EffectCount=function(ret,tag){tag=tag.toLowerCase();var arr=null;if(effects.hasOwnProperty(tag)){arr=effects[tag]};ret.set_int(arr?arr.length:0)};function getAnalyser(tag,index){var arr=null;if(effects.hasOwnProperty(tag)){arr=effects[tag]};if(arr&&index>=0&&index<arr.length&&arr[index].freqBins){return arr[index]}else{return null}}Exps.prototype.AnalyserFreqBinCount=function(ret,tag,index){tag=tag.toLowerCase();index=Math.floor(index);var analyser=getAnalyser(tag,index);ret.set_int(analyser?analyser.node["\x66\x72\x65\x71\x75\x65\x6E\x63\x79\x42\x69\x6E\x43\x6F\x75\x6E\x74"]:0)};Exps.prototype.AnalyserFreqBinAt=function(ret,tag,index,bin){tag=tag.toLowerCase();index=Math.floor(index);bin=Math.floor(bin);var analyser=getAnalyser(tag,index);if(!analyser){ret.set_float(0)}else{if(bin<0||bin>=analyser.node["\x66\x72\x65\x71\x75\x65\x6E\x63\x79\x42\x69\x6E\x43\x6F\x75\x6E\x74"]){ret.set_float(0)}else{ret.set_float(analyser.freqBins[bin])}}};Exps.prototype.AnalyserPeakLevel=function(ret,tag,index){tag=tag.toLowerCase();index=Math.floor(index);var analyser=getAnalyser(tag,index);if(analyser){ret.set_float(analyser.peak)}else{ret.set_float(0)}};Exps.prototype.AnalyserRMSLevel=function(ret,tag,index){tag=tag.toLowerCase();index=Math.floor(index);var analyser=getAnalyser(tag,index);if(analyser){ret.set_float(analyser.rms)}else{ret.set_float(0)}};pluginProto.exps=new Exps()}());;;;;cr.plugins_.Browser=function(runtime){this.runtime=runtime};(function(){var pluginProto=cr.plugins_.Browser.prototype;pluginProto.Type=function(plugin){this.plugin=plugin;this.runtime=plugin.runtime};var typeProto=pluginProto.Type.prototype;typeProto.onCreate=function(){};pluginProto.Instance=function(type){this.type=type;this.runtime=type.runtime};var instanceProto=pluginProto.Instance.prototype;instanceProto.onCreate=function(){var self=this;window.addEventListener("\x72\x65\x73\x69\x7A\x65",function(){self.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnResize,self)});if(typeof navigator.onLine!=="\x75\x6E\x64\x65\x66\x69\x6E\x65\x64"){window.addEventListener("\x6F\x6E\x6C\x69\x6E\x65",function(){self.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnOnline,self)});window.addEventListener("\x6F\x66\x66\x6C\x69\x6E\x65",function(){self.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnOffline,self)})};if(typeof window.applicationCache!=="\x75\x6E\x64\x65\x66\x69\x6E\x65\x64"){window.applicationCache.addEventListener('\x75\x70\x64\x61\x74\x65\x72\x65\x61\x64\x79',function(){self.runtime.loadingprogress=1;self.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnUpdateReady,self)});window.applicationCache.addEventListener('\x70\x72\x6F\x67\x72\x65\x73\x73',function(e){self.runtime.loadingprogress=e["\x6C\x6F\x61\x64\x65\x64"]/e["\x74\x6F\x74\x61\x6C"]})};if(!this.runtime.isDirectCanvas){document.addEventListener("\x61\x70\x70\x4D\x6F\x62\x69\x2E\x64\x65\x76\x69\x63\x65\x2E\x75\x70\x64\x61\x74\x65\x2E\x61\x76\x61\x69\x6C\x61\x62\x6C\x65",function(){self.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnUpdateReady,self)});document.addEventListener("\x62\x61\x63\x6B\x62\x75\x74\x74\x6F\x6E",function(){self.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnBackButton,self)});document.addEventListener("\x6D\x65\x6E\x75\x62\x75\x74\x74\x6F\x6E",function(){self.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnMenuButton,self)});document.addEventListener("\x73\x65\x61\x72\x63\x68\x62\x75\x74\x74\x6F\x6E",function(){self.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnSearchButton,self)});document.addEventListener("\x74\x69\x7A\x65\x6E\x68\x77\x6B\x65\x79",function(e){var ret;switch(e["\x6B\x65\x79\x4E\x61\x6D\x65"]){case "\x62\x61\x63\x6B":ret=self.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnBackButton,self);if(!ret){if(window["\x74\x69\x7A\x65\x6E"]){window["\x74\x69\x7A\x65\x6E"]["\x61\x70\x70\x6C\x69\x63\x61\x74\x69\x6F\x6E"]["\x67\x65\x74\x43\x75\x72\x72\x65\x6E\x74\x41\x70\x70\x6C\x69\x63\x61\x74\x69\x6F\x6E"]()["\x65\x78\x69\x74"]()}};break;case "\x6D\x65\x6E\x75":ret=self.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnMenuButton,self);if(!ret){e.preventDefault()};break}})};if(this.runtime.isWinJS&&WinJS["\x41\x70\x70\x6C\x69\x63\x61\x74\x69\x6F\x6E"]){WinJS["\x41\x70\x70\x6C\x69\x63\x61\x74\x69\x6F\x6E"]["\x6F\x6E\x62\x61\x63\x6B\x63\x6C\x69\x63\x6B"]=function(e){return!!self.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnBackButton,self)}};this.runtime.addSuspendCallback(function(s){if(s){self.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnPageHidden,self)}else{self.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnPageVisible,self)}});this.is_arcade=(typeof window["\x69\x73\x5F\x73\x63\x69\x72\x72\x61\x5F\x61\x72\x63\x61\x64\x65"]!=="\x75\x6E\x64\x65\x66\x69\x6E\x65\x64")};var batteryManager=null;var loadedBatteryManager=false;function maybeLoadBatteryManager(){if(loadedBatteryManager){return};if(!navigator["\x67\x65\x74\x42\x61\x74\x74\x65\x72\x79"]){return};var promise=navigator["\x67\x65\x74\x42\x61\x74\x74\x65\x72\x79"]();loadedBatteryManager=true;if(promise){promise.then(function(manager){batteryManager=manager})}}function Cnds(){}Cnds.prototype.CookiesEnabled=function(){return navigator?navigator.cookieEnabled:false};Cnds.prototype.IsOnline=function(){return navigator?navigator.onLine:false};Cnds.prototype.HasJava=function(){return navigator?navigator.javaEnabled():false};Cnds.prototype.OnOnline=function(){return true};Cnds.prototype.OnOffline=function(){return true};Cnds.prototype.IsDownloadingUpdate=function(){if(typeof window["\x61\x70\x70\x6C\x69\x63\x61\x74\x69\x6F\x6E\x43\x61\x63\x68\x65"]==="\x75\x6E\x64\x65\x66\x69\x6E\x65\x64"){return false}else{return window["\x61\x70\x70\x6C\x69\x63\x61\x74\x69\x6F\x6E\x43\x61\x63\x68\x65"]["\x73\x74\x61\x74\x75\x73"]===window["\x61\x70\x70\x6C\x69\x63\x61\x74\x69\x6F\x6E\x43\x61\x63\x68\x65"]["\x44\x4F\x57\x4E\x4C\x4F\x41\x44\x49\x4E\x47"]}};Cnds.prototype.OnUpdateReady=function(){return true};Cnds.prototype.PageVisible=function(){return!this.runtime.isSuspended};Cnds.prototype.OnPageVisible=function(){return true};Cnds.prototype.OnPageHidden=function(){return true};Cnds.prototype.OnResize=function(){return true};Cnds.prototype.IsFullscreen=function(){return!!(document["\x6D\x6F\x7A\x46\x75\x6C\x6C\x53\x63\x72\x65\x65\x6E"]||document["\x77\x65\x62\x6B\x69\x74\x49\x73\x46\x75\x6C\x6C\x53\x63\x72\x65\x65\x6E"]||document["\x66\x75\x6C\x6C\x53\x63\x72\x65\x65\x6E"]||this.runtime.isNodeFullscreen)};Cnds.prototype.OnBackButton=function(){return true};Cnds.prototype.OnMenuButton=function(){return true};Cnds.prototype.OnSearchButton=function(){return true};Cnds.prototype.IsMetered=function(){var connection=navigator["\x63\x6F\x6E\x6E\x65\x63\x74\x69\x6F\x6E"]||navigator["\x6D\x6F\x7A\x43\x6F\x6E\x6E\x65\x63\x74\x69\x6F\x6E"]||navigator["\x77\x65\x62\x6B\x69\x74\x43\x6F\x6E\x6E\x65\x63\x74\x69\x6F\x6E"];if(!connection){return false};return!!connection["\x6D\x65\x74\x65\x72\x65\x64"]};Cnds.prototype.IsCharging=function(){var battery=navigator["\x62\x61\x74\x74\x65\x72\x79"]||navigator["\x6D\x6F\x7A\x42\x61\x74\x74\x65\x72\x79"]||navigator["\x77\x65\x62\x6B\x69\x74\x42\x61\x74\x74\x65\x72\x79"];if(battery){return!!battery["\x63\x68\x61\x72\x67\x69\x6E\x67"]}else{maybeLoadBatteryManager();if(batteryManager){return!!batteryManager["\x63\x68\x61\x72\x67\x69\x6E\x67"]}else{return true}}};Cnds.prototype.IsPortraitLandscape=function(p){var current=(window.innerWidth<=window.innerHeight?0:1);return current===p};Cnds.prototype.SupportsFullscreen=function(){if(this.runtime.isNodeWebkit){return true};var elem=this.runtime.canvasdiv||this.runtime.canvas;return!!(elem["\x72\x65\x71\x75\x65\x73\x74\x46\x75\x6C\x6C\x73\x63\x72\x65\x65\x6E"]||elem["\x6D\x6F\x7A\x52\x65\x71\x75\x65\x73\x74\x46\x75\x6C\x6C\x53\x63\x72\x65\x65\x6E"]||elem["\x6D\x73\x52\x65\x71\x75\x65\x73\x74\x46\x75\x6C\x6C\x73\x63\x72\x65\x65\x6E"]||elem["\x77\x65\x62\x6B\x69\x74\x52\x65\x71\x75\x65\x73\x74\x46\x75\x6C\x6C\x53\x63\x72\x65\x65\x6E"])};pluginProto.cnds=new Cnds();function Acts(){}Acts.prototype.Alert=function(msg){if(!this.runtime.isDomFree){alert(msg.toString())}};Acts.prototype.Close=function(){if(this.runtime.isCocoonJs){CocoonJS["\x41\x70\x70"]["\x66\x6F\x72\x63\x65\x54\x6F\x46\x69\x6E\x69\x73\x68"]()}else{if(window["\x74\x69\x7A\x65\x6E"]){window["\x74\x69\x7A\x65\x6E"]["\x61\x70\x70\x6C\x69\x63\x61\x74\x69\x6F\x6E"]["\x67\x65\x74\x43\x75\x72\x72\x65\x6E\x74\x41\x70\x70\x6C\x69\x63\x61\x74\x69\x6F\x6E"]()["\x65\x78\x69\x74"]()}else{if(navigator["\x61\x70\x70"]&&navigator["\x61\x70\x70"]["\x65\x78\x69\x74\x41\x70\x70"]){navigator["\x61\x70\x70"]["\x65\x78\x69\x74\x41\x70\x70"]()}else{if(navigator["\x64\x65\x76\x69\x63\x65"]&&navigator["\x64\x65\x76\x69\x63\x65"]["\x65\x78\x69\x74\x41\x70\x70"]){navigator["\x64\x65\x76\x69\x63\x65"]["\x65\x78\x69\x74\x41\x70\x70"]()}else{if(!this.is_arcade&&!this.runtime.isDomFree){window.close()}}}}}};Acts.prototype.Focus=function(){if(this.runtime.isNodeWebkit){var win=window["\x6E\x77\x67\x75\x69"]["\x57\x69\x6E\x64\x6F\x77"]["\x67\x65\x74"]();win["\x66\x6F\x63\x75\x73"]()}else{if(!this.is_arcade&&!this.runtime.isDomFree){window.focus()}}};Acts.prototype.Blur=function(){if(this.runtime.isNodeWebkit){var win=window["\x6E\x77\x67\x75\x69"]["\x57\x69\x6E\x64\x6F\x77"]["\x67\x65\x74"]();win["\x62\x6C\x75\x72"]()}else{if(!this.is_arcade&&!this.runtime.isDomFree){window.blur()}}};Acts.prototype.GoBack=function(){if(navigator["\x61\x70\x70"]&&navigator["\x61\x70\x70"]["\x62\x61\x63\x6B\x48\x69\x73\x74\x6F\x72\x79"]){navigator["\x61\x70\x70"]["\x62\x61\x63\x6B\x48\x69\x73\x74\x6F\x72\x79"]()}else{if(!this.is_arcade&&!this.runtime.isDomFree&&window.back){window.back()}}};Acts.prototype.GoForward=function(){if(!this.is_arcade&&!this.runtime.isDomFree&&window.forward){window.forward()}};Acts.prototype.GoHome=function(){if(!this.is_arcade&&!this.runtime.isDomFree&&window.home){window.home()}};Acts.prototype.GoToURL=function(url,target){if(this.runtime.isCocoonJs){CocoonJS["\x41\x70\x70"]["\x6F\x70\x65\x6E\x55\x52\x4C"](url)}else{if(this.runtime.isEjecta){ejecta["\x6F\x70\x65\x6E\x55\x52\x4C"](url)}else{if(this.runtime.isWinJS){Windows["\x53\x79\x73\x74\x65\x6D"]["\x4C\x61\x75\x6E\x63\x68\x65\x72"]["\x6C\x61\x75\x6E\x63\x68\x55\x72\x69\x41\x73\x79\x6E\x63"](new Windows["\x46\x6F\x75\x6E\x64\x61\x74\x69\x6F\x6E"]["\x55\x72\x69"](url))}else{if(navigator["\x61\x70\x70"]&&navigator["\x61\x70\x70"]["\x6C\x6F\x61\x64\x55\x72\x6C"]){navigator["\x61\x70\x70"]["\x6C\x6F\x61\x64\x55\x72\x6C"](url,{"\x6F\x70\x65\x6E\x45\x78\x74\x65\x72\x6E\x61\x6C":true})}else{if(this.runtime.isCordova){window.open(url,"\x5F\x73\x79\x73\x74\x65\x6D")}else{if(!this.is_arcade&&!this.runtime.isDomFree){if(target===2&&!this.is_arcade){window.top.location=url}else{if(target===1&&!this.is_arcade){window.parent.location=url}else{window.location=url}}}}}}}}};Acts.prototype.GoToURLWindow=function(url,tag){if(this.runtime.isCocoonJs){CocoonJS["\x41\x70\x70"]["\x6F\x70\x65\x6E\x55\x52\x4C"](url)}else{if(this.runtime.isEjecta){ejecta["\x6F\x70\x65\x6E\x55\x52\x4C"](url)}else{if(this.runtime.isWinJS){Windows["\x53\x79\x73\x74\x65\x6D"]["\x4C\x61\x75\x6E\x63\x68\x65\x72"]["\x6C\x61\x75\x6E\x63\x68\x55\x72\x69\x41\x73\x79\x6E\x63"](new Windows["\x46\x6F\x75\x6E\x64\x61\x74\x69\x6F\x6E"]["\x55\x72\x69"](url))}else{if(navigator["\x61\x70\x70"]&&navigator["\x61\x70\x70"]["\x6C\x6F\x61\x64\x55\x72\x6C"]){navigator["\x61\x70\x70"]["\x6C\x6F\x61\x64\x55\x72\x6C"](url,{"\x6F\x70\x65\x6E\x45\x78\x74\x65\x72\x6E\x61\x6C":true})}else{if(this.runtime.isCordova){window.open(url,"\x5F\x73\x79\x73\x74\x65\x6D")}else{if(!this.is_arcade&&!this.runtime.isDomFree){window.open(url,tag)}}}}}}};Acts.prototype.Reload=function(){if(!this.is_arcade&&!this.runtime.isDomFree){window.location.reload()}};var firstRequestFullscreen=true;var crruntime=null;function onFullscreenError(e){if(console&&console.warn){console.warn("\x46\x75\x6C\x6C\x73\x63\x72\x65\x65\x6E\x20\x72\x65\x71\x75\x65\x73\x74\x20\x66\x61\x69\x6C\x65\x64\x3A\x20",e)};crruntime["\x73\x65\x74\x53\x69\x7A\x65"](window.innerWidth,window.innerHeight)}Acts.prototype.RequestFullScreen=function(stretchmode){if(this.runtime.isDomFree){cr.logexport("\x5B\x43\x6F\x6E\x73\x74\x72\x75\x63\x74\x20\x32\x5D\x20\x52\x65\x71\x75\x65\x73\x74\x69\x6E\x67\x20\x66\x75\x6C\x6C\x73\x63\x72\x65\x65\x6E\x20\x69\x73\x20\x6E\x6F\x74\x20\x73\x75\x70\x70\x6F\x72\x74\x65\x64\x20\x6F\x6E\x20\x74\x68\x69\x73\x20\x70\x6C\x61\x74\x66\x6F\x72\x6D\x20\x2D\x20\x74\x68\x65\x20\x72\x65\x71\x75\x65\x73\x74\x20\x68\x61\x73\x20\x62\x65\x65\x6E\x20\x69\x67\x6E\x6F\x72\x65\x64");return};if(stretchmode>=2){stretchmode+=1};if(stretchmode===6){stretchmode=2};if(this.runtime.isNodeWebkit){if(this.runtime.isDebug){debuggerFullscreen(true)}else{if(!this.runtime.isNodeFullscreen&&window["\x6E\x77\x67\x75\x69"]){window["\x6E\x77\x67\x75\x69"]["\x57\x69\x6E\x64\x6F\x77"]["\x67\x65\x74"]()["\x65\x6E\x74\x65\x72\x46\x75\x6C\x6C\x73\x63\x72\x65\x65\x6E"]();this.runtime.isNodeFullscreen=true;this.runtime.fullscreen_scaling=(stretchmode>=2?stretchmode:0)}}}else{if(document["\x6D\x6F\x7A\x46\x75\x6C\x6C\x53\x63\x72\x65\x65\x6E"]||document["\x77\x65\x62\x6B\x69\x74\x49\x73\x46\x75\x6C\x6C\x53\x63\x72\x65\x65\x6E"]||!!document["\x6D\x73\x46\x75\x6C\x6C\x73\x63\x72\x65\x65\x6E\x45\x6C\x65\x6D\x65\x6E\x74"]||document["\x66\x75\x6C\x6C\x53\x63\x72\x65\x65\x6E"]||document["\x66\x75\x6C\x6C\x53\x63\x72\x65\x65\x6E\x45\x6C\x65\x6D\x65\x6E\x74"]){return};this.runtime.fullscreen_scaling=(stretchmode>=2?stretchmode:0);var elem=this.runtime.canvasdiv||this.runtime.canvas;if(firstRequestFullscreen){firstRequestFullscreen=false;crruntime=this.runtime;elem.addEventListener("\x6D\x6F\x7A\x66\x75\x6C\x6C\x73\x63\x72\x65\x65\x6E\x65\x72\x72\x6F\x72",onFullscreenError);elem.addEventListener("\x77\x65\x62\x6B\x69\x74\x66\x75\x6C\x6C\x73\x63\x72\x65\x65\x6E\x65\x72\x72\x6F\x72",onFullscreenError);elem.addEventListener("\x4D\x53\x46\x75\x6C\x6C\x73\x63\x72\x65\x65\x6E\x45\x72\x72\x6F\x72",onFullscreenError);elem.addEventListener("\x66\x75\x6C\x6C\x73\x63\x72\x65\x65\x6E\x65\x72\x72\x6F\x72",onFullscreenError)};if(elem["\x72\x65\x71\x75\x65\x73\x74\x46\x75\x6C\x6C\x73\x63\x72\x65\x65\x6E"]){elem["\x72\x65\x71\x75\x65\x73\x74\x46\x75\x6C\x6C\x73\x63\x72\x65\x65\x6E"]()}else{if(elem["\x6D\x6F\x7A\x52\x65\x71\x75\x65\x73\x74\x46\x75\x6C\x6C\x53\x63\x72\x65\x65\x6E"]){elem["\x6D\x6F\x7A\x52\x65\x71\x75\x65\x73\x74\x46\x75\x6C\x6C\x53\x63\x72\x65\x65\x6E"]()}else{if(elem["\x6D\x73\x52\x65\x71\x75\x65\x73\x74\x46\x75\x6C\x6C\x73\x63\x72\x65\x65\x6E"]){elem["\x6D\x73\x52\x65\x71\x75\x65\x73\x74\x46\x75\x6C\x6C\x73\x63\x72\x65\x65\x6E"]()}else{if(elem["\x77\x65\x62\x6B\x69\x74\x52\x65\x71\x75\x65\x73\x74\x46\x75\x6C\x6C\x53\x63\x72\x65\x65\x6E"]){if(typeof Element!=="\x75\x6E\x64\x65\x66\x69\x6E\x65\x64"&&typeof Element["\x41\x4C\x4C\x4F\x57\x5F\x4B\x45\x59\x42\x4F\x41\x52\x44\x5F\x49\x4E\x50\x55\x54"]!=="\x75\x6E\x64\x65\x66\x69\x6E\x65\x64"){elem["\x77\x65\x62\x6B\x69\x74\x52\x65\x71\x75\x65\x73\x74\x46\x75\x6C\x6C\x53\x63\x72\x65\x65\x6E"](Element["\x41\x4C\x4C\x4F\x57\x5F\x4B\x45\x59\x42\x4F\x41\x52\x44\x5F\x49\x4E\x50\x55\x54"])}else{elem["\x77\x65\x62\x6B\x69\x74\x52\x65\x71\x75\x65\x73\x74\x46\x75\x6C\x6C\x53\x63\x72\x65\x65\x6E"]()}}}}}}};Acts.prototype.CancelFullScreen=function(){if(this.runtime.isDomFree){cr.logexport("\x5B\x43\x6F\x6E\x73\x74\x72\x75\x63\x74\x20\x32\x5D\x20\x45\x78\x69\x74\x69\x6E\x67\x20\x66\x75\x6C\x6C\x73\x63\x72\x65\x65\x6E\x20\x69\x73\x20\x6E\x6F\x74\x20\x73\x75\x70\x70\x6F\x72\x74\x65\x64\x20\x6F\x6E\x20\x74\x68\x69\x73\x20\x70\x6C\x61\x74\x66\x6F\x72\x6D\x20\x2D\x20\x74\x68\x65\x20\x72\x65\x71\x75\x65\x73\x74\x20\x68\x61\x73\x20\x62\x65\x65\x6E\x20\x69\x67\x6E\x6F\x72\x65\x64");return};if(this.runtime.isNodeWebkit){if(this.runtime.isDebug){debuggerFullscreen(false)}else{if(this.runtime.isNodeFullscreen&&window["\x6E\x77\x67\x75\x69"]){window["\x6E\x77\x67\x75\x69"]["\x57\x69\x6E\x64\x6F\x77"]["\x67\x65\x74"]()["\x6C\x65\x61\x76\x65\x46\x75\x6C\x6C\x73\x63\x72\x65\x65\x6E"]();this.runtime.isNodeFullscreen=false}}}else{if(document["\x65\x78\x69\x74\x46\x75\x6C\x6C\x73\x63\x72\x65\x65\x6E"]){document["\x65\x78\x69\x74\x46\x75\x6C\x6C\x73\x63\x72\x65\x65\x6E"]()}else{if(document["\x6D\x6F\x7A\x43\x61\x6E\x63\x65\x6C\x46\x75\x6C\x6C\x53\x63\x72\x65\x65\x6E"]){document["\x6D\x6F\x7A\x43\x61\x6E\x63\x65\x6C\x46\x75\x6C\x6C\x53\x63\x72\x65\x65\x6E"]()}else{if(document["\x6D\x73\x45\x78\x69\x74\x46\x75\x6C\x6C\x73\x63\x72\x65\x65\x6E"]){document["\x6D\x73\x45\x78\x69\x74\x46\x75\x6C\x6C\x73\x63\x72\x65\x65\x6E"]()}else{if(document["\x77\x65\x62\x6B\x69\x74\x43\x61\x6E\x63\x65\x6C\x46\x75\x6C\x6C\x53\x63\x72\x65\x65\x6E"]){document["\x77\x65\x62\x6B\x69\x74\x43\x61\x6E\x63\x65\x6C\x46\x75\x6C\x6C\x53\x63\x72\x65\x65\x6E"]()}}}}}};Acts.prototype.Vibrate=function(pattern_){try{var arr=pattern_.split("\x2C");var i,len;for(i=0,len=arr.length;i<len;i++){arr[i]=parseInt(arr[i],10)};if(navigator["\x76\x69\x62\x72\x61\x74\x65"]){navigator["\x76\x69\x62\x72\x61\x74\x65"](arr)}else{if(navigator["\x6D\x6F\x7A\x56\x69\x62\x72\x61\x74\x65"]){navigator["\x6D\x6F\x7A\x56\x69\x62\x72\x61\x74\x65"](arr)}else{if(navigator["\x77\x65\x62\x6B\x69\x74\x56\x69\x62\x72\x61\x74\x65"]){navigator["\x77\x65\x62\x6B\x69\x74\x56\x69\x62\x72\x61\x74\x65"](arr)}else{if(navigator["\x6D\x73\x56\x69\x62\x72\x61\x74\x65"]){navigator["\x6D\x73\x56\x69\x62\x72\x61\x74\x65"](arr)}}}}}catch(e){}};Acts.prototype.InvokeDownload=function(url_,filename_){var a=document.createElement("\x61");if(typeof a["\x64\x6F\x77\x6E\x6C\x6F\x61\x64"]==="\x75\x6E\x64\x65\x66\x69\x6E\x65\x64"){window.open(url_)}else{var body=document.getElementsByTagName("\x62\x6F\x64\x79")[0];a.textContent=filename_;a.href=url_;a["\x64\x6F\x77\x6E\x6C\x6F\x61\x64"]=filename_;body.appendChild(a);var clickEvent=document.createEvent("\x4D\x6F\x75\x73\x65\x45\x76\x65\x6E\x74");clickEvent.initMouseEvent("\x63\x6C\x69\x63\x6B",true,true,window,0,0,0,0,0,false,false,false,false,0,null);a.dispatchEvent(clickEvent);body.removeChild(a)}};Acts.prototype.InvokeDownloadString=function(str_,mimetype_,filename_){var datauri="\x64\x61\x74\x61\x3A"+mimetype_+"\x2C"+encodeURIComponent(str_);var a=document.createElement("\x61");if(typeof a["\x64\x6F\x77\x6E\x6C\x6F\x61\x64"]==="\x75\x6E\x64\x65\x66\x69\x6E\x65\x64"){window.open(datauri)}else{var body=document.getElementsByTagName("\x62\x6F\x64\x79")[0];a.textContent=filename_;a.href=datauri;a["\x64\x6F\x77\x6E\x6C\x6F\x61\x64"]=filename_;body.appendChild(a);var clickEvent=document.createEvent("\x4D\x6F\x75\x73\x65\x45\x76\x65\x6E\x74");clickEvent.initMouseEvent("\x63\x6C\x69\x63\x6B",true,true,window,0,0,0,0,0,false,false,false,false,0,null);a.dispatchEvent(clickEvent);body.removeChild(a)}};Acts.prototype.ConsoleLog=function(type_,msg_){if(typeof console==="\x75\x6E\x64\x65\x66\x69\x6E\x65\x64"){return};if(type_===0&&console.log){console.log(msg_.toString())};if(type_===1&&console.warn){console.warn(msg_.toString())};if(type_===2&&console.error){console.error(msg_.toString())}};Acts.prototype.ConsoleGroup=function(name_){if(console&&console.group){console.group(name_)}};Acts.prototype.ConsoleGroupEnd=function(){if(console&&console.groupEnd){console.groupEnd()}};Acts.prototype.ExecJs=function(js_){try{if(eval){eval(js_)}}catch(e){if(console&&console.error){console.error("\x45\x72\x72\x6F\x72\x20\x65\x78\x65\x63\x75\x74\x69\x6E\x67\x20\x4A\x61\x76\x61\x73\x63\x72\x69\x70\x74\x3A\x20",e)}}};var orientations=["\x70\x6F\x72\x74\x72\x61\x69\x74","\x6C\x61\x6E\x64\x73\x63\x61\x70\x65","\x70\x6F\x72\x74\x72\x61\x69\x74\x2D\x70\x72\x69\x6D\x61\x72\x79","\x70\x6F\x72\x74\x72\x61\x69\x74\x2D\x73\x65\x63\x6F\x6E\x64\x61\x72\x79","\x6C\x61\x6E\x64\x73\x63\x61\x70\x65\x2D\x70\x72\x69\x6D\x61\x72\x79","\x6C\x61\x6E\x64\x73\x63\x61\x70\x65\x2D\x73\x65\x63\x6F\x6E\x64\x61\x72\x79"];Acts.prototype.LockOrientation=function(o){o=Math.floor(o);if(o<0||o>=orientations.length){return};this.runtime.autoLockOrientation=false;var orientation=orientations[o];if(screen["\x6F\x72\x69\x65\x6E\x74\x61\x74\x69\x6F\x6E"]&&screen["\x6F\x72\x69\x65\x6E\x74\x61\x74\x69\x6F\x6E"]["\x6C\x6F\x63\x6B"]){screen["\x6F\x72\x69\x65\x6E\x74\x61\x74\x69\x6F\x6E"]["\x6C\x6F\x63\x6B"](orientation)}else{if(screen["\x6C\x6F\x63\x6B\x4F\x72\x69\x65\x6E\x74\x61\x74\x69\x6F\x6E"]){screen["\x6C\x6F\x63\x6B\x4F\x72\x69\x65\x6E\x74\x61\x74\x69\x6F\x6E"](orientation)}else{if(screen["\x77\x65\x62\x6B\x69\x74\x4C\x6F\x63\x6B\x4F\x72\x69\x65\x6E\x74\x61\x74\x69\x6F\x6E"]){screen["\x77\x65\x62\x6B\x69\x74\x4C\x6F\x63\x6B\x4F\x72\x69\x65\x6E\x74\x61\x74\x69\x6F\x6E"](orientation)}else{if(screen["\x6D\x6F\x7A\x4C\x6F\x63\x6B\x4F\x72\x69\x65\x6E\x74\x61\x74\x69\x6F\x6E"]){screen["\x6D\x6F\x7A\x4C\x6F\x63\x6B\x4F\x72\x69\x65\x6E\x74\x61\x74\x69\x6F\x6E"](orientation)}else{if(screen["\x6D\x73\x4C\x6F\x63\x6B\x4F\x72\x69\x65\x6E\x74\x61\x74\x69\x6F\x6E"]){screen["\x6D\x73\x4C\x6F\x63\x6B\x4F\x72\x69\x65\x6E\x74\x61\x74\x69\x6F\x6E"](orientation)}}}}}};Acts.prototype.UnlockOrientation=function(){this.runtime.autoLockOrientation=false;if(screen["\x6F\x72\x69\x65\x6E\x74\x61\x74\x69\x6F\x6E"]&&screen["\x6F\x72\x69\x65\x6E\x74\x61\x74\x69\x6F\x6E"]["\x75\x6E\x6C\x6F\x63\x6B"]){screen["\x6F\x72\x69\x65\x6E\x74\x61\x74\x69\x6F\x6E"]["\x75\x6E\x6C\x6F\x63\x6B"]()}else{if(screen["\x75\x6E\x6C\x6F\x63\x6B\x4F\x72\x69\x65\x6E\x74\x61\x74\x69\x6F\x6E"]){screen["\x75\x6E\x6C\x6F\x63\x6B\x4F\x72\x69\x65\x6E\x74\x61\x74\x69\x6F\x6E"]()}else{if(screen["\x77\x65\x62\x6B\x69\x74\x55\x6E\x6C\x6F\x63\x6B\x4F\x72\x69\x65\x6E\x74\x61\x74\x69\x6F\x6E"]){screen["\x77\x65\x62\x6B\x69\x74\x55\x6E\x6C\x6F\x63\x6B\x4F\x72\x69\x65\x6E\x74\x61\x74\x69\x6F\x6E"]()}else{if(screen["\x6D\x6F\x7A\x55\x6E\x6C\x6F\x63\x6B\x4F\x72\x69\x65\x6E\x74\x61\x74\x69\x6F\x6E"]){screen["\x6D\x6F\x7A\x55\x6E\x6C\x6F\x63\x6B\x4F\x72\x69\x65\x6E\x74\x61\x74\x69\x6F\x6E"]()}else{if(screen["\x6D\x73\x55\x6E\x6C\x6F\x63\x6B\x4F\x72\x69\x65\x6E\x74\x61\x74\x69\x6F\x6E"]){screen["\x6D\x73\x55\x6E\x6C\x6F\x63\x6B\x4F\x72\x69\x65\x6E\x74\x61\x74\x69\x6F\x6E"]()}}}}}};pluginProto.acts=new Acts();function Exps(){}Exps.prototype.URL=function(ret){ret.set_string(this.runtime.isDomFree?"":window.location.toString())};Exps.prototype.Protocol=function(ret){ret.set_string(this.runtime.isDomFree?"":window.location.protocol)};Exps.prototype.Domain=function(ret){ret.set_string(this.runtime.isDomFree?"":window.location.hostname)};Exps.prototype.PathName=function(ret){ret.set_string(this.runtime.isDomFree?"":window.location.pathname)};Exps.prototype.Hash=function(ret){ret.set_string(this.runtime.isDomFree?"":window.location.hash)};Exps.prototype.Referrer=function(ret){ret.set_string(this.runtime.isDomFree?"":document.referrer)};Exps.prototype.Title=function(ret){ret.set_string(this.runtime.isDomFree?"":document.title)};Exps.prototype.Name=function(ret){ret.set_string(this.runtime.isDomFree?"":navigator.appName)};Exps.prototype.Version=function(ret){ret.set_string(this.runtime.isDomFree?"":navigator.appVersion)};Exps.prototype.Language=function(ret){if(navigator&&navigator.language){ret.set_string(navigator.language)}else{ret.set_string("")}};Exps.prototype.Platform=function(ret){ret.set_string(this.runtime.isDomFree?"":navigator.platform)};Exps.prototype.Product=function(ret){if(navigator&&navigator.product){ret.set_string(navigator.product)}else{ret.set_string("")}};Exps.prototype.Vendor=function(ret){if(navigator&&navigator.vendor){ret.set_string(navigator.vendor)}else{ret.set_string("")}};Exps.prototype.UserAgent=function(ret){ret.set_string(this.runtime.isDomFree?"":navigator.userAgent)};Exps.prototype.QueryString=function(ret){ret.set_string(this.runtime.isDomFree?"":window.location.search)};Exps.prototype.QueryParam=function(ret,paramname){if(this.runtime.isDomFree){ret.set_string("");return};var match=RegExp('\x5B\x3F\x26\x5D'+paramname+'\x3D\x28\x5B\x5E\x26\x5D\x2A\x29').exec(window.location.search);if(match){ret.set_string(decodeURIComponent(match[1].replace(/\+/g,'\x20')))}else{ret.set_string("")}};Exps.prototype.Bandwidth=function(ret){var connection=navigator["\x63\x6F\x6E\x6E\x65\x63\x74\x69\x6F\x6E"]||navigator["\x6D\x6F\x7A\x43\x6F\x6E\x6E\x65\x63\x74\x69\x6F\x6E"]||navigator["\x77\x65\x62\x6B\x69\x74\x43\x6F\x6E\x6E\x65\x63\x74\x69\x6F\x6E"];if(!connection){ret.set_float(Number.POSITIVE_INFINITY)}else{if(typeof connection["\x62\x61\x6E\x64\x77\x69\x64\x74\x68"]!=="\x75\x6E\x64\x65\x66\x69\x6E\x65\x64"){ret.set_float(connection["\x62\x61\x6E\x64\x77\x69\x64\x74\x68"])}else{if(typeof connection["\x64\x6F\x77\x6E\x6C\x69\x6E\x6B\x4D\x61\x78"]!=="\x75\x6E\x64\x65\x66\x69\x6E\x65\x64"){ret.set_float(connection["\x64\x6F\x77\x6E\x6C\x69\x6E\x6B\x4D\x61\x78"])}else{ret.set_float(Number.POSITIVE_INFINITY)}}}};Exps.prototype.ConnectionType=function(ret){var connection=navigator["\x63\x6F\x6E\x6E\x65\x63\x74\x69\x6F\x6E"]||navigator["\x6D\x6F\x7A\x43\x6F\x6E\x6E\x65\x63\x74\x69\x6F\x6E"]||navigator["\x77\x65\x62\x6B\x69\x74\x43\x6F\x6E\x6E\x65\x63\x74\x69\x6F\x6E"];if(!connection){ret.set_string("\x75\x6E\x6B\x6E\x6F\x77\x6E")}else{ret.set_string(connection["\x74\x79\x70\x65"]||"\x75\x6E\x6B\x6E\x6F\x77\x6E")}};Exps.prototype.BatteryLevel=function(ret){var battery=navigator["\x62\x61\x74\x74\x65\x72\x79"]||navigator["\x6D\x6F\x7A\x42\x61\x74\x74\x65\x72\x79"]||navigator["\x77\x65\x62\x6B\x69\x74\x42\x61\x74\x74\x65\x72\x79"];if(battery){ret.set_float(battery["\x6C\x65\x76\x65\x6C"])}else{maybeLoadBatteryManager();if(batteryManager){ret.set_float(batteryManager["\x6C\x65\x76\x65\x6C"])}else{ret.set_float(1)}}};Exps.prototype.BatteryTimeLeft=function(ret){var battery=navigator["\x62\x61\x74\x74\x65\x72\x79"]||navigator["\x6D\x6F\x7A\x42\x61\x74\x74\x65\x72\x79"]||navigator["\x77\x65\x62\x6B\x69\x74\x42\x61\x74\x74\x65\x72\x79"];if(battery){ret.set_float(battery["\x64\x69\x73\x63\x68\x61\x72\x67\x69\x6E\x67\x54\x69\x6D\x65"])}else{maybeLoadBatteryManager();if(batteryManager){ret.set_float(batteryManager["\x64\x69\x73\x63\x68\x61\x72\x67\x69\x6E\x67\x54\x69\x6D\x65"])}else{ret.set_float(Number.POSITIVE_INFINITY)}}};Exps.prototype.ExecJS=function(ret,js_){if(!eval){ret.set_any(0);return};var result=0;try{result=eval(js_)}catch(e){if(console&&console.error){console.error("\x45\x72\x72\x6F\x72\x20\x65\x78\x65\x63\x75\x74\x69\x6E\x67\x20\x4A\x61\x76\x61\x73\x63\x72\x69\x70\x74\x3A\x20",e)}};if(typeof result==="\x6E\x75\x6D\x62\x65\x72"){ret.set_any(result)}else{if(typeof result==="\x73\x74\x72\x69\x6E\x67"){ret.set_any(result)}else{if(typeof result==="\x62\x6F\x6F\x6C\x65\x61\x6E"){ret.set_any(result?1:0)}else{ret.set_any(0)}}}};Exps.prototype.ScreenWidth=function(ret){ret.set_int(screen.width)};Exps.prototype.ScreenHeight=function(ret){ret.set_int(screen.height)};Exps.prototype.DevicePixelRatio=function(ret){ret.set_float(this.runtime.devicePixelRatio)};Exps.prototype.WindowInnerWidth=function(ret){ret.set_int(window.innerWidth)};Exps.prototype.WindowInnerHeight=function(ret){ret.set_int(window.innerHeight)};Exps.prototype.WindowOuterWidth=function(ret){ret.set_int(window.outerWidth)};Exps.prototype.WindowOuterHeight=function(ret){ret.set_int(window.outerHeight)};pluginProto.exps=new Exps()}());cr.plugins_.Cocoon_Canvasplus=function(runtime){this.runtime=runtime};(function(){var dialog="";var input_text="";var capture_screen_sync="";var capture_screen_async="";var device_info="";var pluginProto=cr.plugins_.Cocoon_Canvasplus.prototype;pluginProto.Type=function(plugin){this.plugin=plugin;this.runtime=plugin.runtime};var typeProto=pluginProto.Type.prototype;typeProto.onCreate=function(){};pluginProto.Instance=function(type){this.type=type;this.runtime=type.runtime};var instanceProto=pluginProto.Instance.prototype;var self;instanceProto.onCreate=function(){if(!(this.runtime.isAndroid||this.runtime.isiOS)){return};if(typeof Cocoon=='\x75\x6E\x64\x65\x66\x69\x6E\x65\x64'){return};self=this};function Cnds(){}Cnds.prototype.isCanvasPlus=function(){return this.runtime.isCocoonJs};Cnds.prototype.onKeyboardCancel=function(){return true};Cnds.prototype.onKeyboardSuccess=function(){return true};Cnds.prototype.onConfirmCancel=function(){return true};Cnds.prototype.onConfirmSuccess=function(){return true};pluginProto.cnds=new Cnds();function Acts(){}Acts.prototype.promptKeyboard=function(title_,message_,initial_,type_,canceltext_,oktext_){if(!this.runtime.isCocoonJs){return};var typestr=["\x74\x65\x78\x74","\x6E\x75\x6D","\x70\x68\x6F\x6E\x65","\x65\x6D\x61\x69\x6C","\x75\x72\x6C"][type_];Cocoon.Dialog.prompt({title:title_,message:message_,text:initial_,type:typestr,cancelText:canceltext_,confirmText:oktext_},{success:function(text){input_text=text;self.runtime.trigger(cr.plugins_.Cocoon_Canvasplus.prototype.cnds.onKeyboardSuccess,self)},cancel:function(){self.runtime.trigger(cr.plugins_.Cocoon_Canvasplus.prototype.cnds.onKeyboardCancel,self)}})};Acts.prototype.confirmDialog=function(title_,message_,canceltext_,oktext_){if(!this.runtime.isCocoonJs){return};Cocoon.Dialog.confirm({title:title_,message:message_,cancelText:canceltext_,confirmText:oktext_},function(accepted){if(accepted){self.runtime.trigger(cr.plugins_.Cocoon_Canvasplus.prototype.cnds.onConfirmSuccess,self)}else{self.runtime.trigger(cr.plugins_.Cocoon_Canvasplus.prototype.cnds.onConfirmCancel,self)}})};Acts.prototype.openURL=function(url_){Cocoon.App.openURL(url_)};Acts.prototype.exitApp=function(){Cocoon.App.exit()};Acts.prototype.pauseApp=function(){Cocoon.App.pause()};Acts.prototype.resumeApp=function(){Cocoon.App.resume()};Acts.prototype.captureScreenSync=function(filename_,storage_,capture_){if(!this.runtime.isCocoonJs){return};var storage_type=["\x41\x50\x50\x5F\x53\x54\x4F\x52\x41\x47\x45","\x49\x4E\x54\x45\x52\x4E\x41\x4C\x5F\x53\x54\x4F\x52\x41\x47\x45","\x45\x58\x54\x45\x52\x4E\x41\x4C\x5F\x53\x54\x4F\x52\x41\x47\x45","\x54\x45\x4D\x50\x4F\x52\x41\x52\x59\x5F\x53\x54\x4F\x52\x41\x47\x45"][storage_];var gallery=false;capture_screen_sync=Cocoon.Utils.captureScreen(filename_,storage_type,capture_,gallery)};Acts.prototype.captureScreenAsync=function(filename_,storage_,capture_){if(!this.runtime.isCocoonJs){return};var storage_type=["\x41\x50\x50\x5F\x53\x54\x4F\x52\x41\x47\x45","\x49\x4E\x54\x45\x52\x4E\x41\x4C\x5F\x53\x54\x4F\x52\x41\x47\x45","\x45\x58\x54\x45\x52\x4E\x41\x4C\x5F\x53\x54\x4F\x52\x41\x47\x45","\x54\x45\x4D\x50\x4F\x52\x41\x52\x59\x5F\x53\x54\x4F\x52\x41\x47\x45"][storage_];var gallery=false;Cocoon.Utils.captureScreenAsync(filename_,storage_type,capture_,gallery,function(url,error){if(error){self.runtime.trigger(cr.plugins_.Cocoon_Canvasplus.prototype.cnds.onCaptureScreenAsyncFail,self)}else{capture_screen_async=url;self.runtime.trigger(cr.plugins_.Cocoon_Canvasplus.prototype.cnds.onCaptureScreenAsyncSuccess,self)}})};Acts.prototype.captureScreenSyncShare=function(filename_,storage_,capture_,text_){if(!this.runtime.isCocoonJs){return};var storage_type=["\x41\x50\x50\x5F\x53\x54\x4F\x52\x41\x47\x45","\x49\x4E\x54\x45\x52\x4E\x41\x4C\x5F\x53\x54\x4F\x52\x41\x47\x45","\x45\x58\x54\x45\x52\x4E\x41\x4C\x5F\x53\x54\x4F\x52\x41\x47\x45","\x54\x45\x4D\x50\x4F\x52\x41\x52\x59\x5F\x53\x54\x4F\x52\x41\x47\x45"][storage_];var gallery=false;url=Cocoon.Utils.captureScreen(filename_,storage_type,capture_,gallery);Cocoon.Share.share({message:text_,image:url},function(activity,completed,error){if(completed){self.runtime.trigger(cr.plugins_.Cocoon_Canvasplus.prototype.cnds.onShareSyncComplete,self)}else{self.runtime.trigger(cr.plugins_.Cocoon_Canvasplus.prototype.cnds.onShareSyncFail,self);console.log(error)}})};Acts.prototype.showWebdialog=function(url_){dialog=new Cocoon.Widget.WebDialog();dialog.show(url_,function(){console.log("\x54\x68\x65\x20\x75\x73\x65\x72\x20\x68\x61\x73\x20\x63\x6C\x6F\x73\x65\x64\x20\x74\x68\x65\x20\x64\x69\x61\x6C\x6F\x67\x21");self.runtime.trigger(cr.plugins_.Cocoon_Canvasplus.prototype.cnds.onWebdialogUserClose,self)})};Acts.prototype.closeWebdialog=function(){dialog.close()};Acts.prototype.getDeviceInfo=function(){device_info=Cocoon.Device.getDeviceInfo()};pluginProto.acts=new Acts();function Exps(){}Exps.prototype.InputText=function(ret){ret.set_string(input_text)};Exps.prototype.CaptureScreenSync=function(ret){ret.set_string(capture_screen_sync)};Exps.prototype.CaptureScreenAsync=function(ret){ret.set_string(capture_screen_async)};Exps.prototype.DeviceOS=function(ret){ret.set_string(device_info.os)};Exps.prototype.DeviceVersion=function(ret){ret.set_string(device_info.version)};Exps.prototype.DeviceDPI=function(ret){ret.set_string(device_info.dpi)};Exps.prototype.DeviceBrand=function(ret){ret.set_string(device_info.brand)};Exps.prototype.DeviceModel=function(ret){ret.set_string(device_info.model)};Exps.prototype.DevicePlatformId=function(ret){ret.set_string(device_info.platformId)};pluginProto.exps=new Exps()}());;;;;cr.plugins_.Keyboard=function(runtime){this.runtime=runtime};(function(){var pluginProto=cr.plugins_.Keyboard.prototype;pluginProto.Type=function(plugin){this.plugin=plugin;this.runtime=plugin.runtime};var typeProto=pluginProto.Type.prototype;typeProto.onCreate=function(){};pluginProto.Instance=function(type){this.type=type;this.runtime=type.runtime;this.keyMap=new Array(256);this.usedKeys=new Array(256);this.triggerKey=0};var instanceProto=pluginProto.Instance.prototype;instanceProto.onCreate=function(){var self=this;if(!this.runtime.isDomFree){jQuery(document).keydown(function(info){self.onKeyDown(info)});jQuery(document).keyup(function(info){self.onKeyUp(info)})}};var keysToBlockWhenFramed=[32,33,34,35,36,37,38,39,40,44];instanceProto.onKeyDown=function(info){var alreadyPreventedDefault=false;if(window!=window.top&&keysToBlockWhenFramed.indexOf(info.which)>-1){info.preventDefault();alreadyPreventedDefault=true;info.stopPropagation()};if(this.keyMap[info.which]){if(this.usedKeys[info.which]&&!alreadyPreventedDefault){info.preventDefault()};return};this.keyMap[info.which]=true;this.triggerKey=info.which;this.runtime.isInUserInputEvent=true;this.runtime.trigger(cr.plugins_.Keyboard.prototype.cnds.OnAnyKey,this);var eventRan=this.runtime.trigger(cr.plugins_.Keyboard.prototype.cnds.OnKey,this);var eventRan2=this.runtime.trigger(cr.plugins_.Keyboard.prototype.cnds.OnKeyCode,this);this.runtime.isInUserInputEvent=false;if(eventRan||eventRan2){this.usedKeys[info.which]=true;if(!alreadyPreventedDefault){info.preventDefault()}}};instanceProto.onKeyUp=function(info){this.keyMap[info.which]=false;this.triggerKey=info.which;this.runtime.isInUserInputEvent=true;this.runtime.trigger(cr.plugins_.Keyboard.prototype.cnds.OnAnyKeyReleased,this);var eventRan=this.runtime.trigger(cr.plugins_.Keyboard.prototype.cnds.OnKeyReleased,this);var eventRan2=this.runtime.trigger(cr.plugins_.Keyboard.prototype.cnds.OnKeyCodeReleased,this);this.runtime.isInUserInputEvent=false;if(eventRan||eventRan2||this.usedKeys[info.which]){this.usedKeys[info.which]=true;info.preventDefault()}};instanceProto.onWindowBlur=function(){var i;for(i=0;i<256;++i){if(!this.keyMap[i]){continue};this.keyMap[i]=false;this.triggerKey=i;this.runtime.trigger(cr.plugins_.Keyboard.prototype.cnds.OnAnyKeyReleased,this);var eventRan=this.runtime.trigger(cr.plugins_.Keyboard.prototype.cnds.OnKeyReleased,this);var eventRan2=this.runtime.trigger(cr.plugins_.Keyboard.prototype.cnds.OnKeyCodeReleased,this);if(eventRan||eventRan2){this.usedKeys[i]=true}}};instanceProto.saveToJSON=function(){return{"\x74\x72\x69\x67\x67\x65\x72\x4B\x65\x79":this.triggerKey}};instanceProto.loadFromJSON=function(o){this.triggerKey=o["\x74\x72\x69\x67\x67\x65\x72\x4B\x65\x79"]};function Cnds(){}Cnds.prototype.IsKeyDown=function(key){return this.keyMap[key]};Cnds.prototype.OnKey=function(key){return(key===this.triggerKey)};Cnds.prototype.OnAnyKey=function(key){return true};Cnds.prototype.OnAnyKeyReleased=function(key){return true};Cnds.prototype.OnKeyReleased=function(key){return(key===this.triggerKey)};Cnds.prototype.IsKeyCodeDown=function(key){key=Math.floor(key);if(key<0||key>=this.keyMap.length){return false};return this.keyMap[key]};Cnds.prototype.OnKeyCode=function(key){return(key===this.triggerKey)};Cnds.prototype.OnKeyCodeReleased=function(key){return(key===this.triggerKey)};pluginProto.cnds=new Cnds();function Acts(){}pluginProto.acts=new Acts();function Exps(){}Exps.prototype.LastKeyCode=function(ret){ret.set_int(this.triggerKey)};function fixedStringFromCharCode(kc){kc=Math.floor(kc);switch(kc){case 8:return "\x62\x61\x63\x6B\x73\x70\x61\x63\x65";case 9:return "\x74\x61\x62";case 13:return "\x65\x6E\x74\x65\x72";case 16:return "\x73\x68\x69\x66\x74";case 17:return "\x63\x6F\x6E\x74\x72\x6F\x6C";case 18:return "\x61\x6C\x74";case 19:return "\x70\x61\x75\x73\x65";case 20:return "\x63\x61\x70\x73\x6C\x6F\x63\x6B";case 27:return "\x65\x73\x63";case 33:return "\x70\x61\x67\x65\x75\x70";case 34:return "\x70\x61\x67\x65\x64\x6F\x77\x6E";case 35:return "\x65\x6E\x64";case 36:return "\x68\x6F\x6D\x65";case 37:return "\u2190";case 38:return "\u2191";case 39:return "\u2192";case 40:return "\u2193";case 45:return "\x69\x6E\x73\x65\x72\x74";case 46:return "\x64\x65\x6C";case 91:return "\x6C\x65\x66\x74\x20\x77\x69\x6E\x64\x6F\x77\x20\x6B\x65\x79";case 92:return "\x72\x69\x67\x68\x74\x20\x77\x69\x6E\x64\x6F\x77\x20\x6B\x65\x79";case 93:return "\x73\x65\x6C\x65\x63\x74";case 96:return "\x6E\x75\x6D\x70\x61\x64\x20\x30";case 97:return "\x6E\x75\x6D\x70\x61\x64\x20\x31";case 98:return "\x6E\x75\x6D\x70\x61\x64\x20\x32";case 99:return "\x6E\x75\x6D\x70\x61\x64\x20\x33";case 100:return "\x6E\x75\x6D\x70\x61\x64\x20\x34";case 101:return "\x6E\x75\x6D\x70\x61\x64\x20\x35";case 102:return "\x6E\x75\x6D\x70\x61\x64\x20\x36";case 103:return "\x6E\x75\x6D\x70\x61\x64\x20\x37";case 104:return "\x6E\x75\x6D\x70\x61\x64\x20\x38";case 105:return "\x6E\x75\x6D\x70\x61\x64\x20\x39";case 106:return "\x6E\x75\x6D\x70\x61\x64\x20\x2A";case 107:return "\x6E\x75\x6D\x70\x61\x64\x20\x2B";case 109:return "\x6E\x75\x6D\x70\x61\x64\x20\x2D";case 110:return "\x6E\x75\x6D\x70\x61\x64\x20\x2E";case 111:return "\x6E\x75\x6D\x70\x61\x64\x20\x2F";case 112:return "\x46\x31";case 113:return "\x46\x32";case 114:return "\x46\x33";case 115:return "\x46\x34";case 116:return "\x46\x35";case 117:return "\x46\x36";case 118:return "\x46\x37";case 119:return "\x46\x38";case 120:return "\x46\x39";case 121:return "\x46\x31\x30";case 122:return "\x46\x31\x31";case 123:return "\x46\x31\x32";case 144:return "\x6E\x75\x6D\x6C\x6F\x63\x6B";case 145:return "\x73\x63\x72\x6F\x6C\x6C\x20\x6C\x6F\x63\x6B";case 186:return "\x3B";case 187:return "\x3D";case 188:return "\x2C";case 189:return "\x2D";case 190:return "\x2E";case 191:return "\x2F";case 192:return "\x27";case 219:return "\x5B";case 220:return "\x5C";case 221:return "\x5D";case 222:return "\x23";case 223:return "\x60";default:return String.fromCharCode(kc)}}Exps.prototype.StringFromKeyCode=function(ret,kc){ret.set_string(fixedStringFromCharCode(kc))};pluginProto.exps=new Exps()}());;;;;cr.plugins_.Mouse=function(runtime){this.runtime=runtime};(function(){var pluginProto=cr.plugins_.Mouse.prototype;pluginProto.Type=function(plugin){this.plugin=plugin;this.runtime=plugin.runtime};var typeProto=pluginProto.Type.prototype;typeProto.onCreate=function(){};pluginProto.Instance=function(type){this.type=type;this.runtime=type.runtime;this.buttonMap=new Array(4);this.mouseXcanvas=0;this.mouseYcanvas=0;this.triggerButton=0;this.triggerType=0;this.triggerDir=0;this.handled=false};var instanceProto=pluginProto.Instance.prototype;instanceProto.onCreate=function(){var self=this;if(!this.runtime.isDomFree){jQuery(document).mousemove(function(info){self.onMouseMove(info)});jQuery(document).mousedown(function(info){self.onMouseDown(info)});jQuery(document).mouseup(function(info){self.onMouseUp(info)});jQuery(document).dblclick(function(info){self.onDoubleClick(info)});var wheelevent=function(info){self.onWheel(info)};document.addEventListener("\x6D\x6F\x75\x73\x65\x77\x68\x65\x65\x6C",wheelevent,false);document.addEventListener("\x44\x4F\x4D\x4D\x6F\x75\x73\x65\x53\x63\x72\x6F\x6C\x6C",wheelevent,false)}};var dummyoffset={left:0,top:0};instanceProto.onMouseMove=function(info){var offset=this.runtime.isDomFree?dummyoffset:jQuery(this.runtime.canvas).offset();this.mouseXcanvas=info.pageX-offset.left;this.mouseYcanvas=info.pageY-offset.top};instanceProto.mouseInGame=function(){if(this.runtime.fullscreen_mode>0){return true};return this.mouseXcanvas>=0&&this.mouseYcanvas>=0&&this.mouseXcanvas<this.runtime.width&&this.mouseYcanvas<this.runtime.height};instanceProto.onMouseDown=function(info){if(!this.mouseInGame()){return};this.buttonMap[info.which]=true;this.runtime.isInUserInputEvent=true;this.runtime.trigger(cr.plugins_.Mouse.prototype.cnds.OnAnyClick,this);this.triggerButton=info.which-1;this.triggerType=0;this.runtime.trigger(cr.plugins_.Mouse.prototype.cnds.OnClick,this);this.runtime.trigger(cr.plugins_.Mouse.prototype.cnds.OnObjectClicked,this);this.runtime.isInUserInputEvent=false};instanceProto.onMouseUp=function(info){if(!this.buttonMap[info.which]){return};if(this.runtime.had_a_click&&!this.runtime.isMobile){info.preventDefault()};this.runtime.had_a_click=true;this.buttonMap[info.which]=false;this.runtime.isInUserInputEvent=true;this.triggerButton=info.which-1;this.runtime.trigger(cr.plugins_.Mouse.prototype.cnds.OnRelease,this);this.runtime.isInUserInputEvent=false};instanceProto.onDoubleClick=function(info){if(!this.mouseInGame()){return};info.preventDefault();this.runtime.isInUserInputEvent=true;this.triggerButton=info.which-1;this.triggerType=1;this.runtime.trigger(cr.plugins_.Mouse.prototype.cnds.OnClick,this);this.runtime.trigger(cr.plugins_.Mouse.prototype.cnds.OnObjectClicked,this);this.runtime.isInUserInputEvent=false};instanceProto.onWheel=function(info){var delta=info.wheelDelta?info.wheelDelta:info.detail?-info.detail:0;this.triggerDir=(delta<0?0:1);this.handled=false;this.runtime.isInUserInputEvent=true;this.runtime.trigger(cr.plugins_.Mouse.prototype.cnds.OnWheel,this);this.runtime.isInUserInputEvent=false;if(this.handled&&cr.isCanvasInputEvent(info)){info.preventDefault()}};function Cnds(){}Cnds.prototype.OnClick=function(button,type){return button===this.triggerButton&&type===this.triggerType};Cnds.prototype.OnAnyClick=function(){return true};Cnds.prototype.IsButtonDown=function(button){return this.buttonMap[button+1]};Cnds.prototype.OnRelease=function(button){return button===this.triggerButton};Cnds.prototype.IsOverObject=function(obj){var cnd=this.runtime.getCurrentCondition();var mx=this.mouseXcanvas;var my=this.mouseYcanvas;return cr.xor(this.runtime.testAndSelectCanvasPointOverlap(obj,mx,my,cnd.inverted),cnd.inverted)};Cnds.prototype.OnObjectClicked=function(button,type,obj){if(button!==this.triggerButton||type!==this.triggerType){return false};return this.runtime.testAndSelectCanvasPointOverlap(obj,this.mouseXcanvas,this.mouseYcanvas,false)};Cnds.prototype.OnWheel=function(dir){this.handled=true;return dir===this.triggerDir};pluginProto.cnds=new Cnds();function Acts(){}var lastSetCursor=null;Acts.prototype.SetCursor=function(c){if(this.runtime.isDomFree){return};var cursor_style=["\x61\x75\x74\x6F","\x70\x6F\x69\x6E\x74\x65\x72","\x74\x65\x78\x74","\x63\x72\x6F\x73\x73\x68\x61\x69\x72","\x6D\x6F\x76\x65","\x68\x65\x6C\x70","\x77\x61\x69\x74","\x6E\x6F\x6E\x65"][c];if(lastSetCursor===cursor_style){return};lastSetCursor=cursor_style;document.body.style.cursor=cursor_style};Acts.prototype.SetCursorSprite=function(obj){if(this.runtime.isDomFree||this.runtime.isMobile||!obj){return};var inst=obj.getFirstPicked();if(!inst||!inst.curFrame){return};var frame=inst.curFrame;if(lastSetCursor===frame){return};lastSetCursor=frame;var datauri=frame.getDataUri();var cursor_style="\x75\x72\x6C\x28"+datauri+"\x29\x20"+Math.round(frame.hotspotX*frame.width)+"\x20"+Math.round(frame.hotspotY*frame.height)+"\x2C\x20\x61\x75\x74\x6F";document.body.style.cursor="";document.body.style.cursor=cursor_style};pluginProto.acts=new Acts();function Exps(){}Exps.prototype.X=function(ret,layerparam){var layer,oldScale,oldZoomRate,oldParallaxX,oldAngle;if(cr.is_undefined(layerparam)){layer=this.runtime.getLayerByNumber(0);oldScale=layer.scale;oldZoomRate=layer.zoomRate;oldParallaxX=layer.parallaxX;oldAngle=layer.angle;layer.scale=1;layer.zoomRate=1.0;layer.parallaxX=1.0;layer.angle=0;ret.set_float(layer.canvasToLayer(this.mouseXcanvas,this.mouseYcanvas,true));layer.scale=oldScale;layer.zoomRate=oldZoomRate;layer.parallaxX=oldParallaxX;layer.angle=oldAngle}else{if(cr.is_number(layerparam)){layer=this.runtime.getLayerByNumber(layerparam)}else{layer=this.runtime.getLayerByName(layerparam)};if(layer){ret.set_float(layer.canvasToLayer(this.mouseXcanvas,this.mouseYcanvas,true))}else{ret.set_float(0)}}};Exps.prototype.Y=function(ret,layerparam){var layer,oldScale,oldZoomRate,oldParallaxY,oldAngle;if(cr.is_undefined(layerparam)){layer=this.runtime.getLayerByNumber(0);oldScale=layer.scale;oldZoomRate=layer.zoomRate;oldParallaxY=layer.parallaxY;oldAngle=layer.angle;layer.scale=1;layer.zoomRate=1.0;layer.parallaxY=1.0;layer.angle=0;ret.set_float(layer.canvasToLayer(this.mouseXcanvas,this.mouseYcanvas,false));layer.scale=oldScale;layer.zoomRate=oldZoomRate;layer.parallaxY=oldParallaxY;layer.angle=oldAngle}else{if(cr.is_number(layerparam)){layer=this.runtime.getLayerByNumber(layerparam)}else{layer=this.runtime.getLayerByName(layerparam)};if(layer){ret.set_float(layer.canvasToLayer(this.mouseXcanvas,this.mouseYcanvas,false))}else{ret.set_float(0)}}};Exps.prototype.AbsoluteX=function(ret){ret.set_float(this.mouseXcanvas)};Exps.prototype.AbsoluteY=function(ret){ret.set_float(this.mouseYcanvas)};pluginProto.exps=new Exps()}());;;;;cr.plugins_.Sprite=function(runtime){this.runtime=runtime};(function(){var pluginProto=cr.plugins_.Sprite.prototype;pluginProto.Type=function(plugin){this.plugin=plugin;this.runtime=plugin.runtime};var typeProto=pluginProto.Type.prototype;function frame_getDataUri(){if(this.datauri.length===0){var tmpcanvas=document.createElement("\x63\x61\x6E\x76\x61\x73");tmpcanvas.width=this.width;tmpcanvas.height=this.height;var tmpctx=tmpcanvas.getContext("\x32\x64");if(this.spritesheeted){tmpctx.drawImage(this.texture_img,this.offx,this.offy,this.width,this.height,0,0,this.width,this.height)}else{tmpctx.drawImage(this.texture_img,0,0,this.width,this.height)};this.datauri=tmpcanvas.toDataURL("\x69\x6D\x61\x67\x65\x2F\x70\x6E\x67")};return this.datauri}typeProto.onCreate=function(){if(this.is_family){return};var i,leni,j,lenj;var anim,frame,animobj,frameobj,wt,uv;this.all_frames=[];this.has_loaded_textures=false;for(i=0,leni=this.animations.length;i<leni;i++){anim=this.animations[i];animobj={};animobj.name=anim[0];animobj.speed=anim[1];animobj.loop=anim[2];animobj.repeatcount=anim[3];animobj.repeatto=anim[4];animobj.pingpong=anim[5];animobj.sid=anim[6];animobj.frames=[];for(j=0,lenj=anim[7].length;j<lenj;j++){frame=anim[7][j];frameobj={};frameobj.texture_file=frame[0];frameobj.texture_filesize=frame[1];frameobj.offx=frame[2];frameobj.offy=frame[3];frameobj.width=frame[4];frameobj.height=frame[5];frameobj.duration=frame[6];frameobj.hotspotX=frame[7];frameobj.hotspotY=frame[8];frameobj.image_points=frame[9];frameobj.poly_pts=frame[10];frameobj.pixelformat=frame[11];frameobj.spritesheeted=(frameobj.width!==0);frameobj.datauri="";frameobj.getDataUri=frame_getDataUri;uv={};uv.left=0;uv.top=0;uv.right=1;uv.bottom=1;frameobj.sheetTex=uv;frameobj.webGL_texture=null;wt=this.runtime.findWaitingTexture(frame[0]);if(wt){frameobj.texture_img=wt}else{frameobj.texture_img=new Image();frameobj.texture_img.cr_src=frame[0];frameobj.texture_img.cr_filesize=frame[1];frameobj.texture_img.c2webGL_texture=null;this.runtime.waitForImageLoad(frameobj.texture_img,frame[0])};cr.seal(frameobj);animobj.frames.push(frameobj);this.all_frames.push(frameobj)};cr.seal(animobj);this.animations[i]=animobj}};typeProto.updateAllCurrentTexture=function(){var i,len,inst;for(i=0,len=this.instances.length;i<len;i++){inst=this.instances[i];inst.curWebGLTexture=inst.curFrame.webGL_texture}};typeProto.onLostWebGLContext=function(){if(this.is_family){return};var i,len,frame;for(i=0,len=this.all_frames.length;i<len;++i){frame=this.all_frames[i];frame.texture_img.c2webGL_texture=null;frame.webGL_texture=null};this.has_loaded_textures=false;this.updateAllCurrentTexture()};typeProto.onRestoreWebGLContext=function(){if(this.is_family||!this.instances.length){return};var i,len,frame;for(i=0,len=this.all_frames.length;i<len;++i){frame=this.all_frames[i];frame.webGL_texture=this.runtime.glwrap.loadTexture(frame.texture_img,false,this.runtime.linearSampling,frame.pixelformat)};this.updateAllCurrentTexture()};typeProto.loadTextures=function(){if(this.is_family||this.has_loaded_textures||!this.runtime.glwrap){return};var i,len,frame;for(i=0,len=this.all_frames.length;i<len;++i){frame=this.all_frames[i];frame.webGL_texture=this.runtime.glwrap.loadTexture(frame.texture_img,false,this.runtime.linearSampling,frame.pixelformat)};this.has_loaded_textures=true};typeProto.unloadTextures=function(){if(this.is_family||this.instances.length||!this.has_loaded_textures){return};var i,len,frame;for(i=0,len=this.all_frames.length;i<len;++i){frame=this.all_frames[i];this.runtime.glwrap.deleteTexture(frame.webGL_texture);frame.webGL_texture=null};this.has_loaded_textures=false};var already_drawn_images=[];typeProto.preloadCanvas2D=function(ctx){var i,len,frameimg;cr.clearArray(already_drawn_images);for(i=0,len=this.all_frames.length;i<len;++i){frameimg=this.all_frames[i].texture_img;if(already_drawn_images.indexOf(frameimg)!==-1){continue};ctx.drawImage(frameimg,0,0);already_drawn_images.push(frameimg)}};pluginProto.Instance=function(type){this.type=type;this.runtime=type.runtime;var poly_pts=this.type.animations[0].frames[0].poly_pts;if(this.recycled){this.collision_poly.set_pts(poly_pts)}else{this.collision_poly=new cr.CollisionPoly(poly_pts)}};var instanceProto=pluginProto.Instance.prototype;instanceProto.onCreate=function(){this.visible=(this.properties[0]===0);this.isTicking=false;this.inAnimTrigger=false;this.collisionsEnabled=(this.properties[3]!==0);if(!(this.type.animations.length===1&&this.type.animations[0].frames.length===1)&&this.type.animations[0].speed!==0){this.runtime.tickMe(this);this.isTicking=true};this.cur_animation=this.getAnimationByName(this.properties[1])||this.type.animations[0];this.cur_frame=this.properties[2];if(this.cur_frame<0){this.cur_frame=0};if(this.cur_frame>=this.cur_animation.frames.length){this.cur_frame=this.cur_animation.frames.length-1};var curanimframe=this.cur_animation.frames[this.cur_frame];this.collision_poly.set_pts(curanimframe.poly_pts);this.hotspotX=curanimframe.hotspotX;this.hotspotY=curanimframe.hotspotY;this.cur_anim_speed=this.cur_animation.speed;if(this.recycled){this.animTimer.reset()}else{this.animTimer=new cr.KahanAdder()};this.frameStart=this.getNowTime();this.animPlaying=true;this.animRepeats=0;this.animForwards=true;this.animTriggerName="";this.changeAnimName="";this.changeAnimFrom=0;this.changeAnimFrame=-1;this.type.loadTextures();var i,leni,j,lenj;var anim,frame,uv,maintex;for(i=0,leni=this.type.animations.length;i<leni;i++){anim=this.type.animations[i];for(j=0,lenj=anim.frames.length;j<lenj;j++){frame=anim.frames[j];if(frame.width===0){frame.width=frame.texture_img.width;frame.height=frame.texture_img.height};if(frame.spritesheeted){maintex=frame.texture_img;uv=frame.sheetTex;uv.left=frame.offx/maintex.width;uv.top=frame.offy/maintex.height;uv.right=(frame.offx+frame.width)/maintex.width;uv.bottom=(frame.offy+frame.height)/maintex.height;if(frame.offx===0&&frame.offy===0&&frame.width===maintex.width&&frame.height===maintex.height){frame.spritesheeted=false}}}};this.curFrame=this.cur_animation.frames[this.cur_frame];this.curWebGLTexture=this.curFrame.webGL_texture};instanceProto.saveToJSON=function(){var o={"\x61":this.cur_animation.sid,"\x66":this.cur_frame,"\x63\x61\x73":this.cur_anim_speed,"\x66\x73":this.frameStart,"\x61\x72":this.animRepeats,"\x61\x74":this.animTimer.sum};if(!this.animPlaying){o["\x61\x70"]=this.animPlaying};if(!this.animForwards){o["\x61\x66"]=this.animForwards};return o};instanceProto.loadFromJSON=function(o){var anim=this.getAnimationBySid(o["\x61"]);if(anim){this.cur_animation=anim};this.cur_frame=o["\x66"];if(this.cur_frame<0){this.cur_frame=0};if(this.cur_frame>=this.cur_animation.frames.length){this.cur_frame=this.cur_animation.frames.length-1};this.cur_anim_speed=o["\x63\x61\x73"];this.frameStart=o["\x66\x73"];this.animRepeats=o["\x61\x72"];this.animTimer.reset();this.animTimer.sum=o["\x61\x74"];this.animPlaying=o.hasOwnProperty("\x61\x70")?o["\x61\x70"]:true;this.animForwards=o.hasOwnProperty("\x61\x66")?o["\x61\x66"]:true;this.curFrame=this.cur_animation.frames[this.cur_frame];this.curWebGLTexture=this.curFrame.webGL_texture;this.collision_poly.set_pts(this.curFrame.poly_pts);this.hotspotX=this.curFrame.hotspotX;this.hotspotY=this.curFrame.hotspotY};instanceProto.animationFinish=function(reverse){this.cur_frame=reverse?0:this.cur_animation.frames.length-1;this.animPlaying=false;this.animTriggerName=this.cur_animation.name;this.inAnimTrigger=true;this.runtime.trigger(cr.plugins_.Sprite.prototype.cnds.OnAnyAnimFinished,this);this.runtime.trigger(cr.plugins_.Sprite.prototype.cnds.OnAnimFinished,this);this.inAnimTrigger=false;this.animRepeats=0};instanceProto.getNowTime=function(){return this.animTimer.sum};instanceProto.tick=function(){this.animTimer.add(this.runtime.getDt(this));if(this.changeAnimName.length){this.doChangeAnim()};if(this.changeAnimFrame>=0){this.doChangeAnimFrame()};var now=this.getNowTime();var cur_animation=this.cur_animation;var prev_frame=cur_animation.frames[this.cur_frame];var next_frame;var cur_frame_time=prev_frame.duration/this.cur_anim_speed;if(this.animPlaying&&now>=this.frameStart+cur_frame_time){if(this.animForwards){this.cur_frame++}else{this.cur_frame--};this.frameStart+=cur_frame_time;if(this.cur_frame>=cur_animation.frames.length){if(cur_animation.pingpong){this.animForwards=false;this.cur_frame=cur_animation.frames.length-2}else{if(cur_animation.loop){this.cur_frame=cur_animation.repeatto}else{this.animRepeats++;if(this.animRepeats>=cur_animation.repeatcount){this.animationFinish(false)}else{this.cur_frame=cur_animation.repeatto}}}};if(this.cur_frame<0){if(cur_animation.pingpong){this.cur_frame=1;this.animForwards=true;if(!cur_animation.loop){this.animRepeats++;if(this.animRepeats>=cur_animation.repeatcount){this.animationFinish(true)}}}else{if(cur_animation.loop){this.cur_frame=cur_animation.repeatto}else{this.animRepeats++;if(this.animRepeats>=cur_animation.repeatcount){this.animationFinish(true)}else{this.cur_frame=cur_animation.repeatto}}}};if(this.cur_frame<0){this.cur_frame=0}else{if(this.cur_frame>=cur_animation.frames.length){this.cur_frame=cur_animation.frames.length-1}};if(now>this.frameStart+(cur_animation.frames[this.cur_frame].duration/this.cur_anim_speed)){this.frameStart=now};next_frame=cur_animation.frames[this.cur_frame];this.OnFrameChanged(prev_frame,next_frame);this.runtime.redraw=true}};instanceProto.getAnimationByName=function(name_){var i,len,a;for(i=0,len=this.type.animations.length;i<len;i++){a=this.type.animations[i];if(cr.equals_nocase(a.name,name_)){return a}};return null};instanceProto.getAnimationBySid=function(sid_){var i,len,a;for(i=0,len=this.type.animations.length;i<len;i++){a=this.type.animations[i];if(a.sid===sid_){return a}};return null};instanceProto.doChangeAnim=function(){var prev_frame=this.cur_animation.frames[this.cur_frame];var anim=this.getAnimationByName(this.changeAnimName);this.changeAnimName="";if(!anim){return};if(cr.equals_nocase(anim.name,this.cur_animation.name)&&this.animPlaying){return};this.cur_animation=anim;this.cur_anim_speed=anim.speed;if(this.cur_frame<0){this.cur_frame=0};if(this.cur_frame>=this.cur_animation.frames.length){this.cur_frame=this.cur_animation.frames.length-1};if(this.changeAnimFrom===1){this.cur_frame=0};this.animPlaying=true;this.frameStart=this.getNowTime();this.animForwards=true;this.OnFrameChanged(prev_frame,this.cur_animation.frames[this.cur_frame]);this.runtime.redraw=true};instanceProto.doChangeAnimFrame=function(){var prev_frame=this.cur_animation.frames[this.cur_frame];var prev_frame_number=this.cur_frame;this.cur_frame=cr.floor(this.changeAnimFrame);if(this.cur_frame<0){this.cur_frame=0};if(this.cur_frame>=this.cur_animation.frames.length){this.cur_frame=this.cur_animation.frames.length-1};if(prev_frame_number!==this.cur_frame){this.OnFrameChanged(prev_frame,this.cur_animation.frames[this.cur_frame]);this.frameStart=this.getNowTime();this.runtime.redraw=true};this.changeAnimFrame=-1};instanceProto.OnFrameChanged=function(prev_frame,next_frame){var oldw=prev_frame.width;var oldh=prev_frame.height;var neww=next_frame.width;var newh=next_frame.height;if(oldw!=neww){this.width*=(neww/oldw)};if(oldh!=newh){this.height*=(newh/oldh)};this.hotspotX=next_frame.hotspotX;this.hotspotY=next_frame.hotspotY;this.collision_poly.set_pts(next_frame.poly_pts);this.set_bbox_changed();this.curFrame=next_frame;this.curWebGLTexture=next_frame.webGL_texture;var i,len,b;for(i=0,len=this.behavior_insts.length;i<len;i++){b=this.behavior_insts[i];if(b.onSpriteFrameChanged){b.onSpriteFrameChanged(prev_frame,next_frame)}};this.runtime.trigger(cr.plugins_.Sprite.prototype.cnds.OnFrameChanged,this)};instanceProto.draw=function(ctx){ctx.globalAlpha=this.opacity;var cur_frame=this.curFrame;var spritesheeted=cur_frame.spritesheeted;var cur_image=cur_frame.texture_img;var myx=this.x;var myy=this.y;var w=this.width;var h=this.height;if(this.angle===0&&w>=0&&h>=0){myx-=this.hotspotX*w;myy-=this.hotspotY*h;if(this.runtime.pixel_rounding){myx=Math.round(myx);myy=Math.round(myy)};if(spritesheeted){ctx.drawImage(cur_image,cur_frame.offx,cur_frame.offy,cur_frame.width,cur_frame.height,myx,myy,w,h)}else{ctx.drawImage(cur_image,myx,myy,w,h)}}else{if(this.runtime.pixel_rounding){myx=Math.round(myx);myy=Math.round(myy)};ctx.save();var widthfactor=w>0?1:-1;var heightfactor=h>0?1:-1;ctx.translate(myx,myy);if(widthfactor!==1||heightfactor!==1){ctx.scale(widthfactor,heightfactor)};ctx.rotate(this.angle*widthfactor*heightfactor);var drawx=0-(this.hotspotX*cr.abs(w));var drawy=0-(this.hotspotY*cr.abs(h));if(spritesheeted){ctx.drawImage(cur_image,cur_frame.offx,cur_frame.offy,cur_frame.width,cur_frame.height,drawx,drawy,cr.abs(w),cr.abs(h))}else{ctx.drawImage(cur_image,drawx,drawy,cr.abs(w),cr.abs(h))};ctx.restore()}};instanceProto.drawGL_earlyZPass=function(glw){this.drawGL(glw)};instanceProto.drawGL=function(glw){glw.setTexture(this.curWebGLTexture);glw.setOpacity(this.opacity);var cur_frame=this.curFrame;var q=this.bquad;if(this.runtime.pixel_rounding){var ox=Math.round(this.x)-this.x;var oy=Math.round(this.y)-this.y;if(cur_frame.spritesheeted){glw.quadTex(q.tlx+ox,q.tly+oy,q.trx+ox,q.try_+oy,q.brx+ox,q.bry+oy,q.blx+ox,q.bly+oy,cur_frame.sheetTex)}else{glw.quad(q.tlx+ox,q.tly+oy,q.trx+ox,q.try_+oy,q.brx+ox,q.bry+oy,q.blx+ox,q.bly+oy)}}else{if(cur_frame.spritesheeted){glw.quadTex(q.tlx,q.tly,q.trx,q.try_,q.brx,q.bry,q.blx,q.bly,cur_frame.sheetTex)}else{glw.quad(q.tlx,q.tly,q.trx,q.try_,q.brx,q.bry,q.blx,q.bly)}}};instanceProto.getImagePointIndexByName=function(name_){var cur_frame=this.curFrame;var i,len;for(i=0,len=cur_frame.image_points.length;i<len;i++){if(cr.equals_nocase(name_,cur_frame.image_points[i][0])){return i}};return-1};instanceProto.getImagePoint=function(imgpt,getX){var cur_frame=this.curFrame;var image_points=cur_frame.image_points;var index;if(cr.is_string(imgpt)){index=this.getImagePointIndexByName(imgpt)}else{index=imgpt-1};index=cr.floor(index);if(index<0||index>=image_points.length){return getX?this.x:this.y};var x=(image_points[index][1]-cur_frame.hotspotX)*this.width;var y=image_points[index][2];y=(y-cur_frame.hotspotY)*this.height;var cosa=Math.cos(this.angle);var sina=Math.sin(this.angle);var x_temp=(x*cosa)-(y*sina);y=(y*cosa)+(x*sina);x=x_temp;x+=this.x;y+=this.y;return getX?x:y};function Cnds(){}var arrCache=[];function allocArr(){if(arrCache.length){return arrCache.pop()}else{return[0,0,0]}}function freeArr(a){a[0]=0;a[1]=0;a[2]=0;arrCache.push(a)}function makeCollKey(a,b){if(a<b){return ""+a+"\x2C"+b}else{return ""+b+"\x2C"+a}}function collmemory_add(collmemory,a,b,tickcount){var a_uid=a.uid;var b_uid=b.uid;var key=makeCollKey(a_uid,b_uid);if(collmemory.hasOwnProperty(key)){collmemory[key][2]=tickcount;return};var arr=allocArr();arr[0]=a_uid;arr[1]=b_uid;arr[2]=tickcount;collmemory[key]=arr}function collmemory_remove(collmemory,a,b){var key=makeCollKey(a.uid,b.uid);if(collmemory.hasOwnProperty(key)){freeArr(collmemory[key]);delete collmemory[key]}}function collmemory_removeInstance(collmemory,inst){var uid=inst.uid;var p,entry;for(p in collmemory){if(collmemory.hasOwnProperty(p)){entry=collmemory[p];if(entry[0]===uid||entry[1]===uid){freeArr(collmemory[p]);delete collmemory[p]}}}}var last_coll_tickcount=-2;function collmemory_has(collmemory,a,b){var key=makeCollKey(a.uid,b.uid);if(collmemory.hasOwnProperty(key)){last_coll_tickcount=collmemory[key][2];return true}else{last_coll_tickcount=-2;return false}}var candidates1=[];Cnds.prototype.OnCollision=function(rtype){if(!rtype){return false};var runtime=this.runtime;var cnd=runtime.getCurrentCondition();var ltype=cnd.type;var collmemory=null;if(cnd.extra["\x63\x6F\x6C\x6C\x6D\x65\x6D\x6F\x72\x79"]){collmemory=cnd.extra["\x63\x6F\x6C\x6C\x6D\x65\x6D\x6F\x72\x79"]}else{collmemory={};cnd.extra["\x63\x6F\x6C\x6C\x6D\x65\x6D\x6F\x72\x79"]=collmemory};if(!cnd.extra["\x73\x70\x72\x69\x74\x65\x43\x72\x65\x61\x74\x65\x64\x44\x65\x73\x74\x72\x6F\x79\x43\x61\x6C\x6C\x62\x61\x63\x6B"]){cnd.extra["\x73\x70\x72\x69\x74\x65\x43\x72\x65\x61\x74\x65\x64\x44\x65\x73\x74\x72\x6F\x79\x43\x61\x6C\x6C\x62\x61\x63\x6B"]=true;runtime.addDestroyCallback(function(inst){collmemory_removeInstance(cnd.extra["\x63\x6F\x6C\x6C\x6D\x65\x6D\x6F\x72\x79"],inst)})};var lsol=ltype.getCurrentSol();var rsol=rtype.getCurrentSol();var linstances=lsol.getObjects();var rinstances;var l,linst,r,rinst;var curlsol,currsol;var tickcount=this.runtime.tickcount;var lasttickcount=tickcount-1;var exists,run;var current_event=runtime.getCurrentEventStack().current_event;var orblock=current_event.orblock;for(l=0;l<linstances.length;l++){linst=linstances[l];if(rsol.select_all){linst.update_bbox();this.runtime.getCollisionCandidates(linst.layer,rtype,linst.bbox,candidates1);rinstances=candidates1}else{rinstances=rsol.getObjects()};for(r=0;r<rinstances.length;r++){rinst=rinstances[r];if(runtime.testOverlap(linst,rinst)||runtime.checkRegisteredCollision(linst,rinst)){exists=collmemory_has(collmemory,linst,rinst);run=(!exists||(last_coll_tickcount<lasttickcount));collmemory_add(collmemory,linst,rinst,tickcount);if(run){runtime.pushCopySol(current_event.solModifiers);curlsol=ltype.getCurrentSol();currsol=rtype.getCurrentSol();curlsol.select_all=false;currsol.select_all=false;if(ltype===rtype){curlsol.instances.length=2;curlsol.instances[0]=linst;curlsol.instances[1]=rinst;ltype.applySolToContainer()}else{curlsol.instances.length=1;currsol.instances.length=1;curlsol.instances[0]=linst;currsol.instances[0]=rinst;ltype.applySolToContainer();rtype.applySolToContainer()};current_event.retrigger();runtime.popSol(current_event.solModifiers)}}else{collmemory_remove(collmemory,linst,rinst)}};cr.clearArray(candidates1)};return false};var rpicktype=null;var rtopick=new cr.ObjectSet();var needscollisionfinish=false;var candidates2=[];var temp_bbox=new cr.rect(0,0,0,0);function DoOverlapCondition(rtype,offx,offy){if(!rtype){return false};var do_offset=(offx!==0||offy!==0);var oldx,oldy,ret=false,r,lenr,rinst;var cnd=this.runtime.getCurrentCondition();var ltype=cnd.type;var inverted=cnd.inverted;var rsol=rtype.getCurrentSol();var orblock=this.runtime.getCurrentEventStack().current_event.orblock;var rinstances;if(rsol.select_all){this.update_bbox();temp_bbox.copy(this.bbox);temp_bbox.offset(offx,offy);this.runtime.getCollisionCandidates(this.layer,rtype,temp_bbox,candidates2);rinstances=candidates2}else{if(orblock){rinstances=rsol.else_instances}else{rinstances=rsol.instances}};rpicktype=rtype;needscollisionfinish=(ltype!==rtype&&!inverted);if(do_offset){oldx=this.x;oldy=this.y;this.x+=offx;this.y+=offy;this.set_bbox_changed()};for(r=0,lenr=rinstances.length;r<lenr;r++){rinst=rinstances[r];if(this.runtime.testOverlap(this,rinst)){ret=true;if(inverted){break};if(ltype!==rtype){rtopick.add(rinst)}}};if(do_offset){this.x=oldx;this.y=oldy;this.set_bbox_changed()};cr.clearArray(candidates2);return ret}typeProto.finish=function(do_pick){if(!needscollisionfinish){return};if(do_pick){var orblock=this.runtime.getCurrentEventStack().current_event.orblock;var sol=rpicktype.getCurrentSol();var topick=rtopick.valuesRef();var i,len,inst;if(sol.select_all){sol.select_all=false;cr.clearArray(sol.instances);for(i=0,len=topick.length;i<len;++i){sol.instances[i]=topick[i]};if(orblock){cr.clearArray(sol.else_instances);for(i=0,len=rpicktype.instances.length;i<len;++i){inst=rpicktype.instances[i];if(!rtopick.contains(inst)){sol.else_instances.push(inst)}}}}else{if(orblock){var initsize=sol.instances.length;for(i=0,len=topick.length;i<len;++i){sol.instances[initsize+i]=topick[i];cr.arrayFindRemove(sol.else_instances,topick[i])}}else{cr.shallowAssignArray(sol.instances,topick)}};rpicktype.applySolToContainer()};rtopick.clear();needscollisionfinish=false};Cnds.prototype.IsOverlapping=function(rtype){return DoOverlapCondition.call(this,rtype,0,0)};Cnds.prototype.IsOverlappingOffset=function(rtype,offx,offy){return DoOverlapCondition.call(this,rtype,offx,offy)};Cnds.prototype.IsAnimPlaying=function(animname){if(this.changeAnimName.length){return cr.equals_nocase(this.changeAnimName,animname)}else{return cr.equals_nocase(this.cur_animation.name,animname)}};Cnds.prototype.CompareFrame=function(cmp,framenum){return cr.do_cmp(this.cur_frame,cmp,framenum)};Cnds.prototype.CompareAnimSpeed=function(cmp,x){var s=(this.animForwards?this.cur_anim_speed:-this.cur_anim_speed);return cr.do_cmp(s,cmp,x)};Cnds.prototype.OnAnimFinished=function(animname){return cr.equals_nocase(this.animTriggerName,animname)};Cnds.prototype.OnAnyAnimFinished=function(){return true};Cnds.prototype.OnFrameChanged=function(){return true};Cnds.prototype.IsMirrored=function(){return this.width<0};Cnds.prototype.IsFlipped=function(){return this.height<0};Cnds.prototype.OnURLLoaded=function(){return true};Cnds.prototype.IsCollisionEnabled=function(){return this.collisionsEnabled};pluginProto.cnds=new Cnds();function Acts(){}Acts.prototype.Spawn=function(obj,layer,imgpt){if(!obj||!layer){return};var inst=this.runtime.createInstance(obj,layer,this.getImagePoint(imgpt,true),this.getImagePoint(imgpt,false));if(!inst){return};if(typeof inst.angle!=="\x75\x6E\x64\x65\x66\x69\x6E\x65\x64"){inst.angle=this.angle;inst.set_bbox_changed()};this.runtime.isInOnDestroy++;var i,len,s;this.runtime.trigger(Object.getPrototypeOf(obj.plugin).cnds.OnCreated,inst);if(inst.is_contained){for(i=0,len=inst.siblings.length;i<len;i++){s=inst.siblings[i];this.runtime.trigger(Object.getPrototypeOf(s.type.plugin).cnds.OnCreated,s)}};this.runtime.isInOnDestroy--;var cur_act=this.runtime.getCurrentAction();var reset_sol=false;if(cr.is_undefined(cur_act.extra["\x53\x70\x61\x77\x6E\x5F\x4C\x61\x73\x74\x45\x78\x65\x63"])||cur_act.extra["\x53\x70\x61\x77\x6E\x5F\x4C\x61\x73\x74\x45\x78\x65\x63"]<this.runtime.execcount){reset_sol=true;cur_act.extra["\x53\x70\x61\x77\x6E\x5F\x4C\x61\x73\x74\x45\x78\x65\x63"]=this.runtime.execcount};var sol;if(obj!=this.type){sol=obj.getCurrentSol();sol.select_all=false;if(reset_sol){cr.clearArray(sol.instances);sol.instances[0]=inst}else{sol.instances.push(inst)};if(inst.is_contained){for(i=0,len=inst.siblings.length;i<len;i++){s=inst.siblings[i];sol=s.type.getCurrentSol();sol.select_all=false;if(reset_sol){cr.clearArray(sol.instances);sol.instances[0]=s}else{sol.instances.push(s)}}}}};Acts.prototype.SetEffect=function(effect){this.blend_mode=effect;this.compositeOp=cr.effectToCompositeOp(effect);cr.setGLBlend(this,effect,this.runtime.gl);this.runtime.redraw=true};Acts.prototype.StopAnim=function(){this.animPlaying=false};Acts.prototype.StartAnim=function(from){this.animPlaying=true;this.frameStart=this.getNowTime();if(from===1&&this.cur_frame!==0){this.changeAnimFrame=0;if(!this.inAnimTrigger){this.doChangeAnimFrame()}};if(!this.isTicking){this.runtime.tickMe(this);this.isTicking=true}};Acts.prototype.SetAnim=function(animname,from){this.changeAnimName=animname;this.changeAnimFrom=from;if(!this.isTicking){this.runtime.tickMe(this);this.isTicking=true};if(!this.inAnimTrigger){this.doChangeAnim()}};Acts.prototype.SetAnimFrame=function(framenumber){this.changeAnimFrame=framenumber;if(!this.isTicking){this.runtime.tickMe(this);this.isTicking=true};if(!this.inAnimTrigger){this.doChangeAnimFrame()}};Acts.prototype.SetAnimSpeed=function(s){this.cur_anim_speed=cr.abs(s);this.animForwards=(s>=0);if(!this.isTicking){this.runtime.tickMe(this);this.isTicking=true}};Acts.prototype.SetMirrored=function(m){var neww=cr.abs(this.width)*(m===0?-1:1);if(this.width===neww){return};this.width=neww;this.set_bbox_changed()};Acts.prototype.SetFlipped=function(f){var newh=cr.abs(this.height)*(f===0?-1:1);if(this.height===newh){return};this.height=newh;this.set_bbox_changed()};Acts.prototype.SetScale=function(s){var cur_frame=this.curFrame;var mirror_factor=(this.width<0?-1:1);var flip_factor=(this.height<0?-1:1);var new_width=cur_frame.width*s*mirror_factor;var new_height=cur_frame.height*s*flip_factor;if(this.width!==new_width||this.height!==new_height){this.width=new_width;this.height=new_height;this.set_bbox_changed()}};Acts.prototype.LoadURL=function(url_,resize_){var img=new Image();var self=this;var curFrame_=this.curFrame;img.onload=function(){if(curFrame_.texture_img.src===img.src){if(self.runtime.glwrap&&self.curFrame===curFrame_){self.curWebGLTexture=curFrame_.webGL_texture};if(resize_===0){self.width=img.width;self.height=img.height;self.set_bbox_changed()};self.runtime.redraw=true;self.runtime.trigger(cr.plugins_.Sprite.prototype.cnds.OnURLLoaded,self);return};curFrame_.texture_img=img;curFrame_.offx=0;curFrame_.offy=0;curFrame_.width=img.width;curFrame_.height=img.height;curFrame_.spritesheeted=false;curFrame_.datauri="";curFrame_.pixelformat=0;if(self.runtime.glwrap){if(curFrame_.webGL_texture){self.runtime.glwrap.deleteTexture(curFrame_.webGL_texture)};curFrame_.webGL_texture=self.runtime.glwrap.loadTexture(img,false,self.runtime.linearSampling);if(self.curFrame===curFrame_){self.curWebGLTexture=curFrame_.webGL_texture};self.type.updateAllCurrentTexture()};if(resize_===0){self.width=img.width;self.height=img.height;self.set_bbox_changed()};self.runtime.redraw=true;self.runtime.trigger(cr.plugins_.Sprite.prototype.cnds.OnURLLoaded,self)};if(url_.substr(0,5)!=="\x64\x61\x74\x61\x3A"){img["\x63\x72\x6F\x73\x73\x4F\x72\x69\x67\x69\x6E"]="\x61\x6E\x6F\x6E\x79\x6D\x6F\x75\x73"};img.src=url_};Acts.prototype.SetCollisions=function(set_){if(this.collisionsEnabled===(set_!==0)){return};this.collisionsEnabled=(set_!==0);if(this.collisionsEnabled){this.set_bbox_changed()}else{if(this.collcells.right>=this.collcells.left){this.type.collision_grid.update(this,this.collcells,null)};this.collcells["\x73\x65\x74"](0,0,-1,-1)}};pluginProto.acts=new Acts();function Exps(){}Exps.prototype.AnimationFrame=function(ret){ret.set_int(this.cur_frame)};Exps.prototype.AnimationFrameCount=function(ret){ret.set_int(this.cur_animation.frames.length)};Exps.prototype.AnimationName=function(ret){ret.set_string(this.cur_animation.name)};Exps.prototype.AnimationSpeed=function(ret){ret.set_float(this.animForwards?this.cur_anim_speed:-this.cur_anim_speed)};Exps.prototype.ImagePointX=function(ret,imgpt){ret.set_float(this.getImagePoint(imgpt,true))};Exps.prototype.ImagePointY=function(ret,imgpt){ret.set_float(this.getImagePoint(imgpt,false))};Exps.prototype.ImagePointCount=function(ret){ret.set_int(this.curFrame.image_points.length)};Exps.prototype.ImageWidth=function(ret){ret.set_float(this.curFrame.width)};Exps.prototype.ImageHeight=function(ret){ret.set_float(this.curFrame.height)};pluginProto.exps=new Exps()}());;;;;cr.plugins_.Spritefont2=function(runtime){this.runtime=runtime};(function(){var pluginProto=cr.plugins_.Spritefont2.prototype;pluginProto.onCreate=function(){};pluginProto.Type=function(plugin){this.plugin=plugin;this.runtime=plugin.runtime};var typeProto=pluginProto.Type.prototype;typeProto.onCreate=function(){if(this.is_family){return};this.texture_img=new Image();this.runtime.waitForImageLoad(this.texture_img,this.texture_file);this.webGL_texture=null};typeProto.onLostWebGLContext=function(){if(this.is_family){return};this.webGL_texture=null};typeProto.onRestoreWebGLContext=function(){if(this.is_family||!this.instances.length){return};if(!this.webGL_texture){this.webGL_texture=this.runtime.glwrap.loadTexture(this.texture_img,false,this.runtime.linearSampling,this.texture_pixelformat)};var i,len;for(i=0,len=this.instances.length;i<len;i++){this.instances[i].webGL_texture=this.webGL_texture}};typeProto.unloadTextures=function(){if(this.is_family||this.instances.length||!this.webGL_texture){return};this.runtime.glwrap.deleteTexture(this.webGL_texture);this.webGL_texture=null};typeProto.preloadCanvas2D=function(ctx){ctx.drawImage(this.texture_img,0,0)};pluginProto.Instance=function(type){this.type=type;this.runtime=type.runtime};var instanceProto=pluginProto.Instance.prototype;instanceProto.onDestroy=function(){freeAllLines(this.lines);freeAllClip(this.clipList);freeAllClipUV(this.clipUV);cr.wipe(this.characterWidthList)};instanceProto.onCreate=function(){this.texture_img=this.type.texture_img;this.characterWidth=this.properties[0];this.characterHeight=this.properties[1];this.characterSet=this.properties[2];this.text=this.properties[3];this.characterScale=this.properties[4];this.visible=(this.properties[5]===0);this.halign=this.properties[6]/2.0;this.valign=this.properties[7]/2.0;this.wrapbyword=(this.properties[9]===0);this.characterSpacing=this.properties[10];this.lineHeight=this.properties[11];this.textWidth=0;this.textHeight=0;if(this.recycled){cr.clearArray(this.lines);cr.wipe(this.clipList);cr.wipe(this.clipUV);cr.wipe(this.characterWidthList)}else{this.lines=[];this.clipList={};this.clipUV={};this.characterWidthList={}};this.text_changed=true;this.lastwrapwidth=this.width;if(this.runtime.glwrap){if(!this.type.webGL_texture){this.type.webGL_texture=this.runtime.glwrap.loadTexture(this.type.texture_img,false,this.runtime.linearSampling,this.type.texture_pixelformat)};this.webGL_texture=this.type.webGL_texture};this.SplitSheet()};instanceProto.saveToJSON=function(){var save={"\x74":this.text,"\x63\x73\x63":this.characterScale,"\x63\x73\x70":this.characterSpacing,"\x6C\x68":this.lineHeight,"\x74\x77":this.textWidth,"\x74\x68":this.textHeight,"\x6C\x72\x74":this.last_render_tick,"\x68\x61":this.halign,"\x76\x61":this.valign,"\x63\x77":{}};for(var ch in this.characterWidthList){save["\x63\x77"][ch]=this.characterWidthList[ch]};return save};instanceProto.loadFromJSON=function(o){this.text=o["\x74"];this.characterScale=o["\x63\x73\x63"];this.characterSpacing=o["\x63\x73\x70"];this.lineHeight=o["\x6C\x68"];this.textWidth=o["\x74\x77"];this.textHeight=o["\x74\x68"];this.last_render_tick=o["\x6C\x72\x74"];if(o.hasOwnProperty("\x68\x61")){this.halign=o["\x68\x61"]};if(o.hasOwnProperty("\x76\x61")){this.valign=o["\x76\x61"]};for(var ch in o["\x63\x77"]){this.characterWidthList[ch]=o["\x63\x77"][ch]};this.text_changed=true;this.lastwrapwidth=this.width};function trimRight(text){return text.replace(/\s\s*$/,'')}var MAX_CACHE_SIZE=1000;function alloc(cache,Constructor){if(cache.length){return cache.pop()}else{return new Constructor()}}function free(cache,data){if(cache.length<MAX_CACHE_SIZE){cache.push(data)}}function freeAll(cache,dataList,isArray){if(isArray){var i,len;for(i=0,len=dataList.length;i<len;i++){free(cache,dataList[i])};cr.clearArray(dataList)}else{var prop;for(prop in dataList){if(Object.prototype.hasOwnProperty.call(dataList,prop)){free(cache,dataList[prop]);delete dataList[prop]}}}}function addLine(inst,lineIndex,cur_line){var lines=inst.lines;var line;cur_line=trimRight(cur_line);if(lineIndex>=lines.length){lines.push(allocLine())};line=lines[lineIndex];line.text=cur_line;line.width=inst.measureWidth(cur_line);inst.textWidth=cr.max(inst.textWidth,line.width)}var linesCache=[];function allocLine(){return alloc(linesCache,Object)}function freeLine(l){free(linesCache,l)}function freeAllLines(arr){freeAll(linesCache,arr,true)}function addClip(obj,property,x,y,w,h){if(obj[property]===undefined){obj[property]=alloc(clipCache,Object)};obj[property].x=x;obj[property].y=y;obj[property].w=w;obj[property].h=h}var clipCache=[];function allocClip(){return alloc(clipCache,Object)}function freeAllClip(obj){freeAll(clipCache,obj,false)}function addClipUV(obj,property,left,top,right,bottom){if(obj[property]===undefined){obj[property]=alloc(clipUVCache,cr.rect)};obj[property].left=left;obj[property].top=top;obj[property].right=right;obj[property].bottom=bottom}var clipUVCache=[];function allocClipUV(){return alloc(clipUVCache,cr.rect)}function freeAllClipUV(obj){freeAll(clipUVCache,obj,false)}instanceProto.SplitSheet=function(){var texture=this.texture_img;var texWidth=texture.width;var texHeight=texture.height;var charWidth=this.characterWidth;var charHeight=this.characterHeight;var charU=charWidth/texWidth;var charV=charHeight/texHeight;var charSet=this.characterSet;var cols=Math.floor(texWidth/charWidth);var rows=Math.floor(texHeight/charHeight);for(var c=0;c<charSet.length;c++){if(c>=cols*rows){break};var x=c%cols;var y=Math.floor(c/cols);var letter=charSet.charAt(c);if(this.runtime.glwrap){addClipUV(this.clipUV,letter,x*charU,y*charV,(x+1)*charU,(y+1)*charV)}else{addClip(this.clipList,letter,x*charWidth,y*charHeight,charWidth,charHeight)}}};var wordsCache=[];pluginProto.TokeniseWords=function(text){cr.clearArray(wordsCache);var cur_word="";var ch;var i=0;while(i<text.length){ch=text.charAt(i);if(ch==="\x0A"){if(cur_word.length){wordsCache.push(cur_word);cur_word=""};wordsCache.push("\x0A");++i}else{if(ch==="\x20"||ch==="\x09"||ch==="\x2D"){do{cur_word+=text.charAt(i);i++}while(i<text.length&&(text.charAt(i)==="\x20"||text.charAt(i)==="\x09"));;wordsCache.push(cur_word);cur_word=""}else{if(i<text.length){cur_word+=ch;i++}}}};if(cur_word.length){wordsCache.push(cur_word)}};pluginProto.WordWrap=function(inst){var text=inst.text;var lines=inst.lines;if(!text||!text.length){freeAllLines(lines);return};var width=inst.width;if(width<=2.0){freeAllLines(lines);return};var charWidth=inst.characterWidth;var charScale=inst.characterScale;var charSpacing=inst.characterSpacing;if((text.length*(charWidth*charScale+charSpacing)-charSpacing)<=width&&text.indexOf("\x0A")===-1){var all_width=inst.measureWidth(text);if(all_width<=width){freeAllLines(lines);lines.push(allocLine());lines[0].text=text;lines[0].width=all_width;inst.textWidth=all_width;inst.textHeight=inst.characterHeight*charScale+inst.lineHeight;return}};var wrapbyword=inst.wrapbyword;this.WrapText(inst);inst.textHeight=lines.length*(inst.characterHeight*charScale+inst.lineHeight)};pluginProto.WrapText=function(inst){var wrapbyword=inst.wrapbyword;var text=inst.text;var lines=inst.lines;var width=inst.width;var wordArray;if(wrapbyword){this.TokeniseWords(text);wordArray=wordsCache}else{wordArray=text};var cur_line="";var prev_line;var line_width;var i;var lineIndex=0;var line;var ignore_newline=false;for(i=0;i<wordArray.length;i++){if(wordArray[i]==="\x0A"){if(ignore_newline===true){ignore_newline=false}else{addLine(inst,lineIndex,cur_line);lineIndex++};cur_line="";continue};ignore_newline=false;prev_line=cur_line;cur_line+=wordArray[i];line_width=inst.measureWidth(trimRight(cur_line));if(line_width>width){if(prev_line===""){addLine(inst,lineIndex,cur_line);cur_line="";ignore_newline=true}else{addLine(inst,lineIndex,prev_line);cur_line=wordArray[i]};lineIndex++;if(!wrapbyword&&cur_line==="\x20"){cur_line=""}}};if(trimRight(cur_line).length){addLine(inst,lineIndex,cur_line);lineIndex++};for(i=lineIndex;i<lines.length;i++){freeLine(lines[i])};lines.length=lineIndex};instanceProto.measureWidth=function(text){var spacing=this.characterSpacing;var len=text.length;var width=0;for(var i=0;i<len;i++){width+=this.getCharacterWidth(text.charAt(i))*this.characterScale+spacing};width-=(width>0)?spacing:0;return width};instanceProto.getCharacterWidth=function(character){var widthList=this.characterWidthList;if(widthList[character]!==undefined){return widthList[character]}else{return this.characterWidth}};instanceProto.rebuildText=function(){if(this.text_changed||this.width!==this.lastwrapwidth){this.textWidth=0;this.textHeight=0;this.type.plugin.WordWrap(this);this.text_changed=false;this.lastwrapwidth=this.width}};var EPSILON=0.00001;instanceProto.draw=function(ctx,glmode){var texture=this.texture_img;if(this.text!==""&&texture!=null){this.rebuildText();if(this.height<this.characterHeight*this.characterScale+this.lineHeight){return};ctx.globalAlpha=this.opacity;var myx=this.x;var myy=this.y;if(this.runtime.pixel_rounding){myx=Math.round(myx);myy=Math.round(myy)};var viewLeft=this.layer.viewLeft;var viewTop=this.layer.viewTop;var viewRight=this.layer.viewRight;var viewBottom=this.layer.viewBottom;ctx.save();ctx.translate(myx,myy);ctx.rotate(this.angle);var ha=this.halign;var va=this.valign;var scale=this.characterScale;var charHeight=this.characterHeight*scale;var lineHeight=this.lineHeight;var charSpace=this.characterSpacing;var lines=this.lines;var textHeight=this.textHeight;var letterWidth;var halign;var valign=va*cr.max(0,(this.height-textHeight));var offx=-(this.hotspotX*this.width);var offy=-(this.hotspotY*this.height);offy+=valign;var drawX;var drawY=offy;var roundX,roundY;for(var i=0;i<lines.length;i++){var line=lines[i].text;var len=lines[i].width;halign=ha*cr.max(0,this.width-len);drawX=offx+halign;drawY+=lineHeight;if(myy+drawY+charHeight<viewTop){drawY+=charHeight;continue};for(var j=0;j<line.length;j++){var letter=line.charAt(j);letterWidth=this.getCharacterWidth(letter);var clip=this.clipList[letter];if(myx+drawX+letterWidth*scale+charSpace<viewLeft){drawX+=letterWidth*scale+charSpace;continue};if(drawX+letterWidth*scale>this.width+EPSILON){break};if(clip!==undefined){roundX=drawX;roundY=drawY;if(this.angle===0){roundX=Math.round(roundX);roundY=Math.round(roundY)};ctx.drawImage(this.texture_img,clip.x,clip.y,clip.w,clip.h,roundX,roundY,clip.w*scale,clip.h*scale)};drawX+=letterWidth*scale+charSpace;if(myx+drawX>viewRight){break}};drawY+=charHeight;if(drawY+charHeight+lineHeight>this.height||myy+drawY>viewBottom){break}};ctx.restore()}};var dQuad=new cr.quad();function rotateQuad(quad,cosa,sina){var x_temp;x_temp=(quad.tlx*cosa)-(quad.tly*sina);quad.tly=(quad.tly*cosa)+(quad.tlx*sina);quad.tlx=x_temp;x_temp=(quad.trx*cosa)-(quad.try_*sina);quad.try_=(quad.try_*cosa)+(quad.trx*sina);quad.trx=x_temp;x_temp=(quad.blx*cosa)-(quad.bly*sina);quad.bly=(quad.bly*cosa)+(quad.blx*sina);quad.blx=x_temp;x_temp=(quad.brx*cosa)-(quad.bry*sina);quad.bry=(quad.bry*cosa)+(quad.brx*sina);quad.brx=x_temp}instanceProto.drawGL=function(glw){glw.setTexture(this.webGL_texture);glw.setOpacity(this.opacity);if(!this.text){return};this.rebuildText();if(this.height<this.characterHeight*this.characterScale+this.lineHeight){return};this.update_bbox();var q=this.bquad;var ox=0;var oy=0;if(this.runtime.pixel_rounding){ox=Math.round(this.x)-this.x;oy=Math.round(this.y)-this.y};var viewLeft=this.layer.viewLeft;var viewTop=this.layer.viewTop;var viewRight=this.layer.viewRight;var viewBottom=this.layer.viewBottom;var angle=this.angle;var ha=this.halign;var va=this.valign;var scale=this.characterScale;var charHeight=this.characterHeight*scale;var lineHeight=this.lineHeight;var charSpace=this.characterSpacing;var lines=this.lines;var textHeight=this.textHeight;var letterWidth;var cosa,sina;if(angle!==0){cosa=Math.cos(angle);sina=Math.sin(angle)};var halign;var valign=va*cr.max(0,(this.height-textHeight));var offx=q.tlx+ox;var offy=q.tly+oy;var drawX;var drawY=valign;var roundX,roundY;for(var i=0;i<lines.length;i++){var line=lines[i].text;var lineWidth=lines[i].width;halign=ha*cr.max(0,this.width-lineWidth);drawX=halign;drawY+=lineHeight;if(angle===0&&offy+drawY+charHeight<viewTop){drawY+=charHeight;continue};for(var j=0;j<line.length;j++){var letter=line.charAt(j);letterWidth=this.getCharacterWidth(letter);var clipUV=this.clipUV[letter];if(offx+drawX+letterWidth*scale+charSpace<viewLeft){drawX+=letterWidth*scale+charSpace;continue};if(drawX+letterWidth*scale>this.width+EPSILON){break};if(clipUV!==undefined){var clipWidth=this.characterWidth*scale;var clipHeight=this.characterHeight*scale;roundX=drawX;roundY=drawY;if(angle===0){roundX=Math.round(roundX);roundY=Math.round(roundY)};dQuad.tlx=roundX;dQuad.tly=roundY;dQuad.trx=roundX+clipWidth;dQuad.try_=roundY;dQuad.blx=roundX;dQuad.bly=roundY+clipHeight;dQuad.brx=roundX+clipWidth;dQuad.bry=roundY+clipHeight;if(angle!==0){rotateQuad(dQuad,cosa,sina)};dQuad.offset(offx,offy);glw.quadTex(dQuad.tlx,dQuad.tly,dQuad.trx,dQuad.try_,dQuad.brx,dQuad.bry,dQuad.blx,dQuad.bly,clipUV)};drawX+=letterWidth*scale+charSpace;if(angle===0&&offx+drawX>viewRight){break}};drawY+=charHeight;if(drawY+charHeight+lineHeight>this.height||offy+drawY>viewBottom){break}}};function Cnds(){}Cnds.prototype.CompareText=function(text_to_compare,case_sensitive){if(case_sensitive){return this.text==text_to_compare}else{return cr.equals_nocase(this.text,text_to_compare)}};pluginProto.cnds=new Cnds();function Acts(){}Acts.prototype.SetText=function(param){if(cr.is_number(param)&&param<1e9){param=Math.round(param*1e10)/1e10};var text_to_set=param.toString();if(this.text!==text_to_set){this.text=text_to_set;this.text_changed=true;this.runtime.redraw=true}};Acts.prototype.AppendText=function(param){if(cr.is_number(param)){param=Math.round(param*1e10)/1e10};var text_to_append=param.toString();if(text_to_append){this.text+=text_to_append;this.text_changed=true;this.runtime.redraw=true}};Acts.prototype.SetScale=function(param){if(param!==this.characterScale){this.characterScale=param;this.text_changed=true;this.runtime.redraw=true}};Acts.prototype.SetCharacterSpacing=function(param){if(param!==this.CharacterSpacing){this.characterSpacing=param;this.text_changed=true;this.runtime.redraw=true}};Acts.prototype.SetLineHeight=function(param){if(param!==this.lineHeight){this.lineHeight=param;this.text_changed=true;this.runtime.redraw=true}};instanceProto.SetCharWidth=function(character,width){var w=parseInt(width,10);if(this.characterWidthList[character]!==w){this.characterWidthList[character]=w;this.text_changed=true;this.runtime.redraw=true}};Acts.prototype.SetCharacterWidth=function(characterSet,width){if(characterSet!==""){for(var c=0;c<characterSet.length;c++){this.SetCharWidth(characterSet.charAt(c),width)}}};Acts.prototype.SetEffect=function(effect){this.blend_mode=effect;this.compositeOp=cr.effectToCompositeOp(effect);cr.setGLBlend(this,effect,this.runtime.gl);this.runtime.redraw=true};Acts.prototype.SetHAlign=function(a){this.halign=a/2.0;this.text_changed=true;this.runtime.redraw=true};Acts.prototype.SetVAlign=function(a){this.valign=a/2.0;this.text_changed=true;this.runtime.redraw=true};pluginProto.acts=new Acts();function Exps(){}Exps.prototype.CharacterWidth=function(ret,character){ret.set_int(this.getCharacterWidth(character))};Exps.prototype.CharacterHeight=function(ret){ret.set_int(this.characterHeight)};Exps.prototype.CharacterScale=function(ret){ret.set_float(this.characterScale)};Exps.prototype.CharacterSpacing=function(ret){ret.set_int(this.characterSpacing)};Exps.prototype.LineHeight=function(ret){ret.set_int(this.lineHeight)};Exps.prototype.Text=function(ret){ret.set_string(this.text)};Exps.prototype.TextWidth=function(ret){this.rebuildText();ret.set_float(this.textWidth)};Exps.prototype.TextHeight=function(ret){this.rebuildText();ret.set_float(this.textHeight)};pluginProto.exps=new Exps()}());;;;;cr.plugins_.TiledBg=function(runtime){this.runtime=runtime};(function(){var pluginProto=cr.plugins_.TiledBg.prototype;pluginProto.Type=function(plugin){this.plugin=plugin;this.runtime=plugin.runtime};var typeProto=pluginProto.Type.prototype;typeProto.onCreate=function(){if(this.is_family){return};this.texture_img=new Image();this.texture_img.cr_filesize=this.texture_filesize;this.runtime.waitForImageLoad(this.texture_img,this.texture_file);this.pattern=null;this.webGL_texture=null};typeProto.onLostWebGLContext=function(){if(this.is_family){return};this.webGL_texture=null};typeProto.onRestoreWebGLContext=function(){if(this.is_family||!this.instances.length){return};if(!this.webGL_texture){this.webGL_texture=this.runtime.glwrap.loadTexture(this.texture_img,true,this.runtime.linearSampling,this.texture_pixelformat)};var i,len;for(i=0,len=this.instances.length;i<len;i++){this.instances[i].webGL_texture=this.webGL_texture}};typeProto.loadTextures=function(){if(this.is_family||this.webGL_texture||!this.runtime.glwrap){return};this.webGL_texture=this.runtime.glwrap.loadTexture(this.texture_img,true,this.runtime.linearSampling,this.texture_pixelformat)};typeProto.unloadTextures=function(){if(this.is_family||this.instances.length||!this.webGL_texture){return};this.runtime.glwrap.deleteTexture(this.webGL_texture);this.webGL_texture=null};typeProto.preloadCanvas2D=function(ctx){ctx.drawImage(this.texture_img,0,0)};pluginProto.Instance=function(type){this.type=type;this.runtime=type.runtime};var instanceProto=pluginProto.Instance.prototype;instanceProto.onCreate=function(){this.visible=(this.properties[0]===0);this.rcTex=new cr.rect(0,0,0,0);this.has_own_texture=false;this.texture_img=this.type.texture_img;if(this.runtime.glwrap){this.type.loadTextures();this.webGL_texture=this.type.webGL_texture}else{if(!this.type.pattern){this.type.pattern=this.runtime.ctx.createPattern(this.type.texture_img,"\x72\x65\x70\x65\x61\x74")};this.pattern=this.type.pattern}};instanceProto.afterLoad=function(){this.has_own_texture=false;this.texture_img=this.type.texture_img};instanceProto.onDestroy=function(){if(this.runtime.glwrap&&this.has_own_texture&&this.webGL_texture){this.runtime.glwrap.deleteTexture(this.webGL_texture);this.webGL_texture=null}};instanceProto.draw=function(ctx){ctx.globalAlpha=this.opacity;ctx.save();ctx.fillStyle=this.pattern;var myx=this.x;var myy=this.y;if(this.runtime.pixel_rounding){myx=Math.round(myx);myy=Math.round(myy)};var drawX=-(this.hotspotX*this.width);var drawY=-(this.hotspotY*this.height);var offX=drawX%this.texture_img.width;var offY=drawY%this.texture_img.height;if(offX<0){offX+=this.texture_img.width};if(offY<0){offY+=this.texture_img.height};ctx.translate(myx,myy);ctx.rotate(this.angle);ctx.translate(offX,offY);ctx.fillRect(drawX-offX,drawY-offY,this.width,this.height);ctx.restore()};instanceProto.drawGL_earlyZPass=function(glw){this.drawGL(glw)};instanceProto.drawGL=function(glw){glw.setTexture(this.webGL_texture);glw.setOpacity(this.opacity);var rcTex=this.rcTex;rcTex.right=this.width/this.texture_img.width;rcTex.bottom=this.height/this.texture_img.height;var q=this.bquad;if(this.runtime.pixel_rounding){var ox=Math.round(this.x)-this.x;var oy=Math.round(this.y)-this.y;glw.quadTex(q.tlx+ox,q.tly+oy,q.trx+ox,q.try_+oy,q.brx+ox,q.bry+oy,q.blx+ox,q.bly+oy,rcTex)}else{glw.quadTex(q.tlx,q.tly,q.trx,q.try_,q.brx,q.bry,q.blx,q.bly,rcTex)}};function Cnds(){}Cnds.prototype.OnURLLoaded=function(){return true};pluginProto.cnds=new Cnds();function Acts(){}Acts.prototype.SetEffect=function(effect){this.blend_mode=effect;this.compositeOp=cr.effectToCompositeOp(effect);cr.setGLBlend(this,effect,this.runtime.gl);this.runtime.redraw=true};Acts.prototype.LoadURL=function(url_){var img=new Image();var self=this;img.onload=function(){self.texture_img=img;if(self.runtime.glwrap){if(self.has_own_texture&&self.webGL_texture){self.runtime.glwrap.deleteTexture(self.webGL_texture)};self.webGL_texture=self.runtime.glwrap.loadTexture(img,true,self.runtime.linearSampling)}else{self.pattern=self.runtime.ctx.createPattern(img,"\x72\x65\x70\x65\x61\x74")};self.has_own_texture=true;self.runtime.redraw=true;self.runtime.trigger(cr.plugins_.TiledBg.prototype.cnds.OnURLLoaded,self)};if(url_.substr(0,5)!=="\x64\x61\x74\x61\x3A"){img.crossOrigin="\x61\x6E\x6F\x6E\x79\x6D\x6F\x75\x73"};img.src=url_};pluginProto.acts=new Acts();function Exps(){}Exps.prototype.ImageWidth=function(ret){ret.set_float(this.texture_img.width)};Exps.prototype.ImageHeight=function(ret){ret.set_float(this.texture_img.height)};pluginProto.exps=new Exps()}());;;;;cr.plugins_.Touch=function(runtime){this.runtime=runtime};(function(){var pluginProto=cr.plugins_.Touch.prototype;pluginProto.Type=function(plugin){this.plugin=plugin;this.runtime=plugin.runtime};var typeProto=pluginProto.Type.prototype;typeProto.onCreate=function(){};pluginProto.Instance=function(type){this.type=type;this.runtime=type.runtime;this.touches=[];this.mouseDown=false};var instanceProto=pluginProto.Instance.prototype;var dummyoffset={left:0,top:0};instanceProto.findTouch=function(id){var i,len;for(i=0,len=this.touches.length;i<len;i++){if(this.touches[i]["\x69\x64"]===id){return i}};return-1};var appmobi_accx=0;var appmobi_accy=0;var appmobi_accz=0;function AppMobiGetAcceleration(evt){appmobi_accx=evt.x;appmobi_accy=evt.y;appmobi_accz=evt.z}var pg_accx=0;var pg_accy=0;var pg_accz=0;function PhoneGapGetAcceleration(evt){pg_accx=evt.x;pg_accy=evt.y;pg_accz=evt.z}var theInstance=null;var touchinfo_cache=[];function AllocTouchInfo(x,y,id,index){var ret;if(touchinfo_cache.length){ret=touchinfo_cache.pop()}else{ret=new TouchInfo()};ret.init(x,y,id,index);return ret}function ReleaseTouchInfo(ti){if(touchinfo_cache.length<100){touchinfo_cache.push(ti)}}var GESTURE_HOLD_THRESHOLD=15;var GESTURE_HOLD_TIMEOUT=500;var GESTURE_TAP_TIMEOUT=333;var GESTURE_DOUBLETAP_THRESHOLD=25;function TouchInfo(){this.starttime=0;this.time=0;this.lasttime=0;this.startx=0;this.starty=0;this.x=0;this.y=0;this.lastx=0;this.lasty=0;this["\x69\x64"]=0;this.startindex=0;this.triggeredHold=false;this.tooFarForHold=false}TouchInfo.prototype.init=function(x,y,id,index){var nowtime=cr.performance_now();this.time=nowtime;this.lasttime=nowtime;this.starttime=nowtime;this.startx=x;this.starty=y;this.x=x;this.y=y;this.lastx=x;this.lasty=y;this["\x69\x64"]=id;this.startindex=index;this.triggeredHold=false;this.tooFarForHold=false};TouchInfo.prototype.update=function(nowtime,x,y){this.lasttime=this.time;this.time=nowtime;this.lastx=this.x;this.lasty=this.y;this.x=x;this.y=y;if(!this.tooFarForHold&&cr.distanceTo(this.startx,this.starty,this.x,this.y)>=GESTURE_HOLD_THRESHOLD){this.tooFarForHold=true}};TouchInfo.prototype.maybeTriggerHold=function(inst,index){if(this.triggeredHold){return};var nowtime=cr.performance_now();if(nowtime-this.starttime>=GESTURE_HOLD_TIMEOUT&&!this.tooFarForHold&&cr.distanceTo(this.startx,this.starty,this.x,this.y)<GESTURE_HOLD_THRESHOLD){this.triggeredHold=true;inst.trigger_index=this.startindex;inst.trigger_id=this["\x69\x64"];inst.getTouchIndex=index;inst.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnHoldGesture,inst);inst.curTouchX=this.x;inst.curTouchY=this.y;inst.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnHoldGestureObject,inst);inst.getTouchIndex=0}};var lastTapX=-1000;var lastTapY=-1000;var lastTapTime=-10000;TouchInfo.prototype.maybeTriggerTap=function(inst,index){if(this.triggeredHold){return};var nowtime=cr.performance_now();if(nowtime-this.starttime<=GESTURE_TAP_TIMEOUT&&!this.tooFarForHold&&cr.distanceTo(this.startx,this.starty,this.x,this.y)<GESTURE_HOLD_THRESHOLD){inst.trigger_index=this.startindex;inst.trigger_id=this["\x69\x64"];inst.getTouchIndex=index;if((nowtime-lastTapTime<=GESTURE_TAP_TIMEOUT*2)&&cr.distanceTo(lastTapX,lastTapY,this.x,this.y)<GESTURE_DOUBLETAP_THRESHOLD){inst.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnDoubleTapGesture,inst);inst.curTouchX=this.x;inst.curTouchY=this.y;inst.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnDoubleTapGestureObject,inst);lastTapX=-1000;lastTapY=-1000;lastTapTime=-10000}else{inst.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnTapGesture,inst);inst.curTouchX=this.x;inst.curTouchY=this.y;inst.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnTapGestureObject,inst);lastTapX=this.x;lastTapY=this.y;lastTapTime=nowtime};inst.getTouchIndex=0}};instanceProto.onCreate=function(){theInstance=this;this.isWindows8=!!(typeof window["\x63\x32\x69\x73\x57\x69\x6E\x64\x6F\x77\x73\x38"]!=="\x75\x6E\x64\x65\x66\x69\x6E\x65\x64"&&window["\x63\x32\x69\x73\x57\x69\x6E\x64\x6F\x77\x73\x38"]);this.orient_alpha=0;this.orient_beta=0;this.orient_gamma=0;this.acc_g_x=0;this.acc_g_y=0;this.acc_g_z=0;this.acc_x=0;this.acc_y=0;this.acc_z=0;this.curTouchX=0;this.curTouchY=0;this.trigger_index=0;this.trigger_id=0;this.getTouchIndex=0;this.useMouseInput=(this.properties[0]!==0);var elem=(this.runtime.fullscreen_mode>0)?document:this.runtime.canvas;var elem2=document;if(this.runtime.isDirectCanvas){elem2=elem=window["\x43\x61\x6E\x76\x61\x73"]}else{if(this.runtime.isCocoonJs){elem2=elem=window}};var self=this;if(window.navigator["\x70\x6F\x69\x6E\x74\x65\x72\x45\x6E\x61\x62\x6C\x65\x64"]){elem.addEventListener("\x70\x6F\x69\x6E\x74\x65\x72\x64\x6F\x77\x6E",function(info){self.onPointerStart(info)},false);elem.addEventListener("\x70\x6F\x69\x6E\x74\x65\x72\x6D\x6F\x76\x65",function(info){self.onPointerMove(info)},false);elem2.addEventListener("\x70\x6F\x69\x6E\x74\x65\x72\x75\x70",function(info){self.onPointerEnd(info,false)},false);elem2.addEventListener("\x70\x6F\x69\x6E\x74\x65\x72\x63\x61\x6E\x63\x65\x6C",function(info){self.onPointerEnd(info,true)},false);if(this.runtime.canvas){this.runtime.canvas.addEventListener("\x4D\x53\x47\x65\x73\x74\x75\x72\x65\x48\x6F\x6C\x64",function(e){e.preventDefault()},false);document.addEventListener("\x4D\x53\x47\x65\x73\x74\x75\x72\x65\x48\x6F\x6C\x64",function(e){e.preventDefault()},false);this.runtime.canvas.addEventListener("\x67\x65\x73\x74\x75\x72\x65\x68\x6F\x6C\x64",function(e){e.preventDefault()},false);document.addEventListener("\x67\x65\x73\x74\x75\x72\x65\x68\x6F\x6C\x64",function(e){e.preventDefault()},false)}}else{if(window.navigator["\x6D\x73\x50\x6F\x69\x6E\x74\x65\x72\x45\x6E\x61\x62\x6C\x65\x64"]){elem.addEventListener("\x4D\x53\x50\x6F\x69\x6E\x74\x65\x72\x44\x6F\x77\x6E",function(info){self.onPointerStart(info)},false);elem.addEventListener("\x4D\x53\x50\x6F\x69\x6E\x74\x65\x72\x4D\x6F\x76\x65",function(info){self.onPointerMove(info)},false);elem2.addEventListener("\x4D\x53\x50\x6F\x69\x6E\x74\x65\x72\x55\x70",function(info){self.onPointerEnd(info,false)},false);elem2.addEventListener("\x4D\x53\x50\x6F\x69\x6E\x74\x65\x72\x43\x61\x6E\x63\x65\x6C",function(info){self.onPointerEnd(info,true)},false);if(this.runtime.canvas){this.runtime.canvas.addEventListener("\x4D\x53\x47\x65\x73\x74\x75\x72\x65\x48\x6F\x6C\x64",function(e){e.preventDefault()},false);document.addEventListener("\x4D\x53\x47\x65\x73\x74\x75\x72\x65\x48\x6F\x6C\x64",function(e){e.preventDefault()},false)}}else{elem.addEventListener("\x74\x6F\x75\x63\x68\x73\x74\x61\x72\x74",function(info){self.onTouchStart(info)},false);elem.addEventListener("\x74\x6F\x75\x63\x68\x6D\x6F\x76\x65",function(info){self.onTouchMove(info)},false);elem2.addEventListener("\x74\x6F\x75\x63\x68\x65\x6E\x64",function(info){self.onTouchEnd(info,false)},false);elem2.addEventListener("\x74\x6F\x75\x63\x68\x63\x61\x6E\x63\x65\x6C",function(info){self.onTouchEnd(info,true)},false)}};if(this.isWindows8){var win8accelerometerFn=function(e){var reading=e["\x72\x65\x61\x64\x69\x6E\x67"];self.acc_x=reading["\x61\x63\x63\x65\x6C\x65\x72\x61\x74\x69\x6F\x6E\x58"];self.acc_y=reading["\x61\x63\x63\x65\x6C\x65\x72\x61\x74\x69\x6F\x6E\x59"];self.acc_z=reading["\x61\x63\x63\x65\x6C\x65\x72\x61\x74\x69\x6F\x6E\x5A"]};var win8inclinometerFn=function(e){var reading=e["\x72\x65\x61\x64\x69\x6E\x67"];self.orient_alpha=reading["\x79\x61\x77\x44\x65\x67\x72\x65\x65\x73"];self.orient_beta=reading["\x70\x69\x74\x63\x68\x44\x65\x67\x72\x65\x65\x73"];self.orient_gamma=reading["\x72\x6F\x6C\x6C\x44\x65\x67\x72\x65\x65\x73"]};var accelerometer=Windows["\x44\x65\x76\x69\x63\x65\x73"]["\x53\x65\x6E\x73\x6F\x72\x73"]["\x41\x63\x63\x65\x6C\x65\x72\x6F\x6D\x65\x74\x65\x72"]["\x67\x65\x74\x44\x65\x66\x61\x75\x6C\x74"]();if(accelerometer){accelerometer["\x72\x65\x70\x6F\x72\x74\x49\x6E\x74\x65\x72\x76\x61\x6C"]=Math.max(accelerometer["\x6D\x69\x6E\x69\x6D\x75\x6D\x52\x65\x70\x6F\x72\x74\x49\x6E\x74\x65\x72\x76\x61\x6C"],16);accelerometer.addEventListener("\x72\x65\x61\x64\x69\x6E\x67\x63\x68\x61\x6E\x67\x65\x64",win8accelerometerFn)};var inclinometer=Windows["\x44\x65\x76\x69\x63\x65\x73"]["\x53\x65\x6E\x73\x6F\x72\x73"]["\x49\x6E\x63\x6C\x69\x6E\x6F\x6D\x65\x74\x65\x72"]["\x67\x65\x74\x44\x65\x66\x61\x75\x6C\x74"]();if(inclinometer){inclinometer["\x72\x65\x70\x6F\x72\x74\x49\x6E\x74\x65\x72\x76\x61\x6C"]=Math.max(inclinometer["\x6D\x69\x6E\x69\x6D\x75\x6D\x52\x65\x70\x6F\x72\x74\x49\x6E\x74\x65\x72\x76\x61\x6C"],16);inclinometer.addEventListener("\x72\x65\x61\x64\x69\x6E\x67\x63\x68\x61\x6E\x67\x65\x64",win8inclinometerFn)};document.addEventListener("\x76\x69\x73\x69\x62\x69\x6C\x69\x74\x79\x63\x68\x61\x6E\x67\x65",function(e){if(document["\x68\x69\x64\x64\x65\x6E"]||document["\x6D\x73\x48\x69\x64\x64\x65\x6E"]){if(accelerometer){accelerometer.removeEventListener("\x72\x65\x61\x64\x69\x6E\x67\x63\x68\x61\x6E\x67\x65\x64",win8accelerometerFn)};if(inclinometer){inclinometer.removeEventListener("\x72\x65\x61\x64\x69\x6E\x67\x63\x68\x61\x6E\x67\x65\x64",win8inclinometerFn)}}else{if(accelerometer){accelerometer.addEventListener("\x72\x65\x61\x64\x69\x6E\x67\x63\x68\x61\x6E\x67\x65\x64",win8accelerometerFn)};if(inclinometer){inclinometer.addEventListener("\x72\x65\x61\x64\x69\x6E\x67\x63\x68\x61\x6E\x67\x65\x64",win8inclinometerFn)}}},false)}else{window.addEventListener("\x64\x65\x76\x69\x63\x65\x6F\x72\x69\x65\x6E\x74\x61\x74\x69\x6F\x6E",function(eventData){self.orient_alpha=eventData["\x61\x6C\x70\x68\x61"]||0;self.orient_beta=eventData["\x62\x65\x74\x61"]||0;self.orient_gamma=eventData["\x67\x61\x6D\x6D\x61"]||0},false);window.addEventListener("\x64\x65\x76\x69\x63\x65\x6D\x6F\x74\x69\x6F\x6E",function(eventData){if(eventData["\x61\x63\x63\x65\x6C\x65\x72\x61\x74\x69\x6F\x6E\x49\x6E\x63\x6C\x75\x64\x69\x6E\x67\x47\x72\x61\x76\x69\x74\x79"]){self.acc_g_x=eventData["\x61\x63\x63\x65\x6C\x65\x72\x61\x74\x69\x6F\x6E\x49\x6E\x63\x6C\x75\x64\x69\x6E\x67\x47\x72\x61\x76\x69\x74\x79"]["\x78"]||0;self.acc_g_y=eventData["\x61\x63\x63\x65\x6C\x65\x72\x61\x74\x69\x6F\x6E\x49\x6E\x63\x6C\x75\x64\x69\x6E\x67\x47\x72\x61\x76\x69\x74\x79"]["\x79"]||0;self.acc_g_z=eventData["\x61\x63\x63\x65\x6C\x65\x72\x61\x74\x69\x6F\x6E\x49\x6E\x63\x6C\x75\x64\x69\x6E\x67\x47\x72\x61\x76\x69\x74\x79"]["\x7A"]||0};if(eventData["\x61\x63\x63\x65\x6C\x65\x72\x61\x74\x69\x6F\x6E"]){self.acc_x=eventData["\x61\x63\x63\x65\x6C\x65\x72\x61\x74\x69\x6F\x6E"]["\x78"]||0;self.acc_y=eventData["\x61\x63\x63\x65\x6C\x65\x72\x61\x74\x69\x6F\x6E"]["\x79"]||0;self.acc_z=eventData["\x61\x63\x63\x65\x6C\x65\x72\x61\x74\x69\x6F\x6E"]["\x7A"]||0}},false)};if(this.useMouseInput&&!this.runtime.isDomFree){jQuery(document).mousemove(function(info){self.onMouseMove(info)});jQuery(document).mousedown(function(info){self.onMouseDown(info)});jQuery(document).mouseup(function(info){self.onMouseUp(info)})};if(!this.runtime.isiOS&&this.runtime.isCordova&&navigator["\x61\x63\x63\x65\x6C\x65\x72\x6F\x6D\x65\x74\x65\x72"]&&navigator["\x61\x63\x63\x65\x6C\x65\x72\x6F\x6D\x65\x74\x65\x72"]["\x77\x61\x74\x63\x68\x41\x63\x63\x65\x6C\x65\x72\x61\x74\x69\x6F\x6E"]){navigator["\x61\x63\x63\x65\x6C\x65\x72\x6F\x6D\x65\x74\x65\x72"]["\x77\x61\x74\x63\x68\x41\x63\x63\x65\x6C\x65\x72\x61\x74\x69\x6F\x6E"](PhoneGapGetAcceleration,null,{"\x66\x72\x65\x71\x75\x65\x6E\x63\x79":40})};this.runtime.tick2Me(this)};instanceProto.onPointerMove=function(info){if(info["\x70\x6F\x69\x6E\x74\x65\x72\x54\x79\x70\x65"]===info["\x4D\x53\x50\x4F\x49\x4E\x54\x45\x52\x5F\x54\x59\x50\x45\x5F\x4D\x4F\x55\x53\x45"]||info["\x70\x6F\x69\x6E\x74\x65\x72\x54\x79\x70\x65"]==="\x6D\x6F\x75\x73\x65"){return};if(info.preventDefault){info.preventDefault()};var i=this.findTouch(info["\x70\x6F\x69\x6E\x74\x65\x72\x49\x64"]);var nowtime=cr.performance_now();if(i>=0){var offset=this.runtime.isDomFree?dummyoffset:jQuery(this.runtime.canvas).offset();var t=this.touches[i];if(nowtime-t.time<2){return};t.update(nowtime,info.pageX-offset.left,info.pageY-offset.top)}};instanceProto.onPointerStart=function(info){if(info["\x70\x6F\x69\x6E\x74\x65\x72\x54\x79\x70\x65"]===info["\x4D\x53\x50\x4F\x49\x4E\x54\x45\x52\x5F\x54\x59\x50\x45\x5F\x4D\x4F\x55\x53\x45"]||info["\x70\x6F\x69\x6E\x74\x65\x72\x54\x79\x70\x65"]==="\x6D\x6F\x75\x73\x65"){return};if(info.preventDefault&&cr.isCanvasInputEvent(info)){info.preventDefault()};var offset=this.runtime.isDomFree?dummyoffset:jQuery(this.runtime.canvas).offset();var touchx=info.pageX-offset.left;var touchy=info.pageY-offset.top;var nowtime=cr.performance_now();this.trigger_index=this.touches.length;this.trigger_id=info["\x70\x6F\x69\x6E\x74\x65\x72\x49\x64"];this.touches.push(AllocTouchInfo(touchx,touchy,info["\x70\x6F\x69\x6E\x74\x65\x72\x49\x64"],this.trigger_index));this.runtime.isInUserInputEvent=true;this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnNthTouchStart,this);this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnTouchStart,this);this.curTouchX=touchx;this.curTouchY=touchy;this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnTouchObject,this);this.runtime.isInUserInputEvent=false};instanceProto.onPointerEnd=function(info,isCancel){if(info["\x70\x6F\x69\x6E\x74\x65\x72\x54\x79\x70\x65"]===info["\x4D\x53\x50\x4F\x49\x4E\x54\x45\x52\x5F\x54\x59\x50\x45\x5F\x4D\x4F\x55\x53\x45"]||info["\x70\x6F\x69\x6E\x74\x65\x72\x54\x79\x70\x65"]==="\x6D\x6F\x75\x73\x65"){return};if(info.preventDefault&&cr.isCanvasInputEvent(info)){info.preventDefault()};var i=this.findTouch(info["\x70\x6F\x69\x6E\x74\x65\x72\x49\x64"]);this.trigger_index=(i>=0?this.touches[i].startindex:-1);this.trigger_id=(i>=0?this.touches[i]["\x69\x64"]:-1);this.runtime.isInUserInputEvent=true;this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnNthTouchEnd,this);this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnTouchEnd,this);if(i>=0){if(!isCancel){this.touches[i].maybeTriggerTap(this,i)};ReleaseTouchInfo(this.touches[i]);this.touches.splice(i,1)};this.runtime.isInUserInputEvent=false};instanceProto.onTouchMove=function(info){if(info.preventDefault){info.preventDefault()};var nowtime=cr.performance_now();var i,len,t,u;for(i=0,len=info.changedTouches.length;i<len;i++){t=info.changedTouches[i];var j=this.findTouch(t["\x69\x64\x65\x6E\x74\x69\x66\x69\x65\x72"]);if(j>=0){var offset=this.runtime.isDomFree?dummyoffset:jQuery(this.runtime.canvas).offset();u=this.touches[j];if(nowtime-u.time<2){continue};u.update(nowtime,t.pageX-offset.left,t.pageY-offset.top)}}};instanceProto.onTouchStart=function(info){if(info.preventDefault&&cr.isCanvasInputEvent(info)){info.preventDefault()};var offset=this.runtime.isDomFree?dummyoffset:jQuery(this.runtime.canvas).offset();var nowtime=cr.performance_now();this.runtime.isInUserInputEvent=true;var i,len,t,j;for(i=0,len=info.changedTouches.length;i<len;i++){t=info.changedTouches[i];j=this.findTouch(t["\x69\x64\x65\x6E\x74\x69\x66\x69\x65\x72"]);if(j!==-1){continue};var touchx=t.pageX-offset.left;var touchy=t.pageY-offset.top;this.trigger_index=this.touches.length;this.trigger_id=t["\x69\x64\x65\x6E\x74\x69\x66\x69\x65\x72"];this.touches.push(AllocTouchInfo(touchx,touchy,t["\x69\x64\x65\x6E\x74\x69\x66\x69\x65\x72"],this.trigger_index));this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnNthTouchStart,this);this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnTouchStart,this);this.curTouchX=touchx;this.curTouchY=touchy;this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnTouchObject,this)};this.runtime.isInUserInputEvent=false};instanceProto.onTouchEnd=function(info,isCancel){if(info.preventDefault&&cr.isCanvasInputEvent(info)){info.preventDefault()};this.runtime.isInUserInputEvent=true;var i,len,t,j;for(i=0,len=info.changedTouches.length;i<len;i++){t=info.changedTouches[i];j=this.findTouch(t["\x69\x64\x65\x6E\x74\x69\x66\x69\x65\x72"]);if(j>=0){this.trigger_index=this.touches[j].startindex;this.trigger_id=this.touches[j]["\x69\x64"];this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnNthTouchEnd,this);this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnTouchEnd,this);if(!isCancel){this.touches[j].maybeTriggerTap(this,j)};ReleaseTouchInfo(this.touches[j]);this.touches.splice(j,1)}};this.runtime.isInUserInputEvent=false};instanceProto.getAlpha=function(){if(this.runtime.isCordova&&this.orient_alpha===0&&pg_accz!==0){return pg_accz*90}else{return this.orient_alpha}};instanceProto.getBeta=function(){if(this.runtime.isCordova&&this.orient_beta===0&&pg_accy!==0){return pg_accy*90}else{return this.orient_beta}};instanceProto.getGamma=function(){if(this.runtime.isCordova&&this.orient_gamma===0&&pg_accx!==0){return pg_accx*90}else{return this.orient_gamma}};var noop_func=function(){};instanceProto.onMouseDown=function(info){var t={pageX:info.pageX,pageY:info.pageY,"\x69\x64\x65\x6E\x74\x69\x66\x69\x65\x72":0};var fakeinfo={changedTouches:[t]};this.onTouchStart(fakeinfo);this.mouseDown=true};instanceProto.onMouseMove=function(info){if(!this.mouseDown){return};var t={pageX:info.pageX,pageY:info.pageY,"\x69\x64\x65\x6E\x74\x69\x66\x69\x65\x72":0};var fakeinfo={changedTouches:[t]};this.onTouchMove(fakeinfo)};instanceProto.onMouseUp=function(info){if(info.preventDefault&&this.runtime.had_a_click&&!this.runtime.isMobile){info.preventDefault()};this.runtime.had_a_click=true;var t={pageX:info.pageX,pageY:info.pageY,"\x69\x64\x65\x6E\x74\x69\x66\x69\x65\x72":0};var fakeinfo={changedTouches:[t]};this.onTouchEnd(fakeinfo);this.mouseDown=false};instanceProto.tick2=function(){var i,len,t;var nowtime=cr.performance_now();for(i=0,len=this.touches.length;i<len;++i){t=this.touches[i];if(t.time<=nowtime-50){t.lasttime=nowtime};t.maybeTriggerHold(this,i)}};function Cnds(){}Cnds.prototype.OnTouchStart=function(){return true};Cnds.prototype.OnTouchEnd=function(){return true};Cnds.prototype.IsInTouch=function(){return this.touches.length};Cnds.prototype.OnTouchObject=function(type){if(!type){return false};return this.runtime.testAndSelectCanvasPointOverlap(type,this.curTouchX,this.curTouchY,false)};var touching=[];Cnds.prototype.IsTouchingObject=function(type){if(!type){return false};var sol=type.getCurrentSol();var instances=sol.getObjects();var px,py;var i,leni,j,lenj;for(i=0,leni=instances.length;i<leni;i++){var inst=instances[i];inst.update_bbox();for(j=0,lenj=this.touches.length;j<lenj;j++){var touch=this.touches[j];px=inst.layer.canvasToLayer(touch.x,touch.y,true);py=inst.layer.canvasToLayer(touch.x,touch.y,false);if(inst.contains_pt(px,py)){touching.push(inst);break}}};if(touching.length){sol.select_all=false;cr.shallowAssignArray(sol.instances,touching);type.applySolToContainer();cr.clearArray(touching);return true}else{return false}};Cnds.prototype.CompareTouchSpeed=function(index,cmp,s){index=Math.floor(index);if(index<0||index>=this.touches.length){return false};var t=this.touches[index];var dist=cr.distanceTo(t.x,t.y,t.lastx,t.lasty);var timediff=(t.time-t.lasttime)/1000;var speed=0;if(timediff>0){speed=dist/timediff};return cr.do_cmp(speed,cmp,s)};Cnds.prototype.OrientationSupported=function(){return typeof window["\x44\x65\x76\x69\x63\x65\x4F\x72\x69\x65\x6E\x74\x61\x74\x69\x6F\x6E\x45\x76\x65\x6E\x74"]!=="\x75\x6E\x64\x65\x66\x69\x6E\x65\x64"};Cnds.prototype.MotionSupported=function(){return typeof window["\x44\x65\x76\x69\x63\x65\x4D\x6F\x74\x69\x6F\x6E\x45\x76\x65\x6E\x74"]!=="\x75\x6E\x64\x65\x66\x69\x6E\x65\x64"};Cnds.prototype.CompareOrientation=function(orientation_,cmp_,angle_){var v=0;if(orientation_===0){v=this.getAlpha()}else{if(orientation_===1){v=this.getBeta()}else{v=this.getGamma()}};return cr.do_cmp(v,cmp_,angle_)};Cnds.prototype.CompareAcceleration=function(acceleration_,cmp_,angle_){var v=0;if(acceleration_===0){v=this.acc_g_x}else{if(acceleration_===1){v=this.acc_g_y}else{if(acceleration_===2){v=this.acc_g_z}else{if(acceleration_===3){v=this.acc_x}else{if(acceleration_===4){v=this.acc_y}else{if(acceleration_===5){v=this.acc_z}}}}}};return cr.do_cmp(v,cmp_,angle_)};Cnds.prototype.OnNthTouchStart=function(touch_){touch_=Math.floor(touch_);return touch_===this.trigger_index};Cnds.prototype.OnNthTouchEnd=function(touch_){touch_=Math.floor(touch_);return touch_===this.trigger_index};Cnds.prototype.HasNthTouch=function(touch_){touch_=Math.floor(touch_);return this.touches.length>=touch_+1};Cnds.prototype.OnHoldGesture=function(){return true};Cnds.prototype.OnTapGesture=function(){return true};Cnds.prototype.OnDoubleTapGesture=function(){return true};Cnds.prototype.OnHoldGestureObject=function(type){if(!type){return false};return this.runtime.testAndSelectCanvasPointOverlap(type,this.curTouchX,this.curTouchY,false)};Cnds.prototype.OnTapGestureObject=function(type){if(!type){return false};return this.runtime.testAndSelectCanvasPointOverlap(type,this.curTouchX,this.curTouchY,false)};Cnds.prototype.OnDoubleTapGestureObject=function(type){if(!type){return false};return this.runtime.testAndSelectCanvasPointOverlap(type,this.curTouchX,this.curTouchY,false)};pluginProto.cnds=new Cnds();function Exps(){}Exps.prototype.TouchCount=function(ret){ret.set_int(this.touches.length)};Exps.prototype.X=function(ret,layerparam){var index=this.getTouchIndex;if(index<0||index>=this.touches.length){ret.set_float(0);return};var layer,oldScale,oldZoomRate,oldParallaxX,oldAngle;if(cr.is_undefined(layerparam)){layer=this.runtime.getLayerByNumber(0);oldScale=layer.scale;oldZoomRate=layer.zoomRate;oldParallaxX=layer.parallaxX;oldAngle=layer.angle;layer.scale=1;layer.zoomRate=1.0;layer.parallaxX=1.0;layer.angle=0;ret.set_float(layer.canvasToLayer(this.touches[index].x,this.touches[index].y,true));layer.scale=oldScale;layer.zoomRate=oldZoomRate;layer.parallaxX=oldParallaxX;layer.angle=oldAngle}else{if(cr.is_number(layerparam)){layer=this.runtime.getLayerByNumber(layerparam)}else{layer=this.runtime.getLayerByName(layerparam)};if(layer){ret.set_float(layer.canvasToLayer(this.touches[index].x,this.touches[index].y,true))}else{ret.set_float(0)}}};Exps.prototype.XAt=function(ret,index,layerparam){index=Math.floor(index);if(index<0||index>=this.touches.length){ret.set_float(0);return};var layer,oldScale,oldZoomRate,oldParallaxX,oldAngle;if(cr.is_undefined(layerparam)){layer=this.runtime.getLayerByNumber(0);oldScale=layer.scale;oldZoomRate=layer.zoomRate;oldParallaxX=layer.parallaxX;oldAngle=layer.angle;layer.scale=1;layer.zoomRate=1.0;layer.parallaxX=1.0;layer.angle=0;ret.set_float(layer.canvasToLayer(this.touches[index].x,this.touches[index].y,true));layer.scale=oldScale;layer.zoomRate=oldZoomRate;layer.parallaxX=oldParallaxX;layer.angle=oldAngle}else{if(cr.is_number(layerparam)){layer=this.runtime.getLayerByNumber(layerparam)}else{layer=this.runtime.getLayerByName(layerparam)};if(layer){ret.set_float(layer.canvasToLayer(this.touches[index].x,this.touches[index].y,true))}else{ret.set_float(0)}}};Exps.prototype.XForID=function(ret,id,layerparam){var index=this.findTouch(id);if(index<0){ret.set_float(0);return};var touch=this.touches[index];var layer,oldScale,oldZoomRate,oldParallaxX,oldAngle;if(cr.is_undefined(layerparam)){layer=this.runtime.getLayerByNumber(0);oldScale=layer.scale;oldZoomRate=layer.zoomRate;oldParallaxX=layer.parallaxX;oldAngle=layer.angle;layer.scale=1;layer.zoomRate=1.0;layer.parallaxX=1.0;layer.angle=0;ret.set_float(layer.canvasToLayer(touch.x,touch.y,true));layer.scale=oldScale;layer.zoomRate=oldZoomRate;layer.parallaxX=oldParallaxX;layer.angle=oldAngle}else{if(cr.is_number(layerparam)){layer=this.runtime.getLayerByNumber(layerparam)}else{layer=this.runtime.getLayerByName(layerparam)};if(layer){ret.set_float(layer.canvasToLayer(touch.x,touch.y,true))}else{ret.set_float(0)}}};Exps.prototype.Y=function(ret,layerparam){var index=this.getTouchIndex;if(index<0||index>=this.touches.length){ret.set_float(0);return};var layer,oldScale,oldZoomRate,oldParallaxY,oldAngle;if(cr.is_undefined(layerparam)){layer=this.runtime.getLayerByNumber(0);oldScale=layer.scale;oldZoomRate=layer.zoomRate;oldParallaxY=layer.parallaxY;oldAngle=layer.angle;layer.scale=1;layer.zoomRate=1.0;layer.parallaxY=1.0;layer.angle=0;ret.set_float(layer.canvasToLayer(this.touches[index].x,this.touches[index].y,false));layer.scale=oldScale;layer.zoomRate=oldZoomRate;layer.parallaxY=oldParallaxY;layer.angle=oldAngle}else{if(cr.is_number(layerparam)){layer=this.runtime.getLayerByNumber(layerparam)}else{layer=this.runtime.getLayerByName(layerparam)};if(layer){ret.set_float(layer.canvasToLayer(this.touches[index].x,this.touches[index].y,false))}else{ret.set_float(0)}}};Exps.prototype.YAt=function(ret,index,layerparam){index=Math.floor(index);if(index<0||index>=this.touches.length){ret.set_float(0);return};var layer,oldScale,oldZoomRate,oldParallaxY,oldAngle;if(cr.is_undefined(layerparam)){layer=this.runtime.getLayerByNumber(0);oldScale=layer.scale;oldZoomRate=layer.zoomRate;oldParallaxY=layer.parallaxY;oldAngle=layer.angle;layer.scale=1;layer.zoomRate=1.0;layer.parallaxY=1.0;layer.angle=0;ret.set_float(layer.canvasToLayer(this.touches[index].x,this.touches[index].y,false));layer.scale=oldScale;layer.zoomRate=oldZoomRate;layer.parallaxY=oldParallaxY;layer.angle=oldAngle}else{if(cr.is_number(layerparam)){layer=this.runtime.getLayerByNumber(layerparam)}else{layer=this.runtime.getLayerByName(layerparam)};if(layer){ret.set_float(layer.canvasToLayer(this.touches[index].x,this.touches[index].y,false))}else{ret.set_float(0)}}};Exps.prototype.YForID=function(ret,id,layerparam){var index=this.findTouch(id);if(index<0){ret.set_float(0);return};var touch=this.touches[index];var layer,oldScale,oldZoomRate,oldParallaxY,oldAngle;if(cr.is_undefined(layerparam)){layer=this.runtime.getLayerByNumber(0);oldScale=layer.scale;oldZoomRate=layer.zoomRate;oldParallaxY=layer.parallaxY;oldAngle=layer.angle;layer.scale=1;layer.zoomRate=1.0;layer.parallaxY=1.0;layer.angle=0;ret.set_float(layer.canvasToLayer(touch.x,touch.y,false));layer.scale=oldScale;layer.zoomRate=oldZoomRate;layer.parallaxY=oldParallaxY;layer.angle=oldAngle}else{if(cr.is_number(layerparam)){layer=this.runtime.getLayerByNumber(layerparam)}else{layer=this.runtime.getLayerByName(layerparam)};if(layer){ret.set_float(layer.canvasToLayer(touch.x,touch.y,false))}else{ret.set_float(0)}}};Exps.prototype.AbsoluteX=function(ret){if(this.touches.length){ret.set_float(this.touches[0].x)}else{ret.set_float(0)}};Exps.prototype.AbsoluteXAt=function(ret,index){index=Math.floor(index);if(index<0||index>=this.touches.length){ret.set_float(0);return};ret.set_float(this.touches[index].x)};Exps.prototype.AbsoluteXForID=function(ret,id){var index=this.findTouch(id);if(index<0){ret.set_float(0);return};var touch=this.touches[index];ret.set_float(touch.x)};Exps.prototype.AbsoluteY=function(ret){if(this.touches.length){ret.set_float(this.touches[0].y)}else{ret.set_float(0)}};Exps.prototype.AbsoluteYAt=function(ret,index){index=Math.floor(index);if(index<0||index>=this.touches.length){ret.set_float(0);return};ret.set_float(this.touches[index].y)};Exps.prototype.AbsoluteYForID=function(ret,id){var index=this.findTouch(id);if(index<0){ret.set_float(0);return};var touch=this.touches[index];ret.set_float(touch.y)};Exps.prototype.SpeedAt=function(ret,index){index=Math.floor(index);if(index<0||index>=this.touches.length){ret.set_float(0);return};var t=this.touches[index];var dist=cr.distanceTo(t.x,t.y,t.lastx,t.lasty);var timediff=(t.time-t.lasttime)/1000;if(timediff===0){ret.set_float(0)}else{ret.set_float(dist/timediff)}};Exps.prototype.SpeedForID=function(ret,id){var index=this.findTouch(id);if(index<0){ret.set_float(0);return};var touch=this.touches[index];var dist=cr.distanceTo(touch.x,touch.y,touch.lastx,touch.lasty);var timediff=(touch.time-touch.lasttime)/1000;if(timediff===0){ret.set_float(0)}else{ret.set_float(dist/timediff)}};Exps.prototype.AngleAt=function(ret,index){index=Math.floor(index);if(index<0||index>=this.touches.length){ret.set_float(0);return};var t=this.touches[index];ret.set_float(cr.to_degrees(cr.angleTo(t.lastx,t.lasty,t.x,t.y)))};Exps.prototype.AngleForID=function(ret,id){var index=this.findTouch(id);if(index<0){ret.set_float(0);return};var touch=this.touches[index];ret.set_float(cr.to_degrees(cr.angleTo(touch.lastx,touch.lasty,touch.x,touch.y)))};Exps.prototype.Alpha=function(ret){ret.set_float(this.getAlpha())};Exps.prototype.Beta=function(ret){ret.set_float(this.getBeta())};Exps.prototype.Gamma=function(ret){ret.set_float(this.getGamma())};Exps.prototype.AccelerationXWithG=function(ret){ret.set_float(this.acc_g_x)};Exps.prototype.AccelerationYWithG=function(ret){ret.set_float(this.acc_g_y)};Exps.prototype.AccelerationZWithG=function(ret){ret.set_float(this.acc_g_z)};Exps.prototype.AccelerationX=function(ret){ret.set_float(this.acc_x)};Exps.prototype.AccelerationY=function(ret){ret.set_float(this.acc_y)};Exps.prototype.AccelerationZ=function(ret){ret.set_float(this.acc_z)};Exps.prototype.TouchIndex=function(ret){ret.set_int(this.trigger_index)};Exps.prototype.TouchID=function(ret){ret.set_float(this.trigger_id)};pluginProto.exps=new Exps()}());;;;;cr.plugins_.WebStorage=function(runtime){this.runtime=runtime};(function(){var pluginProto=cr.plugins_.WebStorage.prototype;pluginProto.Type=function(plugin){this.plugin=plugin;this.runtime=plugin.runtime};var typeProto=pluginProto.Type.prototype;typeProto.onCreate=function(){};pluginProto.Instance=function(type){this.type=type;this.runtime=type.runtime};var instanceProto=pluginProto.Instance.prototype;var prefix="";var is_arcade=(typeof window["\x69\x73\x5F\x73\x63\x69\x72\x72\x61\x5F\x61\x72\x63\x61\x64\x65"]!=="\x75\x6E\x64\x65\x66\x69\x6E\x65\x64");if(is_arcade){prefix="\x61\x72\x63\x61\x64\x65"+window["\x73\x63\x69\x72\x72\x61\x5F\x61\x72\x63\x61\x64\x65\x5F\x69\x64"]};var isSupported=false;try{localStorage.getItem("\x74\x65\x73\x74");isSupported=true}catch(e){isSupported=false};instanceProto.onCreate=function(){if(!isSupported){cr.logexport("\x5B\x43\x6F\x6E\x73\x74\x72\x75\x63\x74\x20\x32\x5D\x20\x57\x65\x62\x73\x74\x6F\x72\x61\x67\x65\x20\x70\x6C\x75\x67\x69\x6E\x3A\x20\x6C\x6F\x63\x61\x6C\x20\x73\x74\x6F\x72\x61\x67\x65\x20\x69\x73\x20\x6E\x6F\x74\x20\x73\x75\x70\x70\x6F\x72\x74\x65\x64\x20\x6F\x6E\x20\x74\x68\x69\x73\x20\x70\x6C\x61\x74\x66\x6F\x72\x6D\x2E")}};function Cnds(){}Cnds.prototype.LocalStorageEnabled=function(){return isSupported};Cnds.prototype.SessionStorageEnabled=function(){return isSupported};Cnds.prototype.LocalStorageExists=function(key){if(!isSupported){return false};return localStorage.getItem(prefix+key)!=null};Cnds.prototype.SessionStorageExists=function(key){if(!isSupported){return false};return sessionStorage.getItem(prefix+key)!=null};Cnds.prototype.OnQuotaExceeded=function(){return true};Cnds.prototype.CompareKeyText=function(key,text_to_compare,case_sensitive){if(!isSupported){return false};var value=localStorage.getItem(prefix+key)||"";if(case_sensitive){return value==text_to_compare}else{return cr.equals_nocase(value,text_to_compare)}};Cnds.prototype.CompareKeyNumber=function(key,cmp,x){if(!isSupported){return false};var value=localStorage.getItem(prefix+key)||"";return cr.do_cmp(parseFloat(value),cmp,x)};pluginProto.cnds=new Cnds();function Acts(){}Acts.prototype.StoreLocal=function(key,data){if(!isSupported){return};try{localStorage.setItem(prefix+key,data)}catch(e){this.runtime.trigger(cr.plugins_.WebStorage.prototype.cnds.OnQuotaExceeded,this)}};Acts.prototype.StoreSession=function(key,data){if(!isSupported){return};try{sessionStorage.setItem(prefix+key,data)}catch(e){this.runtime.trigger(cr.plugins_.WebStorage.prototype.cnds.OnQuotaExceeded,this)}};Acts.prototype.RemoveLocal=function(key){if(!isSupported){return};localStorage.removeItem(prefix+key)};Acts.prototype.RemoveSession=function(key){if(!isSupported){return};sessionStorage.removeItem(prefix+key)};Acts.prototype.ClearLocal=function(){if(!isSupported){return};if(!is_arcade){localStorage.clear()}};Acts.prototype.ClearSession=function(){if(!isSupported){return};if(!is_arcade){sessionStorage.clear()}};Acts.prototype.JSONLoad=function(json_,mode_){if(!isSupported){return};var d;try{d=JSON.parse(json_)}catch(e){return};if(!d["\x63\x32\x64\x69\x63\x74\x69\x6F\x6E\x61\x72\x79"]){return};var o=d["\x64\x61\x74\x61"];if(mode_===0&&!is_arcade){localStorage.clear()};var p;for(p in o){if(o.hasOwnProperty(p)){try{localStorage.setItem(prefix+p,o[p])}catch(e){this.runtime.trigger(cr.plugins_.WebStorage.prototype.cnds.OnQuotaExceeded,this);return}}}};pluginProto.acts=new Acts();function Exps(){}Exps.prototype.LocalValue=function(ret,key){if(!isSupported){ret.set_string("");return};ret.set_string(localStorage.getItem(prefix+key)||"")};Exps.prototype.SessionValue=function(ret,key){if(!isSupported){ret.set_string("");return};ret.set_string(sessionStorage.getItem(prefix+key)||"")};Exps.prototype.LocalCount=function(ret){if(!isSupported){ret.set_int(0);return};ret.set_int(is_arcade?0:localStorage.length)};Exps.prototype.SessionCount=function(ret){if(!isSupported){ret.set_int(0);return};ret.set_int(is_arcade?0:sessionStorage.length)};Exps.prototype.LocalAt=function(ret,n){if(is_arcade||!isSupported){ret.set_string("")}else{ret.set_string(localStorage.getItem(localStorage.key(n))||"")}};Exps.prototype.SessionAt=function(ret,n){if(is_arcade||!isSupported){ret.set_string("")}else{ret.set_string(sessionStorage.getItem(sessionStorage.key(n))||"")}};Exps.prototype.LocalKeyAt=function(ret,n){if(is_arcade||!isSupported){ret.set_string("")}else{ret.set_string(localStorage.key(n)||"")}};Exps.prototype.SessionKeyAt=function(ret,n){if(is_arcade||!isSupported){ret.set_string("")}else{ret.set_string(sessionStorage.key(n)||"")}};Exps.prototype.AsJSON=function(ret){if(!isSupported){ret.set_string("");return};var o={},i,len,k;for(i=0,len=localStorage.length;i<len;i++){k=localStorage.key(i);if(is_arcade){if(k.substr(0,prefix.length)===prefix){o[k.substr(prefix.length)]=localStorage.getItem(k)}}else{o[k]=localStorage.getItem(k)}};ret.set_string(JSON.stringify({"\x63\x32\x64\x69\x63\x74\x69\x6F\x6E\x61\x72\x79":true,"\x64\x61\x74\x61":o}))};pluginProto.exps=new Exps()}());;;;;cr.behaviors.Bullet=function(runtime){this.runtime=runtime};(function(){var behaviorProto=cr.behaviors.Bullet.prototype;behaviorProto.Type=function(behavior,objtype){this.behavior=behavior;this.objtype=objtype;this.runtime=behavior.runtime};var behtypeProto=behaviorProto.Type.prototype;behtypeProto.onCreate=function(){};behaviorProto.Instance=function(type,inst){this.type=type;this.behavior=type.behavior;this.inst=inst;this.runtime=type.runtime};var behinstProto=behaviorProto.Instance.prototype;behinstProto.onCreate=function(){var speed=this.properties[0];this.acc=this.properties[1];this.g=this.properties[2];this.bounceOffSolid=(this.properties[3]!==0);this.setAngle=(this.properties[4]!==0);this.dx=Math.cos(this.inst.angle)*speed;this.dy=Math.sin(this.inst.angle)*speed;this.lastx=this.inst.x;this.lasty=this.inst.y;this.lastKnownAngle=this.inst.angle;this.travelled=0;this.enabled=(this.properties[5]!==0)};behinstProto.saveToJSON=function(){return{"\x61\x63\x63":this.acc,"\x67":this.g,"\x64\x78":this.dx,"\x64\x79":this.dy,"\x6C\x78":this.lastx,"\x6C\x79":this.lasty,"\x6C\x6B\x61":this.lastKnownAngle,"\x74":this.travelled,"\x65":this.enabled}};behinstProto.loadFromJSON=function(o){this.acc=o["\x61\x63\x63"];this.g=o["\x67"];this.dx=o["\x64\x78"];this.dy=o["\x64\x79"];this.lastx=o["\x6C\x78"];this.lasty=o["\x6C\x79"];this.lastKnownAngle=o["\x6C\x6B\x61"];this.travelled=o["\x74"];this.enabled=o["\x65"]};behinstProto.tick=function(){if(!this.enabled){return};var dt=this.runtime.getDt(this.inst);var s,a;var bounceSolid,bounceAngle;if(this.inst.angle!==this.lastKnownAngle){if(this.setAngle){s=cr.distanceTo(0,0,this.dx,this.dy);this.dx=Math.cos(this.inst.angle)*s;this.dy=Math.sin(this.inst.angle)*s};this.lastKnownAngle=this.inst.angle};if(this.acc!==0){s=cr.distanceTo(0,0,this.dx,this.dy);if(this.dx===0&&this.dy===0){a=this.inst.angle}else{a=cr.angleTo(0,0,this.dx,this.dy)};s+=this.acc*dt;if(s<0){s=0};this.dx=Math.cos(a)*s;this.dy=Math.sin(a)*s};if(this.g!==0){this.dy+=this.g*dt};this.lastx=this.inst.x;this.lasty=this.inst.y;if(this.dx!==0||this.dy!==0){this.inst.x+=this.dx*dt;this.inst.y+=this.dy*dt;this.travelled+=cr.distanceTo(0,0,this.dx*dt,this.dy*dt);if(this.setAngle){this.inst.angle=cr.angleTo(0,0,this.dx,this.dy);this.inst.set_bbox_changed();this.lastKnownAngle=this.inst.angle};this.inst.set_bbox_changed();if(this.bounceOffSolid){bounceSolid=this.runtime.testOverlapSolid(this.inst);if(bounceSolid){this.runtime.registerCollision(this.inst,bounceSolid);s=cr.distanceTo(0,0,this.dx,this.dy);bounceAngle=this.runtime.calculateSolidBounceAngle(this.inst,this.lastx,this.lasty);this.dx=Math.cos(bounceAngle)*s;this.dy=Math.sin(bounceAngle)*s;this.inst.x+=this.dx*dt;this.inst.y+=this.dy*dt;this.inst.set_bbox_changed();if(this.setAngle){this.inst.angle=bounceAngle;this.lastKnownAngle=bounceAngle;this.inst.set_bbox_changed()};if(!this.runtime.pushOutSolid(this.inst,this.dx/s,this.dy/s,Math.max(s*2.5*dt,30))){this.runtime.pushOutSolidNearest(this.inst,100)}}}}};function Cnds(){}Cnds.prototype.CompareSpeed=function(cmp,s){return cr.do_cmp(cr.distanceTo(0,0,this.dx,this.dy),cmp,s)};Cnds.prototype.CompareTravelled=function(cmp,d){return cr.do_cmp(this.travelled,cmp,d)};behaviorProto.cnds=new Cnds();function Acts(){}Acts.prototype.SetSpeed=function(s){var a=cr.angleTo(0,0,this.dx,this.dy);this.dx=Math.cos(a)*s;this.dy=Math.sin(a)*s};Acts.prototype.SetAcceleration=function(a){this.acc=a};Acts.prototype.SetGravity=function(g){this.g=g};Acts.prototype.SetAngleOfMotion=function(a){a=cr.to_radians(a);var s=cr.distanceTo(0,0,this.dx,this.dy);this.dx=Math.cos(a)*s;this.dy=Math.sin(a)*s};Acts.prototype.Bounce=function(objtype){if(!objtype){return};var otherinst=objtype.getFirstPicked(this.inst);if(!otherinst){return};var dt=this.runtime.getDt(this.inst);var s=cr.distanceTo(0,0,this.dx,this.dy);var bounceAngle=this.runtime.calculateSolidBounceAngle(this.inst,this.lastx,this.lasty,otherinst);this.dx=Math.cos(bounceAngle)*s;this.dy=Math.sin(bounceAngle)*s;this.inst.x+=this.dx*dt;this.inst.y+=this.dy*dt;this.inst.set_bbox_changed();if(this.setAngle){this.inst.angle=bounceAngle;this.lastKnownAngle=bounceAngle;this.inst.set_bbox_changed()};if(this.bounceOffSolid){if(!this.runtime.pushOutSolid(this.inst,this.dx/s,this.dy/s,Math.max(s*2.5*dt,30))){this.runtime.pushOutSolidNearest(this.inst,100)}}else{this.runtime.pushOut(this.inst,this.dx/s,this.dy/s,Math.max(s*2.5*dt,30),otherinst)}};Acts.prototype.SetDistanceTravelled=function(d){this.travelled=d};Acts.prototype.SetEnabled=function(en){this.enabled=(en===1)};behaviorProto.acts=new Acts();function Exps(){}Exps.prototype.Speed=function(ret){var s=cr.distanceTo(0,0,this.dx,this.dy);s=cr.round6dp(s);ret.set_float(s)};Exps.prototype.Acceleration=function(ret){ret.set_float(this.acc)};Exps.prototype.AngleOfMotion=function(ret){ret.set_float(cr.to_degrees(cr.angleTo(0,0,this.dx,this.dy)))};Exps.prototype.DistanceTravelled=function(ret){ret.set_float(this.travelled)};behaviorProto.exps=new Exps()}());;;;;cr.behaviors.Fade=function(runtime){this.runtime=runtime};(function(){var behaviorProto=cr.behaviors.Fade.prototype;behaviorProto.Type=function(behavior,objtype){this.behavior=behavior;this.objtype=objtype;this.runtime=behavior.runtime};var behtypeProto=behaviorProto.Type.prototype;behtypeProto.onCreate=function(){};behaviorProto.Instance=function(type,inst){this.type=type;this.behavior=type.behavior;this.inst=inst;this.runtime=type.runtime};var behinstProto=behaviorProto.Instance.prototype;behinstProto.onCreate=function(){this.activeAtStart=this.properties[0]===1;this.setMaxOpacity=false;this.fadeInTime=this.properties[1];this.waitTime=this.properties[2];this.fadeOutTime=this.properties[3];this.destroy=this.properties[4];this.stage=this.activeAtStart?0:3;if(this.recycled){this.stageTime.reset()}else{this.stageTime=new cr.KahanAdder()};this.maxOpacity=(this.inst.opacity?this.inst.opacity:1.0);if(this.activeAtStart){if(this.fadeInTime===0){this.stage=1;if(this.waitTime===0){this.stage=2}}else{this.inst.opacity=0;this.runtime.redraw=true}}};behinstProto.saveToJSON=function(){return{"\x66\x69\x74":this.fadeInTime,"\x77\x74":this.waitTime,"\x66\x6F\x74":this.fadeOutTime,"\x73":this.stage,"\x73\x74":this.stageTime.sum,"\x6D\x6F":this.maxOpacity}};behinstProto.loadFromJSON=function(o){this.fadeInTime=o["\x66\x69\x74"];this.waitTime=o["\x77\x74"];this.fadeOutTime=o["\x66\x6F\x74"];this.stage=o["\x73"];this.stageTime.reset();this.stageTime.sum=o["\x73\x74"];this.maxOpacity=o["\x6D\x6F"]};behinstProto.tick=function(){this.stageTime.add(this.runtime.getDt(this.inst));if(this.stage===0){this.inst.opacity=(this.stageTime.sum/this.fadeInTime)*this.maxOpacity;this.runtime.redraw=true;if(this.inst.opacity>=this.maxOpacity){this.inst.opacity=this.maxOpacity;this.stage=1;this.stageTime.reset();this.runtime.trigger(cr.behaviors.Fade.prototype.cnds.OnFadeInEnd,this.inst)}};if(this.stage===1){if(this.stageTime.sum>=this.waitTime){this.stage=2;this.stageTime.reset();this.runtime.trigger(cr.behaviors.Fade.prototype.cnds.OnWaitEnd,this.inst)}};if(this.stage===2){if(this.fadeOutTime!==0){this.inst.opacity=this.maxOpacity-((this.stageTime.sum/this.fadeOutTime)*this.maxOpacity);this.runtime.redraw=true;if(this.inst.opacity<0){this.inst.opacity=0;this.stage=3;this.stageTime.reset();this.runtime.trigger(cr.behaviors.Fade.prototype.cnds.OnFadeOutEnd,this.inst);if(this.destroy===1){this.runtime.DestroyInstance(this.inst)}}}}};behinstProto.doStart=function(){this.stage=0;this.stageTime.reset();if(this.fadeInTime===0){this.stage=1;if(this.waitTime===0){this.stage=2}}else{this.inst.opacity=0;this.runtime.redraw=true}};function Cnds(){}Cnds.prototype.OnFadeOutEnd=function(){return true};Cnds.prototype.OnFadeInEnd=function(){return true};Cnds.prototype.OnWaitEnd=function(){return true};behaviorProto.cnds=new Cnds();function Acts(){}Acts.prototype.StartFade=function(){if(!this.activeAtStart&&!this.setMaxOpacity){this.maxOpacity=(this.inst.opacity?this.inst.opacity:1.0);this.setMaxOpacity=true};if(this.stage===3){this.doStart()}};Acts.prototype.RestartFade=function(){this.doStart()};Acts.prototype.SetFadeInTime=function(t){if(t<0){t=0};this.fadeInTime=t};Acts.prototype.SetWaitTime=function(t){if(t<0){t=0};this.waitTime=t};Acts.prototype.SetFadeOutTime=function(t){if(t<0){t=0};this.fadeOutTime=t};behaviorProto.acts=new Acts();function Exps(){}Exps.prototype.FadeInTime=function(ret){ret.set_float(this.fadeInTime)};Exps.prototype.WaitTime=function(ret){ret.set_float(this.waitTime)};Exps.prototype.FadeOutTime=function(ret){ret.set_float(this.fadeOutTime)};behaviorProto.exps=new Exps()}());;;;;cr.behaviors.Flash=function(runtime){this.runtime=runtime};(function(){var behaviorProto=cr.behaviors.Flash.prototype;behaviorProto.Type=function(behavior,objtype){this.behavior=behavior;this.objtype=objtype;this.runtime=behavior.runtime};var behtypeProto=behaviorProto.Type.prototype;behtypeProto.onCreate=function(){};behaviorProto.Instance=function(type,inst){this.type=type;this.behavior=type.behavior;this.inst=inst;this.runtime=type.runtime};var behinstProto=behaviorProto.Instance.prototype;behinstProto.onCreate=function(){this.ontime=0;this.offtime=0;this.stage=0;this.stagetimeleft=0;this.timeleft=0};behinstProto.saveToJSON=function(){return{"\x6F\x6E\x74\x69\x6D\x65":this.ontime,"\x6F\x66\x66\x74\x69\x6D\x65":this.offtime,"\x73\x74\x61\x67\x65":this.stage,"\x73\x74\x61\x67\x65\x74\x69\x6D\x65\x6C\x65\x66\x74":this.stagetimeleft,"\x74\x69\x6D\x65\x6C\x65\x66\x74":this.timeleft}};behinstProto.loadFromJSON=function(o){this.ontime=o["\x6F\x6E\x74\x69\x6D\x65"];this.offtime=o["\x6F\x66\x66\x74\x69\x6D\x65"];this.stage=o["\x73\x74\x61\x67\x65"];this.stagetimeleft=o["\x73\x74\x61\x67\x65\x74\x69\x6D\x65\x6C\x65\x66\x74"];this.timeleft=o["\x74\x69\x6D\x65\x6C\x65\x66\x74"]};behinstProto.tick=function(){if(this.timeleft<=0){return};var dt=this.runtime.getDt(this.inst);this.timeleft-=dt;if(this.timeleft<=0){this.timeleft=0;this.inst.visible=true;this.runtime.redraw=true;this.runtime.trigger(cr.behaviors.Flash.prototype.cnds.OnFlashEnded,this.inst);return};this.stagetimeleft-=dt;if(this.stagetimeleft<=0){if(this.stage===0){this.inst.visible=false;this.stage=1;this.stagetimeleft+=this.offtime}else{this.inst.visible=true;this.stage=0;this.stagetimeleft+=this.ontime};this.runtime.redraw=true}};function Cnds(){}Cnds.prototype.IsFlashing=function(){return this.timeleft>0};Cnds.prototype.OnFlashEnded=function(){return true};behaviorProto.cnds=new Cnds();function Acts(){}Acts.prototype.Flash=function(on_,off_,dur_){this.ontime=on_;this.offtime=off_;this.stage=1;this.stagetimeleft=off_;this.timeleft=dur_;this.inst.visible=false;this.runtime.redraw=true};Acts.prototype.StopFlashing=function(){this.timeleft=0;this.inst.visible=true;this.runtime.redraw=true;return};behaviorProto.acts=new Acts();function Exps(){}behaviorProto.exps=new Exps()}());;;;;cr.behaviors.Pin=function(runtime){this.runtime=runtime};(function(){var behaviorProto=cr.behaviors.Pin.prototype;behaviorProto.Type=function(behavior,objtype){this.behavior=behavior;this.objtype=objtype;this.runtime=behavior.runtime};var behtypeProto=behaviorProto.Type.prototype;behtypeProto.onCreate=function(){};behaviorProto.Instance=function(type,inst){this.type=type;this.behavior=type.behavior;this.inst=inst;this.runtime=type.runtime};var behinstProto=behaviorProto.Instance.prototype;behinstProto.onCreate=function(){this.pinObject=null;this.pinObjectUid=-1;this.pinAngle=0;this.pinDist=0;this.myStartAngle=0;this.theirStartAngle=0;this.lastKnownAngle=0;this.mode=0;var self=this;if(!this.recycled){this.myDestroyCallback=(function(inst){self.onInstanceDestroyed(inst)})};this.runtime.addDestroyCallback(this.myDestroyCallback)};behinstProto.saveToJSON=function(){return{"\x75\x69\x64":this.pinObject?this.pinObject.uid:-1,"\x70\x61":this.pinAngle,"\x70\x64":this.pinDist,"\x6D\x73\x61":this.myStartAngle,"\x74\x73\x61":this.theirStartAngle,"\x6C\x6B\x61":this.lastKnownAngle,"\x6D":this.mode}};behinstProto.loadFromJSON=function(o){this.pinObjectUid=o["\x75\x69\x64"];this.pinAngle=o["\x70\x61"];this.pinDist=o["\x70\x64"];this.myStartAngle=o["\x6D\x73\x61"];this.theirStartAngle=o["\x74\x73\x61"];this.lastKnownAngle=o["\x6C\x6B\x61"];this.mode=o["\x6D"]};behinstProto.afterLoad=function(){if(this.pinObjectUid===-1){this.pinObject=null}else{this.pinObject=this.runtime.getObjectByUID(this.pinObjectUid);;};this.pinObjectUid=-1};behinstProto.onInstanceDestroyed=function(inst){if(this.pinObject==inst){this.pinObject=null}};behinstProto.onDestroy=function(){this.pinObject=null;this.runtime.removeDestroyCallback(this.myDestroyCallback)};behinstProto.tick=function(){};behinstProto.tick2=function(){if(!this.pinObject){return};if(this.lastKnownAngle!==this.inst.angle){this.myStartAngle=cr.clamp_angle(this.myStartAngle+(this.inst.angle-this.lastKnownAngle))};var newx=this.inst.x;var newy=this.inst.y;if(this.mode===3||this.mode===4){var dist=cr.distanceTo(this.inst.x,this.inst.y,this.pinObject.x,this.pinObject.y);if((dist>this.pinDist)||(this.mode===4&&dist<this.pinDist)){var a=cr.angleTo(this.pinObject.x,this.pinObject.y,this.inst.x,this.inst.y);newx=this.pinObject.x+Math.cos(a)*this.pinDist;newy=this.pinObject.y+Math.sin(a)*this.pinDist}}else{newx=this.pinObject.x+Math.cos(this.pinObject.angle+this.pinAngle)*this.pinDist;newy=this.pinObject.y+Math.sin(this.pinObject.angle+this.pinAngle)*this.pinDist};var newangle=cr.clamp_angle(this.myStartAngle+(this.pinObject.angle-this.theirStartAngle));this.lastKnownAngle=newangle;if((this.mode===0||this.mode===1||this.mode===3||this.mode===4)&&(this.inst.x!==newx||this.inst.y!==newy)){this.inst.x=newx;this.inst.y=newy;this.inst.set_bbox_changed()};if((this.mode===0||this.mode===2)&&(this.inst.angle!==newangle)){this.inst.angle=newangle;this.inst.set_bbox_changed()}};function Cnds(){}Cnds.prototype.IsPinned=function(){return!!this.pinObject};behaviorProto.cnds=new Cnds();function Acts(){}Acts.prototype.Pin=function(obj,mode_){if(!obj){return};var otherinst=obj.getFirstPicked(this.inst);if(!otherinst){return};this.pinObject=otherinst;this.pinAngle=cr.angleTo(otherinst.x,otherinst.y,this.inst.x,this.inst.y)-otherinst.angle;this.pinDist=cr.distanceTo(otherinst.x,otherinst.y,this.inst.x,this.inst.y);this.myStartAngle=this.inst.angle;this.lastKnownAngle=this.inst.angle;this.theirStartAngle=otherinst.angle;this.mode=mode_};Acts.prototype.Unpin=function(){this.pinObject=null};behaviorProto.acts=new Acts();function Exps(){}Exps.prototype.PinnedUID=function(ret){ret.set_int(this.pinObject?this.pinObject.uid:-1)};behaviorProto.exps=new Exps()}());;;;;cr.behaviors.Rotate=function(runtime){this.runtime=runtime};(function(){var behaviorProto=cr.behaviors.Rotate.prototype;behaviorProto.Type=function(behavior,objtype){this.behavior=behavior;this.objtype=objtype;this.runtime=behavior.runtime};var behtypeProto=behaviorProto.Type.prototype;behtypeProto.onCreate=function(){};behaviorProto.Instance=function(type,inst){this.type=type;this.behavior=type.behavior;this.inst=inst;this.runtime=type.runtime};var behinstProto=behaviorProto.Instance.prototype;behinstProto.onCreate=function(){this.speed=cr.to_radians(this.properties[0]);this.acc=cr.to_radians(this.properties[1])};behinstProto.saveToJSON=function(){return{"\x73\x70\x65\x65\x64":this.speed,"\x61\x63\x63":this.acc}};behinstProto.loadFromJSON=function(o){this.speed=o["\x73\x70\x65\x65\x64"];this.acc=o["\x61\x63\x63"]};behinstProto.tick=function(){var dt=this.runtime.getDt(this.inst);if(dt===0){return};if(this.acc!==0){this.speed+=this.acc*dt};if(this.speed!==0){this.inst.angle=cr.clamp_angle(this.inst.angle+this.speed*dt);this.inst.set_bbox_changed()}};function Cnds(){}behaviorProto.cnds=new Cnds();function Acts(){}Acts.prototype.SetSpeed=function(s){this.speed=cr.to_radians(s)};Acts.prototype.SetAcceleration=function(a){this.acc=cr.to_radians(a)};behaviorProto.acts=new Acts();function Exps(){}Exps.prototype.Speed=function(ret){ret.set_float(cr.to_degrees(this.speed))};Exps.prototype.Acceleration=function(ret){ret.set_float(cr.to_degrees(this.acc))};behaviorProto.exps=new Exps()}());;;;;cr.behaviors.Sin=function(runtime){this.runtime=runtime};(function(){var behaviorProto=cr.behaviors.Sin.prototype;behaviorProto.Type=function(behavior,objtype){this.behavior=behavior;this.objtype=objtype;this.runtime=behavior.runtime};var behtypeProto=behaviorProto.Type.prototype;behtypeProto.onCreate=function(){};behaviorProto.Instance=function(type,inst){this.type=type;this.behavior=type.behavior;this.inst=inst;this.runtime=type.runtime;this.i=0};var behinstProto=behaviorProto.Instance.prototype;var _2pi=2*Math.PI;var _pi_2=Math.PI/2;var _3pi_2=(3*Math.PI)/2;behinstProto.onCreate=function(){this.active=(this.properties[0]===1);this.movement=this.properties[1];this.wave=this.properties[2];this.period=this.properties[3];this.period+=Math.random()*this.properties[4];if(this.period===0){this.i=0}else{this.i=(this.properties[5]/this.period)*_2pi;this.i+=((Math.random()*this.properties[6])/this.period)*_2pi};this.mag=this.properties[7];this.mag+=Math.random()*this.properties[8];this.initialValue=0;this.initialValue2=0;this.ratio=0;this.init()};behinstProto.saveToJSON=function(){return{"\x69":this.i,"\x61":this.active,"\x6D\x76":this.movement,"\x77":this.wave,"\x70":this.period,"\x6D\x61\x67":this.mag,"\x69\x76":this.initialValue,"\x69\x76\x32":this.initialValue2,"\x72":this.ratio,"\x6C\x6B\x76":this.lastKnownValue,"\x6C\x6B\x76\x32":this.lastKnownValue2}};behinstProto.loadFromJSON=function(o){this.i=o["\x69"];this.active=o["\x61"];this.movement=o["\x6D\x76"];this.wave=o["\x77"];this.period=o["\x70"];this.mag=o["\x6D\x61\x67"];this.initialValue=o["\x69\x76"];this.initialValue2=o["\x69\x76\x32"]||0;this.ratio=o["\x72"];this.lastKnownValue=o["\x6C\x6B\x76"];this.lastKnownValue2=o["\x6C\x6B\x76\x32"]||0};behinstProto.init=function(){switch(this.movement){case 0:this.initialValue=this.inst.x;break;case 1:this.initialValue=this.inst.y;break;case 2:this.initialValue=this.inst.width;this.ratio=this.inst.height/this.inst.width;break;case 3:this.initialValue=this.inst.width;break;case 4:this.initialValue=this.inst.height;break;case 5:this.initialValue=this.inst.angle;this.mag=cr.to_radians(this.mag);break;case 6:this.initialValue=this.inst.opacity;break;case 7:this.initialValue=0;break;case 8:this.initialValue=this.inst.x;this.initialValue2=this.inst.y;break;default:;};this.lastKnownValue=this.initialValue;this.lastKnownValue2=this.initialValue2};behinstProto.waveFunc=function(x){x=x%_2pi;switch(this.wave){case 0:return Math.sin(x);case 1:if(x<=_pi_2){return x/_pi_2}else{if(x<=_3pi_2){return 1-(2*(x-_pi_2)/Math.PI)}else{return(x-_3pi_2)/_pi_2-1}};case 2:return 2*x/_2pi-1;case 3:return-2*x/_2pi+1;case 4:return x<Math.PI?-1:1};return 0};behinstProto.tick=function(){var dt=this.runtime.getDt(this.inst);if(!this.active||dt===0){return};if(this.period===0){this.i=0}else{this.i+=(dt/this.period)*_2pi;this.i=this.i%_2pi};switch(this.movement){case 0:if(this.inst.x!==this.lastKnownValue){this.initialValue+=this.inst.x-this.lastKnownValue};this.inst.x=this.initialValue+this.waveFunc(this.i)*this.mag;this.lastKnownValue=this.inst.x;break;case 1:if(this.inst.y!==this.lastKnownValue){this.initialValue+=this.inst.y-this.lastKnownValue};this.inst.y=this.initialValue+this.waveFunc(this.i)*this.mag;this.lastKnownValue=this.inst.y;break;case 2:this.inst.width=this.initialValue+this.waveFunc(this.i)*this.mag;this.inst.height=this.inst.width*this.ratio;break;case 3:this.inst.width=this.initialValue+this.waveFunc(this.i)*this.mag;break;case 4:this.inst.height=this.initialValue+this.waveFunc(this.i)*this.mag;break;case 5:if(this.inst.angle!==this.lastKnownValue){this.initialValue=cr.clamp_angle(this.initialValue+(this.inst.angle-this.lastKnownValue))};this.inst.angle=cr.clamp_angle(this.initialValue+this.waveFunc(this.i)*this.mag);this.lastKnownValue=this.inst.angle;break;case 6:this.inst.opacity=this.initialValue+(this.waveFunc(this.i)*this.mag)/100;if(this.inst.opacity<0){this.inst.opacity=0}else{if(this.inst.opacity>1){this.inst.opacity=1}};break;case 8:if(this.inst.x!==this.lastKnownValue){this.initialValue+=this.inst.x-this.lastKnownValue};if(this.inst.y!==this.lastKnownValue2){this.initialValue2+=this.inst.y-this.lastKnownValue2};this.inst.x=this.initialValue+Math.cos(this.inst.angle)*this.waveFunc(this.i)*this.mag;this.inst.y=this.initialValue2+Math.sin(this.inst.angle)*this.waveFunc(this.i)*this.mag;this.lastKnownValue=this.inst.x;this.lastKnownValue2=this.inst.y;break};this.inst.set_bbox_changed()};behinstProto.onSpriteFrameChanged=function(prev_frame,next_frame){switch(this.movement){case 2:this.initialValue*=(next_frame.width/prev_frame.width);this.ratio=next_frame.height/next_frame.width;break;case 3:this.initialValue*=(next_frame.width/prev_frame.width);break;case 4:this.initialValue*=(next_frame.height/prev_frame.height);break}};function Cnds(){}Cnds.prototype.IsActive=function(){return this.active};Cnds.prototype.CompareMovement=function(m){return this.movement===m};Cnds.prototype.ComparePeriod=function(cmp,v){return cr.do_cmp(this.period,cmp,v)};Cnds.prototype.CompareMagnitude=function(cmp,v){if(this.movement===5){return cr.do_cmp(this.mag,cmp,cr.to_radians(v))}else{return cr.do_cmp(this.mag,cmp,v)}};Cnds.prototype.CompareWave=function(w){return this.wave===w};behaviorProto.cnds=new Cnds();function Acts(){}Acts.prototype.SetActive=function(a){this.active=(a===1)};Acts.prototype.SetPeriod=function(x){this.period=x};Acts.prototype.SetMagnitude=function(x){this.mag=x;if(this.movement===5){this.mag=cr.to_radians(this.mag)}};Acts.prototype.SetMovement=function(m){if(this.movement===5){this.mag=cr.to_degrees(this.mag)};this.movement=m;this.init()};Acts.prototype.SetWave=function(w){this.wave=w};Acts.prototype.SetPhase=function(x){this.i=(x*_2pi)%_2pi};Acts.prototype.UpdateInitialState=function(){this.init()};behaviorProto.acts=new Acts();function Exps(){}Exps.prototype.CyclePosition=function(ret){ret.set_float(this.i/_2pi)};Exps.prototype.Period=function(ret){ret.set_float(this.period)};Exps.prototype.Magnitude=function(ret){if(this.movement===5){ret.set_float(cr.to_degrees(this.mag))}else{ret.set_float(this.mag)}};Exps.prototype.Value=function(ret){ret.set_float(this.waveFunc(this.i)*this.mag)};behaviorProto.exps=new Exps()}());cr.getObjectRefTable=function(){return[cr.plugins_.Browser,cr.plugins_.Audio,cr.plugins_.Cocoon_Canvasplus,cr.plugins_.Keyboard,cr.plugins_.Mouse,cr.plugins_.Sprite,cr.plugins_.Spritefont2,cr.plugins_.TiledBg,cr.plugins_.Touch,cr.plugins_.WebStorage,cr.behaviors.Rotate,cr.behaviors.Fade,cr.behaviors.Sin,cr.behaviors.Pin,cr.behaviors.Bullet,cr.behaviors.Flash,cr.system_object.prototype.cnds.OnLayoutStart,cr.system_object.prototype.acts.SetGroupActive,cr.system_object.prototype.acts.SetVar,cr.plugins_.Sprite.prototype.acts.SetInstanceVar,cr.plugins_.Sprite.prototype.acts.SetPos,cr.plugins_.Spritefont2.prototype.acts.SetPos,cr.plugins_.Sprite.prototype.acts.SetY,cr.system_object.prototype.cnds.EveryTick,cr.system_object.prototype.cnds.CompareVar,cr.plugins_.Spritefont2.prototype.acts.SetText,cr.plugins_.Sprite.prototype.acts.SetPosToObject,cr.behaviors.Bullet.prototype.acts.SetEnabled,cr.plugins_.Sprite.prototype.exps.Y,cr.plugins_.Mouse.prototype.cnds.IsOverObject,cr.plugins_.Sprite.prototype.acts.SetTowardPosition,cr.plugins_.Mouse.prototype.exps.X,cr.plugins_.Mouse.prototype.exps.Y,cr.plugins_.Sprite.prototype.cnds.CompareInstanceVar,cr.plugins_.Sprite.prototype.cnds.IsBoolInstanceVarSet,cr.plugins_.Sprite.prototype.acts.SetX,cr.plugins_.Sprite.prototype.exps.X,cr.behaviors.Sin.prototype.acts.SetActive,cr.system_object.prototype.cnds.IsGroupActive,cr.plugins_.Touch.prototype.cnds.OnTouchObject,cr.behaviors.Sin.prototype.cnds.IsActive,cr.plugins_.Audio.prototype.acts.Play,cr.behaviors.Fade.prototype.acts.StartFade,cr.plugins_.Mouse.prototype.cnds.OnObjectClicked,cr.plugins_.Sprite.prototype.cnds.OnDestroyed,cr.system_object.prototype.cnds.Every,cr.system_object.prototype.acts.SubVar,cr.system_object.prototype.acts.AddVar,cr.system_object.prototype.acts.CreateObject,cr.system_object.prototype.exps.viewportright,cr.system_object.prototype.exps.viewportbottom,cr.plugins_.WebStorage.prototype.acts.StoreLocal,cr.system_object.prototype.acts.WaitForSignal,cr.system_object.prototype.acts.GoToLayout,cr.plugins_.Sprite.prototype.acts.Spawn,cr.plugins_.Sprite.prototype.acts.Destroy,cr.plugins_.Touch.prototype.cnds.IsTouchingObject,cr.plugins_.Touch.prototype.exps.X,cr.plugins_.Touch.prototype.exps.Y,cr.plugins_.Sprite.prototype.acts.SetAnim,cr.plugins_.Sprite.prototype.acts.StartAnim,cr.behaviors.Bullet.prototype.acts.SetAngleOfMotion,cr.plugins_.Sprite.prototype.exps.Angle,cr.behaviors.Pin.prototype.acts.Pin,cr.system_object.prototype.exps.round,cr.system_object.prototype.exps.random,cr.plugins_.Keyboard.prototype.cnds.IsKeyDown,cr.plugins_.Sprite.prototype.cnds.CompareX,cr.plugins_.Sprite.prototype.acts.SetMirrored,cr.plugins_.Sprite.prototype.acts.SetAngle,cr.plugins_.Sprite.prototype.acts.StopAnim,cr.plugins_.Keyboard.prototype.cnds.OnKey,cr.system_object.prototype.exps.str,cr.plugins_.Sprite.prototype.acts.SetBoolInstanceVar,cr.plugins_.Sprite.prototype.cnds.OnCollision,cr.behaviors.Flash.prototype.acts.Flash,cr.plugins_.Sprite.prototype.cnds.IsOutsideLayout,cr.plugins_.Sprite.prototype.cnds.OnAnyAnimFinished,cr.plugins_.Sprite.prototype.acts.SetAnimFrame,cr.plugins_.Sprite.prototype.exps.AnimationFrame,cr.plugins_.Sprite.prototype.acts.MoveToBottom,cr.plugins_.Sprite.prototype.cnds.CompareFrame,cr.plugins_.WebStorage.prototype.cnds.LocalStorageExists,cr.plugins_.WebStorage.prototype.exps.LocalValue,cr.system_object.prototype.exps.loadingprogress,cr.system_object.prototype.cnds.OnLoadFinished,cr.plugins_.Audio.prototype.acts.Preload,cr.system_object.prototype.acts.SetLayerOpacity,cr.system_object.prototype.acts.SetTimescale,cr.plugins_.Spritefont2.prototype.cnds.CompareInstanceVar,cr.plugins_.TiledBg.prototype.acts.SetX,cr.plugins_.TiledBg.prototype.exps.X,cr.plugins_.Sprite.prototype.acts.SetWidth,cr.system_object.prototype.exps.distance,cr.system_object.prototype.cnds.Compare,cr.system_object.prototype.exps.clamp,cr.system_object.prototype.exps.log10,cr.plugins_.Audio.prototype.acts.SetVolume,cr.system_object.prototype.cnds.Else,cr.system_object.prototype.acts.RestartLayout,cr.plugins_.Browser.prototype.acts.RequestFullScreen,cr.system_object.prototype.acts.Wait,cr.plugins_.Browser.prototype.acts.CancelFullScreen,cr.plugins_.Browser.prototype.acts.GoToURLWindow,cr.plugins_.Cocoon_Canvasplus.prototype.cnds.isCanvasPlus,cr.plugins_.Cocoon_Canvasplus.prototype.acts.exitApp,cr.plugins_.Browser.prototype.acts.Close,cr.plugins_.Mouse.prototype.cnds.IsButtonDown,cr.plugins_.Mouse.prototype.acts.SetCursorSprite,cr.plugins_.Sprite.prototype.acts.SetSize,cr.plugins_.Sprite.prototype.cnds.CompareAnimSpeed,cr.system_object.prototype.cnds.TriggerOnce,cr.system_object.prototype.acts.SetLayerScale,cr.system_object.prototype.exps.lerp,cr.system_object.prototype.exps.layeropacity,cr.system_object.prototype.exps.layerscale,cr.plugins_.TiledBg.prototype.cnds.CompareX,cr.plugins_.TiledBg.prototype.exps.Width,cr.system_object.prototype.cnds.LayerCmpOpacity,cr.system_object.prototype.acts.Signal]}